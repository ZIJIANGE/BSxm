(function(n,t){typeof exports=="object"&&typeof module=="object"?module.exports=t(require("echarts")):typeof define=="function"&&define.amd?define(["echarts"],t):typeof exports=="object"?exports["echarts-gl"]=t(require("echarts")):n["echarts-gl"]=t(n.echarts)})(this,function(n){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(n){var i=n&&n.__esModule?function(){return n["default"]}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=106)}([function(t){t.exports=n},function(n,t,i){"use strict";function bi(n){return!n||n==="none"}function a(n){return n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof Image}function ki(n){return n.getZr&&n.setOption}function w(n){return Math.pow(2,Math.round(Math.log(n)/Math.LN2))}function b(n){var i,r,t,u;(n.wrapS===o.a.REPEAT||n.wrapT===o.a.REPEAT)&&n.image&&(i=w(n.width),r=w(n.height),(i!==n.width||r!==n.height)&&(t=document.createElement("canvas"),t.width=i,t.height=r,u=t.getContext("2d"),u.drawImage(n.image,0,0,i,r),n.image=t))}var k=i(40),d=i(52),g=i(5),o=i(4),u=i(8),s=i(19),c=i(35),nt=i(15),tt=i(0),l=i.n(tt),e=i(36),it=i(60),rt=i.n(it),h=i(61),ut=i(124),ft=i(125),et=i(129),ot=i(130),f=i(2),st=i(132),ht=i(43),ct=i(76),lt=i(133),at=i(134),vt=i(135),yt=i(136),pt=i(41),wt=i(37),bt=i(26),kt=i(3),dt=i(137),gt=i(56),ni=i(138),ti=i(139),ii=i(140),ri=i(9),ui=i(74),fi=i(54),ei=i(18),oi=i(59),si=i(141),hi=i(146),ci=i(71),li=i(147),ai=i(148),vi=i(149),yi=i(150),pi=i(151),wi=i(152),v,y,r,p;l.a.util.extend(c.a.prototype,si.a);u.a.import(hi.a);u.a.import(ci.a);u.a.import(li.a);u.a.import(ai.a);u.a.import(vi.a);u.a.import(yi.a);u.a.import(pi.a);u.a.import(wi.a);v=e.a.prototype.addToScene;y=e.a.prototype.removeFromScene;e.a.prototype.addToScene=function(n){if(v.call(this,n),this.__zr){var t=this.__zr;n.traverse(function(n){n.__zr=t;n.addAnimatorsToZr&&n.addAnimatorsToZr(t)})}};e.a.prototype.removeFromScene=function(n){y.call(this,n);n.traverse(function(n){var t=n.__zr;n.__zr=null;t&&n.removeAnimatorsFromZr&&n.removeAnimatorsFromZr(t)})};s.a.prototype.setTextureImage=function(n,t,i,u){if(this.shader){var o=i.getZr(),f=this,e;return f.autoUpdateTextureStatus=!1,f.disableTexture(n),bi(t)||(e=r.loadTexture(t,i,u,function(){f.enableTexture(n);o&&o.refresh()}),f.set(n,e)),e}};r={};r.Renderer=d.a;r.Node=c.a;r.Mesh=k.a;r.Shader=u.a;r.Material=s.a;r.Texture=o.a;r.Texture2D=g.a;r.Geometry=nt.a;r.SphereGeometry=st.a;r.PlaneGeometry=ht.a;r.CubeGeometry=ct.a;r.AmbientLight=lt.a;r.DirectionalLight=at.a;r.PointLight=vt.a;r.SpotLight=yt.a;r.PerspectiveCamera=pt.a;r.OrthographicCamera=wt.a;r.Vector2=bt.a;r.Vector3=kt.a;r.Vector4=dt.a;r.Quaternion=gt.a;r.Matrix2=ni.a;r.Matrix2d=ti.a;r.Matrix3=ii.a;r.Matrix4=ri.a;r.Plane=ui.a;r.Ray=fi.a;r.BoundingBox=ei.a;r.Frustum=oi.a;p=h.a.createBlank("rgba(255,255,255,0)").image;r.loadTexture=function(n,t,i,u){var o,l,v,w,c,f,s,e,y;for(typeof i=="function"&&(u=i,i={}),i=i||{},o=Object.keys(i).sort(),l="",e=0;e<o.length;e++)l+=o[e]+"_"+i[o[e]]+"_";if(v=t.__textureCache=t.__textureCache||new rt.a(20),ki(n)){if(c=n.__textureid__,f=v.get(l+c),f)f.texture.surface.setECharts(n),u&&u(f.texture);else{for(w=new ut.a(n),w.onupdate=function(){t.getZr().refresh()},f={texture:w.getTexture()},e=0;e<o.length;e++)f.texture[o[e]]=i[o[e]];c=n.__textureid__||"__ecgl_ec__"+f.texture.__uid__;n.__textureid__=c;v.put(l+c,f);u&&u(f.texture)}return f.texture}if(a(n)){if(c=n.__textureid__,f=v.get(l+c),!f){for(f={texture:new r.Texture2D({image:n})},e=0;e<o.length;e++)f.texture[o[e]]=i[o[e]];c=n.__textureid__||"__ecgl_image__"+f.texture.__uid__;n.__textureid__=c;v.put(l+c,f);b(f.texture);u&&u(f.texture)}return f.texture}if(f=v.get(l+n),f)f.callbacks?f.callbacks.push(u):u&&u(f.texture);else if(n.match(/.hdr$|^data:application\/octet-stream/))f={callbacks:[u]},s=h.a.loadTexture(n,{exposure:i.exposure,fileType:"hdr"},function(){s.dirty();f.callbacks.forEach(function(n){n&&n(s)});f.callbacks=null}),f.texture=s,v.put(l+n,f);else{for(s=new r.Texture2D({image:new Image}),e=0;e<o.length;e++)s[o[e]]=i[o[e]];f={texture:s,callbacks:[u]};y=s.image;y.onload=function(){s.image=y;b(s);s.dirty();f.callbacks.forEach(function(n){n&&n(s)});f.callbacks=null};y.src=n;s.image=p;v.put(l+n,f)}return f.texture};r.createAmbientCubemap=function(n,t,i,u){n=n||{};var s=n.texture,h=f.a.firstNotNull(n.exposure,1),e=new ft.a({intensity:f.a.firstNotNull(n.specularIntensity,1)}),o=new et.a({intensity:f.a.firstNotNull(n.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});return e.cubemap=r.loadTexture(s,i,{exposure:h},function(){var n,i;e.cubemap.flipY=!1;!0&&(n=Date.now());e.prefilter(t,32);!0&&(i=Date.now()-n,console.log("Prefilter environment map: "+i+"ms"));o.coefficients=ot.a.projectEnvironmentMap(t,e.cubemap,{lod:1});u&&u()}),{specular:e,diffuse:o}};r.createBlankTexture=h.a.createBlank;r.isImage=a;r.additiveBlend=function(n){n.blendEquation(n.FUNC_ADD);n.blendFunc(n.SRC_ALPHA,n.ONE)};r.parseColor=function(n,t){return n instanceof Array?(t||(t=[]),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n.length>3?n[3]:1,t):(t=l.a.color.parse(n||"#000",t)||[0,0,0,0],t[0]/=255,t[1]/=255,t[2]/=255,t)};r.directionFromAlphaBeta=function(n,t){var r=n/180*Math.PI+Math.PI/2,u=-t/180*Math.PI+Math.PI/2,i=[],f=Math.sin(r);return i[0]=f*Math.cos(u),i[1]=-Math.cos(r),i[2]=f*Math.sin(u),i};r.getShadowResolution=function(n){var t=1024;switch(n){case"low":t=512;break;case"high":t=2048;break;case"ultra":t=4096}return t};r.COMMON_SHADERS=["lambert","color","realistic","hatching"];r.createShader=function(n){var i=u.a.source(n+".vertex"),r=u.a.source(n+".fragment"),t;return i||console.error("Vertex shader of '%s' not exits",n),r||console.error("Fragment shader of '%s' not exits",n),t=new u.a(i,r),t.name=n,t};r.createMaterial=function(n,t){t instanceof Array||(t=[t]);var u=r.createShader(n),i=new s.a({shader:u});return t.forEach(function(n){typeof n=="string"&&i.define(n)}),i};r.setMaterialFromModel=function(n,t,i,u){var y,h,c,l,w,p,a;t.autoUpdateTextureStatus=!1;var o=i.getModel(n+"Material"),v=o.get("detailTexture"),e=f.a.firstNotNull(o.get("textureTiling"),1),s=f.a.firstNotNull(o.get("textureOffset"),0);if(typeof e=="number"&&(e=[e,e]),typeof s=="number"&&(s=[s,s]),y=e[0]>1||e[1]>1?r.Texture.REPEAT:r.Texture.CLAMP_TO_EDGE,h={anisotropic:8,wrapS:y,wrapT:y},n==="realistic")c=o.get("roughness"),l=o.get("metalness"),l!=null?isNaN(l)&&(t.setTextureImage("metalnessMap",l,u,h),l=f.a.firstNotNull(o.get("metalnessAdjust"),.5)):l=0,c!=null?isNaN(c)&&(t.setTextureImage("roughnessMap",c,u,h),c=f.a.firstNotNull(o.get("roughnessAdjust"),.5)):c=.5,w=o.get("normalTexture"),t.setTextureImage("detailMap",v,u,h),t.setTextureImage("normalMap",w,u,h),t.set({roughness:c,metalness:l,detailUvRepeat:e,detailUvOffset:s});else if(n==="lambert")t.setTextureImage("detailMap",v,u,h),t.set({detailUvRepeat:e,detailUvOffset:s});else if(n==="color")t.setTextureImage("detailMap",v,u,h),t.set({detailUvRepeat:e,detailUvOffset:s});else if(n==="hatching"){for(p=o.get("hatchingTextures")||[],p.length<6&&!0&&console.error("Invalid hatchingTextures."),a=0;a<6;a++)t.setTextureImage("hatch"+(a+1),p[a],u,{anisotropic:8,wrapS:r.Texture.REPEAT,wrapT:r.Texture.REPEAT});t.set({detailUvRepeat:e,detailUvOffset:s})}};r.updateVertexAnimation=function(n,t,i,r){var o=r.get("animation"),e=r.get("animationDurationUpdate"),s=r.get("animationEasingUpdate"),u=i.shadowDepthMaterial,f;if(o&&t&&e>0&&t.geometry.vertexCount===i.geometry.vertexCount){for(i.material.define("vertex","VERTEX_ANIMATION"),i.ignorePreZ=!0,u&&u.define("vertex","VERTEX_ANIMATION"),f=0;f<n.length;f++)i.geometry.attributes[n[f][0]].value=t.geometry.attributes[n[f][1]].value;i.geometry.dirty();i.__percent=0;i.material.set("percent",0);i.stopAnimation();i.animate().when(e,{__percent:1}).during(function(){i.material.set("percent",i.__percent);u&&u.set("percent",i.__percent)}).done(function(){i.ignorePreZ=!1;i.material.undefine("vertex","VERTEX_ANIMATION");u&&u.undefine("vertex","VERTEX_ANIMATION")}).start(s)}else i.material.undefine("vertex","VERTEX_ANIMATION"),u&&u.undefine("vertex","VERTEX_ANIMATION")};t.a=r},function(n,t,i){"use strict";var u=i(0),r=i.n(u),f={firstNotNull:function(){for(var n=0,t=arguments.length;n<t;n++)if(arguments[n]!=null)return arguments[n]},queryDataIndex:function(n,t){return t.dataIndexInside!=null?t.dataIndexInside:t.dataIndex!=null?r.a.util.isArray(t.dataIndex)?r.a.util.map(t.dataIndex,function(t){return n.indexOfRawIndex(t)}):n.indexOfRawIndex(t.dataIndex):t.name!=null?r.a.util.isArray(t.name)?r.a.util.map(t.name,function(t){return n.indexOfName(t)}):n.indexOfName(t.name):void 0}};t.a=f},function(n,t,i){"use strict";function e(n,t,i){return n<t?t:n>i?i:n}var r=i(12),u=function(n,t,i){n=n||0;t=t||0;i=i||0;this.array=r.a.fromValues(n,t,i);this._dirty=!0},h,c;u.prototype={constructor:u,add:function(n){return r.a.add(this.array,this.array,n.array),this._dirty=!0,this},set:function(n,t,i){return this.array[0]=n,this.array[1]=t,this.array[2]=i,this._dirty=!0,this},setArray:function(n){return this.array[0]=n[0],this.array[1]=n[1],this.array[2]=n[2],this._dirty=!0,this},clone:function(){return new u(this.x,this.y,this.z)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},cross:function(n,t){return r.a.cross(this.array,n.array,t.array),this._dirty=!0,this},dist:function(n){return r.a.dist(this.array,n.array)},distance:function(n){return r.a.distance(this.array,n.array)},div:function(n){return r.a.div(this.array,this.array,n.array),this._dirty=!0,this},divide:function(n){return r.a.divide(this.array,this.array,n.array),this._dirty=!0,this},dot:function(n){return r.a.dot(this.array,n.array)},len:function(){return r.a.len(this.array)},length:function(){return r.a.length(this.array)},lerp:function(n,t,i){return r.a.lerp(this.array,n.array,t.array,i),this._dirty=!0,this},min:function(n){return r.a.min(this.array,this.array,n.array),this._dirty=!0,this},max:function(n){return r.a.max(this.array,this.array,n.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},negate:function(){return r.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return r.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(n){return r.a.random(this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n),this._dirty=!0,this},scaleAndAdd:function(n,t){return r.a.scaleAndAdd(this.array,this.array,n.array,t),this._dirty=!0,this},sqrDist:function(n){return r.a.sqrDist(this.array,n.array)},squaredDistance:function(n){return r.a.squaredDistance(this.array,n.array)},sqrLen:function(){return r.a.sqrLen(this.array)},squaredLength:function(){return r.a.squaredLength(this.array)},sub:function(n){return r.a.sub(this.array,this.array,n.array),this._dirty=!0,this},subtract:function(n){return r.a.subtract(this.array,this.array,n.array),this._dirty=!0,this},transformMat3:function(n){return r.a.transformMat3(this.array,this.array,n.array),this._dirty=!0,this},transformMat4:function(n){return r.a.transformMat4(this.array,this.array,n.array),this._dirty=!0,this},transformQuat:function(n){return r.a.transformQuat(this.array,this.array,n.array),this._dirty=!0,this},applyProjection:function(n){var t=this.array,i;return n=n.array,n[15]===0?(i=-1/t[2],t[0]=n[0]*t[0]*i,t[1]=n[5]*t[1]*i,t[2]=(n[10]*t[2]+n[14])*i):(t[0]=n[0]*t[0]+n[12],t[1]=n[5]*t[1]+n[13],t[2]=n[10]*t[2]+n[14]),this._dirty=!0,this},eulerFromQuat:function(n,t){u.eulerFromQuat(this,n,t)},eulerFromMat3:function(n,t){u.eulerFromMat3(this,n,t)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};h=Object.defineProperty;h&&(c=u.prototype,h(c,"x",{get:function(){return this.array[0]},set:function(n){this.array[0]=n;this._dirty=!0}}),h(c,"y",{get:function(){return this.array[1]},set:function(n){this.array[1]=n;this._dirty=!0}}),h(c,"z",{get:function(){return this.array[2]},set:function(n){this.array[2]=n;this._dirty=!0}}));u.add=function(n,t,i){return r.a.add(n.array,t.array,i.array),n._dirty=!0,n};u.set=function(n,t,i,u){r.a.set(n.array,t,i,u);n._dirty=!0};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.cross=function(n,t,i){return r.a.cross(n.array,t.array,i.array),n._dirty=!0,n};u.dist=function(n,t){return r.a.distance(n.array,t.array)};u.distance=u.dist;u.div=function(n,t,i){return r.a.divide(n.array,t.array,i.array),n._dirty=!0,n};u.divide=u.div;u.dot=function(n,t){return r.a.dot(n.array,t.array)};u.len=function(n){return r.a.length(n.array)};u.lerp=function(n,t,i,u){return r.a.lerp(n.array,t.array,i.array,u),n._dirty=!0,n};u.min=function(n,t,i){return r.a.min(n.array,t.array,i.array),n._dirty=!0,n};u.max=function(n,t,i){return r.a.max(n.array,t.array,i.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.multiply(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.negate=function(n,t){return r.a.negate(n.array,t.array),n._dirty=!0,n};u.normalize=function(n,t){return r.a.normalize(n.array,t.array),n._dirty=!0,n};u.random=function(n,t){return r.a.random(n.array,t),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i),n._dirty=!0,n};u.scaleAndAdd=function(n,t,i,u){return r.a.scaleAndAdd(n.array,t.array,i.array,u),n._dirty=!0,n};u.sqrDist=function(n,t){return r.a.sqrDist(n.array,t.array)};u.squaredDistance=u.sqrDist;u.sqrLen=function(n){return r.a.sqrLen(n.array)};u.squaredLength=u.sqrLen;u.sub=function(n,t,i){return r.a.subtract(n.array,t.array,i.array),n._dirty=!0,n};u.subtract=u.sub;u.transformMat3=function(n,t,i){return r.a.transformMat3(n.array,t.array,i.array),n._dirty=!0,n};u.transformMat4=function(n,t,i){return r.a.transformMat4(n.array,t.array,i.array),n._dirty=!0,n};u.transformQuat=function(n,t,i){return r.a.transformQuat(n.array,t.array,i.array),n._dirty=!0,n};var f=Math.atan2,o=Math.asin,s=Math.abs;u.eulerFromQuat=function(n,t,i){n._dirty=!0;t=t.array;var c=n.array,r=t[0],u=t[1],s=t[2],h=t[3],l=r*r,a=u*u,v=s*s,y=h*h,i=(i||"XYZ").toUpperCase();switch(i){case"XYZ":c[0]=f(2*(r*h-u*s),y-l-a+v);c[1]=o(e(2*(r*s+u*h),-1,1));c[2]=f(2*(s*h-r*u),y+l-a-v);break;case"YXZ":c[0]=o(e(2*(r*h-u*s),-1,1));c[1]=f(2*(r*s+u*h),y-l-a+v);c[2]=f(2*(r*u+s*h),y-l+a-v);break;case"ZXY":c[0]=o(e(2*(r*h+u*s),-1,1));c[1]=f(2*(u*h-s*r),y-l-a+v);c[2]=f(2*(s*h-r*u),y-l+a-v);break;case"ZYX":c[0]=f(2*(r*h+s*u),y-l-a+v);c[1]=o(e(2*(u*h-r*s),-1,1));c[2]=f(2*(r*u+s*h),y+l-a-v);break;case"YZX":c[0]=f(2*(r*h-s*u),y-l+a-v);c[1]=f(2*(u*h-r*s),y+l-a-v);c[2]=o(e(2*(r*u+s*h),-1,1));break;case"XZY":c[0]=f(2*(r*h+u*s),y-l+a-v);c[1]=f(2*(r*s+u*h),y+l-a-v);c[2]=o(e(2*(s*h-r*u),-1,1));break;default:console.warn("Unkown order: "+i)}return n};u.eulerFromMat3=function(n,t,i){var u=t.array,h=u[0],a=u[3],v=u[6],y=u[1],c=u[4],p=u[7],w=u[2],b=u[5],l=u[8],r=n.array,i=(i||"XYZ").toUpperCase();switch(i){case"XYZ":r[1]=o(e(v,-1,1));s(v)<.99999?(r[0]=f(-p,l),r[2]=f(-a,h)):(r[0]=f(b,c),r[2]=0);break;case"YXZ":r[0]=o(-e(p,-1,1));s(p)<.99999?(r[1]=f(v,l),r[2]=f(y,c)):(r[1]=f(-w,h),r[2]=0);break;case"ZXY":r[0]=o(e(b,-1,1));s(b)<.99999?(r[1]=f(-w,l),r[2]=f(-a,c)):(r[1]=0,r[2]=f(y,h));break;case"ZYX":r[1]=o(-e(w,-1,1));s(w)<.99999?(r[0]=f(b,l),r[2]=f(y,h)):(r[0]=0,r[2]=f(-a,c));break;case"YZX":r[2]=o(e(y,-1,1));s(y)<.99999?(r[0]=f(-p,c),r[1]=f(-w,h)):(r[0]=0,r[1]=f(v,l));break;case"XZY":r[2]=o(-e(a,-1,1));s(a)<.99999?(r[0]=f(b,c),r[1]=f(v,h)):(r[0]=f(-p,l),r[1]=0);break;default:console.warn("Unkown order: "+i)}return n._dirty=!0,n};Object.defineProperties(u,{POSITIVE_X:{get:function(){return new u(1,0,0)}},NEGATIVE_X:{get:function(){return new u(-1,0,0)}},POSITIVE_Y:{get:function(){return new u(0,1,0)}},NEGATIVE_Y:{get:function(){return new u(0,-1,0)}},POSITIVE_Z:{get:function(){return new u(0,0,1)}},NEGATIVE_Z:{get:function(){return new u(0,0,-1)}},UP:{get:function(){return new u(0,1,0)}},ZERO:{get:function(){return new u}}});t.a=u},function(n,t,i){"use strict";var f=i(7),r=i(11),e=i(57),u=f.a.extend({width:512,height:512,type:r.a.UNSIGNED_BYTE,format:r.a.RGBA,wrapS:r.a.REPEAT,wrapT:r.a.REPEAT,minFilter:r.a.LINEAR_MIPMAP_LINEAR,magFilter:r.a.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},function(){this._cache=new e.a},{getWebGLTexture:function(n){var i=n.gl,t=this._cache;return t.use(n.__uid__),t.miss("webgl_texture")&&t.put("webgl_texture",i.createTexture()),this.dynamic?this.update(n):t.isDirty()&&(this.update(n),t.fresh()),t.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(){},updateCommon:function(n){var t=n.gl,i;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment);this.format===r.a.DEPTH_COMPONENT&&(this.useMipmap=!1);i=n.getGLExtension("EXT_sRGB");this.format!==u.SRGB||i||(this.format=u.RGB);this.format!==u.SRGB_ALPHA||i||(this.format=u.RGBA);this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?r.a.CLAMP_TO_EDGE:this.wrapS},getAvailableWrapT:function(){return this.NPOT?r.a.CLAMP_TO_EDGE:this.wrapT},getAvailableMinFilter:function(){var n=this.minFilter;return this.NPOT||!this.useMipmap?n===r.a.NEAREST_MIPMAP_NEAREST||n===r.a.NEAREST_MIPMAP_LINEAR?r.a.NEAREST:n===r.a.LINEAR_MIPMAP_LINEAR||n===r.a.LINEAR_MIPMAP_NEAREST?r.a.LINEAR:n:n},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(n){--n;for(var t=1;t<32;t<<=1)n=n|n>>t;return n+1},dispose:function(n){var t=this._cache,i;t.use(n.__uid__);i=t.get("webgl_texture");i&&n.gl.deleteTexture(i);t.deleteContext(n.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(u.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}});Object.defineProperty(u.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}});u.BYTE=r.a.BYTE;u.UNSIGNED_BYTE=r.a.UNSIGNED_BYTE;u.SHORT=r.a.SHORT;u.UNSIGNED_SHORT=r.a.UNSIGNED_SHORT;u.INT=r.a.INT;u.UNSIGNED_INT=r.a.UNSIGNED_INT;u.FLOAT=r.a.FLOAT;u.HALF_FLOAT=36193;u.UNSIGNED_INT_24_8_WEBGL=34042;u.DEPTH_COMPONENT=r.a.DEPTH_COMPONENT;u.DEPTH_STENCIL=r.a.DEPTH_STENCIL;u.ALPHA=r.a.ALPHA;u.RGB=r.a.RGB;u.RGBA=r.a.RGBA;u.LUMINANCE=r.a.LUMINANCE;u.LUMINANCE_ALPHA=r.a.LUMINANCE_ALPHA;u.SRGB=35904;u.SRGB_ALPHA=35906;u.COMPRESSED_RGB_S3TC_DXT1_EXT=33776;u.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777;u.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778;u.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779;u.NEAREST=r.a.NEAREST;u.LINEAR=r.a.LINEAR;u.NEAREST_MIPMAP_NEAREST=r.a.NEAREST_MIPMAP_NEAREST;u.LINEAR_MIPMAP_NEAREST=r.a.LINEAR_MIPMAP_NEAREST;u.NEAREST_MIPMAP_LINEAR=r.a.NEAREST_MIPMAP_LINEAR;u.LINEAR_MIPMAP_LINEAR=r.a.LINEAR_MIPMAP_LINEAR;u.REPEAT=r.a.REPEAT;u.CLAMP_TO_EDGE=r.a.CLAMP_TO_EDGE;u.MIRRORED_REPEAT=r.a.MIRRORED_REPEAT;t.a=u},function(n,t,i){"use strict";function e(n){return Math.pow(2,Math.round(Math.log(n)/Math.LN2))}function c(n,t){var i=e(n.width),r=e(n.height),u;return t=t||document.createElement("canvas"),t.width=i,t.height=r,u=t.getContext("2d"),u.drawImage(n.image,0,0,i,r),t}var r=i(4),o=i(11),s=i(14),h=i(73),f=h.a.isPowerOfTwo,u=r.a.extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}},{textureType:"texture2D",update:function(n){var t=n.gl,e,l,s,h,u,a;t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture"));this.updateCommon(n);var c=this.format,f=this.type,i=!!(this.convertToPOT&&!this.mipmaps.length&&this.image&&(this.wrapS===r.a.REPEAT||this.wrapT===r.a.REPEAT)&&this.NPOT);if(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i?this.wrapS:this.getAvailableWrapS()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i?this.wrapT:this.getAvailableWrapT()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i?this.magFilter:this.getAvailableMagFilter()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i?this.minFilter:this.getAvailableMinFilter()),e=n.getGLExtension("EXT_texture_filter_anisotropic"),e&&this.anisotropic>1&&t.texParameterf(t.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),f===36193&&(l=n.getGLExtension("OES_texture_half_float"),l||(f=o.a.FLOAT)),this.mipmaps.length)for(s=this.width,h=this.height,u=0;u<this.mipmaps.length;u++)a=this.mipmaps[u],this._updateTextureData(t,a,u,s,h,c,f,!1),s/=2,h/=2;else this._updateTextureData(t,this,0,this.width,this.height,c,f,i),this.useMipmap&&(!this.NPOT||i)&&t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)},_updateTextureData:function(n,t,i,u,f,e,o,s){if(t.image){var h=t.image;s&&(this._potCanvas=c(this,this._potCanvas),h=this._potCanvas);n.texImage2D(n.TEXTURE_2D,i,e,e,o,h)}else e<=r.a.COMPRESSED_RGBA_S3TC_DXT5_EXT&&e>=r.a.COMPRESSED_RGB_S3TC_DXT1_EXT?n.compressedTexImage2D(n.TEXTURE_2D,i,e,u,f,0,t.pixels):n.texImage2D(n.TEXTURE_2D,i,e,u,f,0,e,o,t.pixels)},generateMipmap:function(n){var t=n.gl;this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture")),t.generateMipmap(t.TEXTURE_2D))},isPowerOfTwo:function(){return f(this.width)&&f(this.height)},isRenderable:function(){return this.image?this.image.nodeName==="CANVAS"||this.image.nodeName==="VIDEO"||this.image.complete:!!(this.width&&this.height)},bind:function(n){n.gl.bindTexture(n.gl.TEXTURE_2D,this.getWebGLTexture(n))},unbind:function(n){n.gl.bindTexture(n.gl.TEXTURE_2D,null)},load:function(n,t){var i=s.a.createImage(),r;return t&&(i.crossOrigin=t),r=this,i.onload=function(){r.dirty();r.trigger("success",r);i.onload=null},i.onerror=function(){r.trigger("error",r);i.onerror=null},i.src=n,this.image=i,this}});Object.defineProperty(u.prototype,"width",{get:function(){return this.image?this.image.width:this._width},set:function(n){this.image?console.warn("Texture from image can't set width"):(this._width!==n&&this.dirty(),this._width=n)}});Object.defineProperty(u.prototype,"height",{get:function(){return this.image?this.image.height:this._height},set:function(n){this.image?console.warn("Texture from image can't set height"):(this._height!==n&&this.dirty(),this._height=n)}});t.a=u},function(n,t,i){"use strict";var r=i(161);t.a=r.a},function(n,t,i){"use strict";var f=i(110),e=i(53),r=i(23),u=function(){this.__uid__=r.a.genGUID()};u.__initializers__=[function(n){r.a.extend(this,n)}];r.a.extend(u,f.a);r.a.extend(u.prototype,e.a);t.a=u},function(n,t,i){"use strict";function u(n){for(var i=[],t=0;t<n;t++)i[t]=0;return i}function it(n,t){var r="vertex:"+n+"fragment:"+t,i;return o[r]?o[r]:(i=k.a.genGUID(),o[r]=i,v[i]={vertex:n,fragment:t},i)}function y(n){return n.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function f(){console.error("Wrong uniform/attributes syntax")}function p(n,t){function nt(n){n||f();var t=n.match(/\[(.*?)\]/);h=n.replace(/\[(.*?)\]/,"");s[h]={};t&&(s[h].isArray=!0,s[h].arraySize=t[1])}for(var u,c,o=t.replace(/:\s*\[\s*(.*)\s*\]/g,"="+n+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g),y=[],r=0;r<o.length;r++)o[r].match(/[,=\(\):]/)?y.push(o[r].charAt(0),o[r].slice(1)):y.push(o[r]);o=y;var p=0,w=1,b=2,k=4,g=5,i=p,s={},v=null,h;for(nt(o[0]),r=1;r<o.length;r++)if(u=o[r],u){if(u==="="){if(i!==p&&i!==3){f();break}i=w;continue}else if(u===":"){i=k;continue}else if(u===","){if(i===b){if(!(v instanceof Array)){f();break}v.push(+o[++r])}else i=g;continue}else if(u===")"){s[h].value=new d.a.Float32Array(v);v=null;i=g;continue}else if(u==="("){if(i!==b){f();break}if(!(v instanceof Array)){f();break}v.push(+o[++r]);continue}else if(u.indexOf("vec")>=0){if(i!==w&&i!==k){f();break}i=b;v=[];continue}else if(i===w){s[h].value=n==="bool"?u==="true":parseFloat(u);v=null;continue}else if(i===k){c=u;e.indexOf(c)>=0||l.indexOf(c)>=0||a.indexOf(c)>=0?s[h].semantic=c:c==="ignore"||c==="unconfigurable"?s[h].ignore=!0:s[h].value=n==="bool"?c==="true":parseFloat(c);continue}nt(u);i=p}return s}function r(n,t){typeof n=="object"&&(t=n.fragment,n=n.vertex);n=y(n);t=y(t);this._shaderID=it(n,t);this._vertexCode=r.parseImport(n);this._fragmentCode=r.parseImport(t);this.attributeSemantics={};this.matrixSemantics={};this.uniformSemantics={};this.matrixSemanticKeys=[];this.uniformTemplates={};this.attributes={};this.textures={};this.vertexDefines={};this.fragmentDefines={};this._parseAttributes();this._parseUniforms();this._parseDefines()}var k=i(23),d=i(14),s=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g,g=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g,h=/#define\s+(\w+)?(\s+[\d-.]+)?\s*;?\s*\n/g,nt={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},c={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return u(2)},vec3:function(){return u(3)},vec4:function(){return u(4)},ivec2:function(){return u(2)},ivec3:function(){return u(3)},ivec4:function(){return u(4)},mat2:function(){return u(4)},mat3:function(){return u(9)},mat4:function(){return u(16)},array:function(){return[]}},e=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],l=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME"],a=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],tt={vec4:4,vec3:3,vec2:2,float:1},o={},v={},w,b;r.prototype={constructor:r,createUniforms:function(){var i={},n,t;for(n in this.uniformTemplates)t=this.uniformTemplates[n],i[n]={type:t.type,value:t.value()};return i},_parseImport:function(){this._vertexCode=r.parseImport(this.vertex);this._fragmentCode=r.parseImport(this.fragment)},_addSemanticUniform:function(n,t,i){if(e.indexOf(i)>=0)this.attributeSemantics[i]={symbol:n,type:t};else if(a.indexOf(i)>=0){var r=!1,u=i;i.match(/TRANSPOSE$/)&&(r=!0,u=i.slice(0,-9));this.matrixSemantics[i]={symbol:n,type:t,isTranspose:r,semanticNoTranspose:u}}else l.indexOf(i)>=0&&(this.uniformSemantics[i]={symbol:n,type:t})},_addMaterialUniform:function(n,t,i,r,u,f){f[n]={type:i,value:u?c.array:r||c[t],semantic:null}},_parseUniforms:function(){function u(n){return n!=null?function(){return n}:null}function r(r,f,e){var s=p(f,e),h=[];for(var o in s){var l=s[o],a=l.semantic,v=o,c=nt[f],y=u(s[o].value);s[o].isArray&&(v+="["+s[o].arraySize+"]",c+="v");h.push(v);n._uniformList.push(o);l.ignore||((f==="sampler2D"||f==="samplerCube")&&(n.textures[o]={shaderType:i,type:f}),a?n._addSemanticUniform(o,c,a):n._addMaterialUniform(o,f,c,y,s[o].isArray,t))}return h.length>0?"uniform "+f+" "+h.join(",")+";\n":""}var t={},n=this,i="vertex";this._uniformList=[];this._vertexCode=this._vertexCode.replace(s,r);i="fragment";this._fragmentCode=this._fragmentCode.replace(s,r);n.matrixSemanticKeys=Object.keys(this.matrixSemantics);this.uniformTemplates=t},_parseAttributes:function(){function i(i,r,u){var s=p(r,u),c=tt[r]||1,h=[],o,f;for(o in s){if(f=s[o].semantic,n[o]={type:"float",size:c,semantic:f||null},f)if(e.indexOf(f)<0)throw new Error('Unkown semantic "'+f+'"');else t.attributeSemantics[f]={symbol:o,type:r};h.push(o)}return"attribute "+r+" "+h.join(",")+";\n"}var n={},t=this;this._vertexCode=this._vertexCode.replace(g,i);this.attributes=n},_parseDefines:function(){function i(i,r,u){var f=t==="vertex"?n.vertexDefines:n.fragmentDefines;return f[r]||(f[r]=u==="false"?!1:u==="true"?!0:u?isNaN(parseFloat(u))?u.trim():parseFloat(u):null),""}var n=this,t="vertex";this._vertexCode=this._vertexCode.replace(h,i);t="fragment";this._fragmentCode=this._fragmentCode.replace(h,i)},clone:function(){var n=v[this._shaderID];return new r(n.vertex,n.fragment)}};Object.defineProperty&&(Object.defineProperty(r.prototype,"shaderID",{get:function(){return this._shaderID}}),Object.defineProperty(r.prototype,"vertex",{get:function(){return this._vertexCode}}),Object.defineProperty(r.prototype,"fragment",{get:function(){return this._fragmentCode}}),Object.defineProperty(r.prototype,"uniforms",{get:function(){return this._uniformList}}));w=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;r.parseImport=function(n){return n.replace(w,function(n,t,i){var n=r.source(i);return n?r.parseImport(n):(console.error('Shader chunk "'+i+'" not existed in library'),"")})};b=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;r["import"]=function(n){n.replace(b,function(n,t,i,u){var u=u.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(u){for(var o=i.split("."),e=r.codes,s=0,f;s<o.length-1;)f=o[s++],e[f]||(e[f]={}),e=e[f];f=o[s];e[f]=u}return u})};r.codes={};r.source=function(n){for(var i=n.split("."),t=r.codes,u=0,f;t&&u<i.length;)f=i[u++],t=t[f];return typeof t!="string"?(console.error('Shader "'+n+'" not existed in library'),""):t};t.a=r},function(n,t,i){"use strict";var r=i(21),f=i(12),h=i(55),c=i(34),s=i(3),u=function(){this._axisX=new s.a;this._axisY=new s.a;this._axisZ=new s.a;this.array=r.a.create();this._dirty=!0},e,o;u.prototype={constructor:u,setArray:function(n){for(var t=0;t<this.array.length;t++)this.array[t]=n[t];return this._dirty=!0,this},adjoint:function(){return r.a.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new u).copy(this)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},determinant:function(){return r.a.determinant(this.array)},fromQuat:function(n){return r.a.fromQuat(this.array,n.array),this._dirty=!0,this},fromRotationTranslation:function(n,t){return r.a.fromRotationTranslation(this.array,n.array,t.array),this._dirty=!0,this},fromMat2d:function(n){return u.fromMat2d(this,n),this},frustum:function(n,t,i,u,f,e){return r.a.frustum(this.array,n,t,i,u,f,e),this._dirty=!0,this},identity:function(){return r.a.identity(this.array),this._dirty=!0,this},invert:function(){return r.a.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(n,t,i){return r.a.lookAt(this.array,n.array,t.array,i.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},mulLeft:function(n){return r.a.mul(this.array,n.array,this.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},multiplyLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},ortho:function(n,t,i,u,f,e){return r.a.ortho(this.array,n,t,i,u,f,e),this._dirty=!0,this},perspective:function(n,t,i,u){return r.a.perspective(this.array,n,t,i,u),this._dirty=!0,this},rotate:function(n,t){return r.a.rotate(this.array,this.array,n,t.array),this._dirty=!0,this},rotateX:function(n){return r.a.rotateX(this.array,this.array,n),this._dirty=!0,this},rotateY:function(n){return r.a.rotateY(this.array,this.array,n),this._dirty=!0,this},rotateZ:function(n){return r.a.rotateZ(this.array,this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n.array),this._dirty=!0,this},translate:function(n){return r.a.translate(this.array,this.array,n.array),this._dirty=!0,this},transpose:function(){return r.a.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:function(){var t=f.a.create(),i=f.a.create(),r=f.a.create(),n=c.a.create();return function(u,e,o){var s=this.array;f.a.set(t,s[0],s[1],s[2]);f.a.set(i,s[4],s[5],s[6]);f.a.set(r,s[8],s[9],s[10]);var l=f.a.length(t),a=f.a.length(i),v=f.a.length(r),y=this.determinant();y<0&&(l=-l);u&&u.set(l,a,v);o.set(s[12],s[13],s[14]);c.a.fromMat4(n,s);n[0]/=l;n[1]/=l;n[2]/=l;n[3]/=a;n[4]/=a;n[5]/=a;n[6]/=v;n[7]/=v;n[8]/=v;h.a.fromMat3(e.array,n);h.a.normalize(e.array,e.array);e._dirty=!0;o._dirty=!0}}(),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};e=Object.defineProperty;e&&(o=u.prototype,e(o,"z",{get:function(){var n=this.array;return this._axisZ.set(n[8],n[9],n[10]),this._axisZ},set:function(n){var t=this.array;n=n.array;t[8]=n[0];t[9]=n[1];t[10]=n[2];this._dirty=!0}}),e(o,"y",{get:function(){var n=this.array;return this._axisY.set(n[4],n[5],n[6]),this._axisY},set:function(n){var t=this.array;n=n.array;t[4]=n[0];t[5]=n[1];t[6]=n[2];this._dirty=!0}}),e(o,"x",{get:function(){var n=this.array;return this._axisX.set(n[0],n[1],n[2]),this._axisX},set:function(n){var t=this.array;n=n.array;t[0]=n[0];t[1]=n[1];t[2]=n[2];this._dirty=!0}}));u.adjoint=function(n,t){return r.a.adjoint(n.array,t.array),n._dirty=!0,n};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.determinant=function(n){return r.a.determinant(n.array)};u.identity=function(n){return r.a.identity(n.array),n._dirty=!0,n};u.ortho=function(n,t,i,u,f,e,o){return r.a.ortho(n.array,t,i,u,f,e,o),n._dirty=!0,n};u.perspective=function(n,t,i,u,f){return r.a.perspective(n.array,t,i,u,f),n._dirty=!0,n};u.lookAt=function(n,t,i,u){return r.a.lookAt(n.array,t.array,i.array,u.array),n._dirty=!0,n};u.invert=function(n,t){return r.a.invert(n.array,t.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.mul(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.fromQuat=function(n,t){return r.a.fromQuat(n.array,t.array),n._dirty=!0,n};u.fromRotationTranslation=function(n,t,i){return r.a.fromRotationTranslation(n.array,t.array,i.array),n._dirty=!0,n};u.fromMat2d=function(n,t){n._dirty=!0;var t=t.array,n=n.array;return n[0]=t[0],n[4]=t[2],n[12]=t[4],n[1]=t[1],n[5]=t[3],n[13]=t[5],n};u.rotate=function(n,t,i,u){return r.a.rotate(n.array,t.array,i,u.array),n._dirty=!0,n};u.rotateX=function(n,t,i){return r.a.rotateX(n.array,t.array,i),n._dirty=!0,n};u.rotateY=function(n,t,i){return r.a.rotateY(n.array,t.array,i),n._dirty=!0,n};u.rotateZ=function(n,t,i){return r.a.rotateZ(n.array,t.array,i),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i.array),n._dirty=!0,n};u.transpose=function(n,t){return r.a.transpose(n.array,t.array),n._dirty=!0,n};u.translate=function(n,t,i){return r.a.translate(n.array,t.array,i.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";var p=i(7),w=i(4),k=i(27),r=i(11),b=i(57),h="framebuffer",u="renderbuffer",a=u+"_width",v=u+"_height",c=u+"_attached",l="depthtexture_attached",f=r.a.FRAMEBUFFER,e=r.a.RENDERBUFFER,o=r.a.DEPTH_ATTACHMENT,y=r.a.COLOR_ATTACHMENT0,s=p.a.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new b.a;this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(n){var i,t,w,s,h,y,p,r,k,b;if(n.__currentFrameBuffer){if(n.__currentFrameBuffer===this)return;console.warn("Renderer already bound with another framebuffer. Unbind it first")}n.__currentFrameBuffer=this;i=n.gl;i.bindFramebuffer(f,this._getFrameBufferGL(n));this._boundRenderer=n;t=this._cache;t.put("viewport",n.viewport);w=!1;for(r in this._textures)w=!0,y=this._textures[r],y&&(s=y.texture.width,h=y.texture.height,this._doAttach(n,y.texture,r,y.target));if(this._width=s,this._height=h,!w&&this.depthBuffer&&console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height."),this.viewport?n.setViewport(this.viewport):n.setViewport(0,0,s,h,1),p=t.get("attached_textures"),p)for(r in p)this._textures[r]||(k=p[r],this._doDetach(i,r,k));!t.get(l)&&this.depthBuffer&&(t.miss(u)&&t.put(u,i.createRenderbuffer()),b=t.get(u),(s!==t.get(a)||h!==t.get(v))&&(i.bindRenderbuffer(e,b),i.renderbufferStorage(e,i.DEPTH_COMPONENT16,s,h),t.put(a,s),t.put(v,h),i.bindRenderbuffer(e,null)),t.get(c)||(i.framebufferRenderbuffer(f,o,e,b),t.put(c,!0)))},unbind:function(n){var i,t;n.__currentFrameBuffer=null;i=n.gl;i.bindFramebuffer(f,null);this._boundRenderer=null;this._cache.use(n.__uid__);t=this._cache.get("viewport");t&&n.setViewport(t);this.updateMipmap(n)},updateMipmap:function(n){var u=n.gl,e,f,t,i;for(e in this._textures)f=this._textures[e],f&&(t=f.texture,!t.NPOT&&t.useMipmap&&t.minFilter===w.a.LINEAR_MIPMAP_LINEAR&&(i=t.textureType==="textureCube"?r.a.TEXTURE_CUBE_MAP:r.a.TEXTURE_2D,u.bindTexture(i,t.getWebGLTexture(n)),u.generateMipmap(i),u.bindTexture(i,null)))},checkStatus:function(n){return n.checkFramebufferStatus(f)},_getFrameBufferGL:function(n){var t=this._cache;return t.use(n.__uid__),t.miss(h)&&t.put(h,n.gl.createFramebuffer()),t.get(h)},attach:function(n,t,i){var u,h,e,o,f,s;if(!n.width)throw new Error("The texture attached to color buffer is not a valid.");(t=t||y,i=i||r.a.TEXTURE_2D,u=this._boundRenderer,h=u&&u.gl,h&&(o=this._cache,o.use(u.__uid__),e=o.get("attached_textures")),f=this._textures[t],f&&f.target===i&&f.texture===n&&e&&e[t]!=null)||(s=!0,u&&(s=this._doAttach(u,n,t,i),this.viewport||u.setViewport(0,0,n.width,n.height,1)),s&&(this._textures[t]=this._textures[t]||{},this._textures[t].texture=n,this._textures[t].target=i))},_doAttach:function(n,t,i,s){var v=n.gl,b=t.getWebGLTexture(n),h=this._cache.get("attached_textures"),y,a,w,p;if(!h||!h[i]||(y=h[i],y.texture!==t||y.target!==s))return i=+i,a=!0,(i===o||i===r.a.DEPTH_STENCIL_ATTACHMENT)&&(w=n.getGLExtension("WEBGL_depth_texture"),w||(console.error("Depth texture is not supported by the browser"),a=!1),t.format!==r.a.DEPTH_COMPONENT&&t.format!==r.a.DEPTH_STENCIL&&(console.error("The texture attached to depth buffer is not a valid."),a=!1),a&&(p=this._cache.get(u),p&&(v.framebufferRenderbuffer(f,o,e,null),v.deleteRenderbuffer(p),this._cache.put(u,!1)),this._cache.put(c,!1),this._cache.put(l,!0))),v.framebufferTexture2D(f,i,s,b,0),h||(h={},this._cache.put("attached_textures",h)),h[i]=h[i]||{},h[i].texture=t,h[i].target=s,a},_doDetach:function(n,t,i){n.framebufferTexture2D(f,t,i,null,0);var u=this._cache.get("attached_textures");u&&u[t]&&(u[t]=null);(t===o||t===r.a.DEPTH_STENCIL_ATTACHMENT)&&this._cache.put(l,!1)},detach:function(n,t){if(this._textures[n]=null,this._boundRenderer){var i=this._cache;i.use(this._boundRenderer.__uid__);this._doDetach(this._boundRenderer.gl,n,t)}},dispose:function(n){var f=n.gl,t=this._cache,i,r;t.use(n.__uid__);i=t.get(u);i&&f.deleteRenderbuffer(i);r=t.get(h);r&&f.deleteFramebuffer(r);t.deleteContext(n.__uid__);this._textures={}}});s.DEPTH_ATTACHMENT=o;s.COLOR_ATTACHMENT0=y;s.STENCIL_ATTACHMENT=r.a.STENCIL_ATTACHMENT;s.DEPTH_STENCIL_ATTACHMENT=r.a.DEPTH_STENCIL_ATTACHMENT;t.a=s},function(n,t){"use strict";t.a={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(3);return n[0]=0,n[1]=0,n[2]=0,n};r.clone=function(n){var t=new u.a(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t};r.fromValues=function(n,t,i){var r=new u.a(3);return r[0]=n,r[1]=t,r[2]=i,r};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n};r.set=function(n,t,i,r){return n[0]=t,n[1]=i,n[2]=r,n};r.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n};r.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n};r.sub=r.subtract;r.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n};r.mul=r.multiply;r.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n[2]=t[2]/i[2],n};r.div=r.divide;r.min=function(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n[2]=Math.min(t[2],i[2]),n};r.max=function(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n[2]=Math.max(t[2],i[2]),n};r.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n};r.scaleAndAdd=function(n,t,i,r){return n[0]=t[0]+i[0]*r,n[1]=t[1]+i[1]*r,n[2]=t[2]+i[2]*r,n};r.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1],u=t[2]-n[2];return Math.sqrt(i*i+r*r+u*u)};r.dist=r.distance;r.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1],u=t[2]-n[2];return i*i+r*r+u*u};r.sqrDist=r.squaredDistance;r.length=function(n){var t=n[0],i=n[1],r=n[2];return Math.sqrt(t*t+i*i+r*r)};r.len=r.length;r.squaredLength=function(n){var t=n[0],i=n[1],r=n[2];return t*t+i*i+r*r};r.sqrLen=r.squaredLength;r.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n};r.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n};r.normalize=function(n,t){var r=t[0],u=t[1],f=t[2],i=r*r+u*u+f*f;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i),n};r.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]};r.cross=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=i[0],o=i[1],s=i[2];return n[0]=u*s-f*o,n[1]=f*e-r*s,n[2]=r*o-u*e,n};r.lerp=function(n,t,i,r){var u=t[0],f=t[1],e=t[2];return n[0]=u+r*(i[0]-u),n[1]=f+r*(i[1]-f),n[2]=e+r*(i[2]-e),n};r.random=function(n,t){t=t||1;var r=Object(u.c)()*2*Math.PI,i=Object(u.c)()*2-1,f=Math.sqrt(1-i*i)*t;return n[0]=Math.cos(r)*f,n[1]=Math.sin(r)*f,n[2]=i*t,n};r.transformMat4=function(n,t,i){var u=t[0],f=t[1],e=t[2],r=i[3]*u+i[7]*f+i[11]*e+i[15];return r=r||1,n[0]=(i[0]*u+i[4]*f+i[8]*e+i[12])/r,n[1]=(i[1]*u+i[5]*f+i[9]*e+i[13])/r,n[2]=(i[2]*u+i[6]*f+i[10]*e+i[14])/r,n};r.transformMat3=function(n,t,i){var r=t[0],u=t[1],f=t[2];return n[0]=r*i[0]+u*i[3]+f*i[6],n[1]=r*i[1]+u*i[4]+f*i[7],n[2]=r*i[2]+u*i[5]+f*i[8],n};r.transformQuat=function(n,t,i){var o=t[0],s=t[1],h=t[2],r=i[0],u=i[1],f=i[2],e=i[3],c=e*o+u*h-f*s,l=e*s+f*o-r*h,a=e*h+r*s-u*o,v=-r*o-u*s-f*h;return n[0]=c*e+v*-r+l*-f-a*-u,n[1]=l*e+v*-u+a*-r-c*-f,n[2]=a*e+v*-f+c*-u-l*-r,n};r.rotateX=function(n,t,i,r){var u=[],f=[];return u[0]=t[0]-i[0],u[1]=t[1]-i[1],u[2]=t[2]-i[2],f[0]=u[0],f[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),f[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n};r.rotateY=function(n,t,i,r){var u=[],f=[];return u[0]=t[0]-i[0],u[1]=t[1]-i[1],u[2]=t[2]-i[2],f[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),f[1]=u[1],f[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n};r.rotateZ=function(n,t,i,r){var u=[],f=[];return u[0]=t[0]-i[0],u[1]=t[1]-i[1],u[2]=t[2]-i[2],f[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),f[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),f[2]=u[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n};r.forEach=function(){var n=r.create();return function(t,i,r,u,f,e){var o,s;for(i||(i=3),r||(r=0),s=u?Math.min(u*i+r,t.length):t.length,o=r;o<s;o+=i)n[0]=t[o],n[1]=t[o+1],n[2]=t[o+2],f(n,n,e),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2];return t}}();r.angle=function(n,t){var i=r.fromValues(n[0],n[1],n[2]),u=r.fromValues(t[0],t[1],t[2]),f;return r.normalize(i,i),r.normalize(u,u),f=r.dot(i,u),f>1?0:Math.acos(f)};t.a=r},function(n,t){function ft(n,t){n==="createCanvas"&&(s=null);a[n]=t}function i(n){var f,e,h,t,o,s;if(n==null||typeof n!="object")return n;if(f=n,e=u.call(n),e==="[object Array]"){if(!r(n))for(f=[],t=0,o=n.length;t<o;t++)f[t]=i(n[t])}else if(b[e]){if(!r(n))if(h=n.constructor,n.constructor.from)f=h.from(n);else for(f=new h(n.length),t=0,o=n.length;t<o;t++)f[t]=i(n[t])}else if(!w[e]&&!r(n)&&!c(n)){f={};for(s in n)n.hasOwnProperty(s)&&(f[s]=i(n[s]))}return f}function v(n,t,u){var f,e,s;if(!o(t)||!o(n))return u?i(t):n;for(f in t)t.hasOwnProperty(f)&&(e=n[f],s=t[f],!o(s)||!o(e)||h(s)||h(e)||c(s)||c(e)||y(s)||y(e)||r(s)||r(e)?!u&&f in n||(n[f]=i(t[f],!0)):v(e,s,u));return n}function et(n,t){for(var i=n[0],r=1,u=n.length;r<u;r++)i=v(i,n[r],t);return i}function ot(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function k(n,t,i){for(var r in t)t.hasOwnProperty(r)&&(i?t[r]!=null:n[r]==null)&&(n[r]=t[r]);return n}function st(){return s||(s=d().getContext("2d")),s}function ht(n,t){if(n){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i}return-1}function ct(n,t){function u(){}var r=n.prototype,i;u.prototype=t.prototype;n.prototype=new u;for(i in r)n.prototype[i]=r[i];n.prototype.constructor=n;n.superClass=t}function lt(n,t,i){n="prototype"in n?n.prototype:n;t="prototype"in t?t.prototype:t;k(n,t,i)}function at(n){if(n)return typeof n=="string"?!1:typeof n.length=="number"}function g(n,t,i){var r,f,u;if(n&&t)if(n.forEach&&n.forEach===tt)n.forEach(t,i);else if(n.length===+n.length)for(r=0,f=n.length;r<f;r++)t.call(i,n[r],r,n);else for(u in n)n.hasOwnProperty(u)&&t.call(i,n[u],u,n)}function vt(n,t,i){var u,r,f;if(n&&t){if(n.map&&n.map===rt)return n.map(t,i);for(u=[],r=0,f=n.length;r<f;r++)u.push(t.call(i,n[r],r,n));return u}}function yt(n,t,i,r){if(n&&t){if(n.reduce&&n.reduce===ut)return n.reduce(t,i,r);for(var u=0,f=n.length;u<f;u++)i=t.call(r,i,n[u],u,n);return i}}function pt(n,t,i){var u,r,f;if(n&&t){if(n.filter&&n.filter===it)return n.filter(t,i);for(u=[],r=0,f=n.length;r<f;r++)t.call(i,n[r],r,n)&&u.push(n[r]);return u}}function wt(n,t,i){if(n&&t)for(var r=0,u=n.length;r<u;r++)if(t.call(i,n[r],r,n))return n[r]}function nt(n,t){var i=e.call(arguments,2);return function(){return n.apply(t,i.concat(e.call(arguments)))}}function bt(n){var t=e.call(arguments,1);return function(){return n.apply(this,t.concat(e.call(arguments)))}}function h(n){return u.call(n)==="[object Array]"}function kt(n){return typeof n=="function"}function dt(n){return u.call(n)==="[object String]"}function o(n){var t=typeof n;return t==="function"||!!n&&t=="object"}function y(n){return!!w[u.call(n)]}function gt(n){return!!b[u.call(n)]}function c(n){return typeof n=="object"&&typeof n.nodeType=="number"&&typeof n.ownerDocument=="object"}function ni(n){return n!==n}function ti(){for(var n=0,t=arguments.length;n<t;n++)if(arguments[n]!=null)return arguments[n]}function ii(n,t){return n!=null?n:t}function ri(n,t,i){return n!=null?n:t!=null?t:i}function ui(){return Function.call.apply(e,arguments)}function fi(n){if(typeof n=="number")return[n,n,n,n];var t=n.length;return t===2?[n[0],n[1],n[0],n[1]]:t===3?[n[0],n[1],n[2],n[1]]:n}function ei(n,t){if(!n)throw new Error(t);}function oi(n){return n==null?null:typeof n.trim=="function"?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function si(n){n[p]=!0}function r(n){return n[p]}function l(n){function i(n,i){r?t.set(n,i):t.set(i,n)}var r=h(n),t=this;n instanceof l?n.each(i):n&&g(n,i)}function hi(n){return new l(n)}function ci(n,t){for(var u,r=new n.constructor(n.length+t.length),i=0;i<n.length;i++)r[i]=n[i];for(u=n.length,i=0;i<t.length;i++)r[i+u]=t[i];return r}function li(){}var w={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},b={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},u=Object.prototype.toString,f=Array.prototype,tt=f.forEach,it=f.filter,e=f.slice,rt=f.map,ut=f.reduce,a={},d=function(){return a.createCanvas()},s,p;a.createCanvas=function(){return document.createElement("canvas")};p="__ec_primitive__";l.prototype={constructor:l,get:function(n){return this.hasOwnProperty(n)?this[n]:null},set:function(n,t){return this[n]=t},each:function(n,t){t!==void 0&&(n=nt(n,t));for(var i in this)this.hasOwnProperty(i)&&n(this[i],i)},removeKey:function(n){delete this[n]}};t.$override=ft;t.clone=i;t.merge=v;t.mergeAll=et;t.extend=ot;t.defaults=k;t.createCanvas=d;t.getContext=st;t.indexOf=ht;t.inherits=ct;t.mixin=lt;t.isArrayLike=at;t.each=g;t.map=vt;t.reduce=yt;t.filter=pt;t.find=wt;t.bind=nt;t.curry=bt;t.isArray=h;t.isFunction=kt;t.isString=dt;t.isObject=o;t.isBuiltInObject=y;t.isTypedArray=gt;t.isDom=c;t.eqNaN=ni;t.retrieve=ti;t.retrieve2=ii;t.retrieve3=ri;t.slice=ui;t.normalizeCssArray=fi;t.assert=ei;t.trim=oi;t.setAsPrimitive=si;t.isPrimitive=r;t.createHashMap=hi;t.concatArray=ci;t.noop=li},function(n,t,i){"use strict";(function(n){var e=i(112),f,r={},u;r.supportWebGL=function(){if(f==null)try{var n=document.createElement("canvas"),t=n.getContext("webgl")||n.getContext("experimental-webgl");if(!t)throw new Error;}catch(i){f=!1}return f};r.Int8Array=typeof Int8Array=="undefined"?Array:Int8Array;r.Uint8Array=typeof Uint8Array=="undefined"?Array:Uint8Array;r.Uint16Array=typeof Uint16Array=="undefined"?Array:Uint16Array;r.Uint32Array=typeof Uint32Array=="undefined"?Array:Uint32Array;r.Int16Array=typeof Int16Array=="undefined"?Array:Int16Array;r.Float32Array=typeof Float32Array=="undefined"?Array:Float32Array;r.Float64Array=typeof Float64Array=="undefined"?Array:Float64Array;u={};typeof window!="undefined"?u=window:typeof n!="undefined"&&(u=n);r.requestAnimationFrame=u.requestAnimationFrame||u.msRequestAnimationFrame||u.mozRequestAnimationFrame||u.webkitRequestAnimationFrame||function(n){setTimeout(n,16)};r.createCanvas=function(){return document.createElement("canvas")};r.createImage=function(){return new u.Image};r.request={get:e.a.get};t.a=r}).call(t,i(68))},function(n,t,i){"use strict";var l=i(14),r=i(12),c=i(21),a=i(18),e=i(118),u=r.a.create,h=r.a.add,o=r.a.set,f=e.a.Attribute,s=e.a.extend(function(){return{attributes:{position:new f("position","float",3,"POSITION"),texcoord0:new f("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new f("texcoord1","float",2,"TEXCOORD_1"),normal:new f("normal","float",3,"NORMAL"),tangent:new f("tangent","float",4,"TANGENT"),color:new f("color","float",4,"COLOR"),weight:new f("weight","float",3,"WEIGHT"),joint:new f("joint","float",4,"JOINT"),barycentric:new f("barycentric","float",3,null)},boundingBox:null}},{mainAttribute:"position",updateBoundingBox:function(){var f=this.boundingBox,n,u;if(f||(f=this.boundingBox=new a.a),n=this.attributes.position.value,n&&n.length){var h=f.min,c=f.max,t=h.array,i=c.array;for(r.a.set(t,n[0],n[1],n[2]),r.a.set(i,n[0],n[1],n[2]),u=3;u<n.length;){var e=n[u++],o=n[u++],s=n[u++];e<t[0]&&(t[0]=e);o<t[1]&&(t[1]=o);s<t[2]&&(t[2]=s);e>i[0]&&(i[0]=e);o>i[1]&&(i[1]=o);s>i[2]&&(i[2]=s)}h._dirty=!0;c._dirty=!0}},generateVertexNormals:function(){var e,n;if(this.vertexCount){var a=this.indices,v=this.attributes,i=v.position.value,t=v.normal.value;if(t&&t.length===i.length)for(n=0;n<t.length;n++)t[n]=0;else t=v.normal.value=new l.a.Float32Array(i.length);var p=u(),y=u(),w=u(),b=u(),k=u(),f=u(),d=a?a.length:this.vertexCount,s,h,c;for(e=0;e<d;)for(a?(s=a[e++],h=a[e++],c=a[e++]):(s=e++,h=e++,c=e++),o(p,i[s*3],i[s*3+1],i[s*3+2]),o(y,i[h*3],i[h*3+1],i[h*3+2]),o(w,i[c*3],i[c*3+1],i[c*3+2]),r.a.sub(b,p,y),r.a.sub(k,y,w),r.a.cross(f,b,k),n=0;n<3;n++)t[s*3+n]=t[s*3+n]+f[n],t[h*3+n]=t[h*3+n]+f[n],t[c*3+n]=t[c*3+n]+f[n];for(n=0;n<t.length;)o(f,t[n],t[n+1],t[n+2]),r.a.normalize(f,f),t[n++]=f[0],t[n++]=f[1],t[n++]=f[2];this.dirty()}},generateFaceNormals:function(){var k,s,h,c,i,t;if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var f=this.indices,a=this.attributes,n=a.position.value,l=a.normal.value,y=u(),v=u(),p=u(),w=u(),b=u(),e=u();for(l||(l=a.normal.value=new Float32Array(n.length)),k=f?f.length:this.vertexCount,i=0;i<k;)for(f?(s=f[i++],h=f[i++],c=f[i++]):(s=i++,h=i++,c=i++),o(y,n[s*3],n[s*3+1],n[s*3+2]),o(v,n[h*3],n[h*3+1],n[h*3+2]),o(p,n[c*3],n[c*3+1],n[c*3+2]),r.a.sub(w,y,v),r.a.sub(b,v,p),r.a.cross(e,w,b),r.a.normalize(e,e),t=0;t<3;t++)l[s*3+t]=e[t],l[h*3+t]=e[t],l[c*3+t]=e[t];this.dirty()}},generateTangents:function(){var k,l,o,s,n,rt;if(this.vertexCount){k=this.vertexCount;l=this.attributes;l.tangent.value||(l.tangent.value=new Float32Array(k*4));var a=l.texcoord0.value,e=l.position.value,d=l.tangent.value,ut=l.normal.value;if(!a){console.warn("Geometry without texcoords can't generate tangents.");return}for(o=[],s=[],n=0;n<k;n++)o[n]=[0,0,0],s[n]=[0,0,0];var v=[0,0,0],y=[0,0,0],p=this.indices,bt=p?p.length:this.vertexCount,t,i,f;for(n=0;n<bt;){p?(t=p[n++],i=p[n++],f=p[n++]):(t=n++,i=n++,f=n++);var ft=a[t*2],kt=a[i*2],dt=a[f*2],et=a[t*2+1],gt=a[i*2+1],ni=a[f*2+1],ot=e[t*3],ti=e[i*3],ii=e[f*3],st=e[t*3+1],ri=e[i*3+1],ui=e[f*3+1],ht=e[t*3+2],fi=e[i*3+2],ei=e[f*3+2],ct=ti-ot,lt=ii-ot,at=ri-st,vt=ui-st,yt=fi-ht,pt=ei-ht,g=kt-ft,nt=dt-ft,tt=gt-et,it=ni-et,w=1/(g*it-tt*nt);v[0]=(it*ct-tt*lt)*w;v[1]=(it*at-tt*vt)*w;v[2]=(it*yt-tt*pt)*w;y[0]=(g*lt-nt*ct)*w;y[1]=(g*vt-nt*at)*w;y[2]=(g*pt-nt*yt)*w;h(o[t],o[t],v);h(o[i],o[i],v);h(o[f],o[f],v);h(s[t],s[t],y);h(s[i],s[i],y);h(s[f],s[f],y)}var c=u(),wt=u(),b=u();for(n=0;n<k;n++)b[0]=ut[n*3],b[1]=ut[n*3+1],b[2]=ut[n*3+2],rt=o[n],r.a.scale(c,b,r.a.dot(b,rt)),r.a.sub(c,rt,c),r.a.normalize(c,c),r.a.cross(wt,b,rt),d[n*4]=c[0],d[n*4+1]=c[1],d[n*4+2]=c[2],d[n*4+3]=r.a.dot(wt,s[n])<0?-1:1;this.dirty()}},isUniqueVertex:function(){return this.isUseIndices()?this.vertexCount===this.indices.length:!0},generateUniqueVertex:function(){var t,e,i,c,n,r;if(this.vertexCount&&this.indices){this.indices.length>65535&&(this.indices=new l.a.Uint32Array(this.indices));var u=this.attributes,o=this.indices,f=this.getEnabledAttributes(),h={};for(n=0;n<f.length;n++)t=f[n],h[t]=u[t].value,u[t].init(this.indices.length);for(e=0,i=0;i<o.length;i++){for(c=o[i],n=0;n<f.length;n++){var t=f[n],a=u[t].value,s=u[t].size;for(r=0;r<s;r++)a[e*s+r]=h[t][c*s+r]}o[i]=e;e++}this.dirty()}},generateBarycentric:function(){var r,t,f;if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var u=this.attributes,i=u.barycentric.value,n=this.indices;if(!i||i.length!==n.length*3){for(i=u.barycentric.value=new Float32Array(n.length*3),r=0;r<(n?n.length:this.vertexCount/3);)for(t=0;t<3;t++)f=n?n[r++]:r*3+t,i[f*3+t]=1;this.dirty()}}},applyTransform:function(n){var f=this.attributes,s=f.position.value,e=f.normal.value,o=f.tangent.value,t,i,u;n=n.array;t=c.a.create();c.a.invert(t,n);c.a.transpose(t,t);i=r.a.transformMat4;u=r.a.forEach;u(s,3,0,null,i,n);e&&u(e,3,0,null,i,t);o&&u(o,4,0,null,i,t);this.boundingBox&&this.updateBoundingBox()},dispose:function(n){var f=this._cache,i,r,t,u,o,s,h,e;if(f.use(n.__uid__),i=f.get("chunks"),i)for(r=0;r<i.length;r++){for(t=i[r],u=0;u<t.attributeBuffers.length;u++)o=t.attributeBuffers[u],n.gl.deleteBuffer(o.buffer);t.indicesBuffer&&n.gl.deleteBuffer(t.indicesBuffer.buffer)}if(this.__vaoCache){s=n.getGLExtension("OES_vertex_array_object");for(h in this.__vaoCache)e=this.__vaoCache[h].vao,e&&s.deleteVertexArrayOES(e)}this.__vaoCache={};f.deleteContext(n.__uid__)}});s.STATIC_DRAW=e.a.STATIC_DRAW;s.DYNAMIC_DRAW=e.a.DYNAMIC_DRAW;s.STREAM_DRAW=e.a.STREAM_DRAW;s.AttributeBuffer=e.a.AttributeBuffer;s.IndicesBuffer=e.a.IndicesBuffer;s.Attribute=f;t.a=s},function(n,t,i){"use strict";var f=i(7),e=i(37),o=i(43),r=i(8),s=i(19),h=i(40),c=i(11),l=i(126);r.a["import"](l.a);var a=new o.a,u=new h.a({geometry:a,frustumCulling:!1}),v=new e.a,y=f.a.extend(function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}},function(){var t=new r.a(r.a.source("clay.compositor.vertex"),this.fragment),n=new s.a({shader:t});n.enableTexturesAll();this.material=n},{setUniform:function(n,t){this.material.setUniform(n,t)},getUniform:function(n){var t=this.material.uniforms[n];if(t)return t.value},attachOutput:function(n,t){this.outputs||(this.outputs={});t=t||c.a.COLOR_ATTACHMENT0;this.outputs[t]=n},detachOutput:function(n){for(var t in this.outputs)this.outputs[t]===n&&(this.outputs[t]=null)},bind:function(n,t){var i,r;if(this.outputs)for(i in this.outputs)r=this.outputs[i],r&&t.attach(r,i);t&&t.bind(n)},unbind:function(n,t){t.unbind(n)},render:function(n,t){var i=n.gl,e,o,r,f,u;if(t&&(this.bind(n,t),e=n.getGLExtension("EXT_draw_buffers"),e&&this.outputs)){o=[];for(r in this.outputs)r=+r,r>=i.COLOR_ATTACHMENT0&&r<=i.COLOR_ATTACHMENT0+8&&o.push(r);e.drawBuffersEXT(o)}this.trigger("beforerender",this,n);f=this.clearDepth?i.DEPTH_BUFFER_BIT:0;i.depthMask(!0);this.clearColor&&(f=f|i.COLOR_BUFFER_BIT,i.colorMask(!0,!0,!0,!0),u=this.clearColor,Array.isArray(u)&&i.clearColor(u[0],u[1],u[2],u[3]));i.clear(f);this.blendWithPrevious?(i.enable(i.BLEND),this.material.transparent=!0):(i.disable(i.BLEND),this.material.transparent=!1);this.renderQuad(n);this.trigger("afterrender",this,n);t&&this.unbind(n,t)},renderQuad:function(n){u.material=this.material;n.renderPass([u],v)},dispose:function(){}});t.a=y},function(n,t){"use strict";t.a=function(n){return{seriesType:n,reset:function(n){function u(n,i){var u=n.getItemModel(i),r=u.get(t,!0);r!=null&&n.setItemVisual(i,"opacity",r)}var r=n.getData(),t=n.visualColorAccessPath.split("."),i;return t[t.length-1]="opacity",i=n.get(t),r.setVisual("opacity",i==null?1:i),{dataEach:r.hasItemOption?u:null}}}}},function(n,t,i){"use strict";var o=i(3),r=i(12),u=r.a.set,f=r.a.copy,e=function(n,t){this.min=n||new o.a(Infinity,Infinity,Infinity);this.max=t||new o.a(-Infinity,-Infinity,-Infinity);this.vertices=null};e.prototype={constructor:e,updateFromVertices:function(n){var u,t;if(n.length>0){var e=this.min,o=this.max,i=e.array,r=o.array;for(f(i,n[0]),f(r,n[0]),u=1;u<n.length;u++)t=n[u],t[0]<i[0]&&(i[0]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[2]<i[2]&&(i[2]=t[2]),t[0]>r[0]&&(r[0]=t[0]),t[1]>r[1]&&(r[1]=t[1]),t[2]>r[2]&&(r[2]=t[2]);e._dirty=!0;o._dirty=!0}},union:function(n){var t=this.min,i=this.max;return r.a.min(t.array,t.array,n.min.array),r.a.max(i.array,i.array,n.max.array),t._dirty=!0,i._dirty=!0,this},intersection:function(n){var t=this.min,i=this.max;return r.a.max(t.array,t.array,n.min.array),r.a.min(i.array,i.array,n.max.array),t._dirty=!0,i._dirty=!0,this},intersectBoundingBox:function(n){var t=this.min.array,i=this.max.array,r=n.min.array,u=n.max.array;return!(t[0]>u[0]||t[1]>u[1]||t[2]>u[2]||i[0]<r[0]||i[1]<r[1]||i[2]<r[2])},containBoundingBox:function(n){var t=this.min.array,i=this.max.array,r=n.min.array,u=n.max.array;return t[0]<=r[0]&&t[1]<=r[1]&&t[2]<=r[2]&&i[0]>=u[0]&&i[1]>=u[1]&&i[2]>=u[2]},containPoint:function(n){var i=this.min.array,r=this.max.array,t=n.array;return i[0]<=t[0]&&i[1]<=t[1]&&i[2]<=t[2]&&r[0]>=t[0]&&r[1]>=t[1]&&r[2]>=t[2]},isFinite:function(){var n=this.min.array,t=this.max.array;return isFinite(n[0])&&isFinite(n[1])&&isFinite(n[2])&&isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])},applyTransform:function(n){this.transformFrom(this,n)},transformFrom:function(){var n=r.a.create(),t=r.a.create(),i=r.a.create(),u=r.a.create(),f=r.a.create(),e=r.a.create();return function(r,o){var h=r.min.array,c=r.max.array,s=o.array;return n[0]=s[0]*h[0],n[1]=s[1]*h[0],n[2]=s[2]*h[0],t[0]=s[0]*c[0],t[1]=s[1]*c[0],t[2]=s[2]*c[0],i[0]=s[4]*h[1],i[1]=s[5]*h[1],i[2]=s[6]*h[1],u[0]=s[4]*c[1],u[1]=s[5]*c[1],u[2]=s[6]*c[1],f[0]=s[8]*h[2],f[1]=s[9]*h[2],f[2]=s[10]*h[2],e[0]=s[8]*c[2],e[1]=s[9]*c[2],e[2]=s[10]*c[2],h=this.min.array,c=this.max.array,h[0]=Math.min(n[0],t[0])+Math.min(i[0],u[0])+Math.min(f[0],e[0])+s[12],h[1]=Math.min(n[1],t[1])+Math.min(i[1],u[1])+Math.min(f[1],e[1])+s[13],h[2]=Math.min(n[2],t[2])+Math.min(i[2],u[2])+Math.min(f[2],e[2])+s[14],c[0]=Math.max(n[0],t[0])+Math.max(i[0],u[0])+Math.max(f[0],e[0])+s[12],c[1]=Math.max(n[1],t[1])+Math.max(i[1],u[1])+Math.max(f[1],e[1])+s[13],c[2]=Math.max(n[2],t[2])+Math.max(i[2],u[2])+Math.max(f[2],e[2])+s[14],this.min._dirty=!0,this.max._dirty=!0,this}}(),applyProjection:function(n){var r=this.min.array,i=this.max.array,t=n.array,o=r[0],s=r[1],f=r[2],h=i[0],c=i[1],l=r[2],a=i[0],v=i[1],e=i[2],u;return t[15]===1?(r[0]=t[0]*o+t[12],r[1]=t[5]*s+t[13],i[2]=t[10]*f+t[14],i[0]=t[0]*a+t[12],i[1]=t[5]*v+t[13],r[2]=t[10]*e+t[14]):(u=-1/f,r[0]=t[0]*o*u,r[1]=t[5]*s*u,i[2]=(t[10]*f+t[14])*u,u=-1/l,i[0]=t[0]*h*u,i[1]=t[5]*c*u,u=-1/e,r[2]=(t[10]*e+t[14])*u),this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){var i=this.vertices,f,n,t;if(!i){for(i=[],f=0;f<8;f++)i[f]=r.a.fromValues(0,0,0);this.vertices=i}return n=this.min.array,t=this.max.array,u(i[0],n[0],n[1],n[2]),u(i[1],n[0],t[1],n[2]),u(i[2],t[0],n[1],n[2]),u(i[3],t[0],t[1],n[2]),u(i[4],n[0],n[1],t[2]),u(i[5],n[0],t[1],t[2]),u(i[6],t[0],n[1],t[2]),u(i[7],t[0],t[1],t[2]),this},copy:function(n){var t=this.min,i=this.max;return f(t.array,n.min.array),f(i.array,n.max.array),t._dirty=!0,i._dirty=!0,this},clone:function(){var n=new e;return n.copy(this),n}};t.a=e},function(n,t,i){"use strict";function f(n){var u=Object.keys(n),t,i,r,f;for(u.sort(),t=[],i=0;i<u.length;i++)r=u[i],f=n[r],f===null?t.push(r):t.push(r+" "+f.toString());return t.join("\n")}function h(n,t,i){var s,e,c,o,h;for(i.sort(),s=[],e=0;e<i.length;e++)c=i[e],s.push(c);return(o=f(n)+"\n"+f(t)+"\n"+s.join("\n"),u[o])?u[o]:(h=r.a.genGUID(),u[o]=h,h)}var e=i(7),r=i(23),o=i(113),s=o.a.parseToFloat,u={},c=e.a.extend(function(){return{name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){this.name||(this.name="MATERIAL_"+this.__uid__);this.shader&&this.attachShader(this.shader,!0)},{precision:"highp",setUniform:function(n,t){t===undefined&&console.warn('Uniform value "'+n+'" is undefined');var i=this.uniforms[n];i&&(typeof t=="string"&&(t=s(t)||t),i.value=t,this.autoUpdateTextureStatus&&i.type==="t"&&(t?this.enableTexture(n):this.disableTexture(n)))},setUniforms:function(n){var t,i;for(t in n)i=n[t],this.setUniform(t,i)},isUniformEnabled:function(n){return this._enabledUniforms.indexOf(n)>=0},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(n,t){var i,r;if(typeof n=="object")for(i in n)r=n[i],this.setUniform(i,r);else this.setUniform(n,t)},get:function(n){var t=this.uniforms[n];if(t)return t.value},attachShader:function(n,t){var o=this.uniforms,u,s,h,f,e,i;if(this.uniforms=n.createUniforms(),this.shader=n,u=this.uniforms,this._enabledUniforms=Object.keys(u),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter(function(n){var t=this.uniforms[n].type;return t==="t"||t==="tv"},this),s=this.vertexDefines,h=this.fragmentDefines,this.vertexDefines=r.a.clone(n.vertexDefines),this.fragmentDefines=r.a.clone(n.fragmentDefines),t){for(f in o)u[f]&&(u[f].value=o[f].value);r.a.defaults(this.vertexDefines,s);r.a.defaults(this.fragmentDefines,h)}e={};for(i in n.textures)e[i]={shaderType:n.textures[i].shaderType,type:n.textures[i].type,enabled:t&&this._textureStatus[i]?this._textureStatus[i].enabled:!1};this._textureStatus=e;this._programKey=""},clone:function(){var n=new this.constructor({name:this.name,shader:this.shader});for(var t in this.uniforms)n.uniforms[t].value=this.uniforms[t].value;return n.depthTest=this.depthTest,n.depthMask=this.depthMask,n.transparent=this.transparent,n.blend=this.blend,n.vertexDefines=r.a.clone(this.vertexDefines),n.fragmentDefines=r.a.clone(this.fragmentDefines),n.enableTexture(this.getEnabledTextures()),n.precision=this.precision,n},define:function(n,t,i){var r=this.vertexDefines,u=this.fragmentDefines;n!=="vertex"&&n!=="fragment"&&n!=="both"&&arguments.length<3&&(i=t,t=n,n="both");i=i!=null?i:null;(n==="vertex"||n==="both")&&r[t]!==i&&(r[t]=i,this._programKey="");(n==="fragment"||n==="both")&&u[t]!==i&&(u[t]=i,n!=="both"&&(this._programKey=""))},undefine:function(n,t){n!=="vertex"&&n!=="fragment"&&n!=="both"&&arguments.length<2&&(t=n,n="both");(n==="vertex"||n==="both")&&this.isDefined("vertex",t)&&(delete this.vertexDefines[t],this._programKey="");(n==="fragment"||n==="both")&&this.isDefined("fragment",t)&&(delete this.fragmentDefines[t],n!=="both"&&(this._programKey=""))},isDefined:function(n,t){switch(n){case"vertex":return this.vertexDefines[t]!==undefined;case"fragment":return this.fragmentDefines[t]!==undefined}},getDefine:function(n,t){switch(n){case"vertex":return this.vertexDefines[t];case"fragment":return this.fragmentDefines[t]}},enableTexture:function(n){var t,i,r;if(Array.isArray(n)){for(t=0;t<n.length;t++)this.enableTexture(n[t]);return}i=this._textureStatus[n];i&&(r=i.enabled,r||(i.enabled=!0,this._programKey=""))},enableTexturesAll:function(){var n=this._textureStatus;for(var t in n)n[t].enabled=!0;this._programKey=""},disableTexture:function(n){var t,i,r;if(Array.isArray(n)){for(t=0;t<n.length;t++)this.disableTexture(n[t]);return}i=this._textureStatus[n];i&&(r=!i.enabled,r||(i.enabled=!1,this._programKey=""))},disableTexturesAll:function(){var n=this._textureStatus;for(var t in n)n[t].enabled=!1;this._programKey=""},isTextureEnabled:function(n){var t=this._textureStatus;return!!t[n]&&t[n].enabled},getEnabledTextures:function(){var n=[],t=this._textureStatus;for(var i in t)t[i].enabled&&n.push(i);return n},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){return this._programKey||(this._programKey=h(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}});t.a=c},function(n,t,i){"use strict";i.d(t,"b",function(){return r});i.d(t,"a",function(){return u});i.d(t,"c",function(){return f});var r=1e-6,u=Array,f=Math.random},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};r.clone=function(n){var t=new u.a(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n};r.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};r.transpose=function(n,t){if(n===t){var i=t[1],r=t[2],u=t[3],f=t[6],e=t[7],o=t[11];n[1]=t[4];n[2]=t[8];n[3]=t[12];n[4]=i;n[6]=t[9];n[7]=t[13];n[8]=r;n[9]=f;n[11]=t[14];n[12]=u;n[13]=e;n[14]=o}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n};r.invert=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],o=t[4],s=t[5],h=t[6],c=t[7],l=t[8],a=t[9],v=t[10],y=t[11],p=t[12],w=t[13],b=t[14],k=t[15],d=r*s-u*o,g=r*h-f*o,nt=r*c-e*o,tt=u*h-f*s,it=u*c-e*s,rt=f*c-e*h,ut=l*w-a*p,ft=l*b-v*p,et=l*k-y*p,ot=a*b-v*w,st=a*k-y*w,ht=v*k-y*b,i=d*ht-g*st+nt*ot+tt*et-it*ft+rt*ut;return i?(i=1/i,n[0]=(s*ht-h*st+c*ot)*i,n[1]=(f*st-u*ht-e*ot)*i,n[2]=(w*rt-b*it+k*tt)*i,n[3]=(v*it-a*rt-y*tt)*i,n[4]=(h*et-o*ht-c*ft)*i,n[5]=(r*ht-f*et+e*ft)*i,n[6]=(b*nt-p*rt-k*g)*i,n[7]=(l*rt-v*nt+y*g)*i,n[8]=(o*st-s*et+c*ut)*i,n[9]=(u*et-r*st-e*ut)*i,n[10]=(p*it-w*nt+k*d)*i,n[11]=(a*nt-l*it-y*d)*i,n[12]=(s*ft-o*ot-h*ut)*i,n[13]=(r*ot-u*ft+f*ut)*i,n[14]=(w*g-p*tt-b*d)*i,n[15]=(l*tt-a*g+v*d)*i,n):null};r.adjoint=function(n,t){var y=t[0],c=t[1],i=t[2],r=t[3],p=t[4],l=t[5],u=t[6],f=t[7],w=t[8],a=t[9],e=t[10],o=t[11],b=t[12],v=t[13],s=t[14],h=t[15];return n[0]=l*(e*h-o*s)-a*(u*h-f*s)+v*(u*o-f*e),n[1]=-(c*(e*h-o*s)-a*(i*h-r*s)+v*(i*o-r*e)),n[2]=c*(u*h-f*s)-l*(i*h-r*s)+v*(i*f-r*u),n[3]=-(c*(u*o-f*e)-l*(i*o-r*e)+a*(i*f-r*u)),n[4]=-(p*(e*h-o*s)-w*(u*h-f*s)+b*(u*o-f*e)),n[5]=y*(e*h-o*s)-w*(i*h-r*s)+b*(i*o-r*e),n[6]=-(y*(u*h-f*s)-p*(i*h-r*s)+b*(i*f-r*u)),n[7]=y*(u*o-f*e)-p*(i*o-r*e)+w*(i*f-r*u),n[8]=p*(a*h-o*v)-w*(l*h-f*v)+b*(l*o-f*a),n[9]=-(y*(a*h-o*v)-w*(c*h-r*v)+b*(c*o-r*a)),n[10]=y*(l*h-f*v)-p*(c*h-r*v)+b*(c*f-r*l),n[11]=-(y*(l*o-f*a)-p*(c*o-r*a)+w*(c*f-r*l)),n[12]=-(p*(a*s-e*v)-w*(l*s-u*v)+b*(l*e-u*a)),n[13]=y*(a*s-e*v)-w*(c*s-i*v)+b*(c*e-i*a),n[14]=-(y*(l*s-u*v)-p*(c*s-i*v)+b*(c*u-i*l)),n[15]=y*(l*e-u*a)-p*(c*e-i*a)+w*(c*u-i*l),n};r.determinant=function(n){var t=n[0],i=n[1],r=n[2],u=n[3],f=n[4],e=n[5],o=n[6],s=n[7],h=n[8],c=n[9],l=n[10],a=n[11],v=n[12],y=n[13],p=n[14],w=n[15],b=t*e-i*f,k=t*o-r*f,d=t*s-u*f,g=i*o-r*e,nt=i*s-u*e,tt=r*s-u*o,it=h*y-c*v,rt=h*p-l*v,ut=h*w-a*v,ft=c*p-l*y,et=c*w-a*y,ot=l*w-a*p;return b*ot-k*et+d*ft+g*ut-nt*rt+tt*it};r.multiply=function(n,t,i){var o=t[0],s=t[1],h=t[2],c=t[3],l=t[4],a=t[5],v=t[6],y=t[7],p=t[8],w=t[9],b=t[10],k=t[11],d=t[12],g=t[13],nt=t[14],tt=t[15],r=i[0],u=i[1],f=i[2],e=i[3];return n[0]=r*o+u*l+f*p+e*d,n[1]=r*s+u*a+f*w+e*g,n[2]=r*h+u*v+f*b+e*nt,n[3]=r*c+u*y+f*k+e*tt,r=i[4],u=i[5],f=i[6],e=i[7],n[4]=r*o+u*l+f*p+e*d,n[5]=r*s+u*a+f*w+e*g,n[6]=r*h+u*v+f*b+e*nt,n[7]=r*c+u*y+f*k+e*tt,r=i[8],u=i[9],f=i[10],e=i[11],n[8]=r*o+u*l+f*p+e*d,n[9]=r*s+u*a+f*w+e*g,n[10]=r*h+u*v+f*b+e*nt,n[11]=r*c+u*y+f*k+e*tt,r=i[12],u=i[13],f=i[14],e=i[15],n[12]=r*o+u*l+f*p+e*d,n[13]=r*s+u*a+f*w+e*g,n[14]=r*h+u*v+f*b+e*nt,n[15]=r*c+u*y+f*k+e*tt,n};r.multiplyAffine=function(n,t,i){var e=t[0],o=t[1],s=t[2],h=t[4],c=t[5],l=t[6],a=t[8],v=t[9],y=t[10],p=t[12],w=t[13],b=t[14],r=i[0],u=i[1],f=i[2];return n[0]=r*e+u*h+f*a,n[1]=r*o+u*c+f*v,n[2]=r*s+u*l+f*y,r=i[4],u=i[5],f=i[6],n[4]=r*e+u*h+f*a,n[5]=r*o+u*c+f*v,n[6]=r*s+u*l+f*y,r=i[8],u=i[9],f=i[10],n[8]=r*e+u*h+f*a,n[9]=r*o+u*c+f*v,n[10]=r*s+u*l+f*y,r=i[12],u=i[13],f=i[14],n[12]=r*e+u*h+f*a+p,n[13]=r*o+u*c+f*v+w,n[14]=r*s+u*l+f*y+b,n};r.mul=r.multiply;r.mulAffine=r.multiplyAffine;r.translate=function(n,t,i){var r=i[0],u=i[1],f=i[2],e,o,s,h,c,l,a,v,y,p,w,b;return t===n?(n[12]=t[0]*r+t[4]*u+t[8]*f+t[12],n[13]=t[1]*r+t[5]*u+t[9]*f+t[13],n[14]=t[2]*r+t[6]*u+t[10]*f+t[14],n[15]=t[3]*r+t[7]*u+t[11]*f+t[15]):(e=t[0],o=t[1],s=t[2],h=t[3],c=t[4],l=t[5],a=t[6],v=t[7],y=t[8],p=t[9],w=t[10],b=t[11],n[0]=e,n[1]=o,n[2]=s,n[3]=h,n[4]=c,n[5]=l,n[6]=a,n[7]=v,n[8]=y,n[9]=p,n[10]=w,n[11]=b,n[12]=e*r+c*u+y*f+t[12],n[13]=o*r+l*u+p*f+t[13],n[14]=s*r+a*u+w*f+t[14],n[15]=h*r+v*u+b*f+t[15]),n};r.scale=function(n,t,i){var r=i[0],u=i[1],f=i[2];return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*u,n[5]=t[5]*u,n[6]=t[6]*u,n[7]=t[7]*u,n[8]=t[8]*f,n[9]=t[9]*f,n[10]=t[10]*f,n[11]=t[11]*f,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n};r.rotate=function(n,t,i,r){var f=r[0],e=r[1],o=r[2],c=Math.sqrt(f*f+e*e+o*o),h,l,s,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,a,v,y,p,w,b,k,d,g;return Math.abs(c)<u.b?null:(c=1/c,f*=c,e*=c,o*=c,h=Math.sin(i),l=Math.cos(i),s=1-l,nt=t[0],tt=t[1],it=t[2],rt=t[3],ut=t[4],ft=t[5],et=t[6],ot=t[7],st=t[8],ht=t[9],ct=t[10],lt=t[11],a=f*f*s+l,v=e*f*s+o*h,y=o*f*s-e*h,p=f*e*s-o*h,w=e*e*s+l,b=o*e*s+f*h,k=f*o*s+e*h,d=e*o*s-f*h,g=o*o*s+l,n[0]=nt*a+ut*v+st*y,n[1]=tt*a+ft*v+ht*y,n[2]=it*a+et*v+ct*y,n[3]=rt*a+ot*v+lt*y,n[4]=nt*p+ut*w+st*b,n[5]=tt*p+ft*w+ht*b,n[6]=it*p+et*w+ct*b,n[7]=rt*p+ot*w+lt*b,n[8]=nt*k+ut*d+st*g,n[9]=tt*k+ft*d+ht*g,n[10]=it*k+et*d+ct*g,n[11]=rt*k+ot*d+lt*g,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)};r.rotateX=function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f=t[4],e=t[5],o=t[6],s=t[7],h=t[8],c=t[9],l=t[10],a=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=f*u+h*r,n[5]=e*u+c*r,n[6]=o*u+l*r,n[7]=s*u+a*r,n[8]=h*u-f*r,n[9]=c*u-e*r,n[10]=l*u-o*r,n[11]=a*u-s*r,n};r.rotateY=function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f=t[0],e=t[1],o=t[2],s=t[3],h=t[8],c=t[9],l=t[10],a=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*u-h*r,n[1]=e*u-c*r,n[2]=o*u-l*r,n[3]=s*u-a*r,n[8]=f*r+h*u,n[9]=e*r+c*u,n[10]=o*r+l*u,n[11]=s*r+a*u,n};r.rotateZ=function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f=t[0],e=t[1],o=t[2],s=t[3],h=t[4],c=t[5],l=t[6],a=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*u+h*r,n[1]=e*u+c*r,n[2]=o*u+l*r,n[3]=s*u+a*r,n[4]=h*u-f*r,n[5]=c*u-e*r,n[6]=l*u-o*r,n[7]=a*u-s*r,n};r.fromRotationTranslation=function(n,t,i){var r=t[0],u=t[1],e=t[2],o=t[3],h=r+r,s=u+u,f=e+e,c=r*h,l=r*s,a=r*f,v=u*s,y=u*f,p=e*f,w=o*h,b=o*s,k=o*f;return n[0]=1-(v+p),n[1]=l+k,n[2]=a-b,n[3]=0,n[4]=l-k,n[5]=1-(c+p),n[6]=y+w,n[7]=0,n[8]=a+b,n[9]=y-w,n[10]=1-(c+v),n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n};r.fromQuat=function(n,t){var f=t[0],r=t[1],i=t[2],e=t[3],u=f+f,o=r+r,s=i+i,h=f*u,c=r*u,l=r*o,a=i*u,v=i*o,y=i*s,p=e*u,w=e*o,b=e*s;return n[0]=1-l-y,n[1]=c+b,n[2]=a-w,n[3]=0,n[4]=c-b,n[5]=1-h-y,n[6]=v+p,n[7]=0,n[8]=a+w,n[9]=v-p,n[10]=1-h-l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};r.frustum=function(n,t,i,r,u,f,e){var o=1/(i-t),s=1/(u-r),h=1/(f-e);return n[0]=f*2*o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f*2*s,n[6]=0,n[7]=0,n[8]=(i+t)*o,n[9]=(u+r)*s,n[10]=(e+f)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=e*f*2*h,n[15]=0,n};r.perspective=function(n,t,i,r,u){var f=1/Math.tan(t/2),e=1/(r-u);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(u+r)*e,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*u*r*e,n[15]=0,n};r.ortho=function(n,t,i,r,u,f,e){var o=1/(t-i),s=1/(r-u),h=1/(f-e);return n[0]=-2*o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(t+i)*o,n[13]=(u+r)*s,n[14]=(e+f)*h,n[15]=1,n};r.lookAt=function(n,t,i,f){var c,l,a,v,y,p,o,s,h,e,w=t[0],b=t[1],k=t[2],d=f[0],g=f[1],nt=f[2],tt=i[0],it=i[1],rt=i[2];return Math.abs(w-tt)<u.b&&Math.abs(b-it)<u.b&&Math.abs(k-rt)<u.b?r.identity(n):(o=w-tt,s=b-it,h=k-rt,e=1/Math.sqrt(o*o+s*s+h*h),o*=e,s*=e,h*=e,c=g*h-nt*s,l=nt*o-d*h,a=d*s-g*o,e=Math.sqrt(c*c+l*l+a*a),e?(e=1/e,c*=e,l*=e,a*=e):(c=0,l=0,a=0),v=s*a-h*l,y=h*c-o*a,p=o*l-s*c,e=Math.sqrt(v*v+y*y+p*p),e?(e=1/e,v*=e,y*=e,p*=e):(v=0,y=0,p=0),n[0]=c,n[1]=v,n[2]=o,n[3]=0,n[4]=l,n[5]=y,n[6]=s,n[7]=0,n[8]=a,n[9]=p,n[10]=h,n[11]=0,n[12]=-(c*w+l*b+a*k),n[13]=-(v*w+y*b+p*k),n[14]=-(o*w+s*b+h*k),n[15]=1,n)};r.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2)+Math.pow(n[9],2)+Math.pow(n[10],2)+Math.pow(n[11],2)+Math.pow(n[12],2)+Math.pow(n[13],2)+Math.pow(n[14],2)+Math.pow(n[15],2))};t.a=r},function(n,t,i){"use strict";function r(n){var r,t,u,i,f;for(n=n||"perspective",this.layer=null,this.scene=new a.a,this.rootNode=this.scene,this.viewport={x:0,y:0,width:0,height:0},this.setProjection(n),this._compositor=new w.a,this._temporalSS=new b.a,this._shadowMapPass=new v.a,r=[],t=0,u=0;u<30;u++){for(i=[],f=0;f<6;f++)i.push(Object(h.a)(t,2)*4-2),i.push(Object(h.a)(t,3)*4-2),t++;r.push(i)}this._pcfKernels=r;this.scene.on("beforerender",function(n,t,i){this.needsTemporalSS()&&this._temporalSS.jitterProjection(n,i)},this)}var c=i(0),l=i.n(c),a=i(36),v=i(174),u=i(41),e=i(37),o=i(9),s=i(3),y=i(26),p=i(53),w=i(176),b=i(200),h=i(49),f;r.prototype.setProjection=function(n){var t=this.camera;t&&t.update();n==="perspective"?this.camera instanceof u.a||(this.camera=new u.a,t&&this.camera.setLocalTransform(t.localTransform)):this.camera instanceof e.a||(this.camera=new e.a,t&&this.camera.setLocalTransform(t.localTransform));this.camera.near=.1;this.camera.far=2e3};r.prototype.setViewport=function(n,t,i,r,f){this.camera instanceof u.a&&(this.camera.aspect=i/r);f=f||1;this.viewport.x=n;this.viewport.y=t;this.viewport.width=i;this.viewport.height=r;this.viewport.devicePixelRatio=f;this._compositor.resize(i*f,r*f);this._temporalSS.resize(i*f,r*f)};r.prototype.containPoint=function(n,t){var i=this.viewport,r=this.layer.renderer.getHeight();return t=r-t,n>=i.x&&t>=i.y&&n<=i.x+i.width&&t<=i.y+i.height};f=new y.a;r.prototype.castRay=function(n,t,i){var r=this.layer.renderer,u=r.viewport;return r.viewport=this.viewport,r.screenToNDC(n,t,f),this.camera.castRay(f,i),r.viewport=u,i};r.prototype.prepareRender=function(){var i,t,r,n;for(this.scene.update(),this.camera.update(),this.scene.updateLights(),i=this.scene.updateRenderList(this.camera),this._needsSortProgressively=!1,t=0;t<i.transparent.length;t++)r=i.transparent[t],n=r.geometry,n.needsSortVerticesProgressively&&n.needsSortVerticesProgressively()&&(this._needsSortProgressively=!0),n.needsSortTrianglesProgressively&&n.needsSortTrianglesProgressively()&&(this._needsSortProgressively=!0);this._frame=0;this._temporalSS.resetFrame()};r.prototype.render=function(n,t){this._doRender(n,t,this._frame);this._frame++};r.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively};r.prototype.needsTemporalSS=function(){var n=this._enableTemporalSS;return n==="auto"&&(n=this._enablePostEffect),n};r.prototype.hasDOF=function(){return this._enableDOF};r.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():this._frame>30};r.prototype._doRender=function(n,t,i){var u=this.scene,r=this.camera,e,f;i=i||0;this._updateTransparent(n,u,r,i);t||(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(n,u,r,!0));this._updateShadowPCFKernel(i);e=n.clearColor;n.gl.clearColor(e[0],e[1],e[2],e[3]);this._enablePostEffect&&(this.needsTemporalSS()&&this._temporalSS.jitterProjection(n,r),this._compositor.updateNormal(n,u,r,this._temporalSS.getFrame()));this._updateSSAO(n,u,r,this._temporalSS.getFrame());this._enablePostEffect?(f=this._compositor.getSourceFrameBuffer(),f.bind(n),n.gl.clear(n.gl.DEPTH_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT),n.render(u,r,!0,!0),f.unbind(n),this.needsTemporalSS()&&t?(this._compositor.composite(n,u,r,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),n.setViewport(this.viewport),this._temporalSS.render(n)):(n.setViewport(this.viewport),this._compositor.composite(n,u,r,null,0))):this.needsTemporalSS()&&t?(f=this._temporalSS.getSourceFrameBuffer(),f.bind(n),n.saveClear(),n.clearBit=n.gl.DEPTH_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT,n.render(u,r,!0,!0),n.restoreClear(),f.unbind(n),n.setViewport(this.viewport),this._temporalSS.render(n)):(n.setViewport(this.viewport),n.render(u,r,!0,!0))};r.prototype._updateTransparent=function(n,t,i,r){for(var h,u,f=new s.a,c=new o.a,a=i.getWorldPosition(),l=t.getRenderList(i).transparent,e=0;e<l.length;e++)h=l[e],u=h.geometry,o.a.invert(c,h.worldTransform),s.a.transformMat4(f,a,c),u.needsSortTriangles&&u.needsSortTriangles()&&u.doSortTriangles(f,r),u.needsSortVertices&&u.needsSortVertices()&&u.doSortVertices(f,r)};r.prototype._updateSSAO=function(n,t,i){var f=this._enableSSAO&&this._enablePostEffect,e,r,u;for(f&&this._compositor.updateSSAO(n,t,i,this._temporalSS.getFrame()),e=t.getRenderList(i),r=0;r<e.opaque.length;r++)u=e.opaque[r],u.renderNormal&&u.material[f?"enableTexture":"disableTexture"]("ssaoMap"),f&&u.material.set("ssaoMap",this._compositor.getSSAOTexture())};r.prototype._updateShadowPCFKernel=function(n){for(var r=this._pcfKernels[n%this._pcfKernels.length],u=this.scene.getRenderList(this.camera),i=u.opaque,t=0;t<i.length;t++)i[t].receiveShadow&&(i[t].material.set("pcfKernel",r),i[t].material.define("fragment","PCF_KERNEL_SIZE",r.length/2))};r.prototype.dispose=function(n){this._compositor.dispose(n.gl);this._temporalSS.dispose(n.gl);this._shadowMapPass.dispose(n)};r.prototype.setPostEffect=function(n,t){var i=this._compositor;this._enablePostEffect=n.get("enable");var f=n.getModel("bloom"),e=n.getModel("edge"),u=n.getModel("DOF",n.getModel("depthOfField")),o=n.getModel("SSAO",n.getModel("screenSpaceAmbientOcclusion")),s=n.getModel("SSR",n.getModel("screenSpaceReflection")),h=n.getModel("FXAA"),r=n.getModel("colorCorrection");f.get("enable")?i.enableBloom():i.disableBloom();u.get("enable")?i.enableDOF():i.disableDOF();s.get("enable")?i.enableSSR():i.disableSSR();r.get("enable")?i.enableColorCorrection():i.disableColorCorrection();e.get("enable")?i.enableEdge():i.disableEdge();h.get("enable")?i.enableFXAA():i.disableFXAA();this._enableDOF=u.get("enable");this._enableSSAO=o.get("enable");this._enableSSAO?i.enableSSAO():i.disableSSAO();i.setBloomIntensity(f.get("intensity"));i.setEdgeColor(e.get("color"));i.setColorLookupTexture(r.get("lookupTexture"),t);i.setExposure(r.get("exposure"));["radius","quality","intensity"].forEach(function(n){i.setSSAOParameter(n,o.get(n))});["quality","maxRoughness","physical"].forEach(function(n){i.setSSRParameter(n,s.get(n))});["quality","focalDistance","focalRange","blurRadius","fstop"].forEach(function(n){i.setDOFParameter(n,u.get(n))});["brightness","contrast","saturation"].forEach(function(n){i.setColorCorrection(n,r.get(n))})};r.prototype.setDOFFocusOnPoint=function(n){if(this._enablePostEffect)return n>this.camera.far||n<this.camera.near?void 0:(this._compositor.setDOFParameter("focalDistance",n),!0)};r.prototype.setTemporalSuperSampling=function(n){this._enableTemporalSS=n.get("enable")};r.prototype.isLinearSpace=function(){return this._enablePostEffect};r.prototype.setRootNode=function(n){var i,t;if(this.rootNode!==n){for(i=this.rootNode.children(),t=0;t<i.length;t++)n.add(i[t]);n!==this.scene&&this.scene.add(n);this.rootNode=n}};r.prototype.add=function(n){this.rootNode.add(n)};r.prototype.remove=function(n){this.rootNode.remove(n)};r.prototype.removeAll=function(n){this.rootNode.removeAll(n)};l.a.util.extend(r.prototype,p.a);t.a=r},function(n,t){"use strict";var r=0,u=Array.prototype,f=u.forEach,i={genGUID:function(){return++r},relative2absolute:function(n,t){if(!t||n.match(/^\//))return n;for(var i=n.split("/"),u=t.split("/"),r=i[0];r==="."||r==="..";)r===".."&&u.pop(),i.shift(),r=i[0];return u.join("/")+"/"+i.join("/")},extend:function(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},defaults:function(n,t){if(t)for(var i in t)n[i]===undefined&&(n[i]=t[i]);return n},extendWithPropList:function(n,t,i){var r,u;if(t)for(r=0;r<i.length;r++)u=i[r],n[u]=t[u];return n},defaultsWithPropList:function(n,t,i){var r,u;if(t)for(r=0;r<i.length;r++)u=i[r],n[u]==null&&(n[u]=t[u]);return n},each:function(n,t,i){var r,e,u;if(n&&t)if(n.forEach&&n.forEach===f)n.forEach(t,i);else if(n.length===+n.length)for(r=0,e=n.length;r<e;r++)t.call(i,n[r],r,n);else for(u in n)n.hasOwnProperty(u)&&t.call(i,n[u],u,n)},isObject:function(n){return n===Object(n)},isArray:function(n){return Array.isArray(n)},isArrayLike:function(n){return n?n.length===+n.length:!1},clone:function(n){var r,t;if(i.isObject(n)){if(i.isArray(n))return n.slice();if(i.isArrayLike(n)){for(r=new n.constructor(n.length),t=0;t<n.length;t++)r[t]=n[t];return r}return i.extend({},n)}return n}};t.a=i},function(n,t,i){"use strict";var r=i(35),f=i(8),e=i(119),u;f.a["import"](e.a);u=r.a.extend(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}},{type:"",clone:function(){var n=r.a.prototype.clone.call(this);return n.color=Array.prototype.slice.call(this.color),n.intensity=this.intensity,n.castShadow=this.castShadow,n.shadowResolution=this.shadowResolution,n}});t.a=u},function(n,t,i){"use strict";var r=i(15),o=i(0),s=i.n(o),h=i(38),c=i(6),u=c.a.vec3,f=[[0,0],[1,1]],e=r.a.extend(function(){return{segmentScale:1,dynamic:!0,useNativeLine:!0,attributes:{position:new r.a.Attribute("position","float",3,"POSITION"),positionPrev:new r.a.Attribute("positionPrev","float",3),positionNext:new r.a.Attribute("positionNext","float",3),prevPositionPrev:new r.a.Attribute("prevPositionPrev","float",3),prevPosition:new r.a.Attribute("prevPosition","float",3),prevPositionNext:new r.a.Attribute("prevPositionNext","float",3),offset:new r.a.Attribute("offset","float",1),color:new r.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._triangleOffset=0;this._itemVertexOffsets=[]},setVertexCount:function(n){var t=this.attributes;this.vertexCount!==n&&(t.position.init(n),t.color.init(n),this.useNativeLine||(t.positionPrev.init(n),t.positionNext.init(n),t.offset.init(n)),n>65535?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(n){this.triangleCount!==n&&(this.indices=n===0?null:this.vertexCount>65535?new Uint32Array(n*3):new Uint16Array(n*3))},_getCubicCurveApproxStep:function(n,t,i,r){var f=u.dist(n,t)+u.dist(i,t)+u.dist(r,i);return 1/(f+1)*this.segmentScale},getCubicCurveVertexCount:function(n,t,i,r){var f=this._getCubicCurveApproxStep(n,t,i,r),u=Math.ceil(1/f);return this.useNativeLine?u*2:u*2+2},getCubicCurveTriangleCount:function(n,t,i,r){var u=this._getCubicCurveApproxStep(n,t,i,r),f=Math.ceil(1/u);return this.useNativeLine?0:f*2},getLineVertexCount:function(){return this.getPolylineVertexCount(f)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(f)},getPolylineVertexCount:function(n){var t,i;return typeof n=="number"?t=n:(i=typeof n[0]!="number",t=i?n.length:n.length/3),this.useNativeLine?(t-1)*2:(t-1)*2+2},getPolylineTriangleCount:function(n){var t,i;return typeof n=="number"?t=n:(i=typeof n[0]!="number",t=i?n.length:n.length/3),this.useNativeLine?0:Math.max(t-1,0)*2},addCubicCurve:function(n,t,i,r,u,f){var lt;f==null&&(f=1);for(var l=n[0],a=n[1],v=n[2],w=t[0],b=t[1],k=t[2],vt=i[0],yt=i[1],pt=i[2],d=r[0],g=r[1],nt=r[2],e=this._getCubicCurveApproxStep(n,t,i,r),tt=e*e,y=tt*e,it=3*e,rt=3*tt,ut=6*tt,o=6*y,wt=l-w*2+vt,bt=a-b*2+yt,kt=v-k*2+pt,ft=(w-vt)*3-l+d,et=(b-yt)*3-a+g,ot=(k-pt)*3-v+nt,s=l,h=a,c=v,st=(w-l)*it+wt*rt+ft*y,ht=(b-a)*it+bt*rt+et*y,ct=(k-v)*it+kt*rt+ot*y,dt=wt*ut+ft*o,gt=bt*ut+et*o,ni=kt*ut+ot*o,ri=ft*o,ui=et*o,fi=ot*o,ti=0,lt=0,ii=Math.ceil(1/e),p=new Float32Array((ii+1)*3),p=[],at=0,lt=0;lt<ii+1;lt++)p[at++]=s,p[at++]=h,p[at++]=c,s+=st,h+=ht,c+=ct,st+=dt,ht+=gt,ct+=ni,dt+=ri,gt+=ui,ni+=fi,ti+=e,ti>1&&(s=st>0?Math.min(s,d):Math.max(s,d),h=ht>0?Math.min(h,g):Math.max(h,g),c=ct>0?Math.min(c,nt):Math.max(c,nt));return this.addPolyline(p,u,f)},addLine:function(n,t,i,r){return this.addPolyline([n,t],i,r)},addPolyline:function(n,t,i,r,u){var y,s,d,l,c,h,a,v;if(n.length&&(y=typeof n[0]!="number",u==null&&(u=y?n.length:n.length/3),!(u<2))){r==null&&(r=0);i==null&&(i=1);this._itemVertexOffsets.push(this._vertexOffset);var y=typeof n[0]!="number",g=y?typeof t[0]!="number":t.length/4===u,p=this.attributes.position,w=this.attributes.positionPrev,b=this.attributes.positionNext,k=this.attributes.color,nt=this.attributes.offset,h=this.indices,f=this._vertexOffset,e,o;for(i=Math.max(i,.01),s=r;s<u;s++)y?(e=n[s],o=g?t[s]:t):(d=s*3,e=e||[],e[0]=n[d],e[1]=n[d+1],e[2]=n[d+2],g?(l=s*4,o=o||[],o[0]=t[l],o[1]=t[l+1],o[2]=t[l+2],o[3]=t[l+3]):o=t),this.useNativeLine?s>1&&(p.copy(f,f-1),k.copy(f,f-1),f++):(s<u-1&&(w.set(f+2,e),w.set(f+3,e)),s>0&&(b.set(f-2,e),b.set(f-1,e)),p.set(f,e),p.set(f+1,e),k.set(f,o),k.set(f+1,o),nt.set(f,i/2),nt.set(f+1,-i/2),f+=2),this.useNativeLine?(k.set(f,o),p.set(f,e),f++):s>0&&(c=this._triangleOffset*3,h=this.indices,h[c]=f-4,h[c+1]=f-3,h[c+2]=f-2,h[c+3]=f-3,h[c+4]=f-1,h[c+5]=f-2,this._triangleOffset+=2);return this.useNativeLine||(a=this._vertexOffset,v=this._vertexOffset+u*2,w.copy(a,a+2),w.copy(a+1,a+3),b.copy(v-1,v-3),b.copy(v-2,v-4)),this._vertexOffset=f,this._vertexOffset}},setItemColor:function(n,t){for(var r=this._itemVertexOffsets[n],u=n<this._itemVertexOffsets.length-1?this._itemVertexOffsets[n+1]:this._vertexOffset,i=r;i<u;i++)this.attributes.color.set(i,t);this.dirty("color")},currentTriangleOffset:function(){return this._triangleOffset},currentVertexOffset:function(){return this._vertexOffset}});s.a.util.defaults(e.prototype,h.a);t.a=e},function(n,t,i){"use strict";var r=i(70),u=function(n,t){n=n||0;t=t||0;this.array=r.a.fromValues(n,t);this._dirty=!0},f;u.prototype={constructor:u,add:function(n){return r.a.add(this.array,this.array,n.array),this._dirty=!0,this},set:function(n,t){return this.array[0]=n,this.array[1]=t,this._dirty=!0,this},setArray:function(n){return this.array[0]=n[0],this.array[1]=n[1],this._dirty=!0,this},clone:function(){return new u(this.x,this.y)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},cross:function(n,t){return r.a.cross(n.array,this.array,t.array),n._dirty=!0,this},dist:function(n){return r.a.dist(this.array,n.array)},distance:function(n){return r.a.distance(this.array,n.array)},div:function(n){return r.a.div(this.array,this.array,n.array),this._dirty=!0,this},divide:function(n){return r.a.divide(this.array,this.array,n.array),this._dirty=!0,this},dot:function(n){return r.a.dot(this.array,n.array)},len:function(){return r.a.len(this.array)},length:function(){return r.a.length(this.array)},lerp:function(n,t,i){return r.a.lerp(this.array,n.array,t.array,i),this._dirty=!0,this},min:function(n){return r.a.min(this.array,this.array,n.array),this._dirty=!0,this},max:function(n){return r.a.max(this.array,this.array,n.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},negate:function(){return r.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return r.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(n){return r.a.random(this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n),this._dirty=!0,this},scaleAndAdd:function(n,t){return r.a.scaleAndAdd(this.array,this.array,n.array,t),this._dirty=!0,this},sqrDist:function(n){return r.a.sqrDist(this.array,n.array)},squaredDistance:function(n){return r.a.squaredDistance(this.array,n.array)},sqrLen:function(){return r.a.sqrLen(this.array)},squaredLength:function(){return r.a.squaredLength(this.array)},sub:function(n){return r.a.sub(this.array,this.array,n.array),this._dirty=!0,this},subtract:function(n){return r.a.subtract(this.array,this.array,n.array),this._dirty=!0,this},transformMat2:function(n){return r.a.transformMat2(this.array,this.array,n.array),this._dirty=!0,this},transformMat2d:function(n){return r.a.transformMat2d(this.array,this.array,n.array),this._dirty=!0,this},transformMat3:function(n){return r.a.transformMat3(this.array,this.array,n.array),this._dirty=!0,this},transformMat4:function(n){return r.a.transformMat4(this.array,this.array,n.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};Object.defineProperty&&(f=u.prototype,Object.defineProperty(f,"x",{get:function(){return this.array[0]},set:function(n){this.array[0]=n;this._dirty=!0}}),Object.defineProperty(f,"y",{get:function(){return this.array[1]},set:function(n){this.array[1]=n;this._dirty=!0}}));u.add=function(n,t,i){return r.a.add(n.array,t.array,i.array),n._dirty=!0,n};u.set=function(n,t,i){return r.a.set(n.array,t,i),n._dirty=!0,n};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.cross=function(n,t,i){return r.a.cross(n.array,t.array,i.array),n._dirty=!0,n};u.dist=function(n,t){return r.a.distance(n.array,t.array)};u.distance=u.dist;u.div=function(n,t,i){return r.a.divide(n.array,t.array,i.array),n._dirty=!0,n};u.divide=u.div;u.dot=function(n,t){return r.a.dot(n.array,t.array)};u.len=function(n){return r.a.length(n.array)};u.lerp=function(n,t,i,u){return r.a.lerp(n.array,t.array,i.array,u),n._dirty=!0,n};u.min=function(n,t,i){return r.a.min(n.array,t.array,i.array),n._dirty=!0,n};u.max=function(n,t,i){return r.a.max(n.array,t.array,i.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.multiply(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.negate=function(n,t){return r.a.negate(n.array,t.array),n._dirty=!0,n};u.normalize=function(n,t){return r.a.normalize(n.array,t.array),n._dirty=!0,n};u.random=function(n,t){return r.a.random(n.array,t),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i),n._dirty=!0,n};u.scaleAndAdd=function(n,t,i,u){return r.a.scaleAndAdd(n.array,t.array,i.array,u),n._dirty=!0,n};u.sqrDist=function(n,t){return r.a.sqrDist(n.array,t.array)};u.squaredDistance=u.sqrDist;u.sqrLen=function(n){return r.a.sqrLen(n.array)};u.squaredLength=u.sqrLen;u.sub=function(n,t,i){return r.a.subtract(n.array,t.array,i.array),n._dirty=!0,n};u.subtract=u.sub;u.transformMat2=function(n,t,i){return r.a.transformMat2(n.array,t.array,i.array),n._dirty=!0,n};u.transformMat2d=function(n,t,i){return r.a.transformMat2d(n.array,t.array,i.array),n._dirty=!0,n};u.transformMat3=function(n,t,i){return r.a.transformMat3(n.array,t.array,i.array),n._dirty=!0,n};u.transformMat4=function(n,t,i){return r.a.transformMat4(n.array,t.array,i.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";function r(n){return n.nodeName==="CANVAS"||n.nodeName==="VIDEO"||n.complete}var e=i(4),o=i(11),s=i(23),h=i(73),c=i(14),u=h.a.isPowerOfTwo,l=["px","nx","py","ny","pz","nz"],f=e.a.extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:"textureCube",update:function(n){var t=n.gl,u,i,f,h,e,s,r,c;if(t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.updateCommon(n),u=this.format,i=this.type,t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this.getAvailableWrapS()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this.getAvailableWrapT()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this.getAvailableMinFilter()),f=n.getGLExtension("EXT_texture_filter_anisotropic"),f&&this.anisotropic>1&&t.texParameterf(t.TEXTURE_CUBE_MAP,f.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),i===36193&&(h=n.getGLExtension("OES_texture_half_float"),h||(i=o.a.FLOAT)),this.mipmaps.length)for(e=this.width,s=this.height,r=0;r<this.mipmaps.length;r++)c=this.mipmaps[r],this._updateTextureData(t,c,r,e,s,u,i),e/=2,s/=2;else this._updateTextureData(t,this,0,this.width,this.height,u,i),!this.NPOT&&this.useMipmap&&t.generateMipmap(t.TEXTURE_CUBE_MAP);t.bindTexture(t.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(n,t,i,r,u,f,e){for(var s,h,o=0;o<6;o++)s=l[o],h=t.image&&t.image[s],h?n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,i,f,f,e,h):n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,i,f,r,u,0,f,e,t.pixels&&t.pixels[s])},generateMipmap:function(n){var t=n.gl;this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),t.generateMipmap(t.TEXTURE_CUBE_MAP))},bind:function(n){n.gl.bindTexture(n.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(n))},unbind:function(n){n.gl.bindTexture(n.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?u(this.image.px.width)&&u(this.image.px.height):u(this.width)&&u(this.height)},isRenderable:function(){return this.image.px?r(this.image.px)&&r(this.image.nx)&&r(this.image.py)&&r(this.image.ny)&&r(this.image.pz)&&r(this.image.nz):!!(this.width&&this.height)},load:function(n,t){var i=0,r=this;return s.a.each(n,function(n,u){var f=c.a.createImage();t&&(f.crossOrigin=t);f.onload=function(){i--;i===0&&(r.dirty(),r.trigger("success",r));f.onload=null};f.onerror=function(){i--;f.onerror=null};i++;f.src=n;r.image[u]=f}),this}});Object.defineProperty(f.prototype,"width",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(n){this.image&&this.image.px?console.warn("Texture from image can't set width"):(this._width!==n&&this.dirty(),this._width=n)}});Object.defineProperty(f.prototype,"height",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(n){this.image&&this.image.px?console.warn("Texture from image can't set height"):(this._height!==n&&this.dirty(),this._height=n)}});t.a=f},function(n,t){"use strict";t.a={defaultOption:{postEffect:{enable:!1,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:"medium"},screenSpaceAmbientOcclusion:{enable:!1,radius:2,quality:"medium",intensity:1},screenSpaceReflection:{enable:!1,quality:"medium",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},edge:{enable:!1},FXAA:{enable:!1}},temporalSuperSampling:{enable:"auto"}}}},function(n,t){"use strict";t.a={defaultOption:{light:{main:{shadow:!1,shadowQuality:"high",color:"#fff",intensity:1,alpha:0,beta:0},ambient:{color:"#fff",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}}},function(n,t,i){"use strict";function u(){}var r=i(1),e=i(42),o=i(0),f=i.n(o);u.prototype={constructor:u,setScene:function(n){this._scene=n;this._skybox&&this._skybox.attachScene(this._scene)},initLight:function(n){this._lightRoot=n;this.mainLight=new r.a.DirectionalLight({shadowBias:.005});this.ambientLight=new r.a.AmbientLight;n.add(this.mainLight);n.add(this.ambientLight)},dispose:function(){this._lightRoot&&(this._lightRoot.remove(this.mainLight),this._lightRoot.remove(this.ambientLight))},updateLight:function(n){var t=this.mainLight,u=this.ambientLight,f=n.getModel("light"),i=f.getModel("main"),e=f.getModel("ambient"),o,s;t.intensity=i.get("intensity");u.intensity=e.get("intensity");t.color=r.a.parseColor(i.get("color")).slice(0,3);u.color=r.a.parseColor(e.get("color")).slice(0,3);o=i.get("alpha")||0;s=i.get("beta")||0;t.position.setArray(r.a.directionFromAlphaBeta(o,s));t.lookAt(r.a.Vector3.ZERO);t.castShadow=i.get("shadow");t.shadowResolution=r.a.getShadowResolution(i.get("shadowQuality"))},updateAmbientCubemap:function(n,t,i){var o=t.getModel("light.ambientCubemap"),f=o.get("texture"),u,e;f?(this._cubemapLightsCache=this._cubemapLightsCache||{},u=this._cubemapLightsCache[f],u||(e=this,u=this._cubemapLightsCache[f]=r.a.createAmbientCubemap(o.option,n,i,function(){e._isSkyboxFromAmbientCubemap&&e._skybox.setEnvironmentMap(u.specular.cubemap);i.getZr().refresh()})),this._lightRoot.add(u.diffuse),this._lightRoot.add(u.specular),this._currentCubemapLights=u):this._currentCubemapLights&&(this._lightRoot.remove(this._currentCubemapLights.diffuse),this._lightRoot.remove(this._currentCubemapLights.specular),this._currentCubemapLights=null)},updateSkybox:function(n,t,i){function w(){return l._skybox=l._skybox||new e.a,l._skybox}var u=t.get("environment"),l=this,o=w(),a,h,v,y,s,c,p;u&&u!=="none"?u==="auto"?(this._isSkyboxFromAmbientCubemap=!0,this._currentCubemapLights?(a=this._currentCubemapLights.specular.cubemap,o.setEnvironmentMap(a),this._scene&&o.attachScene(this._scene),o.material.set("lod",3)):this._skybox&&this._skybox.detachScene()):typeof u=="object"&&u.colorStops||typeof u=="string"&&f.a.color.parse(u)?(this._isSkyboxFromAmbientCubemap=!1,s=new r.a.Texture2D({anisotropic:8,flipY:!1}),o.setEnvironmentMap(s),h=s.image=document.createElement("canvas"),h.width=h.height=16,v=h.getContext("2d"),y=new f.a.graphic.Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:u}}),y.brush(v),o.attachScene(this._scene)):(this._isSkyboxFromAmbientCubemap=!1,s=r.a.loadTexture(u,i,{anisotropic:8,flipY:!1}),o.setEnvironmentMap(s),o.attachScene(this._scene)):(this._skybox&&this._skybox.detachScene(this._scene),this._skybox=null);c=t.coordinateSystem;this._skybox&&(!c||!c.viewGL||u==="auto"||u.match&&u.match(/.hdr$/)?this._skybox.material.undefine("fragment","SRGB_DECODE"):(p=c.viewGL.isLinearSpace()?"define":"undefine",this._skybox.material[p]("fragment","SRGB_DECODE")))}};t.a=u},function(n,t){"use strict";t.a={defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:"#fff"}}}},function(n,t,i){"use strict";var u=i(0),f=i.n(u),r={};r.getFormattedLabel=function(n,t,i,r,u){var e,s;i=i||"normal";var c=n.getData(r),h=c.getItemModel(t),o=n.getDataParams(t,r);return u!=null&&o.value instanceof Array&&(o.value=o.value[u]),e=h.get(i==="normal"?["label","formatter"]:["emphasis","label","formatter"]),e==null&&(e=h.get(["label","formatter"])),typeof e=="function"?(o.status=i,s=e(o)):typeof e=="string"&&(s=f.a.format.formatTpl(e,o)),s};r.normalizeToArray=function(n){return n instanceof Array?n:n==null?[]:[n]};t.a=r},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n};r.clone=function(n){var t=new u.a(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t};r.fromValues=function(n,t,i,r){var f=new u.a(4);return f[0]=n,f[1]=t,f[2]=i,f[3]=r,f};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n};r.set=function(n,t,i,r,u){return n[0]=t,n[1]=i,n[2]=r,n[3]=u,n};r.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n[3]=t[3]+i[3],n};r.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n[3]=t[3]-i[3],n};r.sub=r.subtract;r.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n};r.mul=r.multiply;r.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n[2]=t[2]/i[2],n[3]=t[3]/i[3],n};r.div=r.divide;r.min=function(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n[2]=Math.min(t[2],i[2]),n[3]=Math.min(t[3],i[3]),n};r.max=function(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n[2]=Math.max(t[2],i[2]),n[3]=Math.max(t[3],i[3]),n};r.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n};r.scaleAndAdd=function(n,t,i,r){return n[0]=t[0]+i[0]*r,n[1]=t[1]+i[1]*r,n[2]=t[2]+i[2]*r,n[3]=t[3]+i[3]*r,n};r.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1],u=t[2]-n[2],f=t[3]-n[3];return Math.sqrt(i*i+r*r+u*u+f*f)};r.dist=r.distance;r.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1],u=t[2]-n[2],f=t[3]-n[3];return i*i+r*r+u*u+f*f};r.sqrDist=r.squaredDistance;r.length=function(n){var t=n[0],i=n[1],r=n[2],u=n[3];return Math.sqrt(t*t+i*i+r*r+u*u)};r.len=r.length;r.squaredLength=function(n){var t=n[0],i=n[1],r=n[2],u=n[3];return t*t+i*i+r*r+u*u};r.sqrLen=r.squaredLength;r.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n};r.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n[3]=1/t[3],n};r.normalize=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],i=r*r+u*u+f*f+e*e;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i),n};r.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]};r.lerp=function(n,t,i,r){var u=t[0],f=t[1],e=t[2],o=t[3];return n[0]=u+r*(i[0]-u),n[1]=f+r*(i[1]-f),n[2]=e+r*(i[2]-e),n[3]=o+r*(i[3]-o),n};r.random=function(n,t){return t=t||1,n[0]=Object(u.c)(),n[1]=Object(u.c)(),n[2]=Object(u.c)(),n[3]=Object(u.c)(),r.normalize(n,n),r.scale(n,n,t),n};r.transformMat4=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3];return n[0]=i[0]*r+i[4]*u+i[8]*f+i[12]*e,n[1]=i[1]*r+i[5]*u+i[9]*f+i[13]*e,n[2]=i[2]*r+i[6]*u+i[10]*f+i[14]*e,n[3]=i[3]*r+i[7]*u+i[11]*f+i[15]*e,n};r.transformQuat=function(n,t,i){var o=t[0],s=t[1],h=t[2],r=i[0],u=i[1],f=i[2],e=i[3],c=e*o+u*h-f*s,l=e*s+f*o-r*h,a=e*h+r*s-u*o,v=-r*o-u*s-f*h;return n[0]=c*e+v*-r+l*-f-a*-u,n[1]=l*e+v*-u+a*-r-c*-f,n[2]=a*e+v*-f+c*-u-l*-r,n};r.forEach=function(){var n=r.create();return function(t,i,r,u,f,e){var o,s;for(i||(i=4),r||(r=0),s=u?Math.min(u*i+r,t.length):t.length,o=r;o<s;o+=i)n[0]=t[o],n[1]=t[o+1],n[2]=t[o+2],n[3]=t[o+3],f(n,n,e),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2],t[o+3]=n[3];return t}}();t.a=r},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};r.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n};r.clone=function(n){var t=new u.a(9);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n};r.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};r.transpose=function(n,t){if(n===t){var i=t[1],r=t[2],u=t[5];n[1]=t[3];n[2]=t[6];n[3]=i;n[5]=t[7];n[6]=r;n[7]=u}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n};r.invert=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],o=t[4],s=t[5],h=t[6],c=t[7],l=t[8],a=l*o-s*c,v=-l*e+s*h,y=c*e-o*h,i=r*a+u*v+f*y;return i?(i=1/i,n[0]=a*i,n[1]=(-l*u+f*c)*i,n[2]=(s*u-f*o)*i,n[3]=v*i,n[4]=(l*r-f*h)*i,n[5]=(-s*r+f*e)*i,n[6]=y*i,n[7]=(-c*r+u*h)*i,n[8]=(o*r-u*e)*i,n):null};r.adjoint=function(n,t){var i=t[0],r=t[1],u=t[2],f=t[3],e=t[4],o=t[5],s=t[6],h=t[7],c=t[8];return n[0]=e*c-o*h,n[1]=u*h-r*c,n[2]=r*o-u*e,n[3]=o*s-f*c,n[4]=i*c-u*s,n[5]=u*f-i*o,n[6]=f*h-e*s,n[7]=r*s-i*h,n[8]=i*e-r*f,n};r.determinant=function(n){var o=n[0],s=n[1],h=n[2],t=n[3],i=n[4],r=n[5],u=n[6],f=n[7],e=n[8];return o*(e*i-r*f)+s*(-e*t+r*u)+h*(f*t-i*u)};r.multiply=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3],o=t[4],s=t[5],h=t[6],c=t[7],l=t[8],a=i[0],v=i[1],y=i[2],p=i[3],w=i[4],b=i[5],k=i[6],d=i[7],g=i[8];return n[0]=a*r+v*e+y*h,n[1]=a*u+v*o+y*c,n[2]=a*f+v*s+y*l,n[3]=p*r+w*e+b*h,n[4]=p*u+w*o+b*c,n[5]=p*f+w*s+b*l,n[6]=k*r+d*e+g*h,n[7]=k*u+d*o+g*c,n[8]=k*f+d*s+g*l,n};r.mul=r.multiply;r.translate=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],h=t[4],c=t[5],l=t[6],a=t[7],v=t[8],r=i[0],u=i[1];return n[0]=f,n[1]=e,n[2]=o,n[3]=s,n[4]=h,n[5]=c,n[6]=r*f+u*s+l,n[7]=r*e+u*h+a,n[8]=r*o+u*c+v,n};r.rotate=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],h=t[4],c=t[5],l=t[6],a=t[7],v=t[8],r=Math.sin(i),u=Math.cos(i);return n[0]=u*f+r*s,n[1]=u*e+r*h,n[2]=u*o+r*c,n[3]=u*s-r*f,n[4]=u*h-r*e,n[5]=u*c-r*o,n[6]=l,n[7]=a,n[8]=v,n};r.scale=function(n,t,i){var r=i[0],u=i[1];return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=u*t[3],n[4]=u*t[4],n[5]=u*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n};r.fromMat2d=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=0,n[6]=t[4],n[7]=t[5],n[8]=1,n};r.fromQuat=function(n,t){var f=t[0],r=t[1],i=t[2],e=t[3],u=f+f,o=r+r,s=i+i,h=f*u,c=r*u,l=r*o,a=i*u,v=i*o,y=i*s,p=e*u,w=e*o,b=e*s;return n[0]=1-l-y,n[3]=c-b,n[6]=a+w,n[1]=c+b,n[4]=1-h-y,n[7]=v-p,n[2]=a-w,n[5]=v+p,n[8]=1-h-l,n};r.normalFromMat4=function(n,t){var e=t[0],o=t[1],s=t[2],r=t[3],h=t[4],c=t[5],l=t[6],u=t[7],k=t[8],d=t[9],g=t[10],nt=t[11],a=t[12],v=t[13],y=t[14],f=t[15],ot=e*c-o*h,st=e*l-s*h,tt=e*u-r*h,ht=o*l-s*c,it=o*u-r*c,rt=s*u-r*l,ut=k*v-d*a,ft=k*y-g*a,p=k*f-nt*a,et=d*y-g*v,w=d*f-nt*v,b=g*f-nt*y,i=ot*b-st*w+tt*et+ht*p-it*ft+rt*ut;return i?(i=1/i,n[0]=(c*b-l*w+u*et)*i,n[1]=(l*p-h*b-u*ft)*i,n[2]=(h*w-c*p+u*ut)*i,n[3]=(s*w-o*b-r*et)*i,n[4]=(e*b-s*p+r*ft)*i,n[5]=(o*p-e*w-r*ut)*i,n[6]=(v*rt-y*it+f*ht)*i,n[7]=(y*tt-a*rt-f*st)*i,n[8]=(a*it-v*tt+f*ot)*i,n):null};r.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))};t.a=r},function(n,t,i){"use strict";var o=i(7),f=i(3),s=i(56),u=i(9),r=i(21),e=i(18),h=0,c=o.a.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||"NODE")+"_"+h++);this.position||(this.position=new f.a);this.rotation||(this.rotation=new s.a);this.scale||(this.scale=new f.a(1,1,1));this.worldTransform=new u.a;this.localTransform=new u.a;this._children=[]},{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(n){var i=this._scene,t;i&&(t=i._nodeRepository,delete t[this.name],t[n]=this);this.name=n},add:function(n){var t=n._parent,i;t!==this&&(t&&t.remove(n),n._parent=this,this._children.push(n),i=this._scene,i&&i!==n.scene&&n.traverse(this._addSelfToScene,this),n._needsUpdateWorldTransform=!0)},remove:function(n){var t=this._children,i=t.indexOf(n);i<0||(t.splice(i,1),n._parent=null,this._scene&&n.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var t=this._children,n=0;n<t.length;n++)t[n]._parent=null,this._scene&&t[n].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(n){n._scene.removeFromScene(n);n._scene=null},_addSelfToScene:function(n){this._scene.addToScene(n);n._scene=this._scene},isAncestor:function(n){for(var t=n._parent;t;){if(t===this)return!0;t=t._parent}return!1},children:function(){return this._children.slice()},childAt:function(n){return this._children[n]},getChildByName:function(n){for(var i=this._children,t=0;t<i.length;t++)if(i[t].name===n)return i[t]},getDescendantByName:function(n){for(var t,r,u=this._children,i=0;i<u.length;i++){if(t=u[i],t.name===n)return t;if(r=t.getDescendantByName(n),r)return r}},queryNode:function(n){var u,t,i,f,e,o,r,s;if(n){for(u=n.split("/"),t=this,i=0;i<u.length;i++)if(f=u[i],f){for(e=!1,o=t._children,r=0;r<o.length;r++)if(s=o[r],s.name===f){t=s;e=!0;break}if(!e)return}return t}},getPath:function(n){if(!this._parent)return"/";for(var t=this._parent,i=this.name;t._parent;){if(i=t.name+"/"+i,t._parent==n)break;t=t._parent}return!t._parent&&n?null:i},traverse:function(n,t){var r,i,u;for(n.call(t,this),r=this._children,i=0,u=r.length;i<u;i++)r[i].traverse(n,t)},eachChild:function(n,t){for(var u,r=this._children,i=0,f=r.length;i<f;i++)u=r[i],n.call(t,u,i)},setLocalTransform:function(n){r.a.copy(this.localTransform.array,n.array);this.decomposeLocalTransform()},decomposeLocalTransform:function(n){var t=n?null:this.scale;this.localTransform.decomposeMatrix(t,this.rotation,this.position)},setWorldTransform:function(n){r.a.copy(this.worldTransform.array,n.array);this.decomposeWorldTransform()},decomposeWorldTransform:function(){var n=r.a.create();return function(t){var i=this.localTransform,u=this.worldTransform,f;this._parent?(r.a.invert(n,this._parent.worldTransform.array),r.a.multiply(i.array,n,u.array)):r.a.copy(i.array,u.array);f=t?null:this.scale;i.decomposeMatrix(f,this.rotation,this.position)}}(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var t=this.position,i=this.rotation,u=this.scale,n;this.transformNeedsUpdate()&&(n=this.localTransform.array,r.a.fromRotationTranslation(n,i.array,t.array),r.a.scale(n,n,u.array),i._dirty=!1,u._dirty=!1,t._dirty=!1,this._needsUpdateWorldTransform=!0)},_updateWorldTransformTopDown:function(){var n=this.localTransform.array,t=this.worldTransform.array;this._parent?r.a.multiplyAffine(t,this._parent.worldTransform.array,n):r.a.copy(t,n)},updateWorldTransform:function(){for(var n=this;n&&n.getParent()&&n.getParent().transformNeedsUpdate();)n=n.getParent();n.update()},update:function(n){var i,t,r;for(this.autoUpdateLocalTransform?this.updateLocalTransform():n=!0,(n||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),n=!0,this._needsUpdateWorldTransform=!1),i=this._children,t=0,r=i.length;t<r;t++)i[t].update(n)},getBoundingBox:function(){function i(n){return!n.invisible&&n.geometry}var n=new e.a,r=new u.a,t=new u.a;return function(f,o){return o=o||new e.a,f=f||i,this._parent?u.a.invert(t,this._parent.worldTransform):u.a.identity(t),this.traverse(function(i){i.geometry&&i.geometry.boundingBox&&(n.copy(i.geometry.boundingBox),u.a.multiply(r,t,i.worldTransform),n.applyTransform(r),o.union(n))},this,i),o}}(),getWorldPosition:function(n){var t,i;return this.transformNeedsUpdate()&&this.updateWorldTransform(),t=this.worldTransform.array,n?(i=n.array,i[0]=t[12],i[1]=t[13],i[2]=t[14],n):new f.a(t[12],t[13],t[14])},clone:function(){var n=new this.constructor,i=this._children,t;for(n.setName(this.name),n.position.copy(this.position),n.rotation.copy(this.rotation),n.scale.copy(this.scale),t=0;t<i.length;t++)n.add(i[t].clone());return n},rotateAround:function(){var n=new f.a,t=new u.a;return function(i,r,u){n.copy(this.position).subtract(i);var f=this.localTransform;f.identity();f.translate(i);f.rotate(u,r);t.fromRotationTranslation(this.rotation,n);f.multiply(t);f.scale(this.scale);this.decomposeLocalTransform();this._needsUpdateWorldTransform=!0}}(),lookAt:function(){var n=new u.a;return function(t,i){n.lookAt(this.position,t,i||this.localTransform.y).invert();this.setLocalTransform(n);this.target=t}}()});t.a=c},function(n,t,i){"use strict";function w(n){var o=[],r=Object.keys(n),t,u,i,e;for(r.sort(),t=0;t<r.length;t++)u=r[t],o.push(u+" "+n[u]);return(i=o.join("\n"),f[i])?f[i]:(e=a.a.genGUID(),f[i]=e,e)}function r(){this.opaque=[];this.transparent=[];this._opaqueCount=0;this._transparentCount=0}function b(n,t){if(t.castShadow&&!n.castShadow)return!0}var l=i(35),e=i(24),o=i(58),s=i(18),a=i(23),u=i(21),v=i(69),y=i(9),p=u.a.create(),h=u.a.create(),f={},c;r.prototype.startCount=function(){this._opaqueCount=0;this._transparentCount=0};r.prototype.add=function(n,t){t?this.transparent[this._transparentCount++]=n:this.opaque[this._opaqueCount++]=n};r.prototype.endCount=function(){this.transparent.length=this._transparentCount;this.opaque.length=this._opaqueCount};c=l.a.extend(function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new s.a,shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new v.a(20)}},function(){this._scene=this},{addToScene:function(n){n instanceof o.a?(this._cameraList.length>0&&console.warn("Found multiple camera in one scene. Use the fist one."),this._cameraList.push(n)):n instanceof e.a&&this.lights.push(n);n.name&&(this._nodeRepository[n.name]=n)},removeFromScene:function(n){var t;n instanceof o.a?(t=this._cameraList.indexOf(n),t>=0&&this._cameraList.splice(t,1)):n instanceof e.a&&(t=this.lights.indexOf(n),t>=0&&this.lights.splice(t,1));n.name&&delete this._nodeRepository[n.name]},getNode:function(n){return this._nodeRepository[n]},setMainCamera:function(n){var t=this._cameraList.indexOf(n);t>=0&&this._cameraList.splice(t,1);this._cameraList.unshift(n)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var f=this.lights,n,r,t,i,u;for(this._previousLightNumber=this._lightNumber,n={},r=0;r<f.length;r++)(t=f[r],t.invisible)||(i=t.group,n[i]||(n[i]={}),n[i][t.type]=n[i][t.type]||0,n[i][t.type]++);this._lightNumber=n;for(u in n)this._lightProgramKeys[u]=w(n[u]);this._updateLightUniforms()},cloneNode:function(n){function r(n,t){var u,f,e;for(i[n.__uid__]=t,u=0;u<n._children.length;u++)f=n._children[u],e=t._children[u],r(f,e)}var t=n.clone(),i={};return r(n,t),t.traverse(function(n){n.skeleton&&(n.skeleton=n.skeleton.clone(i));n.material&&(n.material=n.material.clone())}),t},updateRenderList:function(n,t){var u=n.__uid__,i=this._renderLists.get(u),f;return i||(i=new r,this._renderLists.put(u,i)),i.startCount(),t&&(this.viewBoundingBoxLastFrame.min.set(Infinity,Infinity,Infinity),this.viewBoundingBoxLastFrame.max.set(-Infinity,-Infinity,-Infinity)),f=this.material&&this.material.transparent||!1,this._doUpdateRenderList(this,n,f,i,t),i.endCount(),i},getRenderList:function(n){return this._renderLists.get(n.__uid__)},_doUpdateRenderList:function(n,t,i,r,f){var o,e,s,c;if(!n.invisible)for(o=0;o<n._children.length;o++)e=n._children[o],e.isRenderable()&&(s=e.isSkinnedMesh()?p:e.worldTransform.array,c=e.geometry,u.a.multiplyAffine(h,t.viewMatrix.array,s),(!f||c.boundingBox)&&this.isFrustumCulled(e,t,h)||r.add(e,e.material.transparent||i)),e._children.length>0&&this._doUpdateRenderList(e,t,i,r,f)},isFrustumCulled:function(){var n=new s.a,t=new y.a;return function(i,r,u){var f=i.boundingBox,e,o;return(f||(f=i.skeleton&&i.skeleton.boundingBox?i.skeleton.boundingBox:i.geometry.boundingBox),!f)?!1:(t.array=u,n.transformFrom(f,t),i.castShadow&&this.viewBoundingBoxLastFrame.union(n),i.frustumCulling&&(!n.intersectBoundingBox(r.frustum.boundingBox)||(t.array=r.projectionMatrix.array,n.max.array[2]>0&&n.min.array[2]<0&&(n.max.array[2]=-1e-20),n.applyProjection(t),e=n.min.array,o=n.max.array,o[0]<-1||e[0]>1||o[1]<-1||e[1]>1||o[2]<-1||e[2]>1)))?!0:!1}}(),_updateLightUniforms:function(){var h=this.lights,n,e,r,t,i,u,f,o,s;h.sort(b);n=this._lightUniforms;for(t in n)for(i in n[t])n[t][i].value.length=0;for(e=0;e<h.length;e++)if(r=h[e],!r.invisible){t=r.group;for(i in r.uniformTemplates)if(u=r.uniformTemplates[i],f=u.value(r),f!=null){n[t]||(n[t]={});n[t][i]||(n[t][i]={type:"",value:[]});o=n[t][i];o.type=u.type+"v";switch(u.type){case"1i":case"1f":case"t":o.value.push(f);break;case"2f":case"3f":case"4f":for(s=0;s<f.length;s++)o.value.push(f[s]);break;default:console.error("Unkown light uniform type "+u.type)}}}},getLightGroups:function(){var n=[];for(var t in this._lightNumber)n.push(t);return n},getNumberChangedLightGroups:function(){var n=[];for(var t in this._lightNumber)this.isLightNumberChanged(t)&&n.push(t);return n},isLightNumberChanged:function(n){var i=this._previousLightNumber,r=this._lightNumber;for(var t in r[n])if(!i[n]||r[n][t]!==i[n][t])return!0;for(t in i[n])if(!r[n]||r[n][t]!==i[n][t])return!0;return!1},getLightsNumbers:function(n){return this._lightNumber[n]},getProgramKey:function(n){return this._lightProgramKeys[n]},setLightUniforms:function(){function n(n,t,i){var u,r,e,f,o,s;for(u in n)if(r=n[u],r.type==="tv"){if(!t.hasUniform(u))continue;for(e=[],f=0;f<r.value.length;f++)o=r.value[f],s=t.takeCurrentTextureSlot(i,o),e.push(s);t.setUniform(i.gl,"1iv",u,e)}else t.setUniform(i.gl,r.type,u,r.value)}return function(t,i,r){n(this._lightUniforms[i],t,r);n(this.shadowUniforms,t,r)}}(),dispose:function(){this.material=null;this._opaqueList=[];this._transparentList=[];this.lights=[];this._lightUniforms={};this._lightNumber={};this._nodeRepository={}}});t.a=c},function(n,t,i){"use strict";var r=i(58),u=r.a.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var n=this.projectionMatrix.array;this.left=(-1-n[12])/n[0];this.right=(1-n[12])/n[0];this.top=(1-n[13])/n[5];this.bottom=(-1-n[13])/n[5];this.near=-(-1-n[14])/n[10];this.far=-(1-n[14])/n[10]},clone:function(){var n=r.a.prototype.clone.call(this);return n.left=this.left,n.right=this.right,n.near=this.near,n.far=this.far,n.top=this.top,n.bottom=this.bottom,n}});t.a=u},function(n,t){"use strict";t.a={convertToDynamicArray:function(n){var t,i;n&&this.resetOffset();t=this.attributes;for(i in t)t[i].value=n||!t[i].value?[]:Array.prototype.slice.call(t[i].value);this.indices=n||!this.indices?[]:Array.prototype.slice.call(this.indices)},convertToTypedArray:function(){var n=this.attributes;for(var t in n)n[t].value=n[t].value&&n[t].value.length>0?new Float32Array(n[t].value):null;this.indices&&this.indices.length>0&&(this.indices=this.vertexCount>65535?new Uint32Array(this.indices):new Uint16Array(this.indices));this.dirty()}}},function(n,t,i){"use strict";function f(n,t){var i=[];return r.a.util.each(n.dimensions,function(r){var f=n.getDimensionInfo(r),e=f.otherDims,u=e[t];u!=null&&u!==!1&&(i[u]=f.name)}),i}var u=i(0),r=i.n(u);t.a=function(n,t,i){function a(n){function h(n,t){var f=o.getDimensionInfo(t),s,h;f&&f.otherDims.tooltip!==!1&&(s=f.type,h=(u?"- "+(f.tooltipName||f.name)+": ":"")+(s==="ordinal"?n+"":s==="time"?i?"":r.a.format.formatTime("yyyy/MM/dd hh:mm:ss",n):r.a.format.addCommas(n)),h&&e.push(r.a.format.encodeHTML(h)))}var u=!0,e=[],s=f(o,"tooltip");return s.length?r.a.util.each(s,function(n){h(o.get(n,t),n)}):r.a.util.each(n,h),(u?"<br/>":"")+e.join(u?"<br/>":", ")}var o=n.getData(),s=n.getRawValue(t),h=r.a.util.isArray(s)?a(s):r.a.format.encodeHTML(r.a.format.addCommas(s)),l=o.getName(t),e=o.getItemVisual(t,"color"),c,u;return r.a.util.isObject(e)&&e.colorStops&&(e=(e.colorStops[0]||{}).color),e=e||"transparent",c=r.a.format.getTooltipMarker(e),u=n.name,u==='\0-'&&(u=""),u=u?r.a.format.encodeHTML(u)+(i?": ":"<br/>"):"",i?c+u+h:u+c+(l?r.a.format.encodeHTML(l)+": "+h:h)}},function(n,t,i){"use strict";var f=i(72),u=i(11),r=f.a.extend({skeleton:null,joints:null,useSkinMatricesTexture:!1},function(){this.joints||(this.joints=[])},{isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&this.joints.length>0)},clone:function(){var n=f.a.prototype.clone.call(this);return n.skeleton=this.skeleton,this.joints&&(n.joints=this.joints.slice()),n}});r.POINTS=u.a.POINTS;r.LINES=u.a.LINES;r.LINE_LOOP=u.a.LINE_LOOP;r.LINE_STRIP=u.a.LINE_STRIP;r.TRIANGLES=u.a.TRIANGLES;r.TRIANGLE_STRIP=u.a.TRIANGLE_STRIP;r.TRIANGLE_FAN=u.a.TRIANGLE_FAN;r.BACK=u.a.BACK;r.FRONT=u.a.FRONT;r.FRONT_AND_BACK=u.a.FRONT_AND_BACK;r.CW=u.a.CW;r.CCW=u.a.CCW;t.a=r},function(n,t,i){"use strict";var r=i(58),u=r.a.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var n=this.fov/180*Math.PI;this.projectionMatrix.perspective(n,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var n=this.projectionMatrix.array,t=Math.atan(1/n[5])*2;this.fov=t/Math.PI*180;this.aspect=n[5]/n[0];this.near=n[14]/(n[10]-1);this.far=n[14]/(n[10]+1)},clone:function(){var n=r.a.prototype.clone.call(this);return n.fov=this.fov,n.aspect=this.aspect,n.near=this.near,n.far=this.far,n}});t.a=u},function(n,t,i){"use strict";var f=i(40),e=i(76),r=i(8),o=i(19),s=i(4),h=i(121),u;r.a.import(h.a);u=f.a.extend(function(){var n=new r.a({vertex:r.a.source("clay.skybox.vertex"),fragment:r.a.source("clay.skybox.fragment")}),t=new o.a({shader:n,depthMask:!1});return{scene:null,geometry:new e.a,material:t,environmentMap:null,culling:!1}},function(){var n=this.scene;n&&this.attachScene(n);this.environmentMap&&this.setEnvironmentMap(this.environmentMap)},{attachScene:function(n){this.scene&&this.detachScene();n.skybox=this;this.scene=n;n.on("beforerender",this._beforeRenderScene,this)},detachScene:function(){this.scene&&(this.scene.off("beforerender",this._beforeRenderScene),this.scene.skybox=null);this.scene=null},dispose:function(n){this.detachScene();this.geometry.dispose(n)},setEnvironmentMap:function(n){n.textureType==="texture2D"?(this.material.define("EQUIRECTANGULAR"),n.minFilter=s.a.LINEAR):this.material.undefine("EQUIRECTANGULAR");this.material.set("environmentMap",n)},getEnvironmentMap:function(){return this.material.get("environmentMap")},_beforeRenderScene:function(n,t,i){this.renderSkybox(n,i)},renderSkybox:function(n,t){this.position.copy(t.getWorldPosition());this.update();n.gl.disable(n.gl.BLEND);this.material.get("lod")>0?this.material.define("fragment","LOD"):this.material.undefine("fragment","LOD");n.renderPass([this],t)}});t.a=u},function(n,t,i){"use strict";var r=i(15),u=i(18),f=r.a.extend({dynamic:!1,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var c,i,l,t,f=this.heightSegments,n=this.widthSegments,e=this.attributes,a=[],o=[],s=[],h=[],r=0;r<=f;r++)for(c=r/f,i=0;i<=n;i++)l=i/n,a.push([2*l-1,2*c-1,0]),o&&o.push([l,c]),s&&s.push([0,0,1]),i<n&&r<f&&(t=i+r*(n+1),h.push([t,t+1,t+n+1]),h.push([t+n+1,t+1,t+n+2]));e.position.fromArray(a);e.texcoord0.fromArray(o);e.normal.fromArray(s);this.initIndicesFromArray(h);this.boundingBox=new u.a;this.boundingBox.min.set(-1,-1,0);this.boundingBox.max.set(1,1,0)}});t.a=f},function(n,t){"use strict";t.a={defaultOption:{viewControl:{projection:"perspective",autoRotate:!1,autoRotateDirection:"cw",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(n){n=n||{};this.option.viewControl=this.option.viewControl||{};n.alpha!=null&&(this.option.viewControl.alpha=n.alpha);n.beta!=null&&(this.option.viewControl.beta=n.beta);n.distance!=null&&(this.option.viewControl.distance=n.distance);n.center!=null&&(this.option.viewControl.center=n.center)}}},function(n,t,i){"use strict";function o(n){return n instanceof Array||(n=[n,n]),n}var h=i(7),f=i(26),e=i(3),l=i(56),c=i(2),r=c.a.firstNotNull,u={left:0,middle:1,right:2},s=h.a.extend(function(){return{zr:null,viewGL:null,_center:new e.a,minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-Infinity,maxBeta:Infinity,autoRotateAfterStill:0,autoRotateDirection:"cw",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",_mode:"rotate",_camera:null,_needsUpdate:!1,_rotating:!1,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new f.a,_panVelocity:new f.a,_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}},function(){["_mouseDownHandler","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_pinchHandler","_contextMenuHandler","_update"].forEach(function(n){this[n]=this[n].bind(this)},this)},{init:function(){var n=this.zr;if(n){n.on("mousedown",this._mouseDownHandler);n.on("globalout",this._mouseUpHandler);n.on("mousewheel",this._mouseWheelHandler);n.on("pinch",this._pinchHandler);n.animation.on("frame",this._update);n.dom.addEventListener("contextmenu",this._contextMenuHandler)}},dispose:function(){var n=this.zr;n&&(n.off("mousedown",this._mouseDownHandler),n.off("mousemove",this._mouseMoveHandler),n.off("mouseup",this._mouseUpHandler),n.off("mousewheel",this._mouseWheelHandler),n.off("pinch",this._pinchHandler),n.off("globalout",this._mouseUpHandler),n.dom.removeEventListener("contextmenu",this._contextMenuHandler),n.animation.off("frame",this._update));this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(n){this._distance=n;this._needsUpdate=!0},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(n){this._orthoSize=n;this._needsUpdate=!0},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(n){n=Math.max(Math.min(this.maxAlpha,n),this.minAlpha);this._theta=n/180*Math.PI;this._needsUpdate=!0},setBeta:function(n){n=Math.max(Math.min(this.maxBeta,n),this.minBeta);this._phi=-n/180*Math.PI;this._needsUpdate=!0},setCenter:function(n){this._center.setArray(n)},setViewGL:function(n){this.viewGL=n},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(n,t){var o,s,h,u;t=t||{};var f=t.baseDistance||0,e=t.baseOrthoSize||1,i=n.get("projection");i!=="perspective"&&i!=="orthographic"&&i!=="isometric"&&(!0&&console.error("Unkown projection type %s, use perspective projection instead.",i),i="perspective");this._projection=i;this.viewGL.setProjection(i);o=n.get("distance")+f;s=n.get("orthographicSize")+e;[["damping",.8],["autoRotate",!1],["autoRotateAfterStill",3],["autoRotateDirection","cw"],["autoRotateSpeed",10],["minDistance",30],["maxDistance",400],["minOrthographicSize",30],["maxOrthographicSize",300],["minAlpha",-90],["maxAlpha",90],["minBeta",-Infinity],["maxBeta",Infinity],["rotateSensitivity",1],["zoomSensitivity",1],["panSensitivity",1],["panMouseButton","left"],["rotateMouseButton","middle"],].forEach(function(t){this[t[0]]=r(n.get(t[0]),t[1])},this);this.minDistance+=f;this.maxDistance+=f;this.minOrthographicSize+=e;this.maxOrthographicSize+=e;h=n.ecModel;u={};["animation","animationDurationUpdate","animationEasingUpdate"].forEach(function(t){u[t]=r(n.get(t),h&&h.get(t))});var c=r(t.alpha,n.get("alpha"))||0,l=r(t.beta,n.get("beta"))||0,a=r(t.center,n.get("center"))||[0,0,0];u.animation&&u.animationDurationUpdate>0&&this._notFirst?this.animateTo({alpha:c,beta:l,center:a,distance:o,targetOrthographicSize:s,easing:u.animationEasingUpdate,duration:u.animationDurationUpdate}):(this.setDistance(o),this.setAlpha(c),this.setBeta(l),this.setCenter(a),this.setOrthographicSize(s));this._notFirst=!0;this._validateProperties()},_validateProperties:function(){!0&&(u[this.panMouseButton]==null&&console.error("Unkown panMouseButton %s. It should be left|middle|right",this.panMouseButton),u[this.rotateMouseButton]==null&&console.error("Unkown rotateMouseButton %s. It should be left|middle|right",this.rotateMouseButton),this.autoRotateDirection!=="cw"&&this.autoRotateDirection!=="ccw"&&console.error("Unkown autoRotateDirection %s. It should be cw|ccw",this.autoRotateDirection))},animateTo:function(n){var u=this.zr,i=this,t={},r={};return n.distance!=null&&(t.distance=this.getDistance(),r.distance=n.distance),n.orthographicSize!=null&&(t.orthographicSize=this.getOrthographicSize(),r.orthographicSize=n.orthographicSize),n.alpha!=null&&(t.alpha=this.getAlpha(),r.alpha=n.alpha),n.beta!=null&&(t.beta=this.getBeta(),r.beta=n.beta),n.center!=null&&(t.center=this.getCenter(),r.center=n.center),this._addAnimator(u.animation.animate(t).when(n.duration||1e3,r).during(function(){t.alpha!=null&&i.setAlpha(t.alpha);t.beta!=null&&i.setBeta(t.beta);t.distance!=null&&i.setDistance(t.distance);t.center!=null&&i.setCenter(t.center);t.orthographicSize!=null&&i.setOrthographicSize(t.orthographicSize);i._needsUpdate=!0})).start(n.easing||"linear")},stopAllAnimation:function(){for(var n=0;n<this._animators.length;n++)this._animators[n].stop();this._animators.length=0},update:function(){this._needsUpdate=!0;this._update(20)},_isAnimating:function(){return this._animators.length>0},_update:function(n){if(this._rotating){var t=(this.autoRotateDirection==="cw"?1:-1)*this.autoRotateSpeed/180*Math.PI;this._phi-=t*n/1e3;this._needsUpdate=!0}else this._rotateVelocity.len()>0&&(this._needsUpdate=!0);((Math.abs(this._zoomSpeed)>.1||this._panVelocity.len()>0)&&(this._needsUpdate=!0),this._needsUpdate)&&(n=Math.min(n,50),this._updateDistanceOrSize(n),this._updatePan(n),this._updateRotate(n),this._updateTransform(),this.getCamera().update(),this.zr&&this.zr.refresh(),this.trigger("update"),this._needsUpdate=!1)},_updateRotate:function(n){var t=this._rotateVelocity;this._phi=t.y*n/20+this._phi;this._theta=t.x*n/20+this._theta;this.setAlpha(this.getAlpha());this.setBeta(this.getBeta());this._vectorDamping(t,Math.pow(this.damping,n/16))},_updateDistanceOrSize:function(n){this._projection==="perspective"?this._setDistance(this._distance+this._zoomSpeed*n/20):this._setOrthoSize(this._orthoSize+this._zoomSpeed*n/20);this._zoomSpeed*=Math.pow(this.damping,n/16)},_setDistance:function(n){this._distance=Math.max(Math.min(n,this.maxDistance),this.minDistance)},_setOrthoSize:function(n){this._orthoSize=Math.max(Math.min(n,this.maxOrthographicSize),this.minOrthographicSize);var t=this.getCamera(),i=this._orthoSize,r=i/this.viewGL.viewport.height*this.viewGL.viewport.width;t.left=-r/2;t.right=r/2;t.top=i/2;t.bottom=-i/2},_updatePan:function(){var n=this._panVelocity,t=this._distance,i=this.getCamera(),r=i.worldTransform.y,u=i.worldTransform.x;this._center.scaleAndAdd(u,-n.x*t/200).scaleAndAdd(r,-n.y*t/200);this._vectorDamping(n,0)},_updateTransform:function(){var t=this.getCamera(),n=new e.a,i=this._theta+Math.PI/2,r=this._phi+Math.PI/2,u=Math.sin(i);n.x=u*Math.cos(r);n.y=-Math.cos(i);n.z=u*Math.sin(r);t.position.copy(this._center).scaleAndAdd(n,this._distance);t.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var n=this.autoRotateAfterStill,t=this;!isNaN(n)&&n>0&&(this._stillTimeout=setTimeout(function(){t._rotating=!0},n*1e3))},_vectorDamping:function(n,t){var i=n.len();i=i*t;i<.0001&&(i=0);n.normalize().scale(i)},_decomposeTransform:function(){if(this.getCamera()){this.getCamera().updateWorldTransform();var n=this.getCamera().worldTransform.z,t=Math.asin(n.y),i=Math.atan2(n.x,n.z);this._theta=t;this._phi=-i;this.setBeta(this.getBeta());this.setAlpha(this.getAlpha());this.getCamera().aspect?this._setDistance(this.getCamera().position.dist(this._center)):this._setOrthoSize(this.getCamera().top-this.getCamera().bottom)}},_mouseDownHandler:function(n){if(!n.target&&!this._isAnimating()){var t=n.offsetX,i=n.offsetY;if(!this.viewGL||this.viewGL.containPoint(t,i)){this.zr.on("mousemove",this._mouseMoveHandler);this.zr.on("mouseup",this._mouseUpHandler);n.event.targetTouches?n.event.targetTouches.length===1&&(this._mode="rotate"):this._mode=n.event.button===u[this.rotateMouseButton]?"rotate":n.event.button===u[this.panMouseButton]?"pan":"";this._rotateVelocity.set(0,0);this._rotating=!1;this.autoRotate&&this._startCountingStill();this._mouseX=n.offsetX;this._mouseY=n.offsetY}}},_mouseMoveHandler:function(n){if((!n.target||!n.target.__isGLToZRProxy)&&!this._isAnimating()){var t=o(this.panSensitivity),i=o(this.rotateSensitivity);this._mode==="rotate"?(this._rotateVelocity.y=(n.offsetX-this._mouseX)/this.zr.getHeight()*2*i[0],this._rotateVelocity.x=(n.offsetY-this._mouseY)/this.zr.getWidth()*2*i[1]):this._mode==="pan"&&(this._panVelocity.x=(n.offsetX-this._mouseX)/this.zr.getWidth()*t[0]*400,this._panVelocity.y=(-n.offsetY+this._mouseY)/this.zr.getHeight()*t[1]*400);this._mouseX=n.offsetX;this._mouseY=n.offsetY;n.event.preventDefault()}},_mouseWheelHandler:function(n){if(!this._isAnimating()){var t=n.event.wheelDelta||-n.event.detail;this._zoomHandler(n,t)}},_pinchHandler:function(n){this._isAnimating()||(this._zoomHandler(n,n.pinchScale>1?1:-1),this._mode="")},_zoomHandler:function(n,t){var i,r,u;t!==0&&(i=n.offsetX,r=n.offsetY,!this.viewGL||this.viewGL.containPoint(i,r))&&(u=this._projection==="perspective"?Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5):Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5),this._zoomSpeed=(t>0?-1:1)*u*this.zoomSensitivity,this._rotating=!1,this.autoRotate&&this._mode==="rotate"&&this._startCountingStill(),n.event.preventDefault())},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler);this.zr.off("mouseup",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return this.rotateMouseButton==="right"||this.panMouseButton==="right"},_contextMenuHandler:function(n){this._isRightMouseButtonUsed()&&n.preventDefault()},_addAnimator:function(n){var t=this._animators;return t.push(n),n.done(function(){var i=t.indexOf(n);i>=0&&t.splice(i,1)}),n}});Object.defineProperty(s.prototype,"autoRotate",{get:function(){return this._autoRotate},set:function(n){this._autoRotate=n;this._rotating=n}});t.a=s},function(n,t){"use strict";t.a="@export ecgl.lines3D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, 1.0);\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n}\n@end\n\n\n\n@export ecgl.lines3D.clipNear\n\nvec4 clipNear(vec4 p1, vec4 p2) {\n float n = (p1.w - near) / (p1.w - p2.w);\n return vec4(mix(p1.xy, p2.xy, n), -near, near);\n}\n\n@end\n\n@export ecgl.lines3D.expandLine\n#ifdef VERTEX_ANIMATION\n vec4 prevProj = worldViewProjection * vec4(mix(prevPositionPrev, positionPrev, percent), 1.0);\n vec4 currProj = worldViewProjection * vec4(mix(prevPosition, position, percent), 1.0);\n vec4 nextProj = worldViewProjection * vec4(mix(prevPositionNext, positionNext, percent), 1.0);\n#else\n vec4 prevProj = worldViewProjection * vec4(positionPrev, 1.0);\n vec4 currProj = worldViewProjection * vec4(position, 1.0);\n vec4 nextProj = worldViewProjection * vec4(positionNext, 1.0);\n#endif\n\n if (currProj.w < 0.0) {\n if (nextProj.w > 0.0) {\n currProj = clipNear(currProj, nextProj);\n }\n else if (prevProj.w > 0.0) {\n currProj = clipNear(currProj, prevProj);\n }\n }\n\n vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;\n\n vec2 dir;\n float len = offset;\n if (position == positionPrev) {\n dir = normalize(nextScreen - currScreen);\n }\n else if (position == positionNext) {\n dir = normalize(currScreen - prevScreen);\n }\n else {\n vec2 dirA = normalize(currScreen - prevScreen);\n vec2 dirB = normalize(nextScreen - currScreen);\n\n vec2 tanget = normalize(dirA + dirB);\n\n float miter = 1.0 / max(dot(tanget, dirA), 0.5);\n len *= miter;\n dir = tanget;\n }\n\n dir = vec2(-dir.y, dir.x) * len;\n currScreen += dir;\n\n currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);\n@end\n\n\n@export ecgl.meshLines3D.vertex\n\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevPositionPrev;\nattribute vec3 prevPositionNext;\nuniform float percent : 1.0;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n}\n@end\n\n\n@export ecgl.meshLines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(n,t,i){function o(n,t,i,r,u){var e=0,o=0,f;r==null&&(r=Infinity);u==null&&(u=Infinity);f=0;t.eachChild(function(s,h){var w=s.position,c=s.getBoundingRect(),b=t.childAt(h+1),l=b&&b.getBoundingRect(),a,v,y,p;(n==="horizontal"?(y=c.width+(l?-l.x+c.x:0),a=e+y,a>r||s.newline?(e=0,a=y,o+=f+i,f=c.height):f=Math.max(f,c.height)):(p=c.height+(l?-l.y+c.y:0),v=o+p,v>u||s.newline?(e+=f+i,o=0,v=p,f=c.width):f=Math.max(f,c.width)),s.newline)||(w[0]=e,w[1]=o,n==="horizontal"?e=a+i:o=v+i)})}function b(n,t,i){var u=t.width,f=t.height,e=r(n.x,u),o=r(n.y,f),s=r(n.x2,u),c=r(n.y2,f);return(isNaN(e)||isNaN(parseFloat(n.x)))&&(e=0),(isNaN(s)||isNaN(parseFloat(n.x2)))&&(s=u),(isNaN(o)||isNaN(parseFloat(n.y)))&&(o=0),(isNaN(c)||isNaN(parseFloat(n.y2)))&&(c=f),i=h.normalizeCssArray(i||0),{width:Math.max(s-e-i[1]-i[3],0),height:Math.max(c-o-i[0]-i[2],0)}}function l(n,t,i){var b;i=h.normalizeCssArray(i||0);var e=t.width,o=t.height,c=r(n.left,e),l=r(n.top,o),p=r(n.right,e),w=r(n.bottom,o),u=r(n.width,e),f=r(n.height,o),a=i[2]+i[0],v=i[1]+i[3],y=n.aspect;isNaN(u)&&(u=e-p-v-c);isNaN(f)&&(f=o-w-a-l);y!=null&&(isNaN(u)&&isNaN(f)&&(y>e/o?u=e*.8:f=o*.8),isNaN(u)&&(u=y*f),isNaN(f)&&(f=u/y));isNaN(c)&&(c=e-p-u-v);isNaN(l)&&(l=o-w-f-a);switch(n.left||n.right){case"center":c=e/2-u/2-i[3];break;case"right":c=e-u-v}switch(n.top||n.bottom){case"middle":case"center":l=o/2-f/2-i[0];break;case"bottom":l=o-f-a}return c=c||0,l=l||0,isNaN(u)&&(u=e-v-c-(p||0)),isNaN(f)&&(f=o-a-l-(w||0)),b=new s(c+i[3],l+i[0],u,f),b.margin=i,b}function k(n,t,i,r,u){var o=!u||!u.hv||u.hv[0],h=!u||!u.hv||u.hv[1],c=u&&u.boundingMode||"all",e,a;if(o||h){c==="raw"?e=n.type==="group"?new s(0,0,+t.width||0,+t.height||0):n.getBoundingRect():(e=n.getBoundingRect(),n.needLocalTransform()&&(a=n.getLocalTransform(),e=e.clone(),e.applyTransform(a)));t=l(f.defaults({width:e.width,height:e.height},t),i,r);var v=n.position,y=o?t.x-e.x:0,p=h?t.y-e.y:0;n.attr("position",c==="raw"?[y,p]:[v[0]+y,v[1]+p])}}function d(n,t){return n[u[t][0]]!=null||n[u[t][1]]!=null&&n[u[t][2]]!=null}function g(n,t,i){function l(i,u){var h={},a=0,f={},v=0,y=2,l,c;if(e(i,function(t){f[t]=n[t]}),e(i,function(n){s(t,n)&&(h[n]=f[n]=t[n]);o(h,n)&&a++;o(f,n)&&v++}),r[u])return o(t,i[1])?f[i[2]]=null:o(t,i[2])&&(f[i[1]]=null),f;if(v!==y&&a){if(a>=y)return h;for(l=0;l<i.length;l++)if(c=i[l],!s(h,c)&&s(n,c)){h[c]=n[c];break}return h}return f}function s(n,t){return n.hasOwnProperty(t)}function o(n,t){return n[t]!=null&&n[t]!=="auto"}function a(n,t,i){e(n,function(n){t[n]=i[n]})}var r,h,c;f.isObject(i)||(i={});r=i.ignoreSize;f.isArray(r)||(r=[r,r]);h=l(u[0],0);c=l(u[1],1);a(u[0],n,h);a(u[1],n,c)}function nt(n){return a({},n)}function a(n,t){return t&&n&&e(c,function(i){t.hasOwnProperty(i)&&(n[i]=t[i])}),n}var f=i(13),s=i(82),v=i(85),r=v.parsePercent,h=i(171),e=f.each,c=["left","right","top","bottom","width","height"],u=[["width","left","right"],["height","top","bottom"]],y=o,p=f.curry(o,"vertical"),w=f.curry(o,"horizontal");t.LOCATION_PARAMS=c;t.HV_NAMES=u;t.box=y;t.vbox=p;t.hbox=w;t.getAvailableSize=b;t.getLayoutRect=l;t.positionElement=k;t.sizeCalculable=d;t.mergeLayoutParam=g;t.getLayoutParams=nt;t.copyLayoutParams=a},function(n,t,i){"use strict";var r=i(7),u=r.a.extend(function(){return{name:"",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},{updateParameter:function(n,t){var f=this.outputs[n],i=f.parameters,r=f._parametersCopy,u,e,o;if(r||(r=f._parametersCopy={}),i)for(u in i)u!=="width"&&u!=="height"&&(r[u]=i[u]);return e=i.width instanceof Function?i.width.call(this,t):i.width,o=i.height instanceof Function?i.height.call(this,t):i.height,(r.width!==e||r.height!==o)&&this._outputTextures[n]&&this._outputTextures[n].dispose(t.gl),r.width=e,r.height=o,r},setParameter:function(){},getParameter:function(){},setParameters:function(n){for(var t in n)this.setParameter(t,n[t])},render:function(){},getOutput:function(n,t){if(t==null)return t=n,this._outputTextures[t];var i=this.outputs[t];if(i)return this._rendered?i.outputLastFrame?this._prevOutputTextures[t]:this._outputTextures[t]:this._rendering?(this._prevOutputTextures[t]||(this._prevOutputTextures[t]=this._compositor.allocateTexture(i.parameters||{})),this._prevOutputTextures[t]):(this.render(n),this._outputTextures[t])},removeReference:function(n){if(this._outputReferences[n]--,this._outputReferences[n]===0){var t=this.outputs[n];t.keepLastFrame?(this._prevOutputTextures[n]&&this._compositor.releaseTexture(this._prevOutputTextures[n]),this._prevOutputTextures[n]=this._outputTextures[n]):this._compositor.releaseTexture(this._outputTextures[n])}},link:function(n,t,i){this.inputLinks[n]={node:t,pin:i};t.outputLinks[i]||(t.outputLinks[i]=[]);t.outputLinks[i].push({node:this,pin:n});this.pass.material.enableTexture(n)},clear:function(){this.inputLinks={};this.outputLinks={}},updateReference:function(n){var i,t;if(!this._rendering){this._rendering=!0;for(i in this.inputLinks)t=this.inputLinks[i],t.node.updateReference(t.pin);this._rendering=!1}n&&this._outputReferences[n]++},beforeFrame:function(){this._rendered=!1;for(var n in this.outputLinks)this._outputReferences[n]=0},afterFrame:function(){var n,t;for(n in this.outputLinks)this._outputReferences[n]>0&&(t=this.outputs[n],t.keepLastFrame?(this._prevOutputTextures[n]&&this._compositor.releaseTexture(this._prevOutputTextures[n]),this._prevOutputTextures[n]=this._outputTextures[n]):this._compositor.releaseTexture(this._outputTextures[n]))}});t.a=u},function(n,t){"use strict";function i(n,t){for(var r=0,u=1/t,i=n;i>0;)r=r+u*(i%t),i=Math.floor(i/t),u=u/t;return r}t.a=i},function(n,t,i){"use strict";var u=i(0),r=i.n(u);t.a=function(n,t,i){var e,u,o,f;return i=i||n.getSource(),e=t||r.a.getCoordinateSystemDimensions(n.get("coordinateSystem"))||["x","y","z"],u=r.a.helper.createDimensions(i,{dimensionsDefine:i.dimensionsDefine||n.get("dimensions"),encodeDefine:i.encodeDefine||n.get("encode"),coordDimensions:e.map(function(t){var i=n.getReferringComponents(t+"Axis3D")[0];return{type:i&&i.get("type")==="category"?"ordinal":"float",name:t}})}),n.get("coordinateSystem")==="cartesian3D"&&u.forEach(function(t){if(e.indexOf(t.coordDim)>=0){var i=n.getReferringComponents(t.coordDim+"Axis3D")[0];i&&i.get("type")==="category"&&(t.ordinalMeta=i.getOrdinalMeta())}}),o=r.a.helper.dataStack.enableDataStack(n,u,{byIndex:!0,stackedCoordDimension:"z"}),f=new r.a.List(u,n),f.setCalculationInfo(o),f.initData(i),f}},function(n){function t(n,t,i){return{seriesType:n,performRawSeries:!0,reset:function(n,r){function h(t,i){var f,e;if(typeof u=="function"&&(f=n.getRawValue(i),e=n.getDataParams(i),t.setItemVisual(i,"symbolSize",u(f,e))),t.hasItemOption){var r=t.getItemModel(i),o=r.getShallow("symbol",!0),s=r.getShallow("symbolSize",!0),h=r.getShallow("symbolKeepAspect",!0);o!=null&&t.setItemVisual(i,"symbol",o);s!=null&&t.setItemVisual(i,"symbolSize",s);h!=null&&t.setItemVisual(i,"symbolKeepAspect",h)}}var f=n.getData(),e=n.get("symbol")||t,u=n.get("symbolSize"),s=n.get("symbolKeepAspect"),o;if(f.setVisual({legendSymbol:i||e,symbol:e,symbolSize:u,symbolKeepAspect:s}),!r.isSeriesFiltered(n))return o=typeof u=="function",{dataEach:f.hasItemOption||o?h:null}}}}n.exports=t},function(n,t,i){"use strict";function a(n){return n.material}function nt(n,t,i){return t.uniforms[i].value}function tt(n,t,i,r){return i!==r}function it(){return!0}function v(){}function rt(n,t,i){this.availableAttributes=n;this.availableAttributeSymbols=t;this.indicesBuffer=i;this.vao=null}function ut(){var n,t;this.bind=function(i){n||(n=c.a.createCanvas(),n.width=n.height=1,n.getContext("2d"));var r=i.gl,u=!t;u&&(t=r.createTexture());r.bindTexture(r.TEXTURE_2D,t);u&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)};this.unbind=function(n){n.gl.bindTexture(n.gl.TEXTURE_2D,null)};this.isRenderable=function(){return!0}}var p=i(7),w=i(111),o=i(11),c=i(14),b=i(19),k=i(26),d=i(115),s=i(8),g=i(71),f=i(21),l=i(12),r,h,y,e,u;s.a["import"](g.a);r=f.a.create;h={};y={float:o.a.FLOAT,byte:o.a.BYTE,ubyte:o.a.UNSIGNED_BYTE,short:o.a.SHORT,ushort:o.a.UNSIGNED_SHORT};e=p.a.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:typeof window!="undefined"&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){var n,t;this.canvas||(this.canvas=c.a.createCanvas());n=this.canvas;try{if(t={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer},this.gl=n.getContext("webgl",t)||n.getContext("experimental-webgl",t),!this.gl)throw new Error;this._glinfo=new w.a(this.gl);this.gl.targetRenderer&&console.error("Already created a renderer");this.gl.targetRenderer=this;this.resize()}catch(i){throw"Error creating WebGL Context "+i;}this._programMgr=new d.a(this);this._placeholderTexture=new ut(this)},{resize:function(n,t){var i=this.canvas,r=this.devicePixelRatio;n!=null?(i.style.width=n+"px",i.style.height=t+"px",i.width=n*r,i.height=t*r,this._width=n,this._height=t):(this._width=i.width/r,this._height=i.height/r);this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var n=this.viewport;return n.width/n.height},setDevicePixelRatio:function(n){this.devicePixelRatio=n;this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(n){return this._glinfo.getExtension(n)},getGLParameter:function(n){return this._glinfo.getParameter(n)},setViewport:function(n,t,i,r,u){if(typeof n=="object"){var f=n;n=f.x;t=f.y;i=f.width;r=f.height;u=f.devicePixelRatio}u=u||this.devicePixelRatio;this.gl.viewport(n*u,t*u,i*u,r*u);this.viewport={x:n,y:t,width:i,height:r,devicePixelRatio:u}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){this._viewportStack.length>0&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){if(this._clearStack.length>0){var n=this._clearStack.pop();this.clearColor=n.clearColor;this.clearBit=n.clearBit}},bindSceneRendering:function(n){this._sceneRendering=n},render:function(n,t,i,u){var e=this.gl,c=this.clearColor,h,p,w,a,v;if(this.clearBit){e.colorMask(!0,!0,!0,!0);e.depthMask(!0);var o=this.viewport,b=!1,s=o.devicePixelRatio;(o.width!==this._width||o.height!==this._height||s&&s!==this.devicePixelRatio||o.x||o.y)&&(b=!0,e.enable(e.SCISSOR_TEST),e.scissor(o.x*s,o.y*s,o.width*s,o.height*s));e.clearColor(c[0],c[1],c[2],c[3]);e.clear(this.clearBit);b&&e.disable(e.SCISSOR_TEST)}if(i||n.update(!1),n.updateLights(),t=t||n.getMainCamera(),!t){console.error("Can't find camera in the scene.");return}t.update();h=n.updateRenderList(t,!0);this._sceneRendering=n;var k=h.opaque,y=h.transparent,d=n.material;for(n.trigger("beforerender",this,n,t,h),u?(this.renderPreZ(k,n,t),e.depthFunc(e.LEQUAL)):e.depthFunc(e.LESS),p=r(),w=l.a.create(),a=0;a<y.length;a++)v=y[a],f.a.multiplyAffine(p,t.viewMatrix.array,v.worldTransform.array),l.a.transformMat4(w,v.position.array,p),v.__depth=w[2];this.renderPass(k,t,{getMaterial:function(n){return d||n.material},sortCompare:this.opaqueSortCompare});this.renderPass(y,t,{getMaterial:function(n){return d||n.material},sortCompare:this.transparentSortCompare});n.trigger("afterrender",this,n,t,h);this._sceneRendering=null},getProgram:function(n,t,i){return t=t||n.material,this._programMgr.getProgram(n,t,i)},validateProgram:function(n){if(n.__error){var t=n.__error;if(h[n.__uid__])return;if(h[n.__uid__]=!0,this.throwError)throw new Error(t);else this.trigger("error",t)}},updatePrograms:function(n,t,i){var s=i&&i.getMaterial||a,u,r,o,e;for(t=t||null,u=0;u<n.length;u++){if(r=n[u],o=s.call(this,r),u>0){var f=n[u-1],h=f.joints?f.joints.length:0,c=r.joints?r.joints.length:0;if(c===h&&r.material===f.material&&r.lightGroup===f.lightGroup){r.__program=f.__program;continue}}e=this._programMgr.getProgram(r,o,t);this.validateProgram(e);r.__program=e}},renderPass:function(n,t,i){var lt,k,e,d,p,ht,ct,g,ui;this.trigger("beforerenderpass",this,n,t,i);i=i||{};i.getMaterial=i.getMaterial||a;i.getUniform=i.getUniform||nt;i.isMaterialChanged=i.isMaterialChanged||tt;i.beforeRender=i.beforeRender||v;i.afterRender=i.afterRender||v;lt=i.ifRender||it;this.updatePrograms(n,this._sceneRendering,i);i.sortCompare&&n.sort(i.sortCompare);var c=this.viewport,l=c.devicePixelRatio,ut=[c.x*l,c.y*l,c.width*l,c.height*l],at=this.devicePixelRatio,fi=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*at,this._height*at],ei=[ut[2],ut[3]],oi=Date.now();t?(f.a.copy(u.VIEW,t.viewMatrix.array),f.a.copy(u.PROJECTION,t.projectionMatrix.array),f.a.copy(u.VIEWINVERSE,t.worldTransform.array)):(f.a.identity(u.VIEW),f.a.identity(u.PROJECTION),f.a.identity(u.VIEWINVERSE));f.a.multiply(u.VIEWPROJECTION,u.PROJECTION,u.VIEW);f.a.invert(u.PROJECTIONINVERSE,u.PROJECTION);f.a.invert(u.VIEWPROJECTIONINVERSE,u.VIEWPROJECTION);var r=this.gl,vt=this._sceneRendering,w,b,ft,yt,pt,et,ot,st,wt,bt,kt,dt,y=this.getGLExtension("OES_vertex_array_object");for(k=0;k<n.length;k++)if(e=n[k],d=e.worldTransform!=null,lt(e)){d&&(p=e.isSkinnedMesh&&e.isSkinnedMesh()?u.IDENTITY:e.worldTransform.array);var gt=e.geometry,o=i.getMaterial.call(this,e),s=e.__program,h=o.shader,ni=gt.__uid__+"-"+s.__uid__,ti=ni!==bt;if(bt=ni,ti&&y&&y.bindVertexArrayOES(null),d&&(f.a.copy(u.WORLD,p),f.a.multiply(u.WORLDVIEWPROJECTION,u.VIEWPROJECTION,p),f.a.multiplyAffine(u.WORLDVIEW,u.VIEW,p),(h.matrixSemantics.WORLDINVERSE||h.matrixSemantics.WORLDINVERSETRANSPOSE)&&f.a.invert(u.WORLDINVERSE,p),(h.matrixSemantics.WORLDVIEWINVERSE||h.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&f.a.invert(u.WORLDVIEWINVERSE,u.WORLDVIEW),(h.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||h.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&f.a.invert(u.WORLDVIEWPROJECTIONINVERSE,u.WORLDVIEWPROJECTION)),e.beforeRender&&e.beforeRender(this),i.beforeRender.call(this,e,o,w),ht=s!==b,ht?(s.bind(this),s.setUniformOfSemantic(r,"VIEWPORT",ut),s.setUniformOfSemantic(r,"WINDOW_SIZE",fi),t&&(s.setUniformOfSemantic(r,"NEAR",t.near),s.setUniformOfSemantic(r,"FAR",t.far)),s.setUniformOfSemantic(r,"DEVICEPIXELRATIO",l),s.setUniformOfSemantic(r,"TIME",oi),s.setUniformOfSemantic(r,"VIEWPORT_SIZE",ei),vt&&vt.setLightUniforms(s,e.lightGroup,this)):s=b,(ht||i.isMaterialChanged(e,ft,o,w))&&(o.depthTest!==yt&&(o.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),yt=o.depthTest),o.depthMask!==pt&&(r.depthMask(o.depthMask),pt=o.depthMask),o.transparent!==wt&&(o.transparent?r.enable(r.BLEND):r.disable(r.BLEND),wt=o.transparent),o.transparent&&(o.blend?o.blend(r):(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA))),dt=this._bindMaterial(e,o,s,ft||null,w||null,b||null,i.getUniform),w=o),ct=h.matrixSemanticKeys,d)for(g=0;g<ct.length;g++){var ii=ct[g],rt=h.matrixSemantics[ii],ri=u[ii];rt.isTranspose&&(ui=u[rt.semanticNoTranspose],f.a.transpose(ri,ui));s.setUniform(r,rt.type,rt.symbol,ri)}e.cullFace!==ot&&(ot=e.cullFace,r.cullFace(ot));e.frontFace!==st&&(st=e.frontFace,r.frontFace(st));e.culling!==et&&(et=e.culling,et?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE));this._updateSkeleton(e,s,dt);ti&&(kt=this._bindVAO(y,h,gt,s));this._renderObject(e,kt);i.afterRender(this,e);e.afterRender&&e.afterRender(this);b=s;ft=e}y&&y.bindVertexArrayOES(null);this.trigger("afterrenderpass",this,n,t,i)},getMaxJointNumber:function(){return this._glinfo.getMaxJointNumber()},_updateSkeleton:function(n,t,i){var u=this.gl,r=n.skeleton,f,e;r&&(r.update(),n.joints.length>this._glinfo.getMaxJointNumber()?(f=r.getSubSkinMatricesTexture(n.__uid__,n.joints),t.useTextureSlot(this,f,i),t.setUniform(u,"1i","skinMatricesTexture",i),t.setUniform(u,"1f","skinMatricesTextureSize",f.width)):(e=r.getSubSkinMatrices(n.__uid__,n.joints),t.setUniformOfSemantic(u,"SKIN_MATRIX",e)))},_renderObject:function(n,t){var i=this.gl,u=n.geometry,r=n.mode;if(r==null&&(r=4),t.indicesBuffer){var f=this.getGLExtension("OES_element_index_uint"),e=f&&u.indices instanceof Uint32Array,o=e?i.UNSIGNED_INT:i.UNSIGNED_SHORT;i.drawElements(r,t.indicesBuffer.count,o,0)}else i.drawArrays(r,0,u.vertexCount)},_bindMaterial:function(n,t,i,r,u,f,e){for(var y,tt,b,s,p,l,it,a=this.gl,rt=f===i,ut=i.currentTextureSlot(),g=t.getEnabledUniforms(),nt=t.getTextureUniforms(),k=this._placeholderTexture,c=0;c<nt.length;c++){var h=nt[c],o=e(n,t,h),v=t.uniforms[h].type;if(v==="t"&&o)o.__slot=-1;else if(v==="tv")for(s=0;s<o.length;s++)o[s]&&(o[s].__slot=-1)}for(k.__slot=-1,c=0;c<g.length;c++){var h=g[c],d=t.uniforms[h],o=e(n,t,h),v=d.type,w=v==="t";if(w&&(o&&o.isRenderable()||(o=k)),u&&rt&&(y=e(r,u,h),w&&(y&&y.isRenderable()||(y=k)),y===o)){if(w)i.takeCurrentTextureSlot(this,null);else if(v==="tv"&&o)for(s=0;s<o.length;s++)i.takeCurrentTextureSlot(this,null);continue}if(o==null)continue;else if(w)o.__slot<0?(l=i.currentTextureSlot(),tt=i.setUniform(a,"1i",h,l),tt&&(i.takeCurrentTextureSlot(this,o),o.__slot=l)):i.setUniform(a,"1i",h,o.__slot);else if(Array.isArray(o)){if(o.length===0)continue;if(v==="tv"){if(!i.hasUniform(h))continue;for(b=[],s=0;s<o.length;s++)p=o[s],p.__slot<0?(l=i.currentTextureSlot(),b.push(l),i.takeCurrentTextureSlot(this,p),p.__slot=l):b.push(p.__slot);i.setUniform(a,"1iv",h,b)}else i.setUniform(a,d.type,h,o)}else i.setUniform(a,d.type,h,o)}return it=i.currentTextureSlot(),i.resetTextureSlot(ut),it},_bindVAO:function(n,t,i,r){var l=!i.dynamic,e=this.gl,b=this.__uid__+"-"+r.__uid__,u=i.__vaoCache[b],c,v,p,s,a,tt,f,w;if(!u){if(c=i.getBufferChunks(this),!c||!c.length)return;var k=c[0],d=k.attributeBuffers,a=k.indicesBuffer,s=[],g=[];for(f=0;f<d.length;f++){var o=d[f],it=o.name,nt=o.semantic,h;nt?(v=t.attributeSemantics[nt],h=v&&v.symbol):h=it;h&&r.attributes[h]&&(s.push(o),g.push(h))}u=new rt(s,g,a);l&&(i.__vaoCache[b]=u)}if(p=!0,n&&l&&(u.vao==null?u.vao=n.createVertexArrayOES():p=!1,n.bindVertexArrayOES(u.vao)),s=u.availableAttributes,a=u.indicesBuffer,p){for(tt=r.enableAttributes(this,u.availableAttributeSymbols,n&&l&&u),f=0;f<s.length;f++)if(w=tt[f],w!==-1){var o=s[f],ut=o.buffer,ft=o.size,et=y[o.type]||e.FLOAT;e.bindBuffer(e.ARRAY_BUFFER,ut);e.vertexAttribPointer(w,ft,et,!1,0,0)}i.isUseIndices()&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.buffer)}return u},renderPreZ:function(n,t,i){var r=this.gl,u=this._prezMaterial||new b.a({shader:new s.a(s.a.source("clay.prez.vertex"),s.a.source("clay.prez.fragment"))});this._prezMaterial=u;r.colorMask(!1,!1,!1,!1);r.depthMask(!0);this.renderPass(n,i,{ifRender:function(n){return!n.ignorePreZ},isMaterialChanged:function(n,t){var i=n.material,r=t.material;return i.get("diffuseMap")!==r.get("diffuseMap")||(i.get("alphaCutoff")||0)!==(r.get("alphaCutoff")||0)},getUniform:function(n,t,i){if(i==="alphaMap")return n.material.get("diffuseMap");if(i==="alphaCutoff"){if(n.material.isDefined("fragment","ALPHA_TEST")&&n.material.get("diffuseMap")){var r=n.material.get("alphaCutoff");return r||0}return 0}return t.get(i)},getMaterial:function(){return u},sort:this.opaqueSortCompare});r.colorMask(!0,!0,!0,!0);r.depthMask(!0)},disposeScene:function(n){this.disposeNode(n,!0,!0);n.dispose()},disposeNode:function(n,t,i){n.getParent()&&n.getParent().remove(n);var r={};n.traverse(function(n){var f=n.material,s,o,e;if(n.geometry&&t&&n.geometry.dispose(this),i&&f&&!r[f.__uid__]){for(s=f.getTextureUniforms(),o=0;o<s.length;o++){var h=s[o],u=f.uniforms[h].value,c=f.uniforms[h].type;if(u)if(c==="t")u.dispose&&u.dispose(this);else if(c==="tv")for(e=0;e<u.length;e++)u[e]&&u[e].dispose&&u[e].dispose(this)}r[f.__uid__]=!0}n.dispose&&n.dispose(this)},this)},disposeGeometry:function(n){n.dispose(this)},disposeTexture:function(n){n.dispose(this)},disposeFrameBuffer:function(n){n.dispose(this)},dispose:function(){},screenToNDC:function(n,t,i){i||(i=new k.a);t=this._height-t;var u=this.viewport,r=i.array;return r[0]=(n-u.x)/u.width,r[0]=r[0]*2-1,r[1]=(t-u.y)/u.height,r[1]=r[1]*2-1,i}});e.opaqueSortCompare=e.prototype.opaqueSortCompare=function(n,t){return n.renderOrder===t.renderOrder?n.__program===t.__program?n.material===t.material?n.geometry.__uid__-t.geometry.__uid__:n.material.__uid__-t.material.__uid__:n.__program&&t.__program?n.__program.__uid__-t.__program.__uid__:0:n.renderOrder-t.renderOrder};e.transparentSortCompare=e.prototype.transparentSortCompare=function(n,t){return n.renderOrder===t.renderOrder?n.__depth===t.__depth?n.__program===t.__program?n.material===t.material?n.geometry.__uid__-t.geometry.__uid__:n.material.__uid__-t.material.__uid__:n.__program&&t.__program?n.__program.__uid__-t.__program.__uid__:0:n.__depth-t.__depth:n.renderOrder-t.renderOrder};u={IDENTITY:r(),WORLD:r(),VIEW:r(),PROJECTION:r(),WORLDVIEW:r(),VIEWPROJECTION:r(),WORLDVIEWPROJECTION:r(),WORLDINVERSE:r(),VIEWINVERSE:r(),PROJECTIONINVERSE:r(),WORLDVIEWINVERSE:r(),VIEWPROJECTIONINVERSE:r(),WORLDVIEWPROJECTIONINVERSE:r(),WORLDTRANSPOSE:r(),VIEWTRANSPOSE:r(),PROJECTIONTRANSPOSE:r(),WORLDVIEWTRANSPOSE:r(),VIEWPROJECTIONTRANSPOSE:r(),WORLDVIEWPROJECTIONTRANSPOSE:r(),WORLDINVERSETRANSPOSE:r(),VIEWINVERSETRANSPOSE:r(),PROJECTIONINVERSETRANSPOSE:r(),WORLDVIEWINVERSETRANSPOSE:r(),VIEWPROJECTIONINVERSETRANSPOSE:r(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:r()};e.COLOR_BUFFER_BIT=o.a.COLOR_BUFFER_BIT;e.DEPTH_BUFFER_BIT=o.a.DEPTH_BUFFER_BIT;e.STENCIL_BUFFER_BIT=o.a.STENCIL_BUFFER_BIT;t.a=e},function(n,t){"use strict";function i(n,t){this.action=n;this.context=t}var r={trigger:function(n){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(n)){var i=this.__handlers__[n],u=i.length,t=-1,r=arguments;switch(r.length){case 1:while(++t<u)i[t].action.call(i[t].context);return;case 2:while(++t<u)i[t].action.call(i[t].context,r[1]);return;case 3:while(++t<u)i[t].action.call(i[t].context,r[1],r[2]);return;case 4:while(++t<u)i[t].action.call(i[t].context,r[1],r[2],r[3]);return;case 5:while(++t<u)i[t].action.call(i[t].context,r[1],r[2],r[3],r[4]);return;default:while(++t<u)i[t].action.apply(i[t].context,Array.prototype.slice.call(r,1));return}}},on:function(n,t,r){var u,f;if(n&&t){if(u=this.__handlers__||(this.__handlers__={}),u[n]){if(this.has(n,t))return}else u[n]=[];return f=new i(t,r||this),u[n].push(f),this}},once:function(n,t,i){function r(){u.off(n,r);t.apply(this,arguments)}if(n&&t){var u=this;return this.on(n,r,i)}},before:function(n,t,i){if(n&&t){n="before"+n;return this.on(n,t,i)}},after:function(n,t,i){if(n&&t){n="after"+n;return this.on(n,t,i)}},success:function(n,t){return this.once("success",n,t)},error:function(n,t){return this.once("error",n,t)},off:function(n,t){var r=this.__handlers__||(this.__handlers__={}),u,f,i;if(!t){r[n]=[];return}if(r[n]){for(u=r[n],f=[],i=0;i<u.length;i++)t&&u[i].action!==t&&f.push(u[i]);r[n]=f}return this},has:function(n,t){var r=this.__handlers__,u,i;if(!r||!r[n])return!1;for(u=r[n],i=0;i<u.length;i++)if(u[i].action===t)return!0}};t.a=r},function(n,t,i){"use strict";var u=i(3),r=i(12),e=1e-5,f=function(n,t){this.origin=n||new u.a;this.direction=t||new u.a};f.prototype={constructor:f,intersectPlane:function(n,t){var i=n.normal.array,h=n.distance,f=this.origin.array,e=this.direction.array,o=r.a.dot(i,e),s;return o===0?null:(t||(t=new u.a),s=(r.a.dot(i,f)-h)/o,r.a.scaleAndAdd(t.array,f,e,-s),t._dirty=!0,t)},mirrorAgainstPlane:function(n){var t=r.a.dot(n.normal.array,this.direction.array);r.a.scaleAndAdd(this.direction.array,this.direction.array,n.normal.array,-t*2);this.direction._dirty=!0},distanceToPoint:function(){var n=r.a.create();return function(t){var i,u;return(r.a.sub(n,t,this.origin.array),i=r.a.dot(n,this.direction.array),i<0)?r.a.distance(this.origin.array,t):(u=r.a.lenSquared(n),Math.sqrt(u-i*i))}}(),intersectSphere:function(){var n=r.a.create();return function(t,i,f){var o=this.origin.array,s=this.direction.array;t=t.array;r.a.sub(n,t,o);var e=r.a.dot(n,s),y=r.a.squaredLength(n),h=y-e*e,c=i*i;if(!(h>c)){var l=Math.sqrt(c-h),a=e-l,v=e+l;return f||(f=new u.a),a<0?v<0?null:(r.a.scaleAndAdd(f.array,o,s,v),f):(r.a.scaleAndAdd(f.array,o,s,a),f)}}}(),intersectBoundingBox:function(n,t){var w=this.direction.array,e=this.origin.array,o=n.min.array,s=n.max.array,h=1/w[0],c=1/w[1],l=1/w[2],i,f,a,v,y,p,b;return(h>=0?(i=(o[0]-e[0])*h,f=(s[0]-e[0])*h):(f=(o[0]-e[0])*h,i=(s[0]-e[0])*h),c>=0?(a=(o[1]-e[1])*c,v=(s[1]-e[1])*c):(v=(o[1]-e[1])*c,a=(s[1]-e[1])*c),i>v||a>f)?null:((a>i||i!==i)&&(i=a),(v<f||f!==f)&&(f=v),l>=0?(y=(o[2]-e[2])*l,p=(s[2]-e[2])*l):(p=(o[2]-e[2])*l,y=(s[2]-e[2])*l),i>p||y>f)?null:((y>i||i!==i)&&(i=y),(p<f||f!==f)&&(f=p),f<0)?null:(b=i>=0?i:f,t||(t=new u.a),r.a.scaleAndAdd(t.array,e,w,b),t)},intersectTriangle:function(){var t=r.a.create(),f=r.a.create(),i=r.a.create(),n=r.a.create();return function(o,s,h,c,l,a){var w=this.direction.array,k=this.origin.array,v,y,p,b;if(o=o.array,s=s.array,h=h.array,r.a.sub(t,s,o),r.a.sub(f,h,o),r.a.cross(n,f,w),v=r.a.dot(t,n),c){if(v>-e)return null}else if(v>-e&&v<e)return null;return(r.a.sub(i,k,o),y=r.a.dot(n,i)/v,y<0||y>1)?null:(r.a.cross(n,t,i),p=r.a.dot(w,n)/v,p<0||p>1||y+p>1)?null:(r.a.cross(n,t,f),b=-r.a.dot(i,n)/v,b<0)?null:(l||(l=new u.a),a&&u.a.set(a,1-y-p,y,p),r.a.scaleAndAdd(l.array,k,w,b),l)}}(),applyTransform:function(n){u.a.add(this.direction,this.direction,this.origin);u.a.transformMat4(this.origin,this.origin,n);u.a.transformMat4(this.direction,this.direction,n);u.a.sub(this.direction,this.direction,this.origin);u.a.normalize(this.direction,this.direction)},copy:function(n){u.a.copy(this.origin,n.origin);u.a.copy(this.direction,n.direction)},clone:function(){var n=new f;return n.copy(this),n}};t.a=f},function(n,t,i){"use strict";var e=i(20),f=i(12),u=i(33),o=i(34),r={};r.create=function(){var n=new e.a(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};r.rotationTo=function(){var n=f.a.create(),t=f.a.fromValues(1,0,0),i=f.a.fromValues(0,1,0);return function(u,e,o){var s=f.a.dot(e,o);return s<-.999999?(f.a.cross(n,t,e),f.a.length(n)<1e-6&&f.a.cross(n,i,e),f.a.normalize(n,n),r.setAxisAngle(u,n,Math.PI),u):s>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(f.a.cross(n,e,o),u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=1+s,r.normalize(u,u))}}();r.setAxes=function(){var n=o.a.create();return function(t,i,u,f){return n[0]=u[0],n[3]=u[1],n[6]=u[2],n[1]=f[0],n[4]=f[1],n[7]=f[2],n[2]=-i[0],n[5]=-i[1],n[8]=-i[2],r.normalize(t,r.fromMat3(t,n))}}();r.clone=u.a.clone;r.fromValues=u.a.fromValues;r.copy=u.a.copy;r.set=u.a.set;r.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};r.setAxisAngle=function(n,t,i){i=i*.5;var r=Math.sin(i);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(i),n};r.add=u.a.add;r.multiply=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3],o=i[0],s=i[1],h=i[2],c=i[3];return n[0]=r*c+e*o+u*h-f*s,n[1]=u*c+e*s+f*o-r*h,n[2]=f*c+e*h+r*s-u*o,n[3]=e*c-r*o-u*s-f*h,n};r.mul=r.multiply;r.scale=u.a.scale;r.rotateX=function(n,t,i){i*=.5;var f=t[0],e=t[1],o=t[2],s=t[3],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u+s*r,n[1]=e*u+o*r,n[2]=o*u-e*r,n[3]=s*u-f*r,n};r.rotateY=function(n,t,i){i*=.5;var f=t[0],e=t[1],o=t[2],s=t[3],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u-o*r,n[1]=e*u+s*r,n[2]=o*u+f*r,n[3]=s*u-e*r,n};r.rotateZ=function(n,t,i){i*=.5;var f=t[0],e=t[1],o=t[2],s=t[3],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u+e*r,n[1]=e*u-f*r,n[2]=o*u+s*r,n[3]=s*u-o*r,n};r.calculateW=function(n,t){var i=t[0],r=t[1],u=t[2];return n[0]=i,n[1]=r,n[2]=u,n[3]=Math.sqrt(Math.abs(1-i*i-r*r-u*u)),n};r.dot=u.a.dot;r.lerp=u.a.lerp;r.slerp=function(n,t,i,r){var v=t[0],y=t[1],p=t[2],w=t[3],o=i[0],s=i[1],h=i[2],c=i[3],l,u,a,f,e;return u=v*o+y*s+p*h+w*c,u<0&&(u=-u,o=-o,s=-s,h=-h,c=-c),1-u>1e-6?(l=Math.acos(u),a=Math.sin(l),f=Math.sin((1-r)*l)/a,e=Math.sin(r*l)/a):(f=1-r,e=r),n[0]=f*v+e*o,n[1]=f*y+e*s,n[2]=f*p+e*h,n[3]=f*w+e*c,n};r.invert=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],o=r*r+u*u+f*f+e*e,i=o?1/o:0;return n[0]=-r*i,n[1]=-u*i,n[2]=-f*i,n[3]=e*i,n};r.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n};r.length=u.a.length;r.len=r.length;r.squaredLength=u.a.squaredLength;r.sqrLen=r.squaredLength;r.normalize=u.a.normalize;r.fromMat3=function(n,t){var e=t[0]+t[4]+t[8],i,r,u,f;return e>0?(i=Math.sqrt(e+1),n[3]=.5*i,i=.5/i,n[0]=(t[5]-t[7])*i,n[1]=(t[6]-t[2])*i,n[2]=(t[1]-t[3])*i):(r=0,t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2),u=(r+1)%3,f=(r+2)%3,i=Math.sqrt(t[r*3+r]-t[u*3+u]-t[f*3+f]+1),n[r]=.5*i,i=.5/i,n[3]=(t[u*3+f]-t[f*3+u])*i,n[u]=(t[u*3+r]+t[r*3+u])*i,n[f]=(t[f*3+r]+t[r*3+f])*i),n};t.a=r},function(n,t,i){"use strict";var r=i(55),o=i(34),u=function(n,t,i,u){n=n||0;t=t||0;i=i||0;u=u===undefined?1:u;this.array=r.a.fromValues(n,t,i,u);this._dirty=!0},f,e;u.prototype={constructor:u,add:function(n){return r.a.add(this.array,this.array,n.array),this._dirty=!0,this},calculateW:function(){return r.a.calculateW(this.array,this.array),this._dirty=!0,this},set:function(n,t,i,r){return this.array[0]=n,this.array[1]=t,this.array[2]=i,this.array[3]=r,this._dirty=!0,this},setArray:function(n){return this.array[0]=n[0],this.array[1]=n[1],this.array[2]=n[2],this.array[3]=n[3],this._dirty=!0,this},clone:function(){return new u(this.x,this.y,this.z,this.w)},conjugate:function(){return r.a.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},dot:function(n){return r.a.dot(this.array,n.array)},fromMat3:function(n){return r.a.fromMat3(this.array,n.array),this._dirty=!0,this},fromMat4:function(){var n=o.a.create();return function(t){return o.a.fromMat4(n,t.array),o.a.transpose(n,n),r.a.fromMat3(this.array,n),this._dirty=!0,this}}(),identity:function(){return r.a.identity(this.array),this._dirty=!0,this},invert:function(){return r.a.invert(this.array,this.array),this._dirty=!0,this},len:function(){return r.a.len(this.array)},length:function(){return r.a.length(this.array)},lerp:function(n,t,i){return r.a.lerp(this.array,n.array,t.array,i),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},mulLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},multiplyLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},normalize:function(){return r.a.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(n){return r.a.rotateX(this.array,this.array,n),this._dirty=!0,this},rotateY:function(n){return r.a.rotateY(this.array,this.array,n),this._dirty=!0,this},rotateZ:function(n){return r.a.rotateZ(this.array,this.array,n),this._dirty=!0,this},rotationTo:function(n,t){return r.a.rotationTo(this.array,n.array,t.array),this._dirty=!0,this},setAxes:function(n,t,i){return r.a.setAxes(this.array,n.array,t.array,i.array),this._dirty=!0,this},setAxisAngle:function(n,t){return r.a.setAxisAngle(this.array,n.array,t),this._dirty=!0,this},slerp:function(n,t,i){return r.a.slerp(this.array,n.array,t.array,i),this._dirty=!0,this},sqrLen:function(){return r.a.sqrLen(this.array)},squaredLength:function(){return r.a.squaredLength(this.array)},fromEuler:function(n,t){return u.fromEuler(this,n,t)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};f=Object.defineProperty;f&&(e=u.prototype,f(e,"x",{get:function(){return this.array[0]},set:function(n){this.array[0]=n;this._dirty=!0}}),f(e,"y",{get:function(){return this.array[1]},set:function(n){this.array[1]=n;this._dirty=!0}}),f(e,"z",{get:function(){return this.array[2]},set:function(n){this.array[2]=n;this._dirty=!0}}),f(e,"w",{get:function(){return this.array[3]},set:function(n){this.array[3]=n;this._dirty=!0}}));u.add=function(n,t,i){return r.a.add(n.array,t.array,i.array),n._dirty=!0,n};u.set=function(n,t,i,u,f){r.a.set(n.array,t,i,u,f);n._dirty=!0};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.calculateW=function(n,t){return r.a.calculateW(n.array,t.array),n._dirty=!0,n};u.conjugate=function(n,t){return r.a.conjugate(n.array,t.array),n._dirty=!0,n};u.identity=function(n){return r.a.identity(n.array),n._dirty=!0,n};u.invert=function(n,t){return r.a.invert(n.array,t.array),n._dirty=!0,n};u.dot=function(n,t){return r.a.dot(n.array,t.array)};u.len=function(n){return r.a.length(n.array)};u.lerp=function(n,t,i,u){return r.a.lerp(n.array,t.array,i.array,u),n._dirty=!0,n};u.slerp=function(n,t,i,u){return r.a.slerp(n.array,t.array,i.array,u),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.multiply(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.rotateX=function(n,t,i){return r.a.rotateX(n.array,t.array,i),n._dirty=!0,n};u.rotateY=function(n,t,i){return r.a.rotateY(n.array,t.array,i),n._dirty=!0,n};u.rotateZ=function(n,t,i){return r.a.rotateZ(n.array,t.array,i),n._dirty=!0,n};u.setAxisAngle=function(n,t,i){return r.a.setAxisAngle(n.array,t.array,i),n._dirty=!0,n};u.normalize=function(n,t){return r.a.normalize(n.array,t.array),n._dirty=!0,n};u.sqrLen=function(n){return r.a.sqrLen(n.array)};u.squaredLength=u.sqrLen;u.fromMat3=function(n,t){return r.a.fromMat3(n.array,t.array),n._dirty=!0,n};u.setAxes=function(n,t,i,u){return r.a.setAxes(n.array,t.array,i.array,u.array),n._dirty=!0,n};u.rotationTo=function(n,t,i){return r.a.rotationTo(n.array,t.array,i.array),n._dirty=!0,n};u.fromEuler=function(n,t,i){n._dirty=!0;t=t.array;var r=n.array,u=Math.cos(t[0]/2),f=Math.cos(t[1]/2),e=Math.cos(t[2]/2),o=Math.sin(t[0]/2),s=Math.sin(t[1]/2),h=Math.sin(t[2]/2),i=(i||"XYZ").toUpperCase();switch(i){case"XYZ":r[0]=o*f*e+u*s*h;r[1]=u*s*e-o*f*h;r[2]=u*f*h+o*s*e;r[3]=u*f*e-o*s*h;break;case"YXZ":r[0]=o*f*e+u*s*h;r[1]=u*s*e-o*f*h;r[2]=u*f*h-o*s*e;r[3]=u*f*e+o*s*h;break;case"ZXY":r[0]=o*f*e-u*s*h;r[1]=u*s*e+o*f*h;r[2]=u*f*h+o*s*e;r[3]=u*f*e-o*s*h;break;case"ZYX":r[0]=o*f*e-u*s*h;r[1]=u*s*e+o*f*h;r[2]=u*f*h-o*s*e;r[3]=u*f*e+o*s*h;break;case"YZX":r[0]=o*f*e+u*s*h;r[1]=u*s*e+o*f*h;r[2]=u*f*h-o*s*e;r[3]=u*f*e-o*s*h;break;case"XZY":r[0]=o*f*e-u*s*h;r[1]=u*s*e-o*f*h;r[2]=u*f*h+o*s*e;r[3]=u*f*e+o*s*h}};t.a=u},function(n,t){"use strict";var i="__dt__",r=function(){this._contextId=0;this._caches=[];this._context={}};r.prototype={use:function(n,t){var i=this._caches;i[n]||(i[n]={},t&&(i[n]=t()));this._contextId=n;this._context=i[n]},put:function(n,t){this._context[n]=t},get:function(n){return this._context[n]},dirty:function(n){n=n||"";var t=i+n;this.put(t,!0)},dirtyAll:function(n){var u,r,t;for(n=n||"",u=i+n,r=this._caches,t=0;t<r.length;t++)r[t]&&(r[t][u]=!0)},fresh:function(n){n=n||"";var t=i+n;this.put(t,!1)},freshAll:function(n){var u,r,t;for(n=n||"",u=i+n,r=this._caches,t=0;t<r.length;t++)r[t]&&(r[t][u]=!1)},isDirty:function(n){n=n||"";var t=i+n,r=this._context;return!r.hasOwnProperty(t)||r[t]===!0},deleteContext:function(n){delete this._caches[n];this._context={}},"delete":function(n){delete this._context[n]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(n,t){var i=Object.keys(this._caches);i.forEach(function(i){n&&n.call(t,i)})},miss:function(n){return!this._context.hasOwnProperty(n)}};r.prototype.constructor=r;t.a=r},function(n,t,i){"use strict";var e=i(35),r=i(9),o=i(59),s=i(54),u=i(33),f=i(12),h=e.a.extend(function(){return{projectionMatrix:new r.a,invProjectionMatrix:new r.a,viewMatrix:new r.a,frustum:new o.a}},function(){this.update(!0)},{update:function(n){e.a.prototype.update.call(this,n);r.a.invert(this.viewMatrix,this.worldTransform);this.updateProjectionMatrix();r.a.invert(this.invProjectionMatrix,this.projectionMatrix);this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(n){r.a.copy(this.viewMatrix,n);r.a.invert(this.worldTransform,n);this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(n){r.a.copy(this.projectionMatrix,n);r.a.invert(this.invProjectionMatrix,n);this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:function(){var n=u.a.create();return function(t,i){var r=i!==undefined?i:new s.a,e=t.array[0],o=t.array[1];return u.a.set(n,e,o,-1,1),u.a.transformMat4(n,n,this.invProjectionMatrix.array),u.a.transformMat4(n,n,this.worldTransform.array),f.a.scale(r.origin.array,n,1/n[3]),u.a.set(n,e,o,1,1),u.a.transformMat4(n,n,this.invProjectionMatrix.array),u.a.transformMat4(n,n,this.worldTransform.array),f.a.scale(n,n,1/n[3]),f.a.sub(r.direction.array,n,r.origin.array),f.a.normalize(r.direction.array,r.direction.array),r.direction._dirty=!0,r.origin._dirty=!0,r}}()});t.a=h},function(n,t,i){"use strict";var c=i(18),l=i(74),u=i(12),r=u.a.set,o=u.a.copy,s=u.a.transformMat4,f=Math.min,e=Math.max,h=function(){var n;for(this.planes=[],n=0;n<6;n++)this.planes.push(new l.a);for(this.boundingBox=new c.a,this.vertices=[],n=0;n<8;n++)this.vertices[n]=u.a.fromValues(0,0,0)};h.prototype={setFromProjection:function(n){var t=this.planes,u=n.array,g=u[0],it=u[1],rt=u[2],v=u[3],ut=u[4],c=u[5],ft=u[6],y=u[7],et=u[8],ot=u[9],p=u[10],w=u[11],nt=u[12],tt=u[13],b=u[14],l=u[15],a,i,f,e;if(r(t[0].normal.array,v-g,y-ut,w-et),t[0].distance=-(l-nt),t[0].normalize(),r(t[1].normal.array,v+g,y+ut,w+et),t[1].distance=-(l+nt),t[1].normalize(),r(t[2].normal.array,v+it,y+c,w+ot),t[2].distance=-(l+tt),t[2].normalize(),r(t[3].normal.array,v-it,y-c,w-ot),t[3].distance=-(l-tt),t[3].normalize(),r(t[4].normal.array,v-rt,y-ft,w-p),t[4].distance=-(l-b),t[4].normalize(),r(t[5].normal.array,v+rt,y+ft,w+p),t[5].distance=-(l+b),t[5].normalize(),a=this.boundingBox,i=this.vertices,l===0){var s=c/g,k=-b/(p-1),d=-b/(p+1),o=-d/c,h=-k/c;a.min.set(-o*s,-o,d);a.max.set(o*s,o,k);r(i[0],-o*s,-o,d);r(i[1],-o*s,o,d);r(i[2],o*s,-o,d);r(i[3],o*s,o,d);r(i[4],-h*s,-h,k);r(i[5],-h*s,h,k);r(i[6],h*s,-h,k);r(i[7],h*s,h,k)}else{var st=(-1-nt)/g,ht=(1-nt)/g,ct=(1-tt)/c,lt=(-1-tt)/c,at=(-1-b)/p,vt=(1-b)/p;a.min.set(Math.min(st,ht),Math.min(lt,ct),Math.min(vt,at));a.max.set(Math.max(ht,st),Math.max(ct,lt),Math.max(at,vt));f=a.min.array;e=a.max.array;r(i[0],f[0],f[1],f[2]);r(i[1],f[0],e[1],f[2]);r(i[2],e[0],f[1],f[2]);r(i[3],e[0],e[1],f[2]);r(i[4],f[0],f[1],e[2]);r(i[5],f[0],e[1],e[2]);r(i[6],e[0],f[1],e[2]);r(i[7],e[0],e[1],e[2])}},getTransformedBoundingBox:function(){var n=u.a.create();return function(t,i){var l=this.vertices,a=i.array,v=t.min,y=t.max,r=v.array,u=y.array,c=l[0],h;for(s(n,c,a),o(r,n),o(u,n),h=1;h<8;h++)c=l[h],s(n,c,a),r[0]=f(n[0],r[0]),r[1]=f(n[1],r[1]),r[2]=f(n[2],r[2]),u[0]=e(n[0],u[0]),u[1]=e(n[1],u[1]),u[2]=e(n[2],u[2]);return v._dirty=!0,y._dirty=!0,t}}()};t.a=h},function(n){var r=function(){this.head=null;this.tail=null;this._len=0},t=r.prototype,e;t.insert=function(n){var t=new u(n);return this.insertEntry(t),t};t.insertEntry=function(n){this.head?(this.tail.next=n,n.prev=this.tail,n.next=null,this.tail=n):this.head=this.tail=n;this._len++};t.remove=function(n){var t=n.prev,i=n.next;t?t.next=i:this.head=i;i?i.prev=t:this.tail=t;n.next=n.prev=null;this._len--};t.len=function(){return this._len};t.clear=function(){this.head=this.tail=null;this._len=0};var u=function(n){this.value=n;this.next;this.prev},f=function(n){this._list=new r;this._map={};this._maxSize=n||10;this._lastRemovedEntry=null},i=f.prototype;i.put=function(n,t){var f=this._list,e=this._map,s=null,o,i,r;return e[n]==null&&(o=f.len(),i=this._lastRemovedEntry,o>=this._maxSize&&o>0&&(r=f.head,f.remove(r),delete e[r.key],s=r.value,this._lastRemovedEntry=r),i?i.value=t:i=new u(t),i.key=n,f.insertEntry(i),e[n]=i),s};i.get=function(n){var t=this._map[n],i=this._list;if(t!=null)return t!==i.tail&&(i.remove(t),i.insertEntry(t)),t.value};i.clear=function(){this._list.clear();this._map={}};e=f;n.exports=e},function(n,t,i){"use strict";var r=i(5),f=i(27),e=i(14),o=i(62),s=i(75),h=i(36),c=i(122),l=i(123),u={loadTexture:function(n,t,i,e){var o;if(typeof t=="function"?(i=t,e=i,t={}):t=t||{},typeof n=="string"){if(n.match(/.hdr$/)||t.fileType==="hdr")return o=new r.a({width:0,height:0,sRGB:!1}),u._fetchTexture(n,function(n){l.a.parseRGBE(n,o,t.exposure);o.dirty();i&&i(o)},e),o;n.match(/.dds$/)||t.fileType==="dds"?(o=new r.a({width:0,height:0}),u._fetchTexture(n,function(n){c.a.parse(n,o);o.dirty();i&&i(o)},e)):(o=new r.a,o.load(n),o.success(i),o.error(e))}else typeof n=="object"&&typeof n.px!="undefined"&&(o=new f.a,o.load(n),o.success(i),o.error(e));return o},loadPanorama:function(n,t,i,r,f,e){var o=this;typeof r=="function"?(f=r,e=f,r={}):r=r||{};u.loadTexture(t,r,function(t){t.flipY=r.flipY||!1;o.panoramaToCubeMap(n,t,i,r);t.dispose(n);f&&f(i)},e)},panoramaToCubeMap:function(n,t,i,r){var u=new o.a,f=new s.a({scene:new h.a});return f.setEnvironmentMap(t),r=r||{},r.encodeRGBM&&f.material.define("fragment","RGBM_ENCODE"),i.sRGB=t.sRGB,u.texture=i,u.render(n,f.scene),u.texture=null,u.dispose(n),i},heightToNormal:function(n,t){var e=document.createElement("canvas"),u=e.width=n.width,o=e.height=n.height,s=e.getContext("2d"),r,f,i,h,c,l,a;for(s.drawImage(n,0,0,u,o),t=t||!1,r=s.getImageData(0,0,u,o),f=s.createImageData(u,o),i=0;i<r.data.length;i+=4){if(t){var y=r.data[i],v=r.data[i+1],p=r.data[i+2],w=Math.abs(y-v)+Math.abs(v-p);if(w>20)return console.warn("Given image is not a height map"),n}i%(u*4)==0?(h=r.data[i],l=r.data[i+4]):i%(u*4)==(u-1)*4?(h=r.data[i-4],l=r.data[i]):(h=r.data[i-4],l=r.data[i+4]);i<u*4?(c=r.data[i],a=r.data[i+u*4]):i>u*(o-1)*4?(c=r.data[i-u*4],a=r.data[i]):(c=r.data[i-u*4],a=r.data[i+u*4]);f.data[i]=h-l+127;f.data[i+1]=c-a+127;f.data[i+2]=255;f.data[i+3]=255}return s.putImageData(f,0,0),e},isHeightImage:function(n,t,i){var f,r;if(!n||!n.width||!n.height)return!1;var e=document.createElement("canvas"),o=e.getContext("2d"),u=t||32;for(i=i||20,e.width=e.height=u,o.drawImage(n,0,0,u,u),f=o.getImageData(0,0,u,u),r=0;r<f.data.length;r+=4){var h=f.data[r],s=f.data[r+1],c=f.data[r+2],l=Math.abs(h-s)+Math.abs(s-c);if(l>i)return!1}return!0},_fetchTexture:function(n,t,i){e.a.request.get({url:n,responseType:"arraybuffer",onload:t,onerror:i})},createChessboard:function(n,t,i,u){var h,e,o,f,s,c;for(n=n||512,t=t||64,i=i||"black",u=u||"white",h=Math.ceil(n/t),e=document.createElement("canvas"),e.width=n,e.height=n,o=e.getContext("2d"),o.fillStyle=u,o.fillRect(0,0,n,n),o.fillStyle=i,f=0;f<h;f++)for(s=0;s<h;s++)c=s%2?f%2:f%2-1,c&&o.fillRect(f*t,s*t,t,t);return new r.a({image:e,anisotropic:8})},createBlank:function(n){var t=document.createElement("canvas"),i;return t.width=1,t.height=1,i=t.getContext("2d"),i.fillStyle=n,i.fillRect(0,0,1,1),new r.a({image:t})}};t.a=u},function(n,t,i){"use strict";var f=i(7),r=i(3),u=i(41),e=i(10),o=["px","nx","py","ny","pz","nz"],s=f.a.extend(function(){var t={position:new r.a,far:1e3,near:.1,texture:null,shadowMapPass:null},n=t._cameras={px:new u.a({fov:90}),nx:new u.a({fov:90}),py:new u.a({fov:90}),ny:new u.a({fov:90}),pz:new u.a({fov:90}),nz:new u.a({fov:90})};return n.px.lookAt(r.a.POSITIVE_X,r.a.NEGATIVE_Y),n.nx.lookAt(r.a.NEGATIVE_X,r.a.NEGATIVE_Y),n.py.lookAt(r.a.POSITIVE_Y,r.a.POSITIVE_Z),n.ny.lookAt(r.a.NEGATIVE_Y,r.a.NEGATIVE_Z),n.pz.lookAt(r.a.POSITIVE_Z,r.a.NEGATIVE_Y),n.nz.lookAt(r.a.NEGATIVE_Z,r.a.NEGATIVE_Y),t._frameBuffer=new e.a,t},{getCamera:function(n){return this._cameras[n]},render:function(n,t,i){var h=n.gl,e,c,f,l,u,s;for(i||t.update(),e=this.texture.width,c=2*Math.atan(e/(e-.5))/Math.PI*180,f=0;f<6;f++)l=o[f],u=this._cameras[l],r.a.copy(u.position,this.position),u.far=this.far,u.near=this.near,u.fov=c,this.shadowMapPass&&(u.update(),s=t.getBoundingBox(),s.applyTransform(u.viewMatrix),t.viewBoundingBoxLastFrame.copy(s),this.shadowMapPass.render(n,t,u,!0)),this._frameBuffer.attach(this.texture,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+f),this._frameBuffer.bind(n),n.render(t,u,!0),this._frameBuffer.unbind(n)},dispose:function(n){this._frameBuffer.dispose(n)}});t.a=s},function(n,t,i){"use strict";var r=i(1),u=i(165),f=i(166);r.a.Shader.import(f.a);t.a=r.a.Mesh.extend(function(){var n=new u.a({dynamic:!0}),t=new r.a.Material({shader:r.a.createShader("ecgl.labels"),transparent:!0,depthMask:!1});return{geometry:n,material:t,culling:!1,castShadow:!1,ignorePicking:!0}})},function(n,t,i){"use strict";function e(n){this.rootNode=new r.a.Node;this._triangulationResults={};this._shadersMap=r.a.COMMON_SHADERS.reduce(function(n,t){return n[t]=r.a.createShader("ecgl."+t),n},{});this._linesShader=r.a.createShader("ecgl.meshLines3D");var t={};r.a.COMMON_SHADERS.forEach(function(n){t[n]=new r.a.Material({shader:r.a.createShader("ecgl."+n)})});this._groundMaterials=t;this._groundMesh=new r.a.Mesh({geometry:new r.a.PlaneGeometry({dynamic:!0}),castShadow:!1,renderNormal:!0,$ignorePicking:!0});this._groundMesh.rotation.rotateX(-Math.PI/2);this._labelsBuilder=new v.a(512,512,n);this._labelsBuilder.getMesh().renderOrder=100;this._labelsBuilder.getMesh().material.depthTest=!1;this.rootNode.add(this._labelsBuilder.getMesh());this._initMeshes();this._api=n}var s=i(0),o=i.n(s),r=i(1),h=i(204),c=i(25),f=i(2),l=i(6),a=i(65),v=i(66),y=i(46),u=l.a.vec3;r.a.Shader.import(y.a);e.prototype={constructor:e,extrudeY:!0,update:function(n,t,i,r,u){var e=n.getData(),s,f,o;r==null&&(r=0);u==null&&(u=e.count());this._startIndex=r;this._endIndex=u-1;this._triangulation(n,r,u);s=this._getShader(n.get("shading"));this._prepareMesh(n,s,i,r,u);this.rootNode.updateWorldTransform();this._updateRegionMesh(n,i,r,u);f=n.coordinateSystem;f.type==="geo3D"&&this._updateGroundPlane(n,f,i);o=this;this._labelsBuilder.updateData(e,r,u);this._labelsBuilder.getLabelPosition=function(n,t,i){var c=e.getName(n),s=i,h,r,u;if(f.type==="geo3D")return(h=f.getRegion(c),!h)?[NaN,NaN,NaN]:(u=h.center,f.dataToPoint([u[0],u[1],s]));r=o._triangulationResults[n-o._startIndex];u=o.extrudeY?[(r.max[0]+r.min[0])/2,r.max[1]+s,(r.max[2]+r.min[2])/2]:[(r.max[0]+r.min[0])/2,(r.max[1]+r.min[1])/2,r.max[2]+s]};this._data=e;this._labelsBuilder.updateLabels();this._updateDebugWireframe(n);this._lastHoverDataIndex=0},_initMeshes:function(){function u(){var n=new r.a.Mesh({name:"Polygon",material:new r.a.Material({shader:i._shadersMap.lambert}),geometry:new r.a.Geometry({sortTriangles:!0,dynamic:!0}),culling:!1,ignorePicking:!0,renderNormal:!0});return o.a.util.extend(n.geometry,a.a),n}var i=this,n=u(),t=new r.a.Mesh({material:new r.a.Material({shader:this._linesShader}),castShadow:!1,ignorePicking:!0,$ignorePicking:!0,geometry:new c.a({useNativeLine:!1})});this.rootNode.add(n);this.rootNode.add(t);n.material.define("both","VERTEX_COLOR");n.material.define("fragment","DOUBLE_SIDED");this._polygonMesh=n;this._linesMesh=t;this.rootNode.add(this._groundMesh)},_getShader:function(n){var t=this._shadersMap[n];return t||(!0&&console.warn("Unkown shading "+n),t=this._shadersMap.lambert),t.__shading=n,t},_prepareMesh:function(n,t,i,u,f){for(var l,a,e,v,o=0,h=0,c=0,y=0,s=u;s<f;s++)l=this._getRegionPolygonInfo(s),a=this._getRegionLinesInfo(s,n,this._linesMesh.geometry),o+=l.vertexCount,h+=l.triangleCount,c+=a.vertexCount,y+=a.triangleCount;e=this._polygonMesh;v=e.geometry;["position","normal","texcoord0","color"].forEach(function(n){v.attributes[n].init(o)});v.indices=o>65535?new Uint32Array(h*3):new Uint16Array(h*3);e.material.shader!==t&&e.material.attachShader(t,!0);r.a.setMaterialFromModel(t.__shading,e.material,n,i);c>0&&(this._linesMesh.geometry.resetOffset(),this._linesMesh.geometry.setVertexCount(c),this._linesMesh.geometry.setTriangleCount(y));this._dataIndexOfVertex=new Uint32Array(o);this._vertexRangeOfDataIndex=new Uint32Array((f-u)*2)},_updateRegionMesh:function(n,t,i,u){for(var k,rt,d,h,y,p,g,c=n.getData(),l=0,nt=0,a=!1,e=this._polygonMesh,w=this._linesMesh,o=i;o<u;o++){var tt=n.getRegionModel(o),v=tt.getModel("itemStyle"),s=v.get("color"),b=f.a.firstNotNull(v.get("opacity"),1),it=c.getItemVisual(o,"color",!0);for(it!=null&&c.hasValue(o)&&(s=it),c.setItemVisual(o,"color",s),c.setItemVisual(o,"opacity",b),s=r.a.parseColor(s),k=r.a.parseColor(v.get("borderColor")),s[3]*=b,k[3]*=b,rt=s[3]<.99,e.material.set("color",[1,1,1,1]),a=a||rt,d=f.a.firstNotNull(tt.get("height",!0),n.get("regionHeight")),h=this._updatePolygonGeometry(n,e.geometry,o,d,l,nt,s),y=l;y<h.vertexOffset;y++)this._dataIndexOfVertex[y]=o;this._vertexRangeOfDataIndex[(o-i)*2]=l;this._vertexRangeOfDataIndex[(o-i)*2+1]=h.vertexOffset;l=h.vertexOffset;nt=h.triangleOffset;p=v.get("borderWidth");g=p>0;g&&(p*=t.getDevicePixelRatio(),this._updateLinesGeometry(w.geometry,n,o,d,p,n.coordinateSystem.transform));w.invisible=!g;w.material.set({color:k})}e=this._polygonMesh;e.material.transparent=a;e.material.depthMask=!a;e.geometry.updateBoundingBox();e.frontFace=this.extrudeY?r.a.Mesh.CCW:r.a.Mesh.CW;e.material.get("normalMap")&&e.geometry.generateTangents();e.seriesIndex=n.seriesIndex;e.on("mousemove",this._onmousemove,this);e.on("mouseout",this._onmouseout,this)},_updateDebugWireframe:function(n){var i=n.getModel("debug.wireframe");if(i.get("show")){var u=r.a.parseColor(i.get("lineStyle.color")||"rgba(0,0,0,0.5)"),e=f.a.firstNotNull(i.get("lineStyle.width"),1),t=this._polygonMesh;t.geometry.generateBarycentric();t.material.define("both","WIREFRAME_TRIANGLE");t.material.set("wireframeLineColor",u);t.material.set("wireframeLineWidth",e)}},_onmousemove:function(n){var t=this._dataIndexOfVertex[n.triangle[0]];t==null&&(t=-1);t!==this._lastHoverDataIndex&&(this.downplay(this._lastHoverDataIndex),this.highlight(t),this._labelsBuilder.updateLabels([t]));this._lastHoverDataIndex=t;this._polygonMesh.dataIndex=t},_onmouseout:function(n){n.target&&(this.downplay(this._lastHoverDataIndex),this._lastHoverDataIndex=-1,this._polygonMesh.dataIndex=-1);this._labelsBuilder.updateLabels([])},_updateGroundPlane:function(n,t,i){var e=n.getModel("groundPlane",n),f,u;(this._groundMesh.invisible=!e.get("show",!0),this._groundMesh.invisible)||(f=n.get("shading"),u=this._groundMaterials[f],u||(!0&&console.warn("Unkown shading "+f),u=this._groundMaterials.lambert),r.a.setMaterialFromModel(f,u,e,i),u.get("normalMap")&&this._groundMesh.geometry.generateTangents(),this._groundMesh.material=u,this._groundMesh.material.set("color",r.a.parseColor(e.get("color"))),this._groundMesh.scale.set(t.size[0],t.size[2],1))},_triangulation:function(n,t,i){var c,g,l,s,tt,ut,v,o,r;this._triangulationResults=[];var b=[Infinity,Infinity,Infinity],k=[-Infinity,-Infinity,-Infinity],d=n.coordinateSystem;for(c=t;c<i;c++){for(g=[],l=n.getRegionPolygonCoords(c),s=0;s<l.length;s++){var nt=l[s].exterior,a=l[s].interiors,f=[],rt=[];if(!(nt.length<3)){for(tt=0,r=0;r<nt.length;r++)o=nt[r],f[tt++]=o[0],f[tt++]=o[1];for(r=0;r<a.length;r++)if(!(a[r].length<3)){for(ut=f.length/2,v=0;v<a[r].length;v++)o=a[r][v],f.push(o[0]),f.push(o[1]);rt.push(ut)}var ft=Object(h.a)(f,rt),y=new Float64Array(f.length/2*3),e=[],p=[Infinity,Infinity,Infinity],w=[-Infinity,-Infinity,-Infinity],it=0;for(r=0;r<f.length;)u.set(e,f[r++],0,f[r++]),d&&d.transform&&u.transformMat4(e,e,d.transform),u.min(p,p,e),u.max(w,w,e),y[it++]=e[0],y[it++]=e[1],y[it++]=e[2];u.min(b,b,p);u.max(k,k,w);g.push({points:y,indices:ft,min:p,max:w})}}this._triangulationResults.push(g)}this._geoBoundingBox=[b,k]},_getRegionPolygonInfo:function(n){for(var f,e,r=this._triangulationResults[n-this._startIndex],t=0,u=0,i=0;i<r.length;i++)t+=r[i].points.length/3,u+=r[i].indices.length/3;return f=t*2+t*4,e=u*2+t*2,{vertexCount:f,triangleCount:e}},_updatePolygonGeometry:function(n,t,i,r,f,e,o){function ni(n,t){for(var r=n.points,s=r.length,u=[],e=[],i=0;i<s;i+=3)u[0]=r[i],u[w]=t,u[y]=r[i+2],e[0]=(r[i]*l[0]-v[0])/p,e[1]=(r[i+2]*l[y]-v[2])/p,ot.set(f,u),ct&&tt.set(f,o),st.set(f++,e)}function vt(n,t,i){var o=f,u,r;for(ni(n,t,i),u=n.indices.length,r=0;r<u;r++)lt[e*3+r]=n.indices[r]+o;e+=n.indices.length/3}for(var rt,h,b,c,et,d,s,gt=n.get("projectUVOnGround"),ot=t.attributes.position,nt=t.attributes.normal,st=t.attributes.texcoord0,tt=t.attributes.color,ht=this._triangulationResults[i-this._startIndex],ct=tt.value&&o,lt=t.indices,w=this.extrudeY?1:2,y=this.extrudeY?2:1,l=[this.rootNode.worldTransform.x.len(),this.rootNode.worldTransform.y.len(),this.rootNode.worldTransform.z.len()],v=u.mul([],this._geoBoundingBox[0],l),at=u.mul([],this._geoBoundingBox[1],l),p=Math.max(at[0]-v[0],at[2]-v[2]),yt=this.extrudeY?[0,1,0]:[0,0,1],ti=u.negate([],yt),it=0;it<ht.length;it++){for(rt=f,h=ht[it],vt(h,0,0),vt(h,r,0),b=h.points.length/3,c=0;c<b;c++)nt.set(rt+c,ti),nt.set(rt+c+b,yt);var ii=[0,3,1,1,3,2],a=[[],[],[],[]],pt=[],wt=[],g=[],k=[],ut=0;for(c=0;c<b;c++){var ft=(c+1)%b,bt=(h.points[ft*3]-h.points[c*3])*l[0],kt=(h.points[ft*3+2]-h.points[c*3+2])*l[y],dt=Math.sqrt(bt*bt+kt*kt);for(s=0;s<4;s++)et=s===0||s===3,d=(et?c:ft)*3,a[s][0]=h.points[d],a[s][w]=s>1?r:0,a[s][y]=h.points[d+2],ot.set(f+s,a[s]),gt?(k[0]=(h.points[d]*l[0]-v[0])/p,k[1]=(h.points[d+2]*l[y]-v[y])/p):(k[0]=(et?ut:ut+dt)/p,k[1]=(a[s][w]*l[w]-v[w])/p),st.set(f+s,k);for(u.sub(pt,a[1],a[0]),u.sub(wt,a[3],a[0]),u.cross(g,pt,wt),u.normalize(g,g),s=0;s<4;s++)nt.set(f+s,g),ct&&tt.set(f+s,o);for(s=0;s<6;s++)lt[e*3+s]=ii[s]+f;f+=4;e+=2;ut+=dt}}return t.dirty(),{vertexOffset:f,triangleOffset:e}},_getRegionLinesInfo:function(n,t,i){var r=0,u=0,e=t.getRegionModel(n),o=e.getModel("itemStyle"),s=o.get("borderWidth"),f;return s>0&&(f=t.getRegionPolygonCoords(n),f.forEach(function(n){var e=n.exterior,f=n.interiors,t;for(r+=i.getPolylineVertexCount(e),u+=i.getPolylineTriangleCount(e),t=0;t<f.length;t++)r+=i.getPolylineVertexCount(f[t]),u+=i.getPolylineTriangleCount(f[t])},this)),{vertexCount:r,triangleCount:u}},_updateLinesGeometry:function(n,t,i,r,f,e){function o(n){for(var i=new Float64Array(n.length*3),o=0,t=[],f=0;f<n.length;f++)t[0]=n[f][0],t[1]=r+.1,t[2]=n[f][1],e&&u.transformMat4(t,t,e),i[o++]=t[0],i[o++]=t[1],i[o++]=t[2];return i}var s=[1,1,1,1],h=t.getRegionPolygonCoords(i);h.forEach(function(t){var u=t.exterior,r=t.interiors,i;for(n.addPolyline(o(u),s,f),i=0;i<r.length;i++)n.addPolyline(o(r[i]),s,f)})},highlight:function(n){var t=this._data,h,e;if(t){var c=t.getItemModel(n),s=c.getModel("emphasis.itemStyle"),i=s.get("color"),u=f.a.firstNotNull(s.get("opacity"),t.getItemVisual(n,"opacity"),1);i==null&&(h=t.getItemVisual(n,"color"),i=o.a.color.lift(h,-.4));u==null&&(u=t.getItemVisual(n,"opacity"));e=r.a.parseColor(i);e[3]*=u;this._setColorOfDataIndex(t,n,e)}},downplay:function(n){var t=this._data;if(t){var u=t.getItemVisual(n,"color"),e=f.a.firstNotNull(t.getItemVisual(n,"opacity"),1),i=r.a.parseColor(u);i[3]*=e;this._setColorOfDataIndex(t,n,i)}},_setColorOfDataIndex:function(n,t,i){if(!(t<this._startIndex)||!(t>this._endIndex)){t-=this._startIndex;for(var r=this._vertexRangeOfDataIndex[t*2];r<this._vertexRangeOfDataIndex[t*2+1];r++)this._polygonMesh.geometry.attributes.color.set(r,i);this._polygonMesh.geometry.dirty();this._api.getZr().refresh()}}};t.a=e},function(n,t,i){"use strict";var u=i(97),s=i(6),r=s.a.vec3,f=r.create(),e=r.create(),o=r.create();t.a={needsSortTriangles:function(){return this.indices&&this.sortTriangles},needsSortTrianglesProgressively:function(){return this.needsSortTriangles()&&this.triangleCount>=2e4},doSortTriangles:function(n,t){var u=this.indices,c,n,p,w,h,i,l,a,v;if(t===0)for(c=this.attributes.position,n=n.array,this._triangleZList&&this._triangleZList.length===this.triangleCount||(this._triangleZList=new Float32Array(this.triangleCount),this._sortedTriangleIndices=new Uint32Array(this.triangleCount),this._indicesTmp=new u.constructor(u.length),this._triangleZListTmp=new Float32Array(this.triangleCount)),p=0,i=0;i<u.length;){c.get(u[i++],f);c.get(u[i++],e);c.get(u[i++],o);var b=r.sqrDist(f,n),k=r.sqrDist(e,n),d=r.sqrDist(o,n),s=Math.min(b,k);s=Math.min(s,d);i===3?(w=s,s=0):s=s-w;this._triangleZList[p++]=s}for(h=this._sortedTriangleIndices,i=0;i<h.length;i++)h[i]=i;if(this.triangleCount<2e4)t===0&&this._simpleSort(!0);else for(i=0;i<3;i++)this._progressiveQuickSort(t*3+i);var y=this._indicesTmp,g=this._triangleZListTmp,nt=this._triangleZList;for(i=0;i<this.triangleCount;i++)l=h[i]*3,a=i*3,y[a++]=u[l++],y[a++]=u[l++],y[a]=u[l],g[i]=nt[h[i]];v=this._indicesTmp;this._indicesTmp=this.indices;this.indices=v;v=this._triangleZListTmp;this._triangleZListTmp=this._triangleZList;this._triangleZList=v;this.dirtyIndices()},_simpleSort:function(n){function r(n,t){return i[t]-i[n]}var i=this._triangleZList,t=this._sortedTriangleIndices;n?Array.prototype.sort.call(t,r):u.a.sort(t,r,0,t.length-1)},_progressiveQuickSort:function(n){var t=this._triangleZList,i=this._sortedTriangleIndices;this._quickSort=this._quickSort||new u.a;this._quickSort.step(i,function(n,i){return t[i]-t[n]},n)}}},function(n,t,i){"use strict";function r(n,t,i){this._labelsMesh=new h.a;this._labelTextureSurface=new s.a({width:512,height:512,devicePixelRatio:i.getDevicePixelRatio(),onupdate:function(){i.getZr().refresh()}});this._api=i;this._labelsMesh.material.set("textureAtlas",this._labelTextureSurface.getTexture())}var o=i(0),u=i.n(o),s=i(81),h=i(63),c=i(2),f=1,e=2;r.prototype.getLabelPosition=function(){return[0,0,0]};r.prototype.getLabelDistance=function(){return 0};r.prototype.getMesh=function(){return this._labelsMesh};r.prototype.updateData=function(n,t,i){var o,s,r,l;for(t==null&&(t=0),i==null&&(i=n.count()),this._labelsVisibilitiesBits&&this._labelsVisibilitiesBits.length===i-t||(this._labelsVisibilitiesBits=new Uint8Array(i-t)),o=["label","show"],s=["emphasis","label","show"],r=t;r<i;r++){var h=n.getItemModel(r),c=h.get(o),u=h.get(s);u==null&&(u=c);l=(c?f:0)|(u?e:0);this._labelsVisibilitiesBits[r-t]=l}this._start=t;this._end=i;this._data=n};r.prototype.updateLabels=function(n){var k,l,r,t,i,tt,s,h,rt;if(this._data){for(n=n||[],k=n.length>0,l={},r=0;r<n.length;r++)l[n[r]]=!0;this._labelsMesh.geometry.convertToDynamicArray(!0);this._labelTextureSurface.clear();var d=["label"],g=["emphasis","label"],a=this._data.hostModel,v=this._data,nt=a.getModel(d),ut=a.getModel(g,nt),ft={left:"right",right:"left",top:"center",bottom:"center"},et={left:"middle",right:"middle",top:"bottom",bottom:"top"};for(t=this._start;t<this._end;t++)if(i=!1,k&&l[t]&&(i=!0),tt=this._labelsVisibilitiesBits[t-this._start]&(i?e:f),tt){var ot=v.getItemModel(t),y=ot.getModel(i?g:d,i?ut:nt),it=y.get("distance")||0,o=y.get("position"),p=y.getModel("textStyle"),w=this._api.getDevicePixelRatio(),b=a.getFormattedLabel(t,i?"emphasis":"normal");if(b==null||b==="")return;s=new u.a.graphic.Text;u.a.graphic.setTextStyle(s.style,p,{text:b,textFill:p.get("color")||v.getItemVisual(t,"color")||"#000",textAlign:"left",textVerticalAlign:"top",opacity:c.a.firstNotNull(p.get("opacity"),v.getItemVisual(t,"opacity"),1)});h=s.getBoundingRect();rt=1.2;h.height*=rt;var st=this._labelTextureSurface.add(s),ht=ft[o]||"center",ct=et[o]||"bottom";this._labelsMesh.geometry.addSprite(this.getLabelPosition(t,o,it),[h.width*w,h.height*w],st,ht,ct,this.getLabelDistance(t,o,it)*w)}this._labelsMesh.material.set("uvScale",this._labelTextureSurface.getCoordsScale());this._labelTextureSurface.getZr().refreshImmediately();this._labelsMesh.geometry.convertToTypedArray();this._labelsMesh.geometry.dirty()}};t.a=r},function(n,t,i){"use strict";function y(n,t){return n&&t&&n[0]===t[0]&&n[1]===t[1]}function f(n,t){this.rootNode=new r.a.Node;this.is2D=n;this._labelsBuilder=new a.a(256,256,t);this._labelsBuilder.getMesh().renderOrder=100;this.rootNode.add(this._labelsBuilder.getMesh());this._api=t;this._spriteImageCanvas=document.createElement("canvas");this._startDataIndex=0;this._endDataIndex=0;this._sizeScale=1}var h=i(0),c=i.n(h),r=i(1),e=i(239),l=i(240),a=i(66),u=i(9),v=i(2),o=20,s=-10;f.prototype={constructor:f,highlightOnMouseover:!0,update:function(n,t,i,u,f){var et=this._prevMesh,v,e,c,o,h,rt,b,k,a,d,ft;this._prevMesh=this._mesh;this._mesh=et;v=n.getData();u==null&&(u=0);f==null&&(f=v.count());this._startDataIndex=u;this._endDataIndex=f-1;this._mesh||(e=this._prevMesh&&this._prevMesh.material,this._mesh=new l.a({renderOrder:10,frustumCulling:!1}),e&&(this._mesh.material=e));var e=this._mesh.material,g=this._mesh.geometry,y=g.attributes;this.rootNode.remove(this._prevMesh);this.rootNode.add(this._mesh);this._setPositionTextureToMesh(this._mesh,this._positionTexture);var nt=this._getSymbolInfo(n,u,f),ot=i.getDevicePixelRatio(),ut=n.getModel("itemStyle").getItemStyle(),tt=n.get("large"),it=1;nt.maxSize>2?(it=this._updateSymbolSprite(n,ut,nt,ot),e.enableTexture("sprite")):e.disableTexture("sprite");y.position.init(f-u);c=[];tt?(e.undefine("VERTEX_SIZE"),e.undefine("VERTEX_COLOR"),b=v.getVisual("color"),k=v.getVisual("opacity"),r.a.parseColor(b,c),c[3]*=k,e.set({color:c,u_Size:nt.maxSize*this._sizeScale})):(e.set({color:[1,1,1,1]}),e.define("VERTEX_SIZE"),e.define("VERTEX_COLOR"),y.size.init(f-u),y.color.init(f-u),this._originalOpacity=new Float32Array(f-u));var w=v.getLayout("points"),p=y.position.value,st=!1;for(o=0;o<f-u;o++)h=o*3,rt=o*2,this.is2D?(p[h]=w[rt],p[h+1]=w[rt+1],p[h+2]=s):(p[h]=w[h],p[h+1]=w[h+1],p[h+2]=w[h+2]),tt||(b=v.getItemVisual(o,"color"),k=v.getItemVisual(o,"opacity"),r.a.parseColor(b,c),c[3]*=k,y.color.set(o,c),c[3]<.99&&(st=!0),a=v.getItemVisual(o,"symbolSize"),a=a instanceof Array?Math.max(a[0],a[1]):a,isNaN(a)&&(a=0),y.size.value[o]=a*it*this._sizeScale,this._originalOpacity[o]=c[3]);this._mesh.sizeScale=it;g.updateBoundingBox();g.dirty();this._updateMaterial(n,ut);d=n.coordinateSystem;d&&d.viewGL&&(ft=d.viewGL.isLinearSpace()?"define":"undefine",e[ft]("fragment","SRGB_DECODE"));tt||this._updateLabelBuilder(n,u,f);this._updateHandler(n,t,i);this._updateAnimation(n);this._api=i},getPointsMesh:function(){return this._mesh},updateLabels:function(n){this._labelsBuilder.updateLabels(n)},hideLabels:function(){this.rootNode.remove(this._labelsBuilder.getMesh())},showLabels:function(){this.rootNode.add(this._labelsBuilder.getMesh())},_updateSymbolSprite:function(n,t,i,r){i.maxSize=Math.min(i.maxSize*2,200);var u=[];return i.aspect>1?(u[0]=i.maxSize,u[1]=i.maxSize/i.aspect):(u[1]=i.maxSize,u[0]=i.maxSize*i.aspect),u[0]=u[0]||1,u[1]=u[1]||1,this._symbolType===i.type&&y(this._symbolSize,u)&&this._lineWidth===t.lineWidth||(e.a.createSymbolSprite(i.type,u,{fill:"#fff",lineWidth:t.lineWidth,stroke:"transparent",shadowColor:"transparent",minMargin:Math.min(u[0]/2,10)},this._spriteImageCanvas),e.a.createSDFFromCanvas(this._spriteImageCanvas,Math.min(this._spriteImageCanvas.width,32),o,this._mesh.material.get("sprite").image),this._symbolType=i.type,this._symbolSize=u,this._lineWidth=t.lineWidth),this._spriteImageCanvas.width/i.maxSize*r},_updateMaterial:function(n,t){var f=n.get("blendMode")==="lighter"?r.a.additiveBlend:null,i=this._mesh.material,u;i.blend=f;i.set("lineWidth",t.lineWidth/o);u=r.a.parseColor(t.stroke);i.set("strokeColor",u);i.transparent=!0;i.depthMask=!1;i.depthTest=!this.is2D;i.sortVertices=!this.is2D},_updateLabelBuilder:function(n,t,i){var f=n.getData(),u=this._mesh.geometry,r=u.attributes.position.value,t=this._startDataIndex,e=this._mesh.sizeScale;this._labelsBuilder.updateData(f,t,i);this._labelsBuilder.getLabelPosition=function(n){var i=(n-t)*3;return[r[i],r[i+1],r[i+2]]};this._labelsBuilder.getLabelDistance=function(n,i,r){var f=u.attributes.size.get(n-t)/e;return f/2+r};this._labelsBuilder.updateLabels()},_updateAnimation:function(n){r.a.updateVertexAnimation([["prevPosition","position"],["prevSize","size"]],this._prevMesh,this._mesh,n)},_updateHandler:function(n,t,i){var u=n.getData(),r=this._mesh,s=this,f=-1,e=n.coordinateSystem&&n.coordinateSystem.type==="cartesian3D",o;e&&(o=n.coordinateSystem.model);r.seriesIndex=n.seriesIndex;r.off("mousemove");r.off("mouseout");r.on("mousemove",function(t){var h=t.vertexIndex+s._startDataIndex;h!==f&&(this.highlightOnMouseover&&(this.downplay(u,f),this.highlight(u,h),this._labelsBuilder.updateLabels([h])),e&&i.dispatchAction({type:"grid3DShowAxisPointer",value:[u.get(n.coordDimToDataDim("x")[0],h),u.get(n.coordDimToDataDim("y")[0],h),u.get(n.coordDimToDataDim("z")[0],h)],grid3DIndex:o.componentIndex}));r.dataIndex=h;f=h},this);r.on("mouseout",function(n){var t=n.vertexIndex+s._startDataIndex;this.highlightOnMouseover&&(this.downplay(u,t),this._labelsBuilder.updateLabels());f=-1;r.dataIndex=-1;e&&i.dispatchAction({type:"grid3DHideAxisPointer",grid3DIndex:o.componentIndex})},this)},updateLayout:function(n,t,i){var h=n.getData(),f,u,e,o,r;if(this._mesh){if(f=this._mesh.geometry.attributes.position.value,u=h.getLayout("points"),this.is2D)for(r=0;r<u.length/2;r++)e=r*3,o=r*2,f[e]=u[o],f[e+1]=u[o+1],f[e+2]=s;else for(r=0;r<u.length;r++)f[r]=u[r];this._mesh.geometry.dirty();i.getZr().refresh()}},updateView:function(n){if(this._mesh){var t=new u.a;u.a.mul(t,n.viewMatrix,this._mesh.worldTransform);u.a.mul(t,n.projectionMatrix,t);this._mesh.updateNDCPosition(t,this.is2D,this._api)}},highlight:function(n,t){var o,f;if(!(t>this._endDataIndex)&&!(t<this._startDataIndex)){var s=n.getItemModel(t),e=s.getModel("emphasis.itemStyle"),i=e.get("color"),u=e.get("opacity");i==null&&(o=n.getItemVisual(t,"color"),i=c.a.color.lift(o,-.4));u==null&&(u=n.getItemVisual(t,"opacity"));f=r.a.parseColor(i);f[3]*=u;this._mesh.geometry.attributes.color.set(t-this._startDataIndex,f);this._mesh.geometry.dirtyAttribute("color");this._api.getZr().refresh()}},downplay:function(n,t){if(!(t>this._endDataIndex)&&!(t<this._startDataIndex)){var u=n.getItemVisual(t,"color"),f=n.getItemVisual(t,"opacity"),i=r.a.parseColor(u);i[3]*=f;this._mesh.geometry.attributes.color.set(t-this._startDataIndex,i);this._mesh.geometry.dirtyAttribute("color");this._api.getZr().refresh()}},fadeOutAll:function(n){var i,t,r;if(this._originalOpacity){for(i=this._mesh.geometry,t=0;t<i.vertexCount;t++)r=this._originalOpacity[t]*n,i.attributes.color.value[t*4+3]=r;i.dirtyAttribute("color");this._api.getZr().refresh()}},fadeInAll:function(){this.fadeOutAll(1)},setPositionTexture:function(n){this._mesh&&this._setPositionTextureToMesh(this._mesh,n);this._positionTexture=n},removePositionTexture:function(){this._positionTexture=null;this._mesh&&this._setPositionTextureToMesh(this._mesh,null)},setSizeScale:function(n){var r,t,i;if(n!==this._sizeScale){if(this._mesh&&(r=this._mesh.material.get("u_Size"),this._mesh.material.set("u_Size",r/this._sizeScale*n),t=this._mesh.geometry.attributes,t.size.value))for(i=0;i<t.size.value.length;i++)t.size.value[i]=t.size.value[i]/this._sizeScale*n;this._sizeScale=n}},_setPositionTextureToMesh:function(n,t){t&&n.material.set("positionTexture",t);n.material[t?"enableTexture":"disableTexture"]("positionTexture")},_getSymbolInfo:function(n,t,i){var u,f,e,r,c,o;if(n.get("large"))return r=v.a.firstNotNull(n.get("symbolSize"),1),r instanceof Array?(u=Math.max(r[0],r[1]),f=r[0]/r[1]):(u=r,f=1),{maxSize:r,type:n.get("symbol"),aspect:f};var s=n.getData(),f,l=!1,h=s.getItemVisual(0,"symbol")||"circle",a=!1,u=0;for(e=t;e<i;e++){if(r=s.getItemVisual(e,"symbolSize"),c=s.getItemVisual(e,"symbol"),r instanceof Array)o=r[0]/r[1],u=Math.max(Math.max(r[0],r[1]),u);else{if(isNaN(r))return;o=1;u=Math.max(r,u)}!0&&(f!=null&&Math.abs(o-f)>.05&&(l=!0),c!==h&&(a=!0));h=c;f=o}return!0&&(l&&console.warn("Different symbol width / height ratio will be ignored."),a&&console.warn("Different symbol type will be ignored.")),{maxSize:u,type:h,aspect:f}}};t.a=f},function(n){var t=function(){return this}();try{t=t||Function("return this")()||eval("this")}catch(i){typeof window=="object"&&(t=window)}n.exports=t},function(n,t,i){"use strict";var u=i(114),r=function(n){this._list=new u.a;this._map={};this._maxSize=n||10};r.prototype.setMaxSize=function(n){this._maxSize=n};r.prototype.put=function(n,t){var i,r,u;this._map.hasOwnProperty(n)||(i=this._list.length(),i>=this._maxSize&&i>0&&(r=this._list.head,this._list.remove(r),delete this._map[r.key]),u=this._list.insert(t),u.key=n,this._map[n]=u)};r.prototype.get=function(n){var t=this._map[n];if(this._map.hasOwnProperty(n))return t!==this._list.tail&&(this._list.remove(t),this._list.insertEntry(t)),t.value};r.prototype.remove=function(n){var t=this._map[n];typeof t!="undefined"&&(delete this._map[n],this._list.remove(t))};r.prototype.clear=function(){this._list.clear();this._map={}};t.a=r},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(2);return n[0]=0,n[1]=0,n};r.clone=function(n){var t=new u.a(2);return t[0]=n[0],t[1]=n[1],t};r.fromValues=function(n,t){var i=new u.a(2);return i[0]=n,i[1]=t,i};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n};r.set=function(n,t,i){return n[0]=t,n[1]=i,n};r.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n};r.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n};r.sub=r.subtract;r.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n};r.mul=r.multiply;r.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n};r.div=r.divide;r.min=function(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n};r.max=function(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n};r.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n};r.scaleAndAdd=function(n,t,i,r){return n[0]=t[0]+i[0]*r,n[1]=t[1]+i[1]*r,n};r.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)};r.dist=r.distance;r.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r};r.sqrDist=r.squaredDistance;r.length=function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)};r.len=r.length;r.squaredLength=function(n){var t=n[0],i=n[1];return t*t+i*i};r.sqrLen=r.squaredLength;r.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n};r.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n};r.normalize=function(n,t){var r=t[0],u=t[1],i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i),n};r.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]};r.cross=function(n,t,i){var r=t[0]*i[1]-t[1]*i[0];return n[0]=n[1]=0,n[2]=r,n};r.lerp=function(n,t,i,r){var u=t[0],f=t[1];return n[0]=u+r*(i[0]-u),n[1]=f+r*(i[1]-f),n};r.random=function(n,t){t=t||1;var i=GLMAT_RANDOM()*2*Math.PI;return n[0]=Math.cos(i)*t,n[1]=Math.sin(i)*t,n};r.transformMat2=function(n,t,i){var r=t[0],u=t[1];return n[0]=i[0]*r+i[2]*u,n[1]=i[1]*r+i[3]*u,n};r.transformMat2d=function(n,t,i){var r=t[0],u=t[1];return n[0]=i[0]*r+i[2]*u+i[4],n[1]=i[1]*r+i[3]*u+i[5],n};r.transformMat3=function(n,t,i){var r=t[0],u=t[1];return n[0]=i[0]*r+i[3]*u+i[6],n[1]=i[1]*r+i[4]*u+i[7],n};r.transformMat4=function(n,t,i){var r=t[0],u=t[1];return n[0]=i[0]*r+i[4]*u+i[12],n[1]=i[1]*r+i[5]*u+i[13],n};r.forEach=function(){var n=r.create();return function(t,i,r,u,f,e){var o,s;for(i||(i=2),r||(r=0),s=u?Math.min(u*i+r,t.length):t.length,o=r;o<s;o+=i)n[0]=t[o],n[1]=t[o+1],f(n,n,e),t[o]=n[0],t[o+1]=n[1];return t}}();t.a=r},function(n,t){"use strict";t.a="@export clay.prez.vertex\nuniform mat4 WVP : WORLDVIEWPROJECTION;\nattribute vec3 pos : POSITION;\nattribute vec2 uv : TEXCOORD_0;\n@import clay.chunk.skinning_header\nvarying vec2 v_Texcoord;\nvoid main()\n{\n vec3 P = pos;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = (skinMatrixWS * vec4(pos, 1.0)).xyz;\n#endif\n gl_Position = WVP * vec4(P, 1.0);\n v_Texcoord = uv;\n}\n@end\n@export clay.prez.fragment\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n@end"},function(n,t,i){"use strict";var f=i(35),r=i(11),u=f.a.extend({material:null,geometry:null,mode:r.a.TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:r.a.BACK,frontFace:r.a.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&this.geometry.vertexCount>0},beforeRender:function(){},afterRender:function(){},getBoundingBox:function(n,t){return t=f.a.prototype.getBoundingBox.call(this,n,t),this.geometry&&this.geometry.boundingBox&&t.union(this.geometry.boundingBox),t},clone:function(){var n=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"];return function(){var t=f.a.prototype.clone.call(this),r,i;for(t.geometry=this.geometry,t.material=this.material,r=0;r<n.length;r++)i=n[r],t[i]!==this[i]&&(t[i]=this[i]);return t}}()});u.POINTS=r.a.POINTS;u.LINES=r.a.LINES;u.LINE_LOOP=r.a.LINE_LOOP;u.LINE_STRIP=r.a.LINE_STRIP;u.TRIANGLES=r.a.TRIANGLES;u.TRIANGLE_STRIP=r.a.TRIANGLE_STRIP;u.TRIANGLE_FAN=r.a.TRIANGLE_FAN;u.BACK=r.a.BACK;u.FRONT=r.a.FRONT;u.FRONT_AND_BACK=r.a.FRONT_AND_BACK;u.CW=r.a.CW;u.CCW=r.a.CCW;t.a=u},function(n,t){"use strict";var i={};i.isPowerOfTwo=function(n){return(n&n-1)==0};i.nextPowerOfTwo=function(n){return n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n++,n};i.nearestPowerOfTwo=function(n){return Math.pow(2,Math.round(Math.log(n)/Math.LN2))};t.a=i},function(n,t,i){"use strict";var e=i(3),o=i(21),r=i(12),u=i(33),f=function(n,t){this.normal=n||new e.a(0,1,0);this.distance=t||0};f.prototype={constructor:f,distanceToPoint:function(n){return r.a.dot(n.array,this.normal.array)-this.distance},projectPoint:function(n,t){t||(t=new e.a);var i=this.distanceToPoint(n);return r.a.scaleAndAdd(t.array,n.array,this.normal.array,-i),t._dirty=!0,t},normalize:function(){var n=1/r.a.len(this.normal.array);r.a.scale(this.normal.array,n);this.distance*=n},intersectFrustum:function(n){for(var i=n.vertices,u=this.normal.array,f=r.a.dot(i[0].array,u)>this.distance,t=1;t<8;t++)if(r.a.dot(i[t].array,u)>this.distance!=f)return!0},intersectLine:function(){var n=r.a.create();return function(t,i,u){var o=this.distanceToPoint(t),s=this.distanceToPoint(i),f,l;if(o>0&&s>0||o<0&&s<0)return null;var h=this.normal.array,a=this.distance,c=t.array;return(r.a.sub(n,i.array,t.array),r.a.normalize(n,n),f=r.a.dot(h,n),f===0)?null:(u||(u=new e.a),l=(r.a.dot(h,c)-a)/f,r.a.scaleAndAdd(u.array,c,n,-l),u._dirty=!0,u)}}(),applyTransform:function(){var i=o.a.create(),n=u.a.create(),t=u.a.create();return t[3]=1,function(f){f=f.array;r.a.scale(t,this.normal.array,this.distance);u.a.transformMat4(t,t,f);this.distance=r.a.dot(t,this.normal.array);o.a.invert(i,f);o.a.transpose(i,i);n[3]=0;r.a.copy(n,this.normal.array);u.a.transformMat4(n,n,i);r.a.copy(this.normal.array,n)}}(),copy:function(n){r.a.copy(this.normal.array,n.normal.array);this.normal._dirty=!0;this.distance=n.distance},clone:function(){var n=new f;return n.copy(this),n}};t.a=f},function(n,t,i){"use strict";var r=i(42);t.a=r.a},function(n,t,i){"use strict";function e(n,t,i){r.identity();var e=new s.a({widthSegments:t,heightSegments:i});switch(n){case"px":u.a.translate(r,r,f.a.POSITIVE_X);u.a.rotateY(r,r,Math.PI/2);break;case"nx":u.a.translate(r,r,f.a.NEGATIVE_X);u.a.rotateY(r,r,-Math.PI/2);break;case"py":u.a.translate(r,r,f.a.POSITIVE_Y);u.a.rotateX(r,r,-Math.PI/2);break;case"ny":u.a.translate(r,r,f.a.NEGATIVE_Y);u.a.rotateX(r,r,Math.PI/2);break;case"pz":u.a.translate(r,r,f.a.POSITIVE_Z);break;case"nz":u.a.translate(r,r,f.a.NEGATIVE_Z);u.a.rotateY(r,r,Math.PI)}return e.applyTransform(r),e}var o=i(15),s=i(43),u=i(9),f=i(3),h=i(18),c=i(14),r=new u.a,l=o.a.extend({dynamic:!1,widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},function(){this.build()},{build:function(){var r={px:e("px",this.depthSegments,this.heightSegments),nx:e("nx",this.depthSegments,this.heightSegments),py:e("py",this.widthSegments,this.depthSegments),ny:e("ny",this.widthSegments,this.depthSegments),pz:e("pz",this.widthSegments,this.heightSegments),nz:e("nz",this.widthSegments,this.heightSegments)},f=["position","texcoord0","normal"],v=0,y=0,a,o,u,i,t,l,w,n;for(u in r)v+=r[u].vertexCount,y+=r[u].indices.length;for(t=0;t<f.length;t++)this.attributes[f[t]].init(v);this.indices=new c.a.Uint16Array(y);a=0;o=0;for(u in r){for(i=r[u],t=0;t<f.length;t++){var s=f[t],p=i.attributes[s].value,b=i.attributes[s].size,k=s==="normal";for(n=0;n<p.length;n++)l=p[n],this.inside&&k&&(l=-l),this.attributes[s].value[n+b*o]=l}for(w=i.indices.length,n=0;n<i.indices.length;n++)this.indices[n+a]=o+i.indices[this.inside?w-n-1:n];a+=i.indices.length;o+=i.vertexCount}this.boundingBox=new h.a;this.boundingBox.max.set(1,1,1);this.boundingBox.min.set(-1,-1,-1)}});t.a=l},function(n,t,i){"use strict";var f=i(5),o=i(27),r=i(4),s=i(10),c=i(16),l=i(19),h=i(8),a=i(42),v=i(36),y=i(62),p=i(14),w=i(61),b=i(127),k=i(128),u={},e=["px","nx","py","ny","pz","nz"];u.prefilterEnvironmentMap=function(n,t,i,c,b){var ht,et,ct,yt,tt,lt,pt,it,at,vt;b&&c||(c=u.generateNormalDistribution(),b=u.integrateBRDF(n,c));i=i||{};var rt=i.width||64,ut=i.height||64,g=i.type||t.type,nt=new o.a({width:rt,height:ut,type:g,flipY:!1,mipmaps:[]});nt.isPowerOfTwo()||console.warn("Width and height must be power of two to enable mipmap.");var wt=Math.min(rt,ut),st=Math.log(wt)/Math.log(2)+1,ft=new l.a({shader:new h.a({vertex:h.a.source("clay.skybox.vertex"),fragment:k.a})});ft.set("normalDistribution",c);i.encodeRGBM&&ft.define("fragment","RGBM_ENCODE");i.decodeRGBM&&ft.define("fragment","RGBM_DECODE");ht=new v.a;t.textureType==="texture2D"&&(ct=new o.a({width:rt,height:ut,type:g===r.a.FLOAT?r.a.HALF_FLOAT:g}),w.a.panoramaToCubeMap(n,t,ct,{encodeRGBM:i.decodeRGBM}),t=ct);et=new a.a({scene:ht,material:ft});et.material.set("environmentMap",t);yt=new y.a({texture:nt});i.encodeRGBM&&(g=nt.type=r.a.UNSIGNED_BYTE);var d=new f.a({width:rt,height:ut,type:g}),ot=new s.a({depthBuffer:!1}),bt=p.a[g===r.a.UNSIGNED_BYTE?"Uint8Array":"Float32Array"];for(tt=0;tt<st;tt++){for(nt.mipmaps[tt]={pixels:{}},et.material.set("roughness",tt/(st-1)),lt=d.width,pt=2*Math.atan(lt/(lt-.5))/Math.PI*180,it=0;it<e.length;it++)at=new bt(d.width*d.height*4),ot.attach(d),ot.bind(n),vt=yt.getCamera(e[it]),vt.fov=pt,n.render(ht,vt),n.gl.readPixels(0,0,d.width,d.height,r.a.RGBA,g,at),ot.unbind(n),nt.mipmaps[tt].pixels[e[it]]=at;d.width/=2;d.height/=2;d.dirty()}return ot.dispose(n),d.dispose(n),et.dispose(n),c.dispose(n),{environmentMap:nt,brdfLookup:b,normalDistribution:c,maxMipmapLevel:st}};u.integrateBRDF=function(n,t){t=t||u.generateNormalDistribution();var e=new s.a({depthBuffer:!1}),i=new c.a({fragment:b.a}),o=new f.a({width:512,height:256,type:r.a.HALF_FLOAT,wrapS:r.a.CLAMP_TO_EDGE,wrapT:r.a.CLAMP_TO_EDGE,minFilter:r.a.NEAREST,magFilter:r.a.NEAREST,useMipmap:!1});return i.setUniform("normalDistribution",t),i.setUniform("viewportSize",[512,256]),i.attachOutput(o),i.render(n,e),e.dispose(n),o};u.generateNormalDistribution=function(n,t){for(var c,l,i,o,u,n=n||256,t=t||1024,a=new f.a({width:n,height:t,type:r.a.FLOAT,minFilter:r.a.NEAREST,magFilter:r.a.NEAREST,wrapS:r.a.CLAMP_TO_EDGE,wrapT:r.a.CLAMP_TO_EDGE,useMipmap:!1}),e=new Float32Array(t*n*4),v=[],s=0;s<n;s++){for(c=s/n,l=c*c,u=0;u<t;u++)i=(u<<16|u>>>16)>>>0,i=((i&1431655765)<<1|(i&2863311530)>>>1)>>>0,i=((i&858993459)<<2|(i&3435973836)>>>2)>>>0,i=((i&252645135)<<4|(i&4042322160)>>>4)>>>0,i=(((i&16711935)<<8|(i&4278255360)>>>8)>>>0)/4294967296,o=Math.sqrt((1-i)/(1+(l*l-1)*i)),v[u]=o;for(u=0;u<t;u++){var h=(u*n+s)*4,o=v[u],y=Math.sqrt(1-o*o),w=u/t,p=2*Math.PI*w;e[h]=y*Math.cos(p);e[h+1]=o;e[h+2]=y*Math.sin(p);e[h+3]=1}}return a.pixels=e,a};t.a=u},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(4);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n};r.clone=function(n){var t=new u.a(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n};r.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n};r.transpose=function(n,t){if(n===t){var i=t[1];n[1]=t[2];n[2]=i}else n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3];return n};r.invert=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],i=r*e-f*u;return i?(i=1/i,n[0]=e*i,n[1]=-u*i,n[2]=-f*i,n[3]=r*i,n):null};r.adjoint=function(n,t){var i=t[0];return n[0]=t[3],n[1]=-t[1],n[2]=-t[2],n[3]=i,n};r.determinant=function(n){return n[0]*n[3]-n[2]*n[1]};r.multiply=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3],o=i[0],s=i[1],h=i[2],c=i[3];return n[0]=r*o+f*s,n[1]=u*o+e*s,n[2]=r*h+f*c,n[3]=u*h+e*c,n};r.mul=r.multiply;r.rotate=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u+o*r,n[1]=e*u+s*r,n[2]=f*-r+o*u,n[3]=e*-r+s*u,n};r.scale=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],r=i[0],u=i[1];return n[0]=f*r,n[1]=e*r,n[2]=o*u,n[3]=s*u,n};r.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2))};r.LDU=function(n,t,i,r){return n[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-n[2]*i[1],[n,t,i]};t.a=r},function(n,t,i){"use strict";var u=i(20),r={};r.create=function(){var n=new u.a(6);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n};r.clone=function(n){var t=new u.a(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t};r.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n};r.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n};r.invert=function(n,t){var r=t[0],u=t[1],f=t[2],e=t[3],o=t[4],s=t[5],i=r*e-u*f;return i?(i=1/i,n[0]=e*i,n[1]=-u*i,n[2]=-f*i,n[3]=r*i,n[4]=(f*s-e*o)*i,n[5]=(u*o-r*s)*i,n):null};r.determinant=function(n){return n[0]*n[3]-n[1]*n[2]};r.multiply=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3],v=t[4],y=t[5],o=i[0],s=i[1],h=i[2],c=i[3],l=i[4],a=i[5];return n[0]=r*o+f*s,n[1]=u*o+e*s,n[2]=r*h+f*c,n[3]=u*h+e*c,n[4]=r*l+f*a+v,n[5]=u*l+e*a+y,n};r.mul=r.multiply;r.rotate=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],h=t[4],c=t[5],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u+o*r,n[1]=e*u+s*r,n[2]=f*-r+o*u,n[3]=e*-r+s*u,n[4]=h,n[5]=c,n};r.scale=function(n,t,i){var f=t[0],e=t[1],o=t[2],s=t[3],h=t[4],c=t[5],r=i[0],u=i[1];return n[0]=f*r,n[1]=e*r,n[2]=o*u,n[3]=s*u,n[4]=h,n[5]=c,n};r.translate=function(n,t,i){var r=t[0],u=t[1],f=t[2],e=t[3],h=t[4],c=t[5],o=i[0],s=i[1];return n[0]=r,n[1]=u,n[2]=f,n[3]=e,n[4]=r*o+f*s+h,n[5]=u*o+e*s+c,n};r.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)};t.a=r},function(n){var t=typeof window!="undefined"&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(n){setTimeout(n,16)};n.exports=t},function(n,t,i){"use strict";function r(n,t,i,r,u,f,e){this._zr=n;this._x=0;this._y=0;this._rowHeight=0;this.width=r;this.height=u;this.offsetX=t;this.offsetY=i;this.dpr=e;this.gap=f}function u(n){var t,i,u;n=n||{};n.width=n.width||512;n.height=n.height||512;n.devicePixelRatio=n.devicePixelRatio||1;n.gap=n.gap==null?2:n.gap;t=document.createElement("canvas");t.width=n.width*n.devicePixelRatio;t.height=n.height*n.devicePixelRatio;this._canvas=t;this._texture=new o.a({image:t,flipY:!1});i=this;this._zr=e.a.zrender.init(t);u=this._zr.refreshImmediately;this._zr.refreshImmediately=function(){u.call(this);i._texture.dirty();i.onupdate&&i.onupdate()};this._dpr=n.devicePixelRatio;this._coords={};this.onupdate=n.onupdate;this._gap=n.gap;this._textureAtlasNodes=[new r(this._zr,0,0,n.width,n.height,this._gap,this._dpr)];this._nodeWidth=n.width;this._nodeHeight=n.height;this._currentNodeIdx=0}var f=i(0),e=i.n(f),o=i(5);r.prototype={constructor:r,clear:function(){this._x=0;this._y=0;this._rowHeight=0},add:function(n,t,i){var h=n.getBoundingRect(),f,c;t==null&&(t=h.width);i==null&&(i=h.height);t*=this.dpr;i*=this.dpr;this._fitElement(n,t,i);var u=this._x,r=this._y,o=this.width*this.dpr,s=this.height*this.dpr,e=this.gap;return(u+t+e>o&&(u=this._x=0,r+=this._rowHeight+e,this._y=r,this._rowHeight=0),this._x+=t+e,this._rowHeight=Math.max(this._rowHeight,i),r+i+e>s)?null:(n.position[0]+=this.offsetX*this.dpr+u,n.position[1]+=this.offsetY*this.dpr+r,this._zr.add(n),f=[this.offsetX/this.width,this.offsetY/this.height],c=[[u/o+f[0],r/s+f[1]],[(u+t)/o+f[0],(r+i)/s+f[1]]],c)},_fitElement:function(n,t,i){var r=n.getBoundingRect(),u=t/r.width,f=i/r.height;n.position=[-r.x*u,-r.y*f];n.scale=[u,f];n.update()}};u.prototype={clear:function(){for(var n=0;n<this._textureAtlasNodes.length;n++)this._textureAtlasNodes[n].clear();this._currentNodeIdx=0;this._zr.clear();this._coords={}},getWidth:function(){return this._width},getHeight:function(){return this._height},getTexture:function(){return this._texture},getDevicePixelRatio:function(){return this._dpr},getZr:function(){return this._zr},_getCurrentNode:function(){return this._textureAtlasNodes[this._currentNodeIdx]},_expand:function(){var i,u,f;if(this._currentNodeIdx++,this._textureAtlasNodes[this._currentNodeIdx])return this._textureAtlasNodes[this._currentNodeIdx];var n=4096/this._dpr,s=this._textureAtlasNodes,e=s.length,o=e*this._nodeWidth%n,t=Math.floor(e*this._nodeWidth/n)*this._nodeHeight;if(t>=n){!0&&console.error("Too much labels. Some will be ignored.");return}i=(o+this._nodeWidth)*this._dpr;u=(t+this._nodeHeight)*this._dpr;try{this._zr.resize({width:i,height:u})}catch(h){this._canvas.width=i;this._canvas.height=u}return f=new r(this._zr,o,t,this._nodeWidth,this._nodeHeight,this._gap,this._dpr),this._textureAtlasNodes.push(f),f},add:function(n,t,i){var r,u;if(this._coords[n.id])return!0&&console.warn("Element already been add"),this._coords[n.id];if(r=this._getCurrentNode().add(n,t,i),!r){if(u=this._expand(),!u)return;r=u.add(n,t,i)}return this._coords[n.id]=r,r},getCoordsScale:function(){var n=this._dpr;return[this._nodeWidth/this._canvas.width*n,this._nodeHeight/this._canvas.height*n]},getCoords:function(n){return this._coords[n]}};t.a=u},function(n,t,i){function r(n,t,i,r){i<0&&(n=n+i,i=-i);r<0&&(t=t+r,r=-r);this.x=n;this.y=t;this.width=i;this.height=r}var h=i(83),u=i(84),f=h.applyTransform,e=Math.min,o=Math.max,s;r.prototype={constructor:r,union:function(n){var t=e(n.x,this.x),i=e(n.y,this.y);this.width=o(n.x+n.width,this.x+this.width)-t;this.height=o(n.y+n.height,this.y+this.height)-i;this.x=t;this.y=i},applyTransform:function(){var n=[],t=[],i=[],r=[];return function(u){if(u){n[0]=i[0]=this.x;n[1]=r[1]=this.y;t[0]=r[0]=this.x+this.width;t[1]=i[1]=this.y+this.height;f(n,n,u);f(t,t,u);f(i,i,u);f(r,r,u);this.x=e(n[0],t[0],i[0],r[0]);this.y=e(n[1],t[1],i[1],r[1]);var s=o(n[0],t[0],i[0],r[0]),h=o(n[1],t[1],i[1],r[1]);this.width=s-this.x;this.height=h-this.y}}}(),calculateTransform:function(n){var i=this,r=n.width/i.width,f=n.height/i.height,t=u.create();return u.translate(t,t,[-i.x,-i.y]),u.scale(t,t,[r,f]),u.translate(t,t,[n.x,n.y]),t},intersect:function(n){if(!n)return!1;n instanceof r||(n=r.create(n));var t=this,i=t.x,u=t.x+t.width,f=t.y,e=t.y+t.height,o=n.x,s=n.x+n.width,h=n.y,c=n.y+n.height;return!(u<o||s<i||e<h||c<f)},contain:function(n,t){var i=this;return n>=i.x&&n<=i.x+i.width&&t>=i.y&&t<=i.y+i.height},clone:function(){return new r(this.x,this.y,this.width,this.height)},copy:function(n){this.x=n.x;this.y=n.y;this.width=n.width;this.height=n.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}};r.create=function(n){return new r(n.x,n.y,n.width,n.height)};s=r;n.exports=s},function(n,t){function o(n,t){var i=new u(2);return n==null&&(n=0),t==null&&(t=0),i[0]=n,i[1]=t,i}function s(n,t){return n[0]=t[0],n[1]=t[1],n}function h(n){var t=new u(2);return t[0]=n[0],t[1]=n[1],t}function c(n,t,i){return n[0]=t,n[1]=i,n}function l(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n}function a(n,t,i,r){return n[0]=t[0]+i[0]*r,n[1]=t[1]+i[1]*r,n}function v(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n}function i(n){return Math.sqrt(r(n))}function r(n){return n[0]*n[0]+n[1]*n[1]}function w(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n}function b(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n}function k(n,t){return n[0]*t[0]+n[1]*t[1]}function d(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n}function g(n,t){var r=i(t);return r===0?(n[0]=0,n[1]=0):(n[0]=t[0]/r,n[1]=t[1]/r),n}function f(n,t){return Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1]))}function e(n,t){return(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])}function it(n,t){return n[0]=-t[0],n[1]=-t[1],n}function rt(n,t,i,r){return n[0]=t[0]+r*(i[0]-t[0]),n[1]=t[1]+r*(i[1]-t[1]),n}function ut(n,t,i){var r=t[0],u=t[1];return n[0]=i[0]*r+i[2]*u+i[4],n[1]=i[1]*r+i[3]*u+i[5],n}function ft(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n}function et(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n}var u=typeof Float32Array=="undefined"?Array:Float32Array,y=i,p=r,nt=f,tt=e;t.create=o;t.copy=s;t.clone=h;t.set=c;t.add=l;t.scaleAndAdd=a;t.sub=v;t.len=i;t.length=y;t.lenSquare=r;t.lengthSquare=p;t.mul=w;t.div=b;t.dot=k;t.scale=d;t.normalize=g;t.distance=f;t.dist=nt;t.distanceSquare=e;t.distSquare=tt;t.negate=it;t.lerp=rt;t.applyTransform=ut;t.min=ft;t.max=et},function(n,t){function i(){var n=new f(6);return r(n),n}function r(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n}function u(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function e(n,t,i){var r=t[0]*i[0]+t[2]*i[1],u=t[1]*i[0]+t[3]*i[1],f=t[0]*i[2]+t[2]*i[3],e=t[1]*i[2]+t[3]*i[3],o=t[0]*i[4]+t[2]*i[5]+t[4],s=t[1]*i[4]+t[3]*i[5]+t[5];return n[0]=r,n[1]=u,n[2]=f,n[3]=e,n[4]=o,n[5]=s,n}function o(n,t,i){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4]+i[0],n[5]=t[5]+i[1],n}function s(n,t,i){var f=t[0],e=t[2],o=t[4],s=t[1],h=t[3],c=t[5],r=Math.sin(i),u=Math.cos(i);return n[0]=f*u+s*r,n[1]=-f*r+s*u,n[2]=e*u+h*r,n[3]=-e*r+u*h,n[4]=u*o+r*c,n[5]=u*c-r*o,n}function h(n,t,i){var r=i[0],u=i[1];return n[0]=t[0]*r,n[1]=t[1]*u,n[2]=t[2]*r,n[3]=t[3]*u,n[4]=t[4]*r,n[5]=t[5]*u,n}function c(n,t){var r=t[0],u=t[2],o=t[4],f=t[1],e=t[3],s=t[5],i=r*e-f*u;return i?(i=1/i,n[0]=e*i,n[1]=-f*i,n[2]=-u*i,n[3]=r*i,n[4]=(u*s-e*o)*i,n[5]=(f*o-r*s)*i,n):null}function l(n){var t=i();return u(t,n),t}var f=typeof Float32Array=="undefined"?Array:Float32Array;t.create=i;t.identity=r;t.copy=u;t.mul=e;t.translate=o;t.rotate=s;t.scale=h;t.invert=c;t.clone=l},function(n,t,i){function e(n){return n.replace(/^\s+/,"").replace(/\s+$/,"")}function o(n,t,i,r){var u=t[1]-t[0],f=i[1]-i[0];if(u===0)return f===0?i[0]:(i[0]+i[1])/2;if(r)if(u>0){if(n<=t[0])return i[0];if(n>=t[1])return i[1]}else{if(n>=t[0])return i[0];if(n<=t[1])return i[1]}else{if(n===t[0])return i[0];if(n===t[1])return i[1]}return(n-t[0])/u*f+i[0]}function s(n,t){switch(n){case"center":case"middle":n="50%";break;case"left":case"top":n="0%";break;case"right":case"bottom":n="100%"}return typeof n=="string"?e(n).match(/%$/)?parseFloat(n)/100*t:parseFloat(n):n==null?NaN:+n}function h(n,t,i){return t==null&&(t=10),t=Math.min(Math.max(0,t),20),n=(+n).toFixed(t),i?n:+n}function c(n){return n.sort(function(n,t){return n-t}),n}function l(n){if(n=+n,isNaN(n))return 0;for(var t=1,i=0;Math.round(n*t)/t!==n;)t*=10,i++;return i}function a(n){var t=n.toString(),u=t.indexOf("e"),i,r;return u>0?(i=+t.slice(u+1),i<0?-i:0):(r=t.indexOf("."),r<0?0:t.length-1-r)}function v(n,t){var i=Math.log,r=Math.LN10,f=Math.floor(i(n[1]-n[0])/r),e=Math.round(i(Math.abs(t[1]-t[0]))/r),u=Math.min(Math.max(-f+e,0),20);return isFinite(u)?u:20}function y(n,t,i){var s,c,o,u,v;if(!n[t]||(s=r.reduce(n,function(n,t){return n+(isNaN(t)?0:t)},0),s===0))return 0;for(var h=Math.pow(10,i),l=r.map(n,function(n){return(isNaN(n)?0:n)/s*h*100}),y=h*100,f=r.map(l,function(n){return Math.floor(n)}),a=r.reduce(f,function(n,t){return n+t},0),e=r.map(l,function(n,t){return n-f[t]});a<y;){for(c=Number.NEGATIVE_INFINITY,o=null,u=0,v=e.length;u<v;++u)e[u]>c&&(c=e[u],o=u);++f[o];e[o]=0;++a}return f[t]/h}function p(n){var t=Math.PI*2;return(n%t+t)%t}function w(n){return n>-u&&n<u}function k(n){var t,i;return n instanceof Date?n:typeof n=="string"?(t=b.exec(n),!t)?new Date(NaN):t[8]?(i=+t[4]||0,t[8].toUpperCase()!=="Z"&&(i-=t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,i,+(t[5]||0),+t[6]||0,+t[7]||0))):new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,+t[7]||0):n==null?new Date(NaN):new Date(Math.round(n))}function d(n){return Math.pow(10,f(n))}function f(n){return Math.floor(Math.log(n)/Math.LN10)}function g(n,t){var r=f(n),u=Math.pow(10,r),i=n/u,e;return e=t?i<1.5?1:i<2.5?2:i<4?3:i<7?5:10:i<1?1:i<2?2:i<3?3:i<5?5:10,n=e*u,r>=-20?+n.toFixed(r<0?-r:0):n}function nt(n){function o(n,t,i){return n.interval[i]<t.interval[i]||n.interval[i]===t.interval[i]&&(n.close[i]-t.close[i]==(i?-1:1)||!i&&o(n,t,1))}var f,e,i,r,u,t;for(n.sort(function(n,t){return o(n,t,0)?-1:1}),f=-Infinity,e=1,i=0;i<n.length;){for(r=n[i].interval,u=n[i].close,t=0;t<2;t++)r[t]<=f&&(r[t]=f,u[t]=t?1:1-e),f=r[t],e=u[t];r[0]===r[1]&&u[0]*u[1]!=1?n.splice(i,1):i++}return n}function tt(n){return n-parseFloat(n)>=0}var r=i(13),u=.0001,b=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;t.linearMap=o;t.parsePercent=s;t.round=h;t.asc=c;t.getPrecision=l;t.getPrecisionSafe=a;t.getPixelPrecision=v;t.getPercentWithPrecision=y;t.MAX_SAFE_INTEGER=9007199254740991;t.remRadian=p;t.isRadianAroundZero=w;t.parseDate=k;t.quantity=d;t.nice=g;t.reformIntervals=nt;t.isNumeric=tt},function(n,t,i){"use strict";function o(n){var i,t,r,f;for(h.a.defaultsWithPropList(n,e,u),c(n),i="",t=0;t<u.length;t++)r=u[t],f=n[r].toString(),i+=f;return i}function c(n){var t=l(n.width,n.height);n.format===r.a.DEPTH_COMPONENT&&(n.useMipmap=!1);t&&n.useMipmap||(n.minFilter==r.a.NEAREST_MIPMAP_NEAREST||n.minFilter==r.a.NEAREST_MIPMAP_LINEAR?n.minFilter=r.a.NEAREST:(n.minFilter==r.a.LINEAR_MIPMAP_LINEAR||n.minFilter==r.a.LINEAR_MIPMAP_NEAREST)&&(n.minFilter=r.a.LINEAR));t||(n.wrapS=r.a.CLAMP_TO_EDGE,n.wrapT=r.a.CLAMP_TO_EDGE)}function l(n,t){return(n&n-1)==0&&(t&t-1)==0}var s=i(5),r=i(11),h=i(23),f=function(){this._pool={};this._allocatedTextures=[]},e,u;f.prototype={constructor:f,get:function(n){var t=o(n),i,r;return(this._pool.hasOwnProperty(t)||(this._pool[t]=[]),i=this._pool[t],!i.length)?(r=new s.a(n),this._allocatedTextures.push(r),r):i.pop()},put:function(n){var t=o(n),i;this._pool.hasOwnProperty(t)||(this._pool[t]=[]);i=this._pool[t];i.push(n)},clear:function(n){for(var t=0;t<this._allocatedTextures.length;t++)this._allocatedTextures[t].dispose(n);this._pool={};this._allocatedTextures=[]}};e={width:512,height:512,type:r.a.UNSIGNED_BYTE,format:r.a.RGBA,wrapS:r.a.CLAMP_TO_EDGE,wrapT:r.a.CLAMP_TO_EDGE,minFilter:r.a.LINEAR_MIPMAP_LINEAR,magFilter:r.a.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1};u=Object.keys(e);t.a=f},function(n,t){"use strict";t.a="@export clay.compositor.kernel.gaussian_9\nfloat gaussianKernel[9];\ngaussianKernel[0] = 0.07;\ngaussianKernel[1] = 0.09;\ngaussianKernel[2] = 0.12;\ngaussianKernel[3] = 0.14;\ngaussianKernel[4] = 0.16;\ngaussianKernel[5] = 0.14;\ngaussianKernel[6] = 0.12;\ngaussianKernel[7] = 0.09;\ngaussianKernel[8] = 0.07;\n@end\n@export clay.compositor.kernel.gaussian_13\nfloat gaussianKernel[13];\ngaussianKernel[0] = 0.02;\ngaussianKernel[1] = 0.03;\ngaussianKernel[2] = 0.06;\ngaussianKernel[3] = 0.08;\ngaussianKernel[4] = 0.11;\ngaussianKernel[5] = 0.13;\ngaussianKernel[6] = 0.14;\ngaussianKernel[7] = 0.13;\ngaussianKernel[8] = 0.11;\ngaussianKernel[9] = 0.08;\ngaussianKernel[10] = 0.06;\ngaussianKernel[11] = 0.03;\ngaussianKernel[12] = 0.02;\n@end\n@export clay.compositor.gaussian_blur\n#define SHADER_NAME gaussian_blur\nuniform sampler2D texture;varying vec2 v_Texcoord;\nuniform float blurSize : 2.0;\nuniform vec2 textureSize : [512.0, 512.0];\nuniform float blurDir : 0.0;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main (void)\n{\n @import clay.compositor.kernel.gaussian_9\n vec2 off = blurSize / textureSize;\n off *= vec2(1.0 - blurDir, blurDir);\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n for (int i = 0; i < 9; i++) {\n float w = gaussianKernel[i];\n vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));\n sum += texel * w;\n weightAll += w;\n }\n gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));\n}\n@end\n"},function(n,t){"use strict";t.a="\n@export clay.compositor.lut\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform sampler2D lookup;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n float blueColor = tex.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec4 newColor1 = texture2D(lookup, texPos1);\n vec4 newColor2 = texture2D(lookup, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.output\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = tex.rgb;\n#ifdef OUTPUT_ALPHA\n gl_FragColor.a = tex.a;\n#else\n gl_FragColor.a = 1.0;\n#endif\n gl_FragColor = encodeHDR(gl_FragColor);\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.bright\nuniform sampler2D texture;\nuniform float threshold : 1;\nuniform float scale : 1.0;\nuniform vec2 textureSize: [512, 512];\nvarying vec2 v_Texcoord;\nconst vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvec4 median(vec4 a, vec4 b, vec4 c)\n{\n return a + b + c - min(min(a, b), c) - max(max(a, b), c);\n}\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n#ifdef ANTI_FLICKER\n vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);\n vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));\n vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));\n vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));\n vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));\n texel = median(median(texel, s1, s2), s3, s4);\n#endif\n float lum = dot(texel.rgb , lumWeight);\n vec4 color;\n if (lum > threshold && texel.a > 0.0)\n {\n color = vec4(texel.rgb * scale, texel.a * scale);\n }\n else\n {\n color = vec4(0.0);\n }\n gl_FragColor = encodeHDR(color);\n}\n@end\n"},function(n,t){"use strict";t.a="@export clay.compositor.downsample\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nfloat brightness(vec3 c)\n{\n return max(max(c.r, c.g), c.b);\n}\n@import clay.util.clamp_sample\nvoid main()\n{\n vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;\n#ifdef ANTI_FLICKER\n vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;\n vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;\n vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;\n vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;\n float s1w = 1.0 / (brightness(s1) + 1.0);\n float s2w = 1.0 / (brightness(s2) + 1.0);\n float s3w = 1.0 / (brightness(s3) + 1.0);\n float s4w = 1.0 / (brightness(s4) + 1.0);\n float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);\n vec4 color = vec4(\n (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,\n 1.0\n );\n#else\n vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n color *= 0.25;\n#endif\n gl_FragColor = encodeHDR(color);\n}\n@end"},function(n,t){"use strict";t.a="\n@export clay.compositor.upsample\n#define HIGH_QUALITY\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nuniform float sampleScale: 0.5;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main()\n{\n#ifdef HIGH_QUALITY\n vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n gl_FragColor = encodeHDR(s / 16.0);\n#else\n vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n gl_FragColor = encodeHDR(s / 4.0);\n#endif\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.hdr.composite\n#define TONEMAPPING\nuniform sampler2D texture;\n#ifdef BLOOM_ENABLED\nuniform sampler2D bloom;\n#endif\n#ifdef LENSFLARE_ENABLED\nuniform sampler2D lensflare;\nuniform sampler2D lensdirt;\n#endif\n#ifdef LUM_ENABLED\nuniform sampler2D lum;\n#endif\n#ifdef LUT_ENABLED\nuniform sampler2D lut;\n#endif\n#ifdef COLOR_CORRECTION\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float saturation : 1.0;\n#endif\n#ifdef VIGNETTE\nuniform float vignetteDarkness: 1.0;\nuniform float vignetteOffset: 1.0;\n#endif\nuniform float exposure : 1.0;\nuniform float bloomIntensity : 0.25;\nuniform float lensflareIntensity : 1;\nvarying vec2 v_Texcoord;\n@import clay.util.srgb\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nfloat eyeAdaption(float fLum)\n{\n return mix(0.2, fLum, 0.5);\n}\n#ifdef LUT_ENABLED\nvec3 lutTransform(vec3 color) {\n float blueColor = color.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec4 newColor1 = texture2D(lut, texPos1);\n vec4 newColor2 = texture2D(lut, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n return newColor.rgb;\n}\n#endif\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = vec4(0.0);\n vec4 originalTexel = vec4(0.0);\n#ifdef TEXTURE_ENABLED\n texel = decodeHDR(texture2D(texture, v_Texcoord));\n originalTexel = texel;\n#endif\n#ifdef BLOOM_ENABLED\n vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));\n texel.rgb += bloomTexel.rgb * bloomIntensity;\n texel.a += bloomTexel.a * bloomIntensity;\n#endif\n#ifdef LENSFLARE_ENABLED\n texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;\n#endif\n texel.a = min(texel.a, 1.0);\n#ifdef LUM_ENABLED\n float fLum = texture2D(lum, vec2(0.5, 0.5)).r;\n float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));\n float exposureBias = adaptedLumDest * exposure;\n#else\n float exposureBias = exposure;\n#endif\n#ifdef TONEMAPPING\n texel.rgb *= exposureBias;\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n texel = linearTosRGB(texel);\n#ifdef LUT_ENABLED\n texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));\n#endif\n#ifdef COLOR_CORRECTION\n texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);\n texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));\n texel.rgb = mix(vec3(lum), texel.rgb, saturation);\n#endif\n#ifdef VIGNETTE\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);\n texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));\n#endif\n gl_FragColor = encodeHDR(texel);\n#ifdef DEBUG\n #if DEBUG == 1\n gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));\n #elif DEBUG == 2\n gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);\n #elif DEBUG == 3\n gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));\n #endif\n#endif\n if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {\n gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));\n }\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.blend\n#define SHADER_NAME blend\n#ifdef TEXTURE1_ENABLED\nuniform sampler2D texture1;\nuniform float weight1 : 1.0;\n#endif\n#ifdef TEXTURE2_ENABLED\nuniform sampler2D texture2;\nuniform float weight2 : 1.0;\n#endif\n#ifdef TEXTURE3_ENABLED\nuniform sampler2D texture3;\nuniform float weight3 : 1.0;\n#endif\n#ifdef TEXTURE4_ENABLED\nuniform sampler2D texture4;\nuniform float weight4 : 1.0;\n#endif\n#ifdef TEXTURE5_ENABLED\nuniform sampler2D texture5;\nuniform float weight5 : 1.0;\n#endif\n#ifdef TEXTURE6_ENABLED\nuniform sampler2D texture6;\nuniform float weight6 : 1.0;\n#endif\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = vec4(0.0);\n#ifdef TEXTURE1_ENABLED\n tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;\n#endif\n#ifdef TEXTURE2_ENABLED\n tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;\n#endif\n#ifdef TEXTURE3_ENABLED\n tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;\n#endif\n#ifdef TEXTURE4_ENABLED\n tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;\n#endif\n#ifdef TEXTURE5_ENABLED\n tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;\n#endif\n#ifdef TEXTURE6_ENABLED\n tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;\n#endif\n gl_FragColor = encodeHDR(tex);\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.fxaa\nuniform sampler2D texture;\nuniform vec4 viewport : VIEWPORT;\nvarying vec2 v_Texcoord;\n#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\n@import clay.util.rgbm\nvoid main()\n{\n vec2 resolution = 1.0 / viewport.zw;\n vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;\n vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );\n vec3 rgbM = rgbaM.xyz;\n float opacity = rgbaM.w;\n vec3 luma = vec3( 0.299, 0.587, 0.114 );\n float lumaNW = dot( rgbNW, luma );\n float lumaNE = dot( rgbNE, luma );\n float lumaSW = dot( rgbSW, luma );\n float lumaSE = dot( rgbSE, luma );\n float lumaM = dot( rgbM, luma );\n float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n vec2 dir;\n dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n dir * rcpDirMin)) * resolution;\n vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA *= 0.5;\n vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;\n rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;\n rgbB *= 0.25;\n rgbB += rgbA * 0.5;\n float lumaB = dot( rgbB, luma );\n if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )\n {\n gl_FragColor = vec4( rgbA, opacity );\n }\n else {\n gl_FragColor = vec4( rgbB, opacity );\n }\n}\n@end"},function(n,t,i){"use strict";var r=i(0),u=i.n(r);t.a={getFilledRegions:function(n,t){var r=(n||[]).slice(),f,e,o,i,s;if(typeof t=="string"?(t=u.a.getMap(t),f=t&&t.geoJson):t&&t.features&&(f=t),!f)return!0&&(console.error("Map "+t+" not exists. You can download map file on http://echarts.baidu.com/download-map.html"),f.features||console.error("Invalid GeoJSON for map3D")),[];for(e={},o=f.features,i=0;i<r.length;i++)e[r[i].name]=r[i];for(i=0;i<o.length;i++)s=o[i].properties.name,e[s]||r.push({name:s});return r},defaultOption:{show:!0,zlevel:-10,map:"",left:0,top:0,width:"100%",height:"100%",boxWidth:100,boxHeight:10,boxDepth:"auto",regionHeight:3,environment:"auto",groundPlane:{show:!1,color:"#aaa"},shading:"lambert",light:{main:{alpha:40,beta:30}},viewControl:{alpha:40,beta:0,distance:100,orthographicSize:60,minAlpha:5,minBeta:-80,maxBeta:80},label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}}},function(n,t){"use strict";function r(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function f(n,t,i,u,f){var o=i,s=n[t],e;for(r(n,t,u),e=i;e<u;e++)f(n[e],s)<0&&(r(n,e,o),o++);return r(n,u,o),o}function i(n,t,r,u){if(r<u){var o=Math.floor((r+u)/2),e=f(n,o,r,u,t);i(n,t,r,e-1);i(n,t,e+1,u)}}function u(){this._parts=[]}u.prototype.step=function(n,t,r){var l=n.length,a,u,h,o,s,e,c;if(r===0&&(this._parts=[],this._sorted=!1,a=Math.floor(l/2),this._parts.push({pivot:a,left:0,right:l-1}),this._currentSortPartIdx=0),!this._sorted){if(u=this._parts,u.length===0)return this._sorted=!0,!0;if(u.length<512){for(e=0;e<u.length;e++)u[e].pivot=f(n,u[e].pivot,u[e].left,u[e].right,t);for(h=[],e=0;e<u.length;e++)o=u[e].left,s=u[e].pivot-1,s>o&&h.push({pivot:Math.floor((s+o)/2),left:o,right:s}),o=u[e].pivot+1,s=u[e].right,s>o&&h.push({pivot:Math.floor((s+o)/2),left:o,right:s});u=this._parts=h}else for(e=0;e<Math.floor(u.length/10);e++)if(c=u.length-1-this._currentSortPartIdx,i(n,t,u[c].left,u[c].right),this._currentSortPartIdx++,this._currentSortPartIdx===u.length)return this._sorted=!0,!0;return!1}};u.sort=i;t.a=u},function(n,t,i){"use strict";function v(n,t){var s=n.getBoxLayoutParams(),i=c.a.getLayoutRect(s,{width:t.getWidth(),height:t.getHeight()});i.y=t.getHeight()-i.y-i.height;this.viewGL.setViewport(i.x,i.y,i.width,i.height,t.getDevicePixelRatio());var e=this.getGeoBoundingRect(),o=e.width/e.height*(n.get("aspectScale")||.75),r=n.get("boxWidth"),u=n.get("boxDepth"),f=n.get("boxHeight");f==null&&(f=5);isNaN(r)&&isNaN(u)&&(r=100);isNaN(u)?u=r/o:isNaN(r)&&(r=u/o);this.setSize(r,f,u);this.regionHeight=n.get("regionHeight");this.altitudeAxis&&this.altitudeAxis.setExtent(0,Math.max(f-this.regionHeight,0))}function y(n,t){var i=[Infinity,-Infinity],u;n.eachSeries(function(n){var t;if(n.coordinateSystem===this&&n.type!=="series.map3D"){var f=n.getData(),r=n.coordDimToDataDim("alt"),u=r&&r[0];u&&(t=f.getDataExtent(u,!0),i[0]=Math.min(i[0],t[0]),i[1]=Math.max(i[1],t[1]))}},this);i&&isFinite(i[1]-i[0])&&(u=r.a.helper.createScale(i,{type:"value",min:"dataMin",max:"dataMax"}),this.altitudeAxis=new r.a.Axis("altitude",u),this.resize(this.model,t))}var e=i(99),s=i(0),r=i.n(s),h=i(47),c=i.n(h),l=i(22),a=i(2),o,f,u;!0&&(o=function(n){console.error("Map "+n+" not exists. You can download map file on http://echarts.baidu.com/download-map.html")});f=0;u={dimensions:e.a.prototype.dimensions,create:function(n,t){function f(n){var r=u.createGeo3D(n);n.__viewGL=n.__viewGL||new l.a;r.viewGL=n.__viewGL;n.coordinateSystem=r;r.model=n;i.push(r);r.resize=v;r.resize(n,t);r.update=y}var i=[];if(!r.a.getMap)throw new Error("geo3D component depends on geo component");return n.eachComponent("geo3D",function(n,t){f(n,t)}),n.eachSeriesByType("map3D",function(n,t){var i=n.get("coordinateSystem");i==null&&(i="geo3D");i==="geo3D"&&f(n,t)}),n.eachSeries(function(t){if(t.get("coordinateSystem")==="geo3D"){if(t.type==="series.map3D")return;var i=t.getReferringComponents("geo3D")[0];if(i||(i=n.getComponent("geo3D")),!i)throw new Error('geo "'+a.a.firstNotNull(t.get("geo3DIndex"),t.get("geo3DId"),0)+'" not found');t.coordinateSystem=i.coordinateSystem}}),i},createGeo3D:function(n){var t=n.get("map"),i;if(typeof t=="string"?(i=t,t=r.a.getMap(t)):t&&t.features&&(t={geoJson:t}),!0&&(t||o(t),!t.geoJson.features))throw new Error("Invalid GeoJSON for map3D");return i==null&&(i="GEO_ANONYMOUS_"+f++),new e.a(i+f++,i,t&&t.geoJson,t&&t.specialAreas,n.get("nameMap"))}};r.a.registerCoordinateSystem("geo3D",u);t.a=u},function(n,t,i){"use strict";function f(n,t,i,u,f){this.name=n;this.map=t;this.regionHeight=0;this.regions=[];this._nameCoordMap={};this.loadGeoJson(i,u,f);this.transform=r.identity(new Float64Array(16));this.invTransform=r.identity(new Float64Array(16));this.extrudeY=!0;this.altitudeAxis}var o=i(0),u=i.n(o),e=i(6),s=i(205),h=i.n(s),c=i(206),l=i.n(c),a=e.a.vec3,r=e.a.mat4,v=[h.a,l.a];f.prototype={constructor:f,type:"geo3D",dimensions:["lng","lat","alt"],containPoint:function(){},loadGeoJson:function(n,t,i){var h=u.a.parseGeoJSON||u.a.parseGeoJson,e,s,r,f,o;try{this.regions=n?h(n):[]}catch(c){throw"Invalid geoJson format\n"+c;}for(t=t||{},i=i||{},e=this.regions,s={},r=0;r<e.length;r++)f=e[r].name,f=i[f]||f,e[r].name=f,s[f]=e[r],this.addGeoCoord(f,e[r].center),o=t[f],o&&e[r].transformTo(o.left,o.top,o.width,o.height);this._regionsMap=s;this._geoRect=null;v.forEach(function(n){n(this)},this)},getGeoBoundingRect:function(){var n,i,t,r;if(this._geoRect)return this._geoRect;for(i=this.regions,t=0;t<i.length;t++)r=i[t].getBoundingRect(),n=n||r.clone(),n.union(r);return this._geoRect=n||new u.a.graphic.BoundingRect(0,0,0,0)},addGeoCoord:function(n,t){this._nameCoordMap[n]=t},getRegion:function(n){return this._regionsMap[n]},getRegionByCoord:function(n){for(var i=this.regions,t=0;t<i.length;t++)if(i[t].contain(n))return i[t]},setSize:function(n,t,i){this.size=[n,t,i];var f=this.getGeoBoundingRect(),e=n/f.width,o=-i/f.height,s=-n/2-f.x*e,h=i/2-f.y*o,c=this.extrudeY?[s,0,h]:[s,h,0],l=this.extrudeY?[e,1,o]:[e,o,1],u=this.transform;r.identity(u);r.translate(u,u,c);r.scale(u,u,l);r.invert(this.invTransform,u)},dataToPoint:function(n,t){t=t||[];var r=this.extrudeY?1:2,u=this.extrudeY?2:1,i=n[2];return isNaN(i)&&(i=0),t[0]=n[0],t[u]=n[1],t[r]=this.altitudeAxis?this.altitudeAxis.dataToCoord(i):0,t[r]+=this.regionHeight,a.transformMat4(t,t,this.transform),t},pointToData:function(){}};t.a=f},function(n,t,i){"use strict";function s(){this.width=0;this.height=0;this.altitudeScale=1;this.boxHeight="auto";this.altitudeExtent;this.bearing=0;this.pitch=0;this.center=[0,0];this._origin;this.zoom=0;this._initialZoom;this.maxPitch=60;this.zoomOffset=0}var h=i(6),u=h.a.mat4,e=512,o=.64350110879328437,r=Math.PI,f=1/10;s.prototype={constructor:s,dimensions:["lng","lat","alt"],containPoint:function(){},setCameraOption:function(n){this.bearing=n.bearing;this.pitch=n.pitch;this.center=n.center;this.zoom=n.zoom;this._origin||(this._origin=this.projectOnTileWithScale(this.center,e));this._initialZoom==null&&(this._initialZoom=this.zoom);this.updateTransform()},updateTransform:function(){var n,r,s,a,h,v;if(this.height){var t=.5/Math.tan(o/2)*this.height*f,i=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI,c=o/2,y=Math.PI/2+i,p=Math.sin(c)*t/Math.sin(Math.PI-y-c),w=Math.cos(Math.PI/2-i)*p+t,l=w*1.1;this.pitch>50&&(l=1e3);n=[];u.perspective(n,o,this.width/this.height,1,l);this.viewGL.camera.projectionMatrix.setArray(n);this.viewGL.camera.decomposeProjectionMatrix();n=u.identity([]);r=this.dataToPoint(this.center);u.scale(n,n,[1,-1,1]);u.translate(n,n,[0,0,-t]);u.rotateX(n,n,i);u.rotateZ(n,n,-this.bearing/180*Math.PI);u.translate(n,n,[-r[0]*this.getScale()*f,-r[1]*this.getScale()*f,0]);this.viewGL.camera.viewMatrix.array=n;s=[];u.invert(s,n);this.viewGL.camera.worldTransform.array=s;this.viewGL.camera.decomposeWorldTransform();a=e*this.getScale();this.altitudeExtent&&!isNaN(this.boxHeight)?(v=this.altitudeExtent[1]-this.altitudeExtent[0],h=this.boxHeight/v*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)):h=a/(12756e3*Math.PI*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*f;this.viewGL.rootNode.scale.set(this.getScale()*f,this.getScale()*f,h)}},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(n,t){return this.projectOnTileWithScale(n,this.getScale()*e,t)},projectOnTileWithScale:function(n,t,i){var u=n[0],f=n[1],e=u*r/180,o=f*r/180,s=t*(e+r)/(2*r),h=t*(r-Math.log(Math.tan(r/4+o*.5)))/(2*r);return i=i||[],i[0]=s,i[1]=h,i},unprojectFromTile:function(n,t){return this.unprojectOnTileWithScale(n,this.getScale()*e,t)},unprojectOnTileWithScale:function(n,t,i){var u=n[0],f=n[1],e=u/t*2*r-r,o=2*(Math.atan(Math.exp(r-f/t*2*r))-r/4);return i=i||[],i[0]=e*180/r,i[1]=o*180/r,i},dataToPoint:function(n,t){return t=this.projectOnTileWithScale(n,e,t),t[0]-=this._origin[0],t[1]-=this._origin[1],t[2]=isNaN(n[2])?0:n[2],isNaN(n[2])||(t[2]=n[2],this.altitudeExtent&&(t[2]-=this.altitudeExtent[0])),t}};t.a=s},function(n,t,i){"use strict";var r=i(2),u=i(1),f=i(22);t.a=function(n,t,i){function e(n,t){var i=t.getWidth(),r=t.getHeight(),u=t.getDevicePixelRatio();this.viewGL.setViewport(0,0,i,r,u);this.width=i;this.height=r;this.altitudeScale=n.get("altitudeScale");this.boxHeight=n.get("boxHeight")}function o(n){if(this.model.get("boxHeight")!=="auto"){var t=[Infinity,-Infinity];n.eachSeries(function(n){var u,i,r;n.coordinateSystem===this&&(u=n.getData(),i=n.coordDimToDataDim("alt")[0],i&&(r=u.getDataExtent(i,!0),t[0]=Math.min(t[0],r[0]),t[1]=Math.max(t[1],r[1])))},this);t&&isFinite(t[1]-t[0])&&(this.altitudeExtent=t)}}return{dimensions:t.prototype.dimensions,create:function(s,h){var c=[];return s.eachComponent(n,function(n){var r=n.__viewGL,i;r||(r=n.__viewGL=new f.a,r.setRootNode(new u.a.Node));i=new t;i.viewGL=n.__viewGL;i.resize=e;i.resize(n,h);c.push(i);n.coordinateSystem=i;i.model=n;i.update=o}),s.eachSeries(function(t){if(t.get("coordinateSystem")===n){var i=t.getReferringComponents(n)[0];if(i||(i=s.getComponent(n)),!i)throw new Error(n+' "'+r.a.firstNotNull(t.get(n+"Index"),t.get(n+"Id"),0)+'" not found');t.coordinateSystem=i.coordinateSystem}}),i&&i(c,s,h),c}}}},function(n,t){"use strict";t.a="\n@export ecgl.displayShadow.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_WorldPosition;\n\nvarying vec3 v_Normal;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n\n@end\n\n\n@export ecgl.displayShadow.fragment\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform float roughness: 0.2;\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.ssaoMap.header\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n float shadow = 1.0;\n\n @import ecgl.common.ssaoMap.main\n\n#if defined(DIRECTIONAL_LIGHT_COUNT) && defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n for (int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++) {\n shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);\n }\n#endif\n\n shadow *= 0.5 + ao * 0.5;\n shadow = clamp(shadow, 0.0, 1.0);\n\n gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);\n}\n\n@end"},function(n,t,i){"use strict";function r(n){this.viewGL=n}var e=i(84),u=i.n(e),o=i(83),f=i.n(o);r.prototype.reset=function(n,t){this._updateCamera(t.getWidth(),t.getHeight(),t.getDevicePixelRatio());this._viewTransform=u.a.create();this.updateTransform(n,t)};r.prototype.updateTransform=function(n,t){var i=n.coordinateSystem;i.getRoamTransform&&(u.a.invert(this._viewTransform,i.getRoamTransform()),this._setCameraTransform(this._viewTransform),t.getZr().refresh())};r.prototype.dataToPoint=function(n,t,i){i=n.dataToPoint(t,null,i);var r=this._viewTransform;r&&f.a.applyTransform(i,i,r)};r.prototype.removeTransformInPoint=function(n){return this._viewTransform&&f.a.applyTransform(n,n,this._viewTransform),n};r.prototype.getZoom=function(){if(this._viewTransform){var n=this._viewTransform;return 1/Math.max(Math.sqrt(n[0]*n[0]+n[1]*n[1]),Math.sqrt(n[2]*n[2]+n[3]*n[3]))}return 1};r.prototype._setCameraTransform=function(n){var t=this.viewGL.camera;t.position.set(n[4],n[5],0);t.scale.set(Math.sqrt(n[0]*n[0]+n[1]*n[1]),Math.sqrt(n[2]*n[2]+n[3]*n[3]),1)};r.prototype._updateCamera=function(n,t,i){this.viewGL.setViewport(0,0,n,t,i);var r=this.viewGL.camera;r.left=r.top=0;r.bottom=t;r.right=n;r.near=0;r.far=100};t.a=r},function(n,t,i){(function(n){var i,r;typeof window!="undefined"?i=window.__DEV__:typeof n!="undefined"&&(i=n.__DEV__);typeof i=="undefined"&&(i=!0);r=i;t.__DEV__=r}).call(t,i(68))},function(n,t,i){"use strict";var u=i(15),o=i(0),s=i.n(o),h=i(38),c=i(6),r=c.a.vec2,f=[[0,0],[1,1]],e=u.a.extend(function(){return{segmentScale:4,dynamic:!0,useNativeLine:!0,attributes:{position:new u.a.Attribute("position","float",2,"POSITION"),normal:new u.a.Attribute("normal","float",2),offset:new u.a.Attribute("offset","float",1),color:new u.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0;this._itemVertexOffsets=[]},setVertexCount:function(n){var t=this.attributes;this.vertexCount!==n&&(t.position.init(n),t.color.init(n),this.useNativeLine||(t.offset.init(n),t.normal.init(n)),n>65535?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(n){this.triangleCount!==n&&(this.indices=n===0?null:this.vertexCount>65535?new Uint32Array(n*3):new Uint16Array(n*3))},_getCubicCurveApproxStep:function(n,t,i,u){var f=r.dist(n,t)+r.dist(i,t)+r.dist(u,i);return 1/(f+1)*this.segmentScale},getCubicCurveVertexCount:function(n,t,i,r){var f=this._getCubicCurveApproxStep(n,t,i,r),u=Math.ceil(1/f);return this.useNativeLine?u*2:u*2+2},getCubicCurveTriangleCount:function(n,t,i,r){var u=this._getCubicCurveApproxStep(n,t,i,r),f=Math.ceil(1/u);return this.useNativeLine?0:f*2},getLineVertexCount:function(){return this.getPolylineVertexCount(f)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(f)},getPolylineVertexCount:function(n){var t,i;return typeof n=="number"?t=n:(i=typeof n[0]!="number",t=i?n.length:n.length/2),this.useNativeLine?(t-1)*2:(t-1)*2+2},getPolylineTriangleCount:function(n){var t,i;return typeof n=="number"?t=n:(i=typeof n[0]!="number",t=i?n.length:n.length/2),this.useNativeLine?0:(t-1)*2},addCubicCurve:function(n,t,i,r,u,f){var tt;f==null&&(f=1);for(var h=n[0],c=n[1],a=t[0],v=t[1],rt=i[0],ut=i[1],y=r[0],p=r[1],e=this._getCubicCurveApproxStep(n,t,i,r),w=e*e,b=w*e,ft=3*e,et=3*w,ot=6*w,l=6*b,st=h-a*2+rt,ht=c-v*2+ut,k=(a-rt)*3-h+y,d=(v-ut)*3-c+p,o=h,s=c,g=(a-h)*ft+st*et+k*b,nt=(v-c)*ft+ht*et+d*b,ct=st*ot+k*l,lt=ht*ot+d*l,pt=k*l,wt=d*l,at=0,tt=0,vt=Math.ceil(1/e),it=new Float32Array((vt+1)*3),it=[],yt=0,tt=0;tt<vt+1;tt++)it[yt++]=o,it[yt++]=s,o+=g,s+=nt,g+=ct,nt+=lt,ct+=pt,lt+=wt,at+=e,at>1&&(o=g>0?Math.min(o,y):Math.max(o,y),s=nt>0?Math.min(s,p):Math.max(s,p));this.addPolyline(it,u,f)},addLine:function(n,t,i,r){this.addPolyline([n,t],i,r)},addPolyline:function(){var n=r.create(),e=r.create(),i=r.create(),f=r.create(),t=[],u=[],o=[];return function(s,h,c,l,a){var d,y,g,nt,k,et,b,w;if(s.length&&(d=typeof s[0]!="number",a==null&&(a=d?s.length:s.length/2),!(a<2))){l==null&&(l=0);c==null&&(c=1);this._itemVertexOffsets.push(this._vertexOffset);var rt=d?typeof h[0]!="number":h.length/4===a,tt=this.attributes.position,it=this.attributes.color,ut=this.attributes.offset,ft=this.attributes.normal,w=this.indices,v=this._vertexOffset,p;for(y=0;y<a;y++)d?(t=s[y+l],p=rt?h[y+l]:h):(k=y*2+l,t=t||[],t[0]=s[k],t[1]=s[k+1],rt?(g=y*4+l,p=p||[],p[0]=h[g],p[1]=h[g+1],p[2]=h[g+2],p[3]=h[g+3]):p=h),this.useNativeLine?y>1&&(tt.copy(v,v-1),it.copy(v,v-1),v++):(y<a-1?(d?r.copy(u,s[y+1]):(k=(y+1)*2+l,u=u||[],u[0]=s[k],u[1]=s[k+1]),y>0?(r.sub(n,t,o),r.sub(e,u,t),r.normalize(n,n),r.normalize(e,e),r.add(f,n,e),r.normalize(f,f),et=c/2*Math.min(1/r.dot(n,f),2),i[0]=-f[1],i[1]=f[0],nt=et):(r.sub(n,u,t),r.normalize(n,n),i[0]=-n[1],i[1]=n[0],nt=c/2)):(r.sub(n,t,o),r.normalize(n,n),i[0]=-n[1],i[1]=n[0],nt=c/2),ft.set(v,i),ft.set(v+1,i),ut.set(v,nt),ut.set(v+1,-nt),r.copy(o,t),tt.set(v,t),tt.set(v+1,t),it.set(v,p),it.set(v+1,p),v+=2),this.useNativeLine?(it.set(v,p),tt.set(v,t),v++):y>0&&(b=this._faceOffset*3,w=this.indices,w[b]=v-4,w[b+1]=v-3,w[b+2]=v-2,w[b+3]=v-3,w[b+4]=v-1,w[b+5]=v-2,this._faceOffset+=2);this._vertexOffset=v}}}(),setItemColor:function(n,t){for(var r=this._itemVertexOffsets[n],u=n<this._itemVertexOffsets.length-1?this._itemVertexOffsets[n+1]:this._vertexOffset,i=r;i<u;i++)this.attributes.color.set(i,t);this.dirty("color")}});s.a.util.defaults(e.prototype,h.a);t.a=e},function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(107),u=i(154),f=i(201),e=i(207),o=i(213),s=i(219),h=i(225),c=i(232),l=i(236),a=i(243),v=i(249),y=i(252),p=i(256),w=i(259),b=i(262),k=i(275),d=i(281)},function(n,t,i){"use strict";function v(n){throw new Error(n+" version is too old, needs "+f[n]+" or higher");}function e(n,t){n.replace(".","")-0<f[t].replace(".","")-0&&v(t);console.log("Loaded "+t+", version "+n)}function u(n){this._layers={};this._zr=n}var s=i(0),r=i.n(s),h=i(108),c=i(109),l=i(153),a=i(1),f={version:"1.1.1",dependencies:{echarts:"4.1.0",claygl:"1.2.1"}}.dependencies,o,y;e(h.a,"claygl");e(r.a.version,"echarts");u.prototype.update=function(n,t){function u(n){var u,f,t,e;return u=n.coordinateSystem&&n.coordinateSystem.model?n.get("zlevel"):n.get("zlevel"),f=o._layers,t=f[u],t||(t=f[u]=new c.a("gl-"+u,i),i.painter.isSingleCanvas()&&(t.virtual=!0,e=new r.a.graphic.Image({z:1e4,style:{image:t.renderer.canvas},silent:!0}),t.__hostImage=e,i.add(e)),i.painter.insertLayer(u,t)),t.__hostImage&&t.__hostImage.setStyle({width:t.renderer.getWidth(),height:t.renderer.getHeight()}),t}function f(n,t){n&&n.traverse(function(n){n.isRenderable&&n.isRenderable()&&(n.ignorePicking=n.$ignorePicking!=null?n.$ignorePicking:t)})}var o=this,i=t.getZr(),e;if(!i.getWidth()||!i.getHeight()){console.warn("Dom has no width or height");return}for(e in this._layers)this._layers[e].removeViewsAll();n.eachComponent(function(i,r){var o,e,s,h;if(i!=="series"&&(o=t.getViewOfComponentModel(r),e=r.coordinateSystem,o.__ecgl__)){if(e){if(!e.viewGL){console.error("Can't find viewGL in coordinateSystem of component "+r.id);return}s=e.viewGL}else{if(!r.viewGL){console.error("Can't find viewGL of component "+r.id);return}s=e.viewGL}s=e.viewGL;h=u(r);h.addView(s);o.afterRender&&o.afterRender(r,n,t,h);f(o.groupGL,r.get("silent"))}});n.eachSeries(function(i){var r=t.getViewOfSeriesModel(i),e=i.coordinateSystem,s,o;if(r.__ecgl__){if(e&&!e.viewGL&&!r.viewGL){console.error("Can't find viewGL of series "+r.id);return}s=e&&e.viewGL||r.viewGL;o=u(i);o.addView(s);r.afterRender&&r.afterRender(i,n,t,o);f(r.groupGL,i.get("silent"))}})};o=r.a.init;r.a.init=function(){var n=o.apply(this,arguments);return n.getZr().painter.getRenderedCanvas=function(n){function h(n,t){var o=s._zlevelList,r,u,f,e;for(n==null&&(n=-Infinity),u=0;u<o.length;u++)if(f=o[u],e=s._layers[f],!e.__builtin__&&f>n&&f<t){r=e;break}r&&r.renderToCanvas&&(i.save(),r.renderToCanvas(i),i.restore())}var t,u,i,c,e,r;if(n=n||{},this._singleCanvas)return this._layers[0].dom;t=document.createElement("canvas");u=n.pixelRatio||this.dpr;t.width=this.getWidth()*u;t.height=this.getHeight()*u;i=t.getContext("2d");i.dpr=u;i.clearRect(0,0,t.width,t.height);n.backgroundColor&&(i.fillStyle=n.backgroundColor,i.fillRect(0,0,t.width,t.height));var o=this.storage.getDisplayList(!0),l={},f,s=this;for(c={ctx:i},e=0;e<o.length;e++)r=o[e],r.zlevel!==f&&(h(f,r.zlevel),f=r.zlevel),this._doPaintEl(r,c,!0,l);return h(f,Infinity),t},n};r.a.registerPostUpdate(function(n,t){var i=t.getZr(),r=i.__egl=i.__egl||new u(i);r.update(n,t)});r.a.registerPreprocessor(l.a);r.a.graphicGL=a.a;y=u},function(n,t){"use strict";t.a="1.2.1"},function(n,t,i){"use strict";function o(n){var t=n.__zr;n.__zr=null;t&&n.removeAnimatorsFromZr&&n.removeAnimatorsFromZr(t)}function h(n){for(var t=0;t<n.length;t++)n[t].__used__=0}function c(n,t){for(var i=0;i<t.length;i++)t[i].__used__||t[i].dispose(n)}function u(n,t){n.__used__=n.__used__||0;n.__used__++;n.__used__===1&&t.push(n)}function k(n,t,i){var f,o,r;for(n.traverse(function(n){var c,s,a,l,v,r,h;if(n.isRenderable()){if(c=n.geometry,s=n.material,s!==f)for(a=s.getTextureUniforms(),l=0;l<a.length;l++)if(v=a[l],r=s.uniforms[v].value,r)if(r instanceof e.a)u(r,t);else if(r instanceof Array)for(h=0;h<r.length;h++)r[h]instanceof e.a&&u(r[h],t);c!==o&&u(c,i);f=s;o=c}}),r=0;r<n.lights.length;r++)n.lights[r].cubemap&&u(n.lights[r].cubemap,t)}var l=i(0),f=i.n(l),a=i(52),v=i(117),e=i(4),y=i(1),p=i(53),w=i(80),b=i.n(w),r=function(n,t){this.id=n;this.zr=t;try{this.renderer=new a.a({clearBit:0,devicePixelRatio:t.painter.dpr,preserveDrawingBuffer:!0,premultipliedAlpha:!0});this.renderer.resize(t.painter.getWidth(),t.painter.getHeight())}catch(r){this.renderer=null;this.dom=document.createElement("div");this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;";this.dom.className="ecgl-nowebgl";this.dom.innerHTML="Sorry, your browser does not support WebGL";console.error(r);return}this.onglobalout=this.onglobalout.bind(this);t.on("globalout",this.onglobalout);this.dom=this.renderer.canvas;var i=this.dom.style;i.position="absolute";i.left="0";i.top="0";this.views=[];this._picking=new v.a({renderer:this.renderer});this._viewsToDispose=[];this._accumulatingId=0;this._zrEventProxy=new f.a.graphic.Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:!0});this._backgroundColor=null},s;r.prototype.addView=function(n){var t,i;n.layer!==this&&(t=this._viewsToDispose.indexOf(n),t>=0&&this._viewsToDispose.splice(t,1),this.views.push(n),n.layer=this,i=this.zr,n.scene.traverse(function(n){n.__zr=i;n.addAnimatorsToZr&&n.addAnimatorsToZr(i)}))};r.prototype.removeView=function(n){if(n.layer===this){var t=this.views.indexOf(n);t>=0&&(this.views.splice(t,1),n.scene.traverse(o,this),n.layer=null,this._viewsToDispose.push(n))}};r.prototype.removeViewsAll=function(){this.views.forEach(function(n){n.scene.traverse(o,this);n.layer=null;this._viewsToDispose.push(n)},this);this.views.length=0};r.prototype.resize=function(n,t){var i=this.renderer;i.resize(n,t)};r.prototype.clear=function(){var n=this.renderer.gl,t=this._backgroundColor||[0,0,0,0];n.clearColor(t[0],t[1],t[2],t[3]);n.depthMask(!0);n.colorMask(!0,!0,!0,!0);n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT)};r.prototype.clearDepth=function(){var n=this.renderer.gl;n.clear(n.DEPTH_BUFFER_BIT)};r.prototype.clearColor=function(){var n=this.renderer.gl;n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)};r.prototype.needsRefresh=function(){this.zr.refresh()};r.prototype.refresh=function(n){var t;for(this._backgroundColor=n?y.a.parseColor(n):[0,0,0,0],this.renderer.clearColor=this._backgroundColor,t=0;t<this.views.length;t++)this.views[t].prepareRender(this.renderer);for(this._doRender(!1),this._trackAndClean(),t=0;t<this._viewsToDispose.length;t++)this._viewsToDispose[t].dispose(this.renderer);this._viewsToDispose.length=0;this._startAccumulating()};r.prototype.renderToCanvas=function(n){this._startAccumulating(!0);n.drawImage(this.dom,0,0,n.canvas.width,n.canvas.height)};r.prototype._doRender=function(n){this.clear();this.renderer.saveViewport();for(var t=0;t<this.views.length;t++)this.views[t].render(this.renderer,n);this.renderer.restoreViewport()};r.prototype._stopAccumulating=function(){this._accumulatingId=0;clearTimeout(this._accumulatingTimeout)};s=1;r.prototype._startAccumulating=function(n){function u(r){var e,f;if(t._accumulatingId&&r===t._accumulatingId){for(e=!0,f=0;f<t.views.length;f++)e=t.views[f].isAccumulateFinished()&&i;e||(t._doRender(!0),n?u(r):b()(function(){u(r)}))}}var t=this,i,r;for(this._stopAccumulating(),i=!1,r=0;r<this.views.length;r++)i=this.views[r].needsAccumulate()||i;i&&(this._accumulatingId=s++,n?u(t._accumulatingId):this._accumulatingTimeout=setTimeout(function(){u(t._accumulatingId)},50))};r.prototype._trackAndClean=function(){var t=[],i=[],n;for(this._textureList&&(h(this._textureList),h(this._geometriesList)),n=0;n<this.views.length;n++)k(this.views[n].scene,t,i);this._textureList&&(c(this.renderer,this._textureList),c(this.renderer,this._geometriesList));this._textureList=t;this._geometriesList=i};r.prototype.dispose=function(){this._stopAccumulating();this.renderer.disposeScene(this.scene);this.zr.off("globalout",this.onglobalout)};r.prototype.onmousedown=function(n){if(!n.target||!n.target.__isGLToZRProxy){n=n.event;var t=this.pickObject(n.offsetX,n.offsetY);t&&(this._dispatchEvent("mousedown",n,t),this._dispatchDataEvent("mousedown",n,t));this._downX=n.offsetX;this._downY=n.offsetY}};r.prototype.onmousemove=function(n){if(!n.target||!n.target.__isGLToZRProxy){n=n.event;var t=this.pickObject(n.offsetX,n.offsetY),r=t&&t.target,i=this._hovered;this._hovered=t;i&&r!==i.target&&(i.relatedTarget=r,this._dispatchEvent("mouseout",n,i),this.zr.setCursorStyle("default"));this._dispatchEvent("mousemove",n,t);t&&(this.zr.setCursorStyle("pointer"),i&&r===i.target||this._dispatchEvent("mouseover",n,t));this._dispatchDataEvent("mousemove",n,t)}};r.prototype.onmouseup=function(n){if(!n.target||!n.target.__isGLToZRProxy){n=n.event;var t=this.pickObject(n.offsetX,n.offsetY);t&&(this._dispatchEvent("mouseup",n,t),this._dispatchDataEvent("mouseup",n,t));this._upX=n.offsetX;this._upY=n.offsetY}};r.prototype.onclick=r.prototype.dblclick=function(n){var r,u,t,i,f;n.target&&n.target.__isGLToZRProxy||(r=this._upX-this._downX,u=this._upY-this._downY,Math.sqrt(r*r+u*u)>20)||(n=n.event,t=this.pickObject(n.offsetX,n.offsetY),t&&(this._dispatchEvent(n.type,n,t),this._dispatchDataEvent(n.type,n,t)),i=this._clickToSetFocusPoint(n),i&&(f=i.view.setDOFFocusOnPoint(i.distance),f&&this.zr.refresh()))};r.prototype._clickToSetFocusPoint=function(n){for(var t,i,r=this.renderer,f=r.viewport,u=this.views.length-1;u>=0;u--)if(t=this.views[u],t.hasDOF()&&t.containPoint(n.offsetX,n.offsetY)&&(this._picking.scene=t.scene,this._picking.camera=t.camera,r.viewport=t.viewport,i=this._picking.pick(n.offsetX,n.offsetY,!0),i))return i.view=t,i;r.viewport=f};r.prototype.onglobalout=function(n){var t=this._hovered;t&&this._dispatchEvent("mouseout",n,{target:t.target})};r.prototype.pickObject=function(n,t){for(var i,r=[],u=this.renderer,e=u.viewport,f=0;f<this.views.length;f++)i=this.views[f],i.containPoint(n,t)&&(this._picking.scene=i.scene,this._picking.camera=i.camera,u.viewport=i.viewport,this._picking.pickAll(n,t,r));return u.viewport=e,r.sort(function(n,t){return n.distance-t.distance}),r[0]};r.prototype._dispatchEvent=function(n,t,i){i||(i={});var r=i.target;for(i.cancelBubble=!1,i.event=t,i.type=n,i.offsetX=t.offsetX,i.offsetY=t.offsetY;r;)if(r.trigger(n,i),r=r.getParent(),i.cancelBubble)break;this._dispatchToView(n,i)};r.prototype._dispatchDataEvent=function(n,t,i){var u=i&&i.target,f=u&&u.dataIndex,s=u&&u.seriesIndex,e=u&&u.eventData,h=!1,r=this._zrEventProxy,o;r.position=[t.offsetX,t.offsetY];r.update();o={target:r};n==="mousemove"&&(f!=null?f!==this._lastDataIndex&&(parseInt(this._lastDataIndex,10)>=0&&(r.dataIndex=this._lastDataIndex,r.seriesIndex=this._lastSeriesIndex,this.zr.handler.dispatchToElement(o,"mouseout",t)),h=!0):e!=null&&e!==this._lastEventData&&(this._lastEventData!=null&&(r.eventData=this._lastEventData,this.zr.handler.dispatchToElement(o,"mouseout",t)),h=!0),this._lastEventData=e,this._lastDataIndex=f,this._lastSeriesIndex=s);r.eventData=e;r.dataIndex=f;r.seriesIndex=s;(e!=null||parseInt(f,10)>=0&&parseInt(s,10)>=0)&&(this.zr.handler.dispatchToElement(o,n,t),h&&this.zr.handler.dispatchToElement(o,"mouseover",t))};r.prototype._dispatchToView=function(n,t){for(var i=0;i<this.views.length;i++)this.views[i].containPoint(t.offsetX,t.offsetY)&&this.views[i].trigger(n,t)};f.a.util.extend(r.prototype,p.a);t.a=r},function(n,t){"use strict";function i(n,t,i){var e,o,s,f,h;if(typeof t=="object"&&(i=t,t=null),e=this,!(n instanceof Function)){o=[];for(s in n)n.hasOwnProperty(s)&&o.push(s)}return f=function(t){var s,i;if(e.apply(this,arguments),n instanceof Function?r(this,n.call(this,t)):u(this,n,o),this.constructor===f)for(s=f.__initializers__,i=0;i<s.length;i++)s[i].apply(this,arguments)},f.__super__=e,f.__initializers__=e.__initializers__?e.__initializers__.slice():[],t&&f.__initializers__.push(t),h=function(){},h.prototype=e.prototype,f.prototype=new h,f.prototype.constructor=f,r(f.prototype,i),f.extend=e.extend,f.derive=e.extend,f}function r(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}function u(n,t,i){for(var u,r=0;r<i.length;r++)u=i[r],n[u]=t[u]}t.a={extend:i,derive:i}},function(n,t){"use strict";function u(n){function s(t){var i=n.getExtension(t);i||(i=n.getExtension("MOZ_"+t));i||(i=n.getExtension("WEBKIT_"+t));u[t]=i}for(var o,f,u={},e={},t=0;t<i.length;t++)o=i[t],s(o);for(t=0;t<r.length;t++)f=r[t],e[f]=n.getParameter(n[f]);this.getExtension=function(n){return n in u||s(n),u[n]};this.getParameter=function(n){return e[n]};this.getMaxJointNumber=function(){return 15}}var i=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB"],r=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];t.a=u},function(n,t){"use strict";function i(n){var t=new XMLHttpRequest;t.open("get",n.url);t.responseType=n.responseType||"text";n.onprogress&&(t.onprogress=function(t){if(t.lengthComputable){var i=t.loaded/t.total;n.onprogress(i,t.loaded,t.total)}else n.onprogress(null)});t.onload=function(){t.status>=400?n.onerror&&n.onerror():n.onload&&n.onload(t.response)};n.onerror&&(t.onerror=n.onerror);t.send(null)}t.a={get:i}},function(n,t,i){"use strict";function u(n){return n=Math.round(n),n<0?0:n>255?255:n}function k(n){return n=Math.round(n),n<0?0:n>360?360:n}function h(n){return n<0?0:n>1?1:n}function l(n){return n.length&&n.charAt(n.length-1)==="%"?u(parseFloat(n)/100*255):u(parseInt(n,10))}function o(n){return n.length&&n.charAt(n.length-1)==="%"?h(parseFloat(n)/100):h(parseFloat(n))}function a(n,t,i){return(i<0?i+=1:i>1&&(i-=1),i*6<1)?n+(t-n)*i*6:i*2<1?t:i*3<2?n+(t-n)*(2/3-i)*6:n}function e(n,t,i){return n+(t-n)*i}function f(n,t,i,r,u){return n[0]=t,n[1]=i,n[2]=r,n[3]=u,n}function v(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function s(n,t){c&&v(c,t);c=w.put(n,c||t.slice())}function y(n,t){var e=(parseFloat(n[0])%360+360)%360/360,s=o(n[1]),i=o(n[2]),r=i<=.5?i*(s+1):i+s-i*s,h=i*2-r;return t=t||[],f(t,u(a(h,r,e+1/3)*255),u(a(h,r,e)*255),u(a(h,r,e-1/3)*255),1),n.length===4&&(t[3]=n[3]),t}function d(n){var h;if(n){var u=n[0]/255,f=n[1]/255,e=n[2]/255,o=Math.min(u,f,e),t=Math.max(u,f,e),i=t-o,c=(t+o)/2,r,s;if(i===0)r=0,s=0;else{s=c<.5?i/(t+o):i/(2-t-o);var l=((t-u)/6+i/2)/i,a=((t-f)/6+i/2)/i,v=((t-e)/6+i/2)/i;u===t?r=v-a:f===t?r=1/3+l-v:e===t&&(r=2/3+a-l);r<0&&(r+=1);r>1&&(r-=1)}return h=[r*360,s,c],n[3]!=null&&h.push(n[3]),h}}var b=i(69),r={},p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},w=new b.a(20),c=null;r.parse=function(n,t){var h,r,i,e,c;if(n){if(t=t||[],h=w.get(n),h)return v(t,h);if(n=n+"",r=n.replace(/ /g,"").toLowerCase(),r in p)return v(t,p[r]),s(n,t),t;if(r.charAt(0)==="#"){if(r.length===4){if(i=parseInt(r.substr(1),16),!(i>=0&&i<=4095)){f(t,0,0,0,1);return}return f(t,(i&3840)>>4|(i&3840)>>8,i&240|(i&240)>>4,i&15|(i&15)<<4,1),s(n,t),t}if(r.length===7){if(i=parseInt(r.substr(1),16),!(i>=0&&i<=16777215)){f(t,0,0,0,1);return}return f(t,(i&16711680)>>16,(i&65280)>>8,i&255,1),s(n,t),t}return}if(e=r.indexOf("("),c=r.indexOf(")"),e!==-1&&c+1===r.length){var b=r.substr(0,e),u=r.substr(e+1,c-(e+1)).split(","),a=1;switch(b){case"rgba":if(u.length!==4){f(t,0,0,0,1);return}a=o(u.pop());case"rgb":if(u.length!==3){f(t,0,0,0,1);return}return f(t,l(u[0]),l(u[1]),l(u[2]),a),s(n,t),t;case"hsla":if(u.length!==4){f(t,0,0,0,1);return}return u[3]=o(u[3]),y(u,t),s(n,t),t;case"hsl":if(u.length!==3){f(t,0,0,0,1);return}return y(u,t),s(n,t),t;default:return}}f(t,0,0,0,1);return}};r.parseToFloat=function(n,t){if(t=r.parse(n,t),t)return t[0]/=255,t[1]/=255,t[2]/=255,t};r.lift=function(n,t){var i=r.parse(n),u;if(i){for(u=0;u<3;u++)i[u]=t<0?i[u]*(1-t)|0:(255-i[u])*t+i[u]|0;return r.stringify(i,i.length===4?"rgba":"rgb")}};r.toHex=function(n){var t=r.parse(n);if(t)return(16777216+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)};r.fastLerp=function(n,t,i){if(t&&t.length&&n>=0&&n<=1){i=i||[];var s=n*(t.length-1),c=Math.floor(s),l=Math.ceil(s),r=t[c],f=t[l],o=s-c;return i[0]=u(e(r[0],f[0],o)),i[1]=u(e(r[1],f[1],o)),i[2]=u(e(r[2],f[2],o)),i[3]=h(e(r[3],f[3],o)),i}};r.fastMapToColor=r.fastLerp;r.lerp=function(n,t,i){if(t&&t.length&&n>=0&&n<=1){var f=n*(t.length-1),l=Math.floor(f),a=Math.ceil(f),o=r.parse(t[l]),s=r.parse(t[a]),c=f-l,v=r.stringify([u(e(o[0],s[0],c)),u(e(o[1],s[1],c)),u(e(o[2],s[2],c)),h(e(o[3],s[3],c))],"rgba");return i?{color:v,leftIndex:l,rightIndex:a,value:f}:v}};r.mapToColor=r.lerp;r.modifyHSL=function(n,t,i,u){return n=r.parse(n),n?(n=d(n),t!=null&&(n[0]=k(t)),i!=null&&(n[1]=o(i)),u!=null&&(n[2]=o(u)),r.stringify(y(n),"rgba")):void 0};r.modifyAlpha=function(n,t){return n=r.parse(n),n&&t!=null?(n[3]=h(t),r.stringify(n,"rgba")):void 0};r.stringify=function(n,t){if(n&&n.length){var i=n[0]+","+n[1]+","+n[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(i+=","+n[3]),t+"("+i+")"}};t.a=r},function(n,t){"use strict";var i=function(){this.head=null;this.tail=null;this._length=0};i.prototype.insert=function(n){var t=new i.Entry(n);return this.insertEntry(t),t};i.prototype.insertAt=function(n,t){var r,e,u,f;if(!(n<0)){for(r=this.head,e=0;r&&e!=n;)r=r.next,e++;r?(u=new i.Entry(t),f=r.prev,f?(f.next=u,u.prev=f):this.head=u,u.next=r,r.prev=u):this.insert(t)}};i.prototype.insertBeforeEntry=function(n,t){var r=new i.Entry(n),u=t.prev;u?(u.next=r,r.prev=u):this.head=r;r.next=t;t.prev=r;this._length++};i.prototype.insertEntry=function(n){this.head?(this.tail.next=n,n.prev=this.tail,this.tail=n):this.head=this.tail=n;this._length++};i.prototype.remove=function(n){var t=n.prev,i=n.next;t?t.next=i:this.head=i;i?i.prev=t:this.tail=t;n.next=n.prev=null;this._length--};i.prototype.removeAt=function(n){if(!(n<0)){for(var t=this.head,i=0;t&&i!=n;)t=t.next,i++;if(t)return this.remove(t),t.value}};i.prototype.getHead=function(){if(this.head)return this.head.value};i.prototype.getTail=function(){if(this.tail)return this.tail.value};i.prototype.getAt=function(n){if(!(n<0)){for(var t=this.head,i=0;t&&i!=n;)t=t.next,i++;return t.value}};i.prototype.indexOf=function(n){for(var t=this.head,i=0;t;){if(t.value===n)return i;t=t.next;i++}};i.prototype.length=function(){return this._length};i.prototype.isEmpty=function(){return this._length===0};i.prototype.forEach=function(n,t){for(var i=this.head,r=0,u=typeof t!="undefined";i;)u?n.call(t,i.value,r):n(i.value,r),i=i.next,r++};i.prototype.clear=function(){this.tail=this.head=null;this._length=0};i.Entry=function(n){this.value=n;this.next=null;this.prev=null};t.a=i},function(n,t,i){"use strict";function u(n,t,i){function f(n,i,u,f){var o="",e;for(isNaN(i)&&(i=i in t?t[i]:r[i]),isNaN(u)&&(u=u in t?t[u]:r[u]),e=parseInt(i);e<parseInt(u);e++)o+="{"+f.replace(/float\s*\(\s*_idx_\s*\)/g,e.toFixed(1)).replace(/_idx_/g,e)+"}";return o}var r={};for(var u in i)r[u+"_COUNT"]=i[u];return n.replace(o,f)}function r(n,t,i){var u=[],e,o,f,r,s;if(t)for(e in t)o=t[e],o>0&&u.push("#define "+e.toUpperCase()+"_COUNT "+o);if(i)for(f=0;f<i.length;f++)r=i[f],u.push("#define "+r.toUpperCase()+"_ENABLED");for(r in n)s=n[r],s===null?u.push("#define "+r):u.push("#define "+r+" "+s.toString());return u.join("\n")}function s(n){for(var i=[],t=0;t<n.length;t++)i.push("#extension GL_"+n[t]+" : enable");return i.join("\n")}function h(n){return["precision",n,"float"].join(" ")+";\n"+["precision",n,"int"].join(" ")+";\n"+["precision",n,"sampler2D"].join(" ")+";\n"}function f(n){this._renderer=n;this._cache={}}var e=i(116),o=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;f.prototype.getProgram=function(n,t,i){var w=this._cache,b=n.isSkinnedMesh&&n.isSkinnedMesh(),o="s"+t.shader.shaderID+"m"+t.getProgramKey(),f,v,d;if(i&&(o+="se"+i.getProgramKey(n.lightGroup)),b&&(o+=","+n.joints.length),f=w[o],f)return f;var c=i?i.getLightsNumbers(n.lightGroup):{},l=this._renderer,g=l.gl,k=t.getEnabledTextures(),a="";b&&(v={SKINNING:null,JOINT_COUNT:n.joints.length},n.joints.length>l.getMaxJointNumber()&&(v.USE_SKIN_MATRICES_TEXTURE=null),a="\n"+r(v)+"\n");var nt=a+r(t.vertexDefines,c,k),y=a+r(t.fragmentDefines,c,k),tt=nt+"\n"+t.shader.vertex,p=["OES_standard_derivatives","EXT_shader_texture_lod"].filter(function(n){return l.getGLExtension(n)!=null});p.indexOf("EXT_shader_texture_lod")>=0&&(y+="\n#define SUPPORT_TEXTURE_LOD");p.indexOf("OES_standard_derivatives")>=0&&(y+="\n#define SUPPORT_STANDARD_DERIVATIVES");var it=s(p)+"\n"+h(t.precision)+"\n"+y+"\n"+t.shader.fragment,rt=u(tt,t.vertexDefines,c),ut=u(it,t.fragmentDefines,c),f=new e.a;return f.uniformSemantics=t.shader.uniformSemantics,f.attributes=t.shader.attributes,d=f.buildProgram(g,t.shader,rt,ut),f.__error=d,w[o]=f,f};t.a=f},function(n,t,i){"use strict";function l(n){for(var i=n.split("\n"),t=0,r=i.length;t<r;t++)i[t]=t+1+": "+i[t];return i.join("\n")}function s(n,t,i){if(!n.getShaderParameter(t,n.COMPILE_STATUS))return[n.getShaderInfoLog(t),l(i)].join("\n")}var u=i(14),c=i(7),f=1,e=2,r=3,o={},h=new u.a.Float32Array(16),a=c.a.extend({uniformSemantics:{},attributes:{}},function(){this._locations={};this._textureSlot=0;this._program=null},{bind:function(n){this._textureSlot=0;n.gl.useProgram(this._program)},hasUniform:function(n){var t=this._locations[n];return t!==null&&t!==undefined},useTextureSlot:function(n,t,i){t&&(n.gl.activeTexture(n.gl.TEXTURE0+i),t.isRenderable()?t.bind(n):t.unbind(n))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(n){this._textureSlot=n||0},takeCurrentTextureSlot:function(n,t){var i=this._textureSlot;return this.useTextureSlot(n,t,i),this._textureSlot++,i},setUniform:function(n,t,i,r){var a=this._locations,f=a[i],s,c,e,l,o;if(f===null||f===undefined)return!1;switch(t){case"m4":if(!(r instanceof Float32Array)){for(e=0;e<r.length;e++)h[e]=r[e];r=h}n.uniformMatrix4fv(f,!1,r);break;case"2i":n.uniform2i(f,r[0],r[1]);break;case"2f":n.uniform2f(f,r[0],r[1]);break;case"3i":n.uniform3i(f,r[0],r[1],r[2]);break;case"3f":n.uniform3f(f,r[0],r[1],r[2]);break;case"4i":n.uniform4i(f,r[0],r[1],r[2],r[3]);break;case"4f":n.uniform4f(f,r[0],r[1],r[2],r[3]);break;case"1i":n.uniform1i(f,r);break;case"1f":n.uniform1f(f,r);break;case"1fv":n.uniform1fv(f,r);break;case"1iv":n.uniform1iv(f,r);break;case"2iv":n.uniform2iv(f,r);break;case"2fv":n.uniform2fv(f,r);break;case"3iv":n.uniform3iv(f,r);break;case"3fv":n.uniform3fv(f,r);break;case"4iv":n.uniform4iv(f,r);break;case"4fv":n.uniform4fv(f,r);break;case"m2":case"m2v":n.uniformMatrix2fv(f,!1,r);break;case"m3":case"m3v":n.uniformMatrix3fv(f,!1,r);break;case"m4v":if(Array.isArray(r)&&Array.isArray(r[0])){for(s=new u.a.Float32Array(r.length*16),c=0,e=0;e<r.length;e++)for(l=r[e],o=0;o<16;o++)s[c++]=l[o];n.uniformMatrix4fv(f,!1,s)}else n.uniformMatrix4fv(f,!1,r)}return!0},setUniformOfSemantic:function(n,t,i){var r=this.uniformSemantics[t];return r?this.setUniform(n,r.type,r.symbol,i):!1},enableAttributes:function(n,t,i){var a=n.gl,y=this._program,v=this._locations,s,c,l,h,u;for(s=i?i.__enabledAttributeList:o[n.__uid__],s||(s=i?i.__enabledAttributeList=[]:o[n.__uid__]=[]),c=[],u=0;u<t.length;u++){if(l=t[u],!this.attributes[l]){c[u]=-1;continue}if(h=v[l],h==null){if(h=a.getAttribLocation(y,l),h===-1){c[u]=-1;continue}v[l]=h}c[u]=h;s[h]=s[h]?e:f}for(u=0;u<s.length;u++)switch(s[u]){case f:a.enableVertexAttribArray(u);s[u]=r;break;case e:s[u]=r;break;case r:a.disableVertexAttribArray(u);s[u]=0}return c},buildProgram:function(n,t,i,r){var e=n.createShader(n.VERTEX_SHADER),u=n.createProgram(),f,o,l,h,c;if((n.shaderSource(e,i),n.compileShader(e),f=n.createShader(n.FRAGMENT_SHADER),n.shaderSource(f,r),n.compileShader(f),o=s(n,e,i),o)||(o=s(n,f,r),o))return o;if(n.attachShader(u,e),n.attachShader(u,f),t.attributeSemantics.POSITION?n.bindAttribLocation(u,0,t.attributeSemantics.POSITION.symbol):(l=Object.keys(this.attributes),n.bindAttribLocation(u,0,l[0])),n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS))return"Could not link program\n"+n.getProgramInfoLog(u);for(h=0;h<t.uniforms.length;h++)c=t.uniforms[h],this._locations[c]=n.getUniformLocation(u,c);n.deleteShader(e);n.deleteShader(f);this._program=u;this.vertexCode=i;this.fragmentCode=r}});t.a=a},function(n,t,i){"use strict";var h=i(7),o=i(54),c=i(26),r=i(3),s=i(9),l=i(72),u=i(11),f=i(12),e=h.a.extend({scene:null,camera:null,renderer:null},function(){this._ray=new o.a;this._ndc=new c.a},{pick:function(n,t,i){var r=this.pickAll(n,t,[],i);return r[0]||null},pickAll:function(n,t,i,r){return this.renderer.screenToNDC(n,t,this._ndc),this.camera.castRay(this._ndc,this._ray),i=i||[],this._intersectNode(this.scene,i,r||!1),i.sort(this._intersectionCompareFunc),i},_intersectNode:function(n,t,i){n instanceof l.a&&n.isRenderable()&&(!n.ignorePicking||i)&&(n.mode===u.a.TRIANGLES&&n.geometry.isUseIndices()||n.geometry.pickByRay||n.geometry.pick)&&this._intersectRenderable(n,t);for(var r=0;r<n._children.length;r++)this._intersectNode(n._children[r],t,i)},_intersectRenderable:function(){var t=new r.a,i=new r.a,h=new r.a,n=new o.a,c=new s.a;return function(o,l){var w=o.isSkinnedMesh(),v,rt,y,a,g;if(n.copy(this._ray),s.a.invert(c,o.worldTransform),w||n.applyTransform(c),v=o.geometry,rt=w?o.skeleton.boundingBox:v.boundingBox,!rt||n.intersectBoundingBox(rt)){if(v.pick){v.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,o,l);return}if(v.pickByRay){v.pickByRay(n,o,l);return}var at=o.cullFace===u.a.BACK&&o.frontFace===u.a.CCW||o.cullFace===u.a.FRONT&&o.frontFace===u.a.CW,b,k=v.indices,nt=v.attributes.position,vt=v.attributes.weight,yt=v.attributes.joint,et,tt=[];if(nt&&nt.value&&k){if(w){for(et=o.skeleton.getSubSkinMatrices(o.__uid__,o.joints),a=0;a<o.joints.length;a++)for(tt[a]=tt[a]||[],y=0;y<16;y++)tt[a][y]=et[a*16+y];var ot=[],p=[],ut=[],it=[],st=[],d=v.attributes.skinnedPosition;for(d&&d.value||(v.createAttribute("skinnedPosition","f",3),d=v.attributes.skinnedPosition,d.init(v.vertexCount)),a=0;a<v.vertexCount;a++){for(nt.get(a,ot),vt.get(a,p),yt.get(a,ut),p[3]=1-p[0]-p[1]-p[2],f.a.set(it,0,0,0),y=0;y<4;y++)ut[y]>=0&&p[y]>.0001&&(f.a.transformMat4(st,ot,tt[ut[y]]),f.a.scaleAndAdd(it,it,st,p[y]));d.set(a,it)}}for(a=0;a<k.length;a+=3){var ht=k[a],ct=k[a+1],lt=k[a+2],ft=w?v.attributes.skinnedPosition:nt;ft.get(ht,t.array);ft.get(ct,i.array);ft.get(lt,h.array);b=at?n.intersectTriangle(t,i,h,o.culling):n.intersectTriangle(t,h,i,o.culling);b&&(g=new r.a,w?r.a.copy(g,b):r.a.transformMat4(g,b,o.worldTransform),l.push(new e.Intersection(b,g,o,[ht,ct,lt],a/3,r.a.dist(g,this._ray.origin))))}}}}}(),_intersectionCompareFunc:function(n,t){return n.distance-t.distance}});e.Intersection=function(n,t,i,r,u,f){this.point=n;this.pointWorld=t;this.target=i;this.triangle=r;this.triangleIndex=u;this.distance=f};t.a=e},function(n,t,i){"use strict";function s(n){return{byte:f.a.Int8Array,ubyte:f.a.Uint8Array,short:f.a.Int16Array,ushort:f.a.Uint16Array}[n]||f.a.Float32Array}function o(n){return"attr_"+n}function e(n,t,i,r){this.name=n;this.type=t;this.size=i;this.semantic=r||"";this.value=null;switch(i){case 1:this.get=function(n){return this.value[n]};this.set=function(n,t){this.value[n]=t};this.copy=function(n){this.value[n]=this.value[n]};break;case 2:this.get=function(n,t){var i=this.value;return t[0]=i[n*2],t[1]=i[n*2+1],t};this.set=function(n,t){var i=this.value;i[n*2]=t[0];i[n*2+1]=t[1]};this.copy=function(n,t){var i=this.value;t*=2;n*=2;i[n]=i[t];i[n+1]=i[t+1]};break;case 3:this.get=function(n,t){var i=n*3,r=this.value;return t[0]=r[i],t[1]=r[i+1],t[2]=r[i+2],t};this.set=function(n,t){var i=n*3,r=this.value;r[i]=t[0];r[i+1]=t[1];r[i+2]=t[2]};this.copy=function(n,t){var i=this.value;t*=3;n*=3;i[n]=i[t];i[n+1]=i[t+1];i[n+2]=i[t+2]};break;case 4:this.get=function(n,t){var i=this.value,r=n*4;return t[0]=i[r],t[1]=i[r+1],t[2]=i[r+2],t[3]=i[r+3],t};this.set=function(n,t){var i=this.value,r=n*4;i[r]=t[0];i[r+1]=t[1];i[r+2]=t[2];i[r+3]=t[3]};this.copy=function(n,t){var i=this.value;t*=4;n*=4;i[n]=i[t];i[n+1]=i[t+1];i[n+2]=i[t+2];i[n+3]=i[t+3]}}}function h(n,t,i,r,u){this.name=n;this.type=t;this.buffer=i;this.size=r;this.semantic=u;this.symbol="";this.needsRemove=!1}function c(n){this.buffer=n;this.count=0}var l=i(7),u=i(11),a=i(57),f=i(14),r;e.prototype.init=function(n){if(!this.value||this.value.length!=n*this.size){var t=s(this.type);this.value=new t(n*this.size)}};e.prototype.fromArray=function(n){var f=s(this.type),t,e,u,i,r;if(n[0]&&n[0].length)for(e=0,u=this.size,t=new f(n.length*u),i=0;i<n.length;i++)for(r=0;r<u;r++)t[e++]=n[i][r];else t=new f(n);this.value=t};e.prototype.clone=function(n){var t=new e(this.name,this.type,this.size,this.semantic);return n&&console.warn("todo"),t};r=l.a.extend(function(){return{attributes:{},indices:null,dynamic:!0,_enabledAttributes:null,__used:0}},function(){this._cache=new a.a;this._attributeList=Object.keys(this.attributes);this.__vaoCache={}},{mainAttribute:"",pick:null,pickByRay:null,dirty:function(){for(var t=this.getEnabledAttributes(),n=0;n<t.length;n++)this.dirtyAttribute(t[n]);this.dirtyIndices();this._enabledAttributes=null;this._cache.dirty("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(n){this._cache.dirtyAll(o(n));this._cache.dirtyAll("attributes")},getTriangleIndices:function(n,t){if(n<this.triangleCount&&n>=0){t||(t=[]);var i=this.indices;return t[0]=i[n*3],t[1]=i[n*3+1],t[2]=i[n*3+2],t}},setTriangleIndices:function(n,t){var i=this.indices;i[n*3]=t[0];i[n*3+1]=t[1];i[n*3+2]=t[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(n){var t,e=this.vertexCount>65535?f.a.Uint32Array:f.a.Uint16Array,o,u,i,r;if(n[0]&&n[0].length)for(o=0,u=3,t=new e(n.length*u),i=0;i<n.length;i++)for(r=0;r<u;r++)t[o++]=n[i][r];else t=new e(n);this.indices=t},createAttribute:function(n,t,i,r){var u=new e(n,t,i,r);return this.attributes[n]&&this.removeAttribute(n),this.attributes[n]=u,this._attributeList.push(n),u},removeAttribute:function(n){var t=this._attributeList,i=t.indexOf(n);return i>=0?(t.splice(i,1),delete this.attributes[n],!0):!1},getAttribute:function(n){return this.attributes[n]},getEnabledAttributes:function(){var u=this._enabledAttributes,f=this._attributeList,n,e,t,r,i;if(u)return u;for(n=[],e=this.vertexCount,t=0;t<f.length;t++)r=f[t],i=this.attributes[r],i.value&&i.value.length===e*i.size&&n.push(r);return this._enabledAttributes=n,n},getBufferChunks:function(n){var t=this._cache,r,u,f,i;if(t.use(n.__uid__),r=t.isDirty("attributes"),u=t.isDirty("indices"),r||u){for(this._updateBuffer(n.gl,r,u),f=this.getEnabledAttributes(),i=0;i<f.length;i++)t.fresh(o(f[i]));t.fresh("attributes");t.fresh("indices")}return t.fresh("any"),t.get("chunks")},_updateBuffer:function(n,t,i){var p=this._cache,s=p.get("chunks"),l=!1,b,k,e,v,y,d,g,r;s||(s=[],s[0]={attributeBuffers:[],indicesBuffer:null},p.put("chunks",s),l=!0);var w=s[0],f=w.attributeBuffers,a=w.indicesBuffer;if(t||l){if(b=this.getEnabledAttributes(),k={},!l)for(r=0;r<f.length;r++)k[f[r].name]=f[r];for(e=0;e<b.length;e++)v=b[e],y=this.attributes[v],l||(d=k[v]),g=d?d.buffer:n.createBuffer(),p.isDirty(o(v))&&(n.bindBuffer(n.ARRAY_BUFFER,g),n.bufferData(n.ARRAY_BUFFER,y.value,this.dynamic?u.a.DYNAMIC_DRAW:u.a.STATIC_DRAW)),f[e]=new h(v,y.type,g,y.size,y.semantic);for(r=e;r<f.length;r++)n.deleteBuffer(f[r].buffer);f.length=e}this.isUseIndices()&&(i||l)&&(a||(a=new c(n.createBuffer()),w.indicesBuffer=a),a.count=this.indices.length,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?u.a.DYNAMIC_DRAW:u.a.STATIC_DRAW))},dispose:function(n){var f=this._cache,i,r,t,u,o,s,h,e;if(f.use(n.__uid__),i=f.get("chunks"),i)for(r=0;r<i.length;r++){for(t=i[r],u=0;u<t.attributeBuffers.length;u++)o=t.attributeBuffers[u],n.gl.deleteBuffer(o.buffer);t.indicesBuffer&&n.gl.deleteBuffer(t.indicesBuffer.buffer)}if(this.__vaoCache){s=n.getGLExtension("OES_vertex_array_object");for(h in this.__vaoCache)e=this.__vaoCache[h].vao,e&&s.deleteVertexArrayOES(e)}this.__vaoCache={};f.deleteContext(n.__uid__)}});Object.defineProperty&&(Object.defineProperty(r.prototype,"vertexCount",{enumerable:!1,get:function(){var n=this.attributes[this.mainAttribute];return(n||(n=this.attributes[this._attributeList[0]]),!n||!n.value)?0:n.value.length/n.size}}),Object.defineProperty(r.prototype,"triangleCount",{enumerable:!1,get:function(){var n=this.indices;return n?n.length/3:0}}));r.STATIC_DRAW=u.a.STATIC_DRAW;r.DYNAMIC_DRAW=u.a.DYNAMIC_DRAW;r.STREAM_DRAW=u.a.STREAM_DRAW;r.AttributeBuffer=h;r.IndicesBuffer=c;r.Attribute=e;t.a=r},function(n,t,i){"use strict";var s=i(120),u="uniform vec3 ",o="uniform float ",f="@export clay.header.",e="@end",r=":unconfigurable;";t.a=[f+"directional_light",u+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+r,u+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+r,e,f+"ambient_light",u+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+r,e,f+"ambient_sh_light",u+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+r,u+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+r,s.a,e,f+"ambient_cubemap_light",u+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+r,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+r,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+r,e,f+"point_light",u+"pointLightPosition[POINT_LIGHT_COUNT]"+r,o+"pointLightRange[POINT_LIGHT_COUNT]"+r,u+"pointLightColor[POINT_LIGHT_COUNT]"+r,e,f+"spot_light",u+"spotLightPosition[SPOT_LIGHT_COUNT]"+r,u+"spotLightDirection[SPOT_LIGHT_COUNT]"+r,o+"spotLightRange[SPOT_LIGHT_COUNT]"+r,o+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+r,o+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+r,o+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+r,u+"spotLightColor[SPOT_LIGHT_COUNT]"+r,e].join("\n")},function(n,t){"use strict";t.a="vec3 calcAmbientSHLight(int idx, vec3 N) {\n int offset = 9 * idx;\n return ambientSHLightCoefficients[0]\n + ambientSHLightCoefficients[1] * N.x\n + ambientSHLightCoefficients[2] * N.y\n + ambientSHLightCoefficients[3] * N.z\n + ambientSHLightCoefficients[4] * N.x * N.z\n + ambientSHLightCoefficients[5] * N.z * N.y\n + ambientSHLightCoefficients[6] * N.y * N.x\n + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\n + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);\n}"},function(n,t){"use strict";t.a="@export clay.skybox.vertex\n#define SHADER_NAME skybox\nuniform mat4 world : WORLD;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nvarying vec3 v_WorldPosition;\nvoid main()\n{\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end\n@export clay.skybox.fragment\n#define PI 3.1415926\nuniform mat4 viewInverse : VIEWINVERSE;\n#ifdef EQUIRECTANGULAR\nuniform sampler2D environmentMap;\n#else\nuniform samplerCube environmentMap;\n#endif\nuniform float lod: 0.0;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\n@import clay.util.srgb\n@import clay.util.ACES\nvoid main()\n{\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n#ifdef EQUIRECTANGULAR\n float phi = acos(V.y);\n float theta = atan(-V.x, V.z) + PI * 0.5;\n vec2 uv = vec2(theta / 2.0 / PI, phi / PI);\n vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));\n#else\n #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)\n vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));\n #else\n vec4 texel = decodeHDR(textureCube(environmentMap, V));\n #endif\n#endif\n#ifdef SRGB_DECODE\n texel = sRGBToLinear(texel);\n#endif\n#ifdef TONEMAPPING\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n#ifdef SRGB_ENCODE\n texel = linearTosRGB(texel);\n#endif\n gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));\n}\n@end"},function(n,t,i){"use strict";function u(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<24)}var r=i(4),f=i(5),rt=i(27),e=542327876,o=131072,s=512,h=4,c=31,l=u("DXT1"),a=u("DXT3"),v=u("DXT5"),y=0,p=1,w=2,b=3,k=4,d=7,g=20,nt=21,tt=28,it={parse:function(n,t){var u=new Int32Array(n,0,c),i,it,ft,et,ot,st,ht,vt;if(u[y]!==e||!u(g)&h)return null;var yt=u(nt),pt=u[k],wt=u[b],bt=u[tt]&s,ct=u[w]&o,rt,ut;switch(yt){case l:rt=8;ut=r.a.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case a:rt=16;ut=r.a.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case v:rt=16;ut=r.a.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var lt=u[p]+4,kt=bt?6:1,at=1;for(ct&&(at=Math.max(1,u[d])),i=[],it=0;it<kt;it++){for(ft=pt,et=wt,i[it]=new f.a({width:ft,height:et,format:ut}),ot=[],st=0;st<at;st++)ht=Math.max(4,ft)/4*Math.max(4,et)/4*rt,vt=new Uint8Array(n,lt,ht),lt+=ht,ft*=.5,et*=.5,ot[st]=vt;i[it].pixels=ot[0];ct&&(i[it].mipmaps=ot)}if(t)t.width=i[0].width,t.height=i[0].height,t.format=i[0].format,t.pixels=i[0].pixels,t.mipmaps=i[0].mipmaps;else return i[0]}};t.a=it},function(n,t,i){"use strict";function h(n,t,i,r){if(n[3]>0){var u=Math.pow(2,n[3]-136+r);t[i+0]=n[0]*u;t[i+1]=n[1]*u;t[i+2]=n[2]*u}else t[i+0]=0,t[i+1]=0,t[i+2]=0;return t[i+3]=1,t}function c(n,t,i){for(var f="",u=t;u<i;u++)f+=r(n[u]);return f}function l(n,t){t[0]=n[0];t[1]=n[1];t[2]=n[2];t[3]=n[3]}function u(n,t,i,r){for(var f=0,u=0,e=r,o;e>0;)if(n[u][0]=t[i++],n[u][1]=t[i++],n[u][2]=t[i++],n[u][3]=t[i++],n[u][0]===1&&n[u][1]===1&&n[u][2]===1){for(o=n[u][3]<<f>>>0;o>0;o--)l(n[u-1],n[u]),u++,e--;f+=8}else u++,e--,f=0;return i}function a(n,t,i,r){var f,h,e,c;if(r<o|r>s)return u(n,t,i,r);if(f=t[i++],f!=2)return u(n,t,i-1,r);if(n[0][1]=t[i++],n[0][2]=t[i++],f=t[i++],(n[0][2]<<8>>>0|f)>>>0!==r)return null;for(f=0;f<4;f++)for(h=0;h<r;)if(e=t[i++],e>128)for(e=(e&127)>>>0,c=t[i++];e--;)n[h++][f]=c;else while(e--)n[h++][f]=t[i++];return i}var f=i(4),e=i(5),r=String.fromCharCode,o=8,s=32767,v={parseRGBE:function(n,t,i){var s,y,u,k,d,v,b,g,nt,tt,w,o;if(i==null&&(i=0),s=new Uint8Array(n),y=s.length,c(s,0,2)==="#?"){for(u=2;u<y;u++)if(r(s[u])==="\n"&&r(s[u+1])==="\n")break;if(!(u>=y)){for(u+=2,k="";u<y;u++){if(d=r(s[u]),d==="\n")break;k+=d}var it=k.split(" "),p=parseInt(it[1]),l=parseInt(it[3]);if(l&&p){for(w=u+1,v=[],o=0;o<l;o++)for(v[o]=[],b=0;b<4;b++)v[o][b]=0;for(g=new Float32Array(l*p*4),nt=0,tt=0;tt<p;tt++){if(w=a(v,s,w,l),!w)return null;for(o=0;o<l;o++)h(v[o],g,nt,i),nt+=4}return t||(t=new e.a),t.width=l,t.height=p,t.pixels=g,t.type=f.a.FLOAT,t}}}},parseRGBEFromPNG:function(){}};t.a=v},function(n,t,i){"use strict";function e(n){return"_on"+n}var s=i(5),u=i(3),r=i(26),f=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","contextmenu"],o=function(n){var t=this;this._texture=new s.a({anisotropic:32,flipY:!1,surface:this,dispose:function(n){t.dispose();s.a.prototype.dispose.call(this,n)}});f.forEach(function(n){this[e(n)]=function(t){t.triangle&&this._meshes.forEach(function(i){this.dispatchEvent(n,i,t.triangle,t.point)},this)}},this);this._meshes=[];n&&this.setECharts(n);this.onupdate=null};o.prototype={constructor:o,getTexture:function(){return this._texture},setECharts:function(n){var t;if(this._chart=n,t=n.getDom(),t instanceof HTMLCanvasElement){var r=this,i=n.getZr(),u=i.__oldRefreshImmediately||i.refreshImmediately;i.refreshImmediately=function(){u.call(this);r._texture.dirty();r.onupdate&&r.onupdate()};i.__oldRefreshImmediately=u}else console.error("ECharts must init on canvas if it is used as texture."),t=document.createElement("canvas");this._texture.image=t;this._texture.dirty();this.onupdate&&this.onupdate()},dispatchEvent:function(){var i=new u.a,f=new u.a,e=new u.a,o=new r.a,s=new r.a,h=new r.a,n=new r.a,t=new u.a;return function(c,l,a,v){var d=l.geometry,w=d.attributes.position,b=d.attributes.texcoord0,y=u.a.dot,k=u.a.cross,p,g,nt,tt,it,rt;w.get(a[0],i.array);w.get(a[1],f.array);w.get(a[2],e.array);b.get(a[0],o.array);b.get(a[1],s.array);b.get(a[2],h.array);k(t,f,e);p=y(i,t);g=y(v,t)/p;k(t,e,i);nt=y(v,t)/p;k(t,i,f);tt=y(v,t)/p;r.a.scale(n,o,g);r.a.scaleAndAdd(n,n,s,nt);r.a.scaleAndAdd(n,n,h,tt);it=n.x*this._chart.getWidth();rt=n.y*this._chart.getHeight();this._chart.getZr().handler.dispatch(c,{zrX:it,zrY:rt})}}(),attachToMesh:function(n){this._meshes.indexOf(n)>=0||(f.forEach(function(t){n.on(t,this[e(t)],this)},this),this._meshes.push(n))},detachFromMesh:function(n){var t=this._meshes.indexOf(n);t>=0&&this._meshes.splice(t,1);f.forEach(function(t){n.off(t,this[e(t)])},this)},dispose:function(){this._meshes.forEach(function(n){this.detachFromMesh(n)},this)}};t.a=o},function(n,t,i){"use strict";var u=i(24),r=i(77),f=u.a.extend({cubemap:null,castShadow:!1,_normalDistribution:null,_brdfLookup:null},{type:"AMBIENT_CUBEMAP_LIGHT",prefilter:function(n,t){var i,u;if(!n.getGLExtension("EXT_shader_texture_lod")){console.warn("Device not support textureCubeLodEXT");return}(this._brdfLookup||(this._normalDistribution=r.a.generateNormalDistribution(),this._brdfLookup=r.a.integrateBRDF(n,this._normalDistribution)),i=this.cubemap,i.__prefiltered)||(u=r.a.prefilterEnvironmentMap(n,i,{encodeRGBM:!0,width:t,height:t},this._normalDistribution,this._brdfLookup),this.cubemap=u.environmentMap,this.cubemap.__prefiltered=!0,i.dispose(n))},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}},ambientCubemapLightCubemap:{type:"t",value:function(n){return n.cubemap}},ambientCubemapLightBRDFLookup:{type:"t",value:function(n){return n._brdfLookup}}}});t.a=f},function(n,t){"use strict";t.a="\n@export clay.compositor.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n v_Texcoord = texcoord;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end"},function(n,t){"use strict";t.a="#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform sampler2D normalDistribution;\nuniform vec2 viewportSize : [512, 256];\nconst vec3 N = vec3(0.0, 0.0, 1.0);\nconst float fSampleNumber = float(SAMPLE_NUMBER);\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nfloat G_Smith(float roughness, float NoV, float NoL) {\n float k = roughness * roughness / 2.0;\n float G1V = NoV / (NoV * (1.0 - k) + k);\n float G1L = NoL / (NoL * (1.0 - k) + k);\n return G1L * G1V;\n}\nvoid main() {\n vec2 uv = gl_FragCoord.xy / viewportSize;\n float NoV = uv.x;\n float roughness = uv.y;\n vec3 V;\n V.x = sqrt(1.0 - NoV * NoV);\n V.y = 0.0;\n V.z = NoV;\n float A = 0.0;\n float B = 0.0;\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(L.z, 0.0, 1.0);\n float NoH = clamp(H.z, 0.0, 1.0);\n float VoH = clamp(dot(V, H), 0.0, 1.0);\n if (NoL > 0.0) {\n float G = G_Smith(roughness, NoV, NoL);\n float G_Vis = G * VoH / (NoH * NoV);\n float Fc = pow(1.0 - VoH, 5.0);\n A += (1.0 - Fc) * G_Vis;\n B += Fc * G_Vis;\n }\n }\n gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);\n}\n"},function(n,t){"use strict";t.a="#define SHADER_NAME prefilter\n#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform mat4 viewInverse : VIEWINVERSE;\nuniform samplerCube environmentMap;\nuniform sampler2D normalDistribution;\nuniform float roughness : 0.5;\nvarying vec2 v_Texcoord;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvoid main() {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n vec3 N = V;\n vec3 prefilteredColor = vec3(0.0);\n float totalWeight = 0.0;\n float fMaxSampleNumber = float(SAMPLE_NUMBER);\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(dot(N, L), 0.0, 1.0);\n if (NoL > 0.0) {\n prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;\n totalWeight += NoL;\n }\n }\n gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));\n}\n"},function(n,t,i){"use strict";var r=i(24),u=i(14),f=r.a.extend({castShadow:!1,coefficients:[]},function(){this._coefficientsTmpArr=new u.a.Float32Array(27)},{type:"AMBIENT_SH_LIGHT",uniformTemplates:{ambientSHLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}},ambientSHLightCoefficients:{type:"3f",value:function(n){for(var i=n._coefficientsTmpArr,t=0;t<n.coefficients.length;t++)i[t]=n.coefficients[t];return i}}}});t.a=f},function(n,t,i){"use strict";function w(n,t){var i=n[0],r=n[1],u=n[2];return t===0?1:t===1?i:t===2?r:t===3?u:t===4?i*u:t===5?r*u:t===6?i*r:t===7?3*u*u-1:i*i-r*r}function k(n,t,i,f){for(var c,a,d,g,nt,v=new e.a.Float32Array(27),o=r.a.create(),s=r.a.create(),y=r.a.create(),h=0;h<9;h++){for(c=r.a.create(),a=0;a<u.length;a++){var p=t[u[a]],tt=r.a.create(),it=0,k=0,l=b[u[a]];for(d=0;d<f;d++)for(g=0;g<i;g++)o[0]=g/(i-1)*2-1,o[1]=d/(f-1)*2-1,o[2]=-1,r.a.normalize(o,o),y[0]=o[l[0]]*l[3],y[1]=o[l[1]]*l[4],y[2]=o[l[2]]*l[5],s[0]=p[k++]/255,s[1]=p[k++]/255,s[2]=p[k++]/255,nt=p[k++]/255*8.12,s[0]*=nt,s[1]*=nt,s[2]*=nt,r.a.scaleAndAdd(tt,tt,s,w(y,h)*-o[2]),it+=-o[2];r.a.scaleAndAdd(c,c,tt,1/it)}v[h*3]=c[0]/6;v[h*3+1]=c[1]/6;v[h*3+2]=c[2]/6}return v}var f=i(4),o=i(10),s=i(5),c=i(16),e=i(14),l=i(42),a=i(75),v=i(62),y=i(36),r=i(12),p=i(131),h={},u=["px","nx","py","ny","pz","nz"],b={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};h.projectEnvironmentMap=function(n,t,i){var r,h,c,tt,d,e,nt;i=i||{};i.lod=i.lod||0;h=new y.a;c=64;t.textureType==="texture2D"?r=new a.a({scene:h,environmentMap:t}):(c=t.image&&t.image.px?t.image.px.width:t.width,r=new l.a({scene:h,environmentMap:t}));var p=Math.ceil(c/Math.pow(2,i.lod)),w=Math.ceil(c/Math.pow(2,i.lod)),g=new s.a({width:p,height:w}),b=new o.a;for(r.material.define("fragment","RGBM_ENCODE"),i.decodeRGBM&&r.material.define("fragment","RGBM_DECODE"),r.material.set("lod",i.lod),tt=new v.a({texture:g}),d={},e=0;e<u.length;e++)d[u[e]]=new Uint8Array(p*w*4),nt=tt.getCamera(u[e]),nt.fov=90,b.attach(g),b.bind(n),n.render(h,nt),n.gl.readPixels(0,0,p,w,f.a.RGBA,f.a.UNSIGNED_BYTE,d[u[e]]),b.unbind(n);return r.dispose(n),b.dispose(n),g.dispose(n),k(n,d,p,w)};t.a=h},function(n,t){"use strict";t.a="uniform samplerCube environmentMap;\nvarying vec2 v_Texcoord;\n#define TEXTURE_SIZE 16\nmat3 front = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 1.0, 0.0,\n 0.0, 0.0, 1.0\n);\nmat3 back = mat3(\n -1.0, 0.0, 0.0,\n 0.0, 1.0, 0.0,\n 0.0, 0.0, -1.0\n);\nmat3 left = mat3(\n 0.0, 0.0, -1.0,\n 0.0, 1.0, 0.0,\n 1.0, 0.0, 0.0\n);\nmat3 right = mat3(\n 0.0, 0.0, 1.0,\n 0.0, 1.0, 0.0,\n -1.0, 0.0, 0.0\n);\nmat3 up = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 0.0, 1.0,\n 0.0, -1.0, 0.0\n);\nmat3 down = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 0.0, -1.0,\n 0.0, 1.0, 0.0\n);\nfloat harmonics(vec3 normal){\n int index = int(gl_FragCoord.x);\n float x = normal.x;\n float y = normal.y;\n float z = normal.z;\n if(index==0){\n return 1.0;\n }\n else if(index==1){\n return x;\n }\n else if(index==2){\n return y;\n }\n else if(index==3){\n return z;\n }\n else if(index==4){\n return x*z;\n }\n else if(index==5){\n return y*z;\n }\n else if(index==6){\n return x*y;\n }\n else if(index==7){\n return 3.0*z*z - 1.0;\n }\n else{\n return x*x - y*y;\n }\n}\nvec3 sampleSide(mat3 rot)\n{\n vec3 result = vec3(0.0);\n float divider = 0.0;\n for (int i = 0; i < TEXTURE_SIZE * TEXTURE_SIZE; i++) {\n float x = mod(float(i), float(TEXTURE_SIZE));\n float y = float(i / TEXTURE_SIZE);\n vec2 sidecoord = ((vec2(x, y) + vec2(0.5, 0.5)) / vec2(TEXTURE_SIZE)) * 2.0 - 1.0;\n vec3 normal = normalize(vec3(sidecoord, -1.0));\n vec3 fetchNormal = rot * normal;\n vec3 texel = textureCube(environmentMap, fetchNormal).rgb;\n result += harmonics(fetchNormal) * texel * -normal.z;\n divider += -normal.z;\n }\n return result / divider;\n}\nvoid main()\n{\n vec3 result = (\n sampleSide(front) +\n sampleSide(back) +\n sampleSide(left) +\n sampleSide(right) +\n sampleSide(up) +\n sampleSide(down)\n ) / 6.0;\n gl_FragColor = vec4(result, 1.0);\n}"},function(n,t,i){"use strict";var r=i(15),u=i(18),f=r.a.extend({dynamic:!1,widthSegments:40,heightSegments:20,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var s=this.heightSegments,e=this.widthSegments,g=this.attributes.position,nt=this.attributes.texcoord0,tt=this.attributes.normal,l=(e+1)*(s+1),ot,k,st,d,c,f;g.init(l);nt.init(l);tt.init(l);for(var ht=l>65535?Uint32Array:Uint16Array,o=this.indices=new ht(e*s*6),it,rt,ut,a,h,n,i=this.radius,ft=this.phiStart,et=this.phiLength,y=this.thetaStart,p=this.thetaLength,i=this.radius,r=[],w=[],v=0,b=1/i,t=0;t<=s;t++)for(n=0;n<=e;n++)a=n/e,h=t/s,it=-i*Math.cos(ft+a*et)*Math.sin(y+h*p),rt=i*Math.cos(y+h*p),ut=i*Math.sin(ft+a*et)*Math.sin(y+h*p),r[0]=it,r[1]=rt,r[2]=ut,w[0]=a,w[1]=h,g.set(v,r),nt.set(v,w),r[0]*=b,r[1]*=b,r[2]*=b,tt.set(v,r),v++;for(c=e+1,f=0,t=0;t<s;t++)for(n=0;n<e;n++)k=t*c+n,ot=t*c+n+1,d=(t+1)*c+n+1,st=(t+1)*c+n,o[f++]=ot,o[f++]=k,o[f++]=d,o[f++]=k,o[f++]=st,o[f++]=d;this.boundingBox=new u.a;this.boundingBox.max.set(i,i,i);this.boundingBox.min.set(-i,-i,-i)}});t.a=f},function(n,t,i){"use strict";var r=i(24),u=r.a.extend({castShadow:!1},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}}}});t.a=u},function(n,t,i){"use strict";var r=i(24),u=i(3),f=r.a.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(n){return n.__dir=n.__dir||new u.a,n.__dir.copy(n.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}}},clone:function(){var n=r.a.prototype.clone.call(this);return n.shadowBias=this.shadowBias,n.shadowSlopeScale=this.shadowSlopeScale,n}});t.a=f},function(n,t,i){"use strict";var r=i(24),u=r.a.extend({range:100,castShadow:!1},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(n){return n.getWorldPosition().array}},pointLightRange:{type:"1f",value:function(n){return n.range}},pointLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}}},clone:function(){var n=r.a.prototype.clone.call(this);return n.range=this.range,n}});t.a=u},function(n,t,i){"use strict";var r=i(24),u=i(3),f=r.a.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(n){return n.getWorldPosition().array}},spotLightRange:{type:"1f",value:function(n){return n.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(n){return Math.cos(n.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(n){return Math.cos(n.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(n){return n.falloffFactor}},spotLightDirection:{type:"3f",value:function(n){return n.__dir=n.__dir||new u.a,n.__dir.copy(n.worldTransform.z).negate().array}},spotLightColor:{type:"3f",value:function(n){var t=n.color,i=n.intensity;return[t[0]*i,t[1]*i,t[2]*i]}}},clone:function(){var n=r.a.prototype.clone.call(this);return n.range=this.range,n.umbraAngle=this.umbraAngle,n.penumbraAngle=this.penumbraAngle,n.falloffFactor=this.falloffFactor,n.shadowBias=this.shadowBias,n.shadowSlopeScale=this.shadowSlopeScale,n}});t.a=f},function(n,t,i){"use strict";var r=i(33),u=function(n,t,i,u){n=n||0;t=t||0;i=i||0;u=u||0;this.array=r.a.fromValues(n,t,i,u);this._dirty=!0},f,e;u.prototype={constructor:u,add:function(n){return r.a.add(this.array,this.array,n.array),this._dirty=!0,this},set:function(n,t,i,r){return this.array[0]=n,this.array[1]=t,this.array[2]=i,this.array[3]=r,this._dirty=!0,this},setArray:function(n){return this.array[0]=n[0],this.array[1]=n[1],this.array[2]=n[2],this.array[3]=n[3],this._dirty=!0,this},clone:function(){return new u(this.x,this.y,this.z,this.w)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},dist:function(n){return r.a.dist(this.array,n.array)},distance:function(n){return r.a.distance(this.array,n.array)},div:function(n){return r.a.div(this.array,this.array,n.array),this._dirty=!0,this},divide:function(n){return r.a.divide(this.array,this.array,n.array),this._dirty=!0,this},dot:function(n){return r.a.dot(this.array,n.array)},len:function(){return r.a.len(this.array)},length:function(){return r.a.length(this.array)},lerp:function(n,t,i){return r.a.lerp(this.array,n.array,t.array,i),this._dirty=!0,this},min:function(n){return r.a.min(this.array,this.array,n.array),this._dirty=!0,this},max:function(n){return r.a.max(this.array,this.array,n.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},negate:function(){return r.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return r.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(n){return r.a.random(this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n),this._dirty=!0,this},scaleAndAdd:function(n,t){return r.a.scaleAndAdd(this.array,this.array,n.array,t),this._dirty=!0,this},sqrDist:function(n){return r.a.sqrDist(this.array,n.array)},squaredDistance:function(n){return r.a.squaredDistance(this.array,n.array)},sqrLen:function(){return r.a.sqrLen(this.array)},squaredLength:function(){return r.a.squaredLength(this.array)},sub:function(n){return r.a.sub(this.array,this.array,n.array),this._dirty=!0,this},subtract:function(n){return r.a.subtract(this.array,this.array,n.array),this._dirty=!0,this},transformMat4:function(n){return r.a.transformMat4(this.array,this.array,n.array),this._dirty=!0,this},transformQuat:function(n){return r.a.transformQuat(this.array,this.array,n.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};f=Object.defineProperty;f&&(e=u.prototype,f(e,"x",{get:function(){return this.array[0]},set:function(n){this.array[0]=n;this._dirty=!0}}),f(e,"y",{get:function(){return this.array[1]},set:function(n){this.array[1]=n;this._dirty=!0}}),f(e,"z",{get:function(){return this.array[2]},set:function(n){this.array[2]=n;this._dirty=!0}}),f(e,"w",{get:function(){return this.array[3]},set:function(n){this.array[3]=n;this._dirty=!0}}));u.add=function(n,t,i){return r.a.add(n.array,t.array,i.array),n._dirty=!0,n};u.set=function(n,t,i,u,f){r.a.set(n.array,t,i,u,f);n._dirty=!0};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.dist=function(n,t){return r.a.distance(n.array,t.array)};u.distance=u.dist;u.div=function(n,t,i){return r.a.divide(n.array,t.array,i.array),n._dirty=!0,n};u.divide=u.div;u.dot=function(n,t){return r.a.dot(n.array,t.array)};u.len=function(n){return r.a.length(n.array)};u.lerp=function(n,t,i,u){return r.a.lerp(n.array,t.array,i.array,u),n._dirty=!0,n};u.min=function(n,t,i){return r.a.min(n.array,t.array,i.array),n._dirty=!0,n};u.max=function(n,t,i){return r.a.max(n.array,t.array,i.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.multiply(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.negate=function(n,t){return r.a.negate(n.array,t.array),n._dirty=!0,n};u.normalize=function(n,t){return r.a.normalize(n.array,t.array),n._dirty=!0,n};u.random=function(n,t){return r.a.random(n.array,t),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i),n._dirty=!0,n};u.scaleAndAdd=function(n,t,i,u){return r.a.scaleAndAdd(n.array,t.array,i.array,u),n._dirty=!0,n};u.sqrDist=function(n,t){return r.a.sqrDist(n.array,t.array)};u.squaredDistance=u.sqrDist;u.sqrLen=function(n){return r.a.sqrLen(n.array)};u.squaredLength=u.sqrLen;u.sub=function(n,t,i){return r.a.subtract(n.array,t.array,i.array),n._dirty=!0,n};u.subtract=u.sub;u.transformMat4=function(n,t,i){return r.a.transformMat4(n.array,t.array,i.array),n._dirty=!0,n};u.transformQuat=function(n,t,i){return r.a.transformQuat(n.array,t.array,i.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";var r=i(78),u=function(){this.array=r.a.create();this._dirty=!0};u.prototype={constructor:u,setArray:function(n){for(var t=0;t<this.array.length;t++)this.array[t]=n[t];return this._dirty=!0,this},clone:function(){return(new u).copy(this)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},adjoint:function(){return r.a.adjoint(this.array,this.array),this._dirty=!0,this},determinant:function(){return r.a.determinant(this.array)},identity:function(){return r.a.identity(this.array),this._dirty=!0,this},invert:function(){return r.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},mulLeft:function(n){return r.a.mul(this.array,n.array,this.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},multiplyLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},rotate:function(n){return r.a.rotate(this.array,this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n.array),this._dirty=!0,this},transpose:function(){return r.a.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};u.adjoint=function(n,t){return r.a.adjoint(n.array,t.array),n._dirty=!0,n};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.determinant=function(n){return r.a.determinant(n.array)};u.identity=function(n){return r.a.identity(n.array),n._dirty=!0,n};u.invert=function(n,t){return r.a.invert(n.array,t.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.mul(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.rotate=function(n,t,i){return r.a.rotate(n.array,t.array,i),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i.array),n._dirty=!0,n};u.transpose=function(n,t){return r.a.transpose(n.array,t.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";var r=i(79),u=function(){this.array=r.a.create();this._dirty=!0};u.prototype={constructor:u,setArray:function(n){for(var t=0;t<this.array.length;t++)this.array[t]=n[t];return this._dirty=!0,this},clone:function(){return(new u).copy(this)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},determinant:function(){return r.a.determinant(this.array)},identity:function(){return r.a.identity(this.array),this._dirty=!0,this},invert:function(){return r.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},mulLeft:function(n){return r.a.mul(this.array,n.array,this.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},multiplyLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},rotate:function(n){return r.a.rotate(this.array,this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n.array),this._dirty=!0,this},translate:function(n){return r.a.translate(this.array,this.array,n.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.determinant=function(n){return r.a.determinant(n.array)};u.identity=function(n){return r.a.identity(n.array),n._dirty=!0,n};u.invert=function(n,t){return r.a.invert(n.array,t.array),n._dirty=!0,n};u.mul=function(n,t,i){return r.a.mul(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.rotate=function(n,t,i){return r.a.rotate(n.array,t.array,i),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i.array),n._dirty=!0,n};u.translate=function(n,t,i){return r.a.translate(n.array,t.array,i.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";var r=i(34),u=function(){this.array=r.a.create();this._dirty=!0};u.prototype={constructor:u,setArray:function(n){for(var t=0;t<this.array.length;t++)this.array[t]=n[t];return this._dirty=!0,this},adjoint:function(){return r.a.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new u).copy(this)},copy:function(n){return r.a.copy(this.array,n.array),this._dirty=!0,this},determinant:function(){return r.a.determinant(this.array)},fromMat2d:function(n){return r.a.fromMat2d(this.array,n.array),this._dirty=!0,this},fromMat4:function(n){return r.a.fromMat4(this.array,n.array),this._dirty=!0,this},fromQuat:function(n){return r.a.fromQuat(this.array,n.array),this._dirty=!0,this},identity:function(){return r.a.identity(this.array),this._dirty=!0,this},invert:function(){return r.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(n){return r.a.mul(this.array,this.array,n.array),this._dirty=!0,this},mulLeft:function(n){return r.a.mul(this.array,n.array,this.array),this._dirty=!0,this},multiply:function(n){return r.a.multiply(this.array,this.array,n.array),this._dirty=!0,this},multiplyLeft:function(n){return r.a.multiply(this.array,n.array,this.array),this._dirty=!0,this},rotate:function(n){return r.a.rotate(this.array,this.array,n),this._dirty=!0,this},scale:function(n){return r.a.scale(this.array,this.array,n.array),this._dirty=!0,this},translate:function(n){return r.a.translate(this.array,this.array,n.array),this._dirty=!0,this},normalFromMat4:function(n){return r.a.normalFromMat4(this.array,n.array),this._dirty=!0,this},transpose:function(){return r.a.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};u.adjoint=function(n,t){return r.a.adjoint(n.array,t.array),n._dirty=!0,n};u.copy=function(n,t){return r.a.copy(n.array,t.array),n._dirty=!0,n};u.determinant=function(n){return r.a.determinant(n.array)};u.identity=function(n){return r.a.identity(n.array),n._dirty=!0,n};u.invert=function(n,t){return r.a.invert(n.array,t.array),n};u.mul=function(n,t,i){return r.a.mul(n.array,t.array,i.array),n._dirty=!0,n};u.multiply=u.mul;u.fromMat2d=function(n,t){return r.a.fromMat2d(n.array,t.array),n._dirty=!0,n};u.fromMat4=function(n,t){return r.a.fromMat4(n.array,t.array),n._dirty=!0,n};u.fromQuat=function(n,t){return r.a.fromQuat(n.array,t.array),n._dirty=!0,n};u.normalFromMat4=function(n,t){return r.a.normalFromMat4(n.array,t.array),n._dirty=!0,n};u.rotate=function(n,t,i){return r.a.rotate(n.array,t.array,i),n._dirty=!0,n};u.scale=function(n,t,i){return r.a.scale(n.array,t.array,i.array),n._dirty=!0,n};u.transpose=function(n,t){return r.a.transpose(n.array,t.array),n._dirty=!0,n};u.translate=function(n,t,i){return r.a.translate(n.array,t.array,i.array),n._dirty=!0,n};t.a=u},function(n,t,i){"use strict";var r=i(142),u=i.n(r),f={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(n,t){var o,f,s,i,e,c;if(this._animators=this._animators||[],o=this,n){for(s=n.split("."),i=o,e=0,c=s.length;e<c;e++)i&&(i=i[s[e]]);i&&(f=i)}else f=o;if(f==null)throw new Error("Target "+n+" not exists");var h=this._animators,r=new u.a(f,t),l=this;return r.during(function(){l.__zr&&l.__zr.refresh()}).done(function(){var n=h.indexOf(r);n>=0&&h.splice(n,1)}),h.push(r),this.__zr&&this.__zr.animation.addAnimator(r),r},stopAnimation:function(n){var t,r,i;for(this._animators=this._animators||[],t=this._animators,r=t.length,i=0;i<r;i++)t[i].stop(n);return t.length=0,this},addAnimatorsToZr:function(n){if(this._animators)for(var t=0;t<this._animators.length;t++)n.animation.addAnimator(this._animators[t])},removeAnimatorsFromZr:function(n){if(this._animators)for(var t=0;t<this._animators.length;t++)n.animation.removeAnimator(this._animators[t])}};t.a=f},function(n,t,i){function b(n,t){return n[t]}function k(n,t,i){n[t]=i}function f(n,t,i){return(t-n)*i+n}function o(n,t,i){return i>.5?t:n}function s(n,t,i,r,u){var s=n.length,h,e,o;if(u==1)for(e=0;e<s;e++)r[e]=f(n[e],t[e],i);else for(h=s&&n[0].length,e=0;e<s;e++)for(o=0;o<h;o++)r[e][o]=f(n[e][o],t[e][o],i)}function h(n,t,i){var o=n.length,e=t.length,s,h,r,f;if(o!==e)if(s=o>e,s)n.length=e;else for(r=o;r<e;r++)n.push(i===1?t[r]:u.call(t[r]));for(h=n[0]&&n[0].length,r=0;r<n.length;r++)if(i===1)isNaN(n[r])&&(n[r]=t[r]);else for(f=0;f<h;f++)isNaN(n[r][f])&&(n[r][f]=t[r][f])}function d(n,t,i){var f,e,r,u;if(n===t)return!0;if(f=n.length,f!==t.length)return!1;if(i===1){for(r=0;r<f;r++)if(n[r]!==t[r])return!1}else for(e=n[0].length,r=0;r<f;r++)for(u=0;u<e;u++)if(n[r][u]!==t[r][u])return!1;return!0}function c(n,t,i,r,u,f,o,s,h){var a=n.length,v,c,l;if(h==1)for(c=0;c<a;c++)s[c]=e(n[c],t[c],i[c],r[c],u,f,o);else for(v=n[0].length,c=0;c<a;c++)for(l=0;l<v;l++)s[c][l]=e(n[c][l],t[c][l],i[c][l],r[c][l],u,f,o)}function e(n,t,i,r,u,f,e){var o=(i-n)*.5,s=(r-t)*.5;return(2*(t-i)+o+s)*e+(-3*(t-i)-2*o-s)*f+o*u+t}function g(n){var f,i,t;if(r(n)){if(f=n.length,r(n[0])){for(i=[],t=0;t<f;t++)i.push(u.call(n[t]));return i}return u.call(n)}return n}function l(n){return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n[2]=Math.floor(n[2]),"rgba("+n.join(",")+")"}function nt(n){var t=n[n.length-1].value;return r(t&&t[0])?2:1}function tt(n,t,i,u,a,v){var yt=n._getter,gt=n._setter,ri=t==="spline",k=u.length,tt,bt,et,g,lt,kt,ti,w,at,ot,st,vt,ht,ii,dt;if(k){var ui=u[0].value,it=r(ui),ut=!1,ct=!1,ft=it?nt(u):0,pt;u.sort(function(n,t){return n.time-t.time});pt=u[k-1].time;var rt=[],b=[],wt=u[0].value,ni=!0;for(g=0;g<k;g++)rt.push(u[g].time/pt),tt=u[g].value,it&&d(tt,wt,ft)||!it&&tt===wt||(ni=!1),wt=tt,typeof tt=="string"&&(bt=p.parse(tt),bt?(tt=bt,ut=!0):ct=!0),b.push(tt);if(v||!ni){for(et=b[k-1],g=0;g<k-1;g++)it?h(b[g],et,ft):!isNaN(b[g])||isNaN(et)||ct||ut||(b[g]=et);return it&&h(yt(n._target,a),et,ft),lt=0,kt=0,ut&&(ht=[0,0,0,0]),ii=function(n,t){var i,u,r;if(t<0)i=0;else if(t<kt){for(ti=Math.min(lt+1,k-1),i=ti;i>=0;i--)if(rt[i]<=t)break;i=Math.min(i,k-2)}else{for(i=lt;i<k;i++)if(rt[i]>t)break;i=Math.min(i-1,k-2)}if(lt=i,kt=t,u=rt[i+1]-rt[i],u!==0)if(w=(t-rt[i])/u,ri)if(ot=b[i],at=b[i===0?i:i-1],st=b[i>k-2?k-1:i+1],vt=b[i>k-3?k-1:i+2],it)c(at,ot,st,vt,w,w*w,w*w*w,yt(n,a),ft);else{if(ut)r=c(at,ot,st,vt,w,w*w,w*w*w,ht,1),r=l(ht);else{if(ct)return o(ot,st,w);r=e(at,ot,st,vt,w,w*w,w*w*w)}gt(n,a,r)}else if(it)s(b[i],b[i+1],w,yt(n,a),ft);else{if(ut)s(b[i],b[i+1],w,ht,1),r=l(ht);else{if(ct)return o(b[i],b[i+1],w);r=f(b[i],b[i+1],w)}gt(n,a,r)}},dt=new y({target:n._target,life:pt,loop:n._loop,delay:n._delay,onframe:ii,ondestroy:i}),t&&t!=="spline"&&(dt.easing=t),dt}}}var y=i(143),p=i(145),w=i(13),r=w.isArrayLike,u=Array.prototype.slice,a=function(n,t,i,r){this._tracks={};this._target=n;this._loop=t||!1;this._getter=i||b;this._setter=r||k;this._clipCount=0;this._delay=0;this._doneList=[];this._onframeList=[];this._clipList=[]},v;a.prototype={when:function(n,t){var r=this._tracks,i,u;for(i in t)if(t.hasOwnProperty(i)){if(!r[i]){if(r[i]=[],u=this._getter(this._target,i),u==null)continue;n!==0&&r[i].push({time:0,value:g(u)})}r[i].push({time:n,value:t[i]})}return this},during:function(n){return this._onframeList.push(n),this},pause:function(){for(var n=0;n<this._clipList.length;n++)this._clipList[n].pause();this._paused=!0},resume:function(){for(var n=0;n<this._clipList.length;n++)this._clipList[n].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){var t,i,n;for(this._tracks={},this._clipList.length=0,t=this._doneList,i=t.length,n=0;n<i;n++)t[n].call(this)},start:function(n,t){var e=this,r=0,s=function(){r--;r||e._doneCallback()},u,f,i,o;for(f in this._tracks)this._tracks.hasOwnProperty(f)&&(i=tt(this,n,s,this._tracks[f],f,t),i&&(this._clipList.push(i),r++,this.animation&&this.animation.addClip(i),u=i));return u&&(o=u.onframe,u.onframe=function(n,t){o(n,t);for(var i=0;i<e._onframeList.length;i++)e._onframeList[i](n,t)}),r||this._doneCallback(),this},stop:function(n){for(var r,t=this._clipList,u=this.animation,i=0;i<t.length;i++){if(r=t[i],n)r.onframe(this._target,1);u&&u.removeClip(r)}t.length=0},delay:function(n){return this._delay=n,this},done:function(n){return n&&this._doneList.push(n),this},getClips:function(){return this._clipList}};v=a;n.exports=v},function(n,t,i){function r(n){this._target=n.target;this._life=n.life||1e3;this._delay=n.delay||0;this._initialized=!1;this.loop=n.loop==null?!1:n.loop;this.gap=n.gap||0;this.easing=n.easing||"Linear";this.onframe=n.onframe;this.ondestroy=n.ondestroy;this.onrestart=n.onrestart;this._pausedTime=0;this._paused=!1}var f=i(144),u;r.prototype={constructor:r,step:function(n,t){var i;if(this._initialized||(this._startTime=n+this._delay,this._initialized=!0),this._paused){this._pausedTime+=t;return}if(i=(n-this._startTime-this._pausedTime)/this._life,!(i<0)){i=Math.min(i,1);var r=this.easing,u=typeof r=="string"?f[r]:r,e=typeof u=="function"?u(i):i;return(this.fire("frame",e),i==1)?this.loop?(this.restart(n),"restart"):(this._needsRemove=!0,"destroy"):null}},restart:function(n){var t=(n-this._startTime-this._pausedTime)%this._life;this._startTime=n-t+this.gap;this._pausedTime=0;this._needsRemove=!1},fire:function(n,t){n="on"+n;this[n]&&this[n](this._target,t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};u=r;n.exports=u},function(n){var t={linear:function(n){return n},quadraticIn:function(n){return n*n},quadraticOut:function(n){return n*(2-n)},quadraticInOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},quarticIn:function(n){return n*n*n*n},quarticOut:function(n){return 1- --n*n*n*n},quarticInOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)},quinticIn:function(n){return n*n*n*n*n},quinticOut:function(n){return--n*n*n*n*n+1},quinticInOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)},sinusoidalIn:function(n){return 1-Math.cos(n*Math.PI/2)},sinusoidalOut:function(n){return Math.sin(n*Math.PI/2)},sinusoidalInOut:function(n){return.5*(1-Math.cos(Math.PI*n))},exponentialIn:function(n){return n===0?0:Math.pow(1024,n-1)},exponentialOut:function(n){return n===1?1:1-Math.pow(2,-10*n)},exponentialInOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)},circularIn:function(n){return 1-Math.sqrt(1-n*n)},circularOut:function(n){return Math.sqrt(1- --n*n)},circularInOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)},elasticIn:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},elasticOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},elasticInOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1},backIn:function(n){var t=1.70158;return n*n*((t+1)*n-t)},backOut:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},backInOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)},bounceIn:function(n){return 1-t.bounceOut(1-n)},bounceOut:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},bounceInOut:function(n){return n<.5?t.bounceIn(n*2)*.5:t.bounceOut(n*2-1)*.5+.5}},i=t;n.exports=i},function(n,t,i){function r(n){return n=Math.round(n),n<0?0:n>255?255:n}function nt(n){return n=Math.round(n),n<0?0:n>360?360:n}function h(n){return n<0?0:n>1?1:n}function a(n){return n.length&&n.charAt(n.length-1)==="%"?r(parseFloat(n)/100*255):r(parseInt(n,10))}function o(n){return n.length&&n.charAt(n.length-1)==="%"?h(parseFloat(n)/100):h(parseFloat(n))}function v(n,t,i){return(i<0?i+=1:i>1&&(i-=1),i*6<1)?n+(t-n)*i*6:i*2<1?t:i*3<2?n+(t-n)*(2/3-i)*6:n}function f(n,t,i){return n+(t-n)*i}function u(n,t,i,r,u){return n[0]=t,n[1]=i,n[2]=r,n[3]=u,n}function y(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function s(n,t){l&&y(l,t);l=b.put(n,l||t.slice())}function e(n,t){var h,r,i,e,c;if(n){if(t=t||[],h=b.get(n),h)return y(t,h);if(n=n+"",r=n.replace(/ /g,"").toLowerCase(),r in w)return y(t,w[r]),s(n,t),t;if(r.charAt(0)==="#"){if(r.length===4){if(i=parseInt(r.substr(1),16),!(i>=0&&i<=4095)){u(t,0,0,0,1);return}return u(t,(i&3840)>>4|(i&3840)>>8,i&240|(i&240)>>4,i&15|(i&15)<<4,1),s(n,t),t}if(r.length===7){if(i=parseInt(r.substr(1),16),!(i>=0&&i<=16777215)){u(t,0,0,0,1);return}return u(t,(i&16711680)>>16,(i&65280)>>8,i&255,1),s(n,t),t}return}if(e=r.indexOf("("),c=r.indexOf(")"),e!==-1&&c+1===r.length){var v=r.substr(0,e),f=r.substr(e+1,c-(e+1)).split(","),l=1;switch(v){case"rgba":if(f.length!==4){u(t,0,0,0,1);return}l=o(f.pop());case"rgb":if(f.length!==3){u(t,0,0,0,1);return}return u(t,a(f[0]),a(f[1]),a(f[2]),l),s(n,t),t;case"hsla":if(f.length!==4){u(t,0,0,0,1);return}return f[3]=o(f[3]),p(f,t),s(n,t),t;case"hsl":if(f.length!==3){u(t,0,0,0,1);return}return p(f,t),s(n,t),t;default:return}}u(t,0,0,0,1);return}}function p(n,t){var e=(parseFloat(n[0])%360+360)%360/360,s=o(n[1]),i=o(n[2]),f=i<=.5?i*(s+1):i+s-i*s,h=i*2-f;return t=t||[],u(t,r(v(h,f,e+1/3)*255),r(v(h,f,e)*255),r(v(h,f,e-1/3)*255),1),n.length===4&&(t[3]=n[3]),t}function tt(n){var h;if(n){var u=n[0]/255,f=n[1]/255,e=n[2]/255,o=Math.min(u,f,e),t=Math.max(u,f,e),i=t-o,c=(t+o)/2,r,s;if(i===0)r=0,s=0;else{s=c<.5?i/(t+o):i/(2-t-o);var l=((t-u)/6+i/2)/i,a=((t-f)/6+i/2)/i,v=((t-e)/6+i/2)/i;u===t?r=v-a:f===t?r=1/3+l-v:e===t&&(r=2/3+a-l);r<0&&(r+=1);r>1&&(r-=1)}return h=[r*360,s,c],n[3]!=null&&h.push(n[3]),h}}function it(n,t){var r=e(n),i;if(r){for(i=0;i<3;i++)r[i]=t<0?r[i]*(1-t)|0:(255-r[i])*t+r[i]|0,r[i]>255?r[i]=255:n[i]<0&&(r[i]=0);return c(r,r.length===4?"rgba":"rgb")}}function rt(n){var t=e(n);if(t)return(16777216+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}function k(n,t,i){if(t&&t.length&&n>=0&&n<=1){i=i||[];var s=n*(t.length-1),c=Math.floor(s),l=Math.ceil(s),u=t[c],e=t[l],o=s-c;return i[0]=r(f(u[0],e[0],o)),i[1]=r(f(u[1],e[1],o)),i[2]=r(f(u[2],e[2],o)),i[3]=h(f(u[3],e[3],o)),i}}function d(n,t,i){if(t&&t.length&&n>=0&&n<=1){var u=n*(t.length-1),a=Math.floor(u),v=Math.ceil(u),o=e(t[a]),s=e(t[v]),l=u-a,y=c([r(f(o[0],s[0],l)),r(f(o[1],s[1],l)),r(f(o[2],s[2],l)),h(f(o[3],s[3],l))],"rgba");return i?{color:y,leftIndex:a,rightIndex:v,value:u}:y}}function et(n,t,i,r){return n=e(n),n?(n=tt(n),t!=null&&(n[0]=nt(t)),i!=null&&(n[1]=o(i)),r!=null&&(n[2]=o(r)),c(p(n),"rgba")):void 0}function ot(n,t){return n=e(n),n&&t!=null?(n[3]=h(t),c(n,"rgba")):void 0}function c(n,t){if(n&&n.length){var i=n[0]+","+n[1]+","+n[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(i+=","+n[3]),t+"("+i+")"}}var g=i(60),w={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},b=new g(20),l=null,ut=k,ft=d;t.parse=e;t.lift=it;t.toHex=rt;t.fastLerp=k;t.fastMapToColor=ut;t.lerp=d;t.mapToColor=ft;t.modifyHSL=et;t.modifyAlpha=ot;t.stringify=c},function(n,t){"use strict";t.a="\n@export clay.util.rand\nhighp float rand(vec2 uv) {\n const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);\n return fract(sin(sn) * c);\n}\n@end\n@export clay.util.calculate_attenuation\nuniform float attenuationFactor : 5.0;\nfloat lightAttenuation(float dist, float range)\n{\n float attenuation = 1.0;\n attenuation = dist*dist/(range*range+1.0);\n float att_s = attenuationFactor;\n attenuation = 1.0/(attenuation*att_s+1.0);\n att_s = 1.0/(att_s+1.0);\n attenuation = attenuation - att_s;\n attenuation /= 1.0 - att_s;\n return clamp(attenuation, 0.0, 1.0);\n}\n@end\n@export clay.util.edge_factor\n#ifdef SUPPORT_STANDARD_DERIVATIVES\nfloat edgeFactor(float width)\n{\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#else\nfloat edgeFactor(float width)\n{\n return 1.0;\n}\n#endif\n@end\n@export clay.util.encode_float\nvec4 encodeFloat(const in float depth)\n{\n const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n vec4 res = fract(depth * bitShifts);\n res -= res.xxyz * bit_mask;\n return res;\n}\n@end\n@export clay.util.decode_float\nfloat decodeFloat(const in vec4 color)\n{\n const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n return dot(color, bitShifts);\n}\n@end\n@export clay.util.float\n@import clay.util.encode_float\n@import clay.util.decode_float\n@end\n@export clay.util.rgbm_decode\nvec3 RGBMDecode(vec4 rgbm, float range) {\n return range * rgbm.rgb * rgbm.a;\n}\n@end\n@export clay.util.rgbm_encode\nvec4 RGBMEncode(vec3 color, float range) {\n if (dot(color, color) == 0.0) {\n return vec4(0.0);\n }\n vec4 rgbm;\n color /= range;\n rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);\n rgbm.a = ceil(rgbm.a * 255.0) / 255.0;\n rgbm.rgb = color / rgbm.a;\n return rgbm;\n}\n@end\n@export clay.util.rgbm\n@import clay.util.rgbm_decode\n@import clay.util.rgbm_encode\nvec4 decodeHDR(vec4 color)\n{\n#if defined(RGBM_DECODE) || defined(RGBM)\n return vec4(RGBMDecode(color, 8.12), 1.0);\n#else\n return color;\n#endif\n}\nvec4 encodeHDR(vec4 color)\n{\n#if defined(RGBM_ENCODE) || defined(RGBM)\n return RGBMEncode(color.xyz, 8.12);\n#else\n return color;\n#endif\n}\n@end\n@export clay.util.srgb\nvec4 sRGBToLinear(in vec4 value) {\n return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);\n}\nvec4 linearTosRGB(in vec4 value) {\n return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);\n}\n@end\n@export clay.chunk.skinning_header\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n#ifdef USE_SKIN_MATRICES_TEXTURE\nuniform sampler2D skinMatricesTexture : ignore;\nuniform float skinMatricesTextureSize: ignore;\nmat4 getSkinMatrix(sampler2D tex, float idx) {\n float j = idx * 4.0;\n float x = mod(j, skinMatricesTextureSize);\n float y = floor(j / skinMatricesTextureSize) + 0.5;\n vec2 scale = vec2(skinMatricesTextureSize);\n return mat4(\n texture2D(tex, vec2(x + 0.5, y) / scale),\n texture2D(tex, vec2(x + 1.5, y) / scale),\n texture2D(tex, vec2(x + 2.5, y) / scale),\n texture2D(tex, vec2(x + 3.5, y) / scale)\n );\n}\nmat4 getSkinMatrix(float idx) {\n return getSkinMatrix(skinMatricesTexture, idx);\n}\n#else\nuniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;\nmat4 getSkinMatrix(float idx) {\n return skinMatrix[int(idx)];\n}\n#endif\n#endif\n@end\n@export clay.chunk.skin_matrix\nmat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;\nif (weight.y > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.y) * weight.y;\n}\nif (weight.z > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.z) * weight.z;\n}\nfloat weightW = 1.0-weight.x-weight.y-weight.z;\nif (weightW > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.w) * weightW;\n}\n@end\n@export clay.util.parallax_correct\nvec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {\n vec3 first = (boxMax - pos) / dir;\n vec3 second = (boxMin - pos) / dir;\n vec3 further = max(first, second);\n float dist = min(further.x, min(further.y, further.z));\n vec3 fixedPos = pos + dir * dist;\n vec3 boxCenter = (boxMax + boxMin) * 0.5;\n return normalize(fixedPos - boxCenter);\n}\n@end\n@export clay.util.clamp_sample\nvec4 clampSample(const in sampler2D texture, const in vec2 coord)\n{\n#ifdef STEREO\n float eye = step(0.5, coord.x) * 0.5;\n vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));\n#else\n vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));\n#endif\n return texture2D(texture, coordClamped);\n}\n@end\n@export clay.util.ACES\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n@end"},function(n,t){"use strict";t.a="\n@export ecgl.common.transformUniforms\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n@end\n\n@export ecgl.common.attributes\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n@end\n\n@export ecgl.common.uv.header\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\nuniform vec2 detailUvRepeat : [1.0, 1.0];\nuniform vec2 detailUvOffset : [0.0, 0.0];\n\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n@export ecgl.common.uv.main\nv_Texcoord = texcoord * uvRepeat + uvOffset;\nv_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;\n@end\n\n@export ecgl.common.uv.fragmentHeader\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n\n@export ecgl.common.albedo.main\n\n vec4 albedoTexel = vec4(1.0);\n#ifdef DIFFUSEMAP_ENABLED\n albedoTexel = texture2D(diffuseMap, v_Texcoord);\n #ifdef SRGB_DECODE\n albedoTexel = sRGBToLinear(albedoTexel);\n #endif\n#endif\n\n#ifdef DETAILMAP_ENABLED\n vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);\n #ifdef SRGB_DECODE\n detailTexel = sRGBToLinear(detailTexel);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);\n albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexHeader\n\n#ifdef WIREFRAME_QUAD\nattribute vec4 barycentric;\nvarying vec4 v_Barycentric;\n#elif defined(WIREFRAME_TRIANGLE)\nattribute vec3 barycentric;\nvarying vec3 v_Barycentric;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n v_Barycentric = barycentric;\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentHeader\n\nuniform float wireframeLineWidth : 1;\nuniform vec4 wireframeLineColor: [0, 0, 0, 0.5];\n\n#ifdef WIREFRAME_QUAD\nvarying vec4 v_Barycentric;\nfloat edgeFactor () {\n vec4 d = fwidth(v_Barycentric);\n vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(min(a4.x, a4.y), a4.z), a4.w);\n}\n#elif defined(WIREFRAME_TRIANGLE)\nvarying vec3 v_Barycentric;\nfloat edgeFactor () {\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n if (wireframeLineWidth > 0.) {\n vec4 lineColor = wireframeLineColor;\n#ifdef SRGB_DECODE\n lineColor = sRGBToLinear(lineColor);\n#endif\n\n gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);\n }\n#endif\n@end\n\n\n\n\n@export ecgl.common.bumpMap.header\n\n#ifdef BUMPMAP_ENABLED\nuniform sampler2D bumpMap;\nuniform float bumpScale : 1.0;\n\n\nvec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\n{\n vec2 dSTdx = dFdx(v_Texcoord);\n vec2 dSTdy = dFdy(v_Texcoord);\n\n float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\n float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\n float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\n\n vec3 vSigmaX = dFdx(surfPos);\n vec3 vSigmaY = dFdy(surfPos);\n vec3 vN = surfNormal;\n\n vec3 R1 = cross(vSigmaY, vN);\n vec3 R2 = cross(vN, vSigmaX);\n\n float fDet = dot(vSigmaX, R1);\n\n vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\n return normalize(abs(fDet) * baseNormal - vGrad);\n\n}\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexHeader\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexMain\n\n#ifdef NORMALMAP_ENABLED\n if (dot(tangent, tangent) > 0.0) {\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n }\n#endif\n\n@end\n\n\n@export ecgl.common.normalMap.fragmentHeader\n\n#ifdef NORMALMAP_ENABLED\nuniform sampler2D normalMap;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.fragmentMain\n#ifdef NORMALMAP_ENABLED\n if (dot(v_Tangent, v_Tangent) > 0.0) {\n vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;\n if (dot(normalTexel, normalTexel) > 0.0) { N = normalTexel * 2.0 - 1.0;\n mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n N = normalize(tbn * N);\n }\n }\n#endif\n@end\n\n\n\n@export ecgl.common.vertexAnimation.header\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevNormal;\nuniform float percent;\n#endif\n\n@end\n\n@export ecgl.common.vertexAnimation.main\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n vec3 norm = mix(prevNormal, normal, percent);\n#else\n vec3 pos = position;\n vec3 norm = normal;\n#endif\n\n@end\n\n\n@export ecgl.common.ssaoMap.header\n#ifdef SSAOMAP_ENABLED\nuniform sampler2D ssaoMap;\nuniform vec4 viewport : VIEWPORT;\n#endif\n@end\n\n@export ecgl.common.ssaoMap.main\n float ao = 1.0;\n#ifdef SSAOMAP_ENABLED\n ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;\n#endif\n@end\n\n\n\n\n@export ecgl.common.diffuseLayer.header\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\nuniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];\nuniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.header\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\nuniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];\nuniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.layers.header\n@import ecgl.common.diffuseLayer.header\n@import ecgl.common.emissiveLayer.header\n@end\n\n@export ecgl.common.diffuseLayer.main\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_DIFFUSEMAP_COUNT; _idx_++) {{\n float intensity = layerDiffuseIntensity[_idx_];\n vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);\n albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;\n }}\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.main\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_EMISSIVEMAP_COUNT; _idx_++)\n {{\n vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n float intensity = layerEmissionIntensity[_idx_];\n gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;\n }}\n#endif\n\n@end\n"},function(n,t){"use strict";t.a="@export ecgl.color.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\n@import ecgl.common.uv.header\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position: POSITION;\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvoid main()\n{\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n @import ecgl.common.uv.main\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n@export ecgl.color.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.layers.header\n\n@import ecgl.common.uv.fragmentHeader\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n\n}\n@end"},function(n,t){"use strict";t.a="/**\n * http: */\n\n@export ecgl.lambert.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n\n@import ecgl.common.attributes\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.vertexAnimation.header\n\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n}\n\n@end\n\n\n@export ecgl.lambert.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n gl_FragColor *= sRGBToLinear(v_Color);\n #else\n gl_FragColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n diffuseColor += ambientLightColor[i] * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n vec3 lightColor = directionalLightColor[i];\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor.rgb *= diffuseColor;\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(n,t){"use strict";t.a="@export ecgl.realistic.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@import ecgl.common.vertexAnimation.header\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n\n\n@export ecgl.realistic.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n#define PI 3.14159265358979\n#define ROUGHNESS_CHANEL 0\n#define METALNESS_CHANEL 1\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\n\nuniform sampler2D detailMap;\nuniform sampler2D metalnessMap;\nuniform sampler2D roughnessMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform float metalness : 0.0;\nuniform float roughness : 0.5;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n@import clay.header.ambient_cubemap_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.normalMap.fragmentHeader\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import clay.util.rgbm\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n\nfloat D_Phong(float g, float ndh) {\n float a = pow(8192.0, g);\n return (a + 2.0) / 8.0 * pow(ndh, a);\n}\n\nvoid main()\n{\n vec4 albedoColor = color;\n\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n albedoColor *= sRGBToLinear(v_Color);\n #else\n albedoColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n albedoColor *= albedoTexel;\n\n float m = metalness;\n\n#ifdef METALNESSMAP_ENABLED\n float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];\n m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 baseColor = albedoColor.rgb;\n albedoColor.rgb = baseColor * (1.0 - m);\n vec3 specFactor = mix(vec3(0.04), baseColor, m);\n\n float g = 1.0 - roughness;\n\n#ifdef ROUGHNESSMAP_ENABLED\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 N = v_Normal;\n\n#ifdef DOUBLE_SIDED\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n@import ecgl.common.normalMap.fragmentMain\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseTerm = vec3(0.0);\n vec3 specularTerm = vec3(0.0);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n vec3 fresnelTerm = F_Schlick(ndv, specFactor);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;\n }}\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++)\n {{\n vec3 L = -directionalLightDirection[_idx_];\n vec3 lc = directionalLightColor[_idx_];\n\n vec3 H = normalize(L + V);\n float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[_idx_];\n }\n#endif\n\n vec3 li = lc * ndl * shadowContrib;\n\n diffuseTerm += li;\n specularTerm += li * fresnelTerm * D_Phong(g, ndh);\n }}\n#endif\n\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n vec3 L = reflect(-V, N);\n L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);\n float rough2 = clamp(1.0 - g, 0.0, 1.0);\n float bias2 = rough2 * 5.0;\n vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;\n vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;\n vec3 envTexel2;\n for(int _idx_ = 0; _idx_ < AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)\n {{\n envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);\n specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;\n }}\n#endif\n\n gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;\n gl_FragColor.a = albedoColor.a;\n\n#ifdef SRGB_ENCODE\n gl_FragColor = linearTosRGB(gl_FragColor);\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(n,t){"use strict";t.a="@export ecgl.hatching.vertex\n\n@import ecgl.realistic.vertex\n\n@end\n\n\n@export ecgl.hatching.fragment\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform vec4 color : [0.0, 0.0, 0.0, 1.0];\nuniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nuniform sampler2D hatch1;\nuniform sampler2D hatch2;\nuniform sampler2D hatch3;\nuniform sampler2D hatch4;\nuniform sampler2D hatch5;\nuniform sampler2D hatch6;\n\nfloat shade(in float tone) {\n vec4 c = vec4(1. ,1., 1., 1.);\n float step = 1. / 6.;\n vec2 uv = v_DetailTexcoord;\n if (tone <= step / 2.0) {\n c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);\n }\n else if (tone <= step) {\n c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);\n }\n if(tone > step && tone <= 2. * step){\n c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));\n }\n if(tone > 2. * step && tone <= 3. * step){\n c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));\n }\n if(tone > 3. * step && tone <= 4. * step){\n c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));\n }\n if(tone > 4. * step && tone <= 5. * step){\n c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));\n }\n if(tone > 5. * step){\n c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));\n }\n\n return c.r;\n}\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n vec4 inkColor = sRGBToLinear(color);\n#else\n vec4 inkColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n inkColor *= sRGBToLinear(v_Color);\n #else\n inkColor *= v_Color;\n #endif\n#endif\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float tone = 0.0;\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n tone += dot(ambientLightColor[i], w) * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n float lightTone = dot(directionalLightColor[i], w);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n tone += lightTone * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));\n }\n@end\n"},function(n,t){"use strict";t.a="@export ecgl.sm.depth.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n v_ViewPosition = worldViewProjection * vec4(pos, 1.0);\n gl_Position = v_ViewPosition;\n\n v_Texcoord = texcoord;\n\n}\n@end\n\n\n\n@export ecgl.sm.depth.fragment\n\n@import clay.sm.depth.fragment\n\n@end"},function(n,t,i){"use strict";function r(n,t){if(n&&n[t]&&(n[t].normal||n[t].emphasis)){var i=n[t].normal,r=n[t].emphasis;i&&(n[t]=i);r&&(n.emphasis=n.emphasis||{},n.emphasis[t]=r)}}function s(n){r(n,"itemStyle");r(n,"lineStyle");r(n,"areaStyle");r(n,"label")}function f(n){n&&(n instanceof Array||(n=[n]),u.a.util.each(n,function(n){if(n.axisLabel){var t=n.axisLabel;u.a.util.extend(t,t.textStyle);t.textStyle=null}}))}var e=i(0),u=i.n(e),o=["bar3D","line3D","map3D","scatter3D","surface","lines3D","scatterGL","scatter3D"];t.a=function(n){u.a.util.each(n.series,function(t){u.a.util.indexOf(o,t.type)>=0&&(s(t),t.coordinateSystem==="mapbox"&&(t.coordinateSystem="mapbox3D",n.mapbox3D=n.mapbox))});f(n.xAxis3D);f(n.yAxis3D);f(n.zAxis3D);f(n.grid3D);r(n.geo3D)}},function(n,t,i){"use strict";var f=i(155),e=i(159),o=i(160),s=i(167),u=i(0),r=i.n(u);r.a.registerAction({type:"grid3DChangeCamera",event:"grid3dcamerachanged",update:"series:updateCamera"},function(n,t){t.eachComponent({mainType:"grid3D",query:n},function(t){t.setView(n)})});r.a.registerAction({type:"grid3DShowAxisPointer",event:"grid3dshowaxispointer",update:"grid3D:showAxisPointer"},function(){});r.a.registerAction({type:"grid3DHideAxisPointer",event:"grid3dhideaxispointer",update:"grid3D:hideAxisPointer"},function(){})},function(n,t,i){"use strict";function f(n,t){return t.type||(t.data?"category":"value")}var o=i(0),e=i.n(o),u=i(156),r=e.a.extendComponentModel({type:"cartesian3DAxis",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid3D",index:this.option.gridIndex,id:this.option.gridId})[0]}});e.a.helper.mixinAxisModelCommonMethods(r);Object(u.a)("x",r,f,{name:"X"});Object(u.a)("y",r,f,{name:"Y"});Object(u.a)("z",r,f,{name:"Z"})},function(n,t,i){"use strict";var u=i(0),r=i.n(u),f=i(157),e=i(158),o=i.n(e),s=["value","category","time","log"];t.a=function(n,t,i,u){r.a.util.each(s,function(e){t.extend({type:n+"Axis3D."+e,__ordinalMeta:null,mergeDefaultAndTheme:function(t,u){var f=u.getTheme();r.a.util.merge(t,f.get(e+"Axis3D"));r.a.util.merge(t,this.getDefaultOption());t.type=i(n,t)},optionUpdated:function(){var n=this.option;n.type==="category"&&(this.__ordinalMeta=o.a.createByAxisModel(this))},getCategories:function(){if(this.option.type==="category")return this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:r.a.util.merge(r.a.util.clone(f.a[e+"Axis3D"]),u||{},!0)})});t.superClass.registerSubTypeDefaulter(n+"Axis3D",r.a.util.curry(i,n))}},function(n,t,i){"use strict";var o=i(0),r=i.n(o),f={show:!0,grid3DIndex:0,inverse:!1,name:"",nameLocation:"middle",nameTextStyle:{fontSize:16},nameGap:20,axisPointer:{},axisLine:{},axisTick:{},axisLabel:{},splitArea:{}},s=r.a.util.merge({boundaryGap:!0,axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"},axisPointer:{label:{show:!1}}},f),u=r.a.util.merge({boundaryGap:[0,0],splitNumber:5,axisPointer:{label:{}}},f),h=r.a.util.defaults({scale:!0,min:"dataMin",max:"dataMax"},u),e=r.a.util.defaults({logBase:10},u);e.scale=!0;t.a={categoryAxis3D:s,valueAxis3D:u,timeAxis3D:h,logAxis3D:e}},function(n,t,i){function r(n){this.categories=n.categories||[];this._needCollect=n.needCollect;this._deduplication=n.deduplication;this._map}function e(n){return n._map||(n._map=s(n.categories))}function l(n){return h(n)&&n.value!=null?n.value:n+""}var u=i(13),s=u.createHashMap,h=u.isObject,c=u.map,f,o;r.createByAxisModel=function(n){var t=n.option,i=t.data,u=i&&c(i,l);return new r({categories:u,needCollect:!u,deduplication:t.dedplication!==!1})};f=r.prototype;f.getOrdinal=function(n){return e(this).get(n)};f.parseAndCollect=function(n){var t,i=this._needCollect,r;return typeof n!="string"&&!i?n:i&&!this._deduplication?(t=this.categories.length,this.categories[t]=n,t):(r=e(this),t=r.get(n),t==null&&(i?(t=this.categories.length,this.categories[t]=n,r.set(n,t)):t=NaN),t)};o=r;n.exports=o},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(44),o=i(28),s=i(29),u=r.a.extendComponentModel({type:"grid3D",dependencies:["xAxis3D","yAxis3D","zAxis3D"],defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",boxWidth:100,boxHeight:100,boxDepth:100,axisPointer:{show:!0,lineStyle:{color:"rgba(0, 0, 0, 0.8)",width:1},label:{show:!0,formatter:null,margin:8,textStyle:{fontSize:14,color:"#fff",backgroundColor:"rgba(0,0,0,0.5)",padding:3,borderRadius:3}}},axisLine:{show:!0,lineStyle:{color:"#333",width:2,type:"solid"}},axisTick:{show:!0,inside:!1,length:3,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,margin:8,textStyle:{fontSize:12}},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}},light:{main:{alpha:30,beta:40},ambient:{intensity:.4}},viewControl:{alpha:20,beta:40,autoRotate:!1,distance:200,minDistance:40,maxDistance:400}}}),h;r.a.util.merge(u.prototype,e.a);r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);h=u},function(n,t,i){"use strict";var h=i(0),f=i.n(h),r=i(1),c=i(45),l=i(25),e=i(2),o=i(81),a=i(30),v=i(162),y=i(164),p=i(63),w=i(46),s=e.a.firstNotNull,u,b;r.a.Shader.import(w.a);["x","y","z"].forEach(function(n){f.a.extendComponentView({type:n+"Axis3D"})});u={x:0,y:2,z:1};b=f.a.extendComponentView({type:"grid3D",__ecgl__:!0,init:function(n,t){var i=new r.a.Material({shader:r.a.createShader("ecgl.color"),depthMask:!1,transparent:!0}),u=new r.a.Material({shader:r.a.createShader("ecgl.meshLines3D"),depthMask:!1,transparent:!0}),f;i.define("fragment","DOUBLE_SIDED");i.define("both","VERTEX_COLOR");this.groupGL=new r.a.Node;this._control=new c.a({zr:t.getZr()});this._control.init();this._faces=[["y","z","x",-1,"left"],["y","z","x",1,"right"],["x","y","z",-1,"bottom"],["x","y","z",1,"top"],["x","z","y",-1,"far"],["x","z","y",1,"near"]].map(function(n){var t=new v.a(n,u,i);return this.groupGL.add(t.rootNode),t},this);this._axes=["x","y","z"].map(function(n){var t=new y.a(n,u);return this.groupGL.add(t.rootNode),t},this);f=t.getDevicePixelRatio();this._axisLabelSurface=new o.a({width:256,height:256,devicePixelRatio:f});this._axisLabelSurface.onupdate=function(){t.getZr().refresh()};this._axisPointerLineMesh=new r.a.Mesh({geometry:new l.a({useNativeLine:!1}),material:u,castShadow:!1,ignorePicking:!0,renderOrder:3});this.groupGL.add(this._axisPointerLineMesh);this._axisPointerLabelsSurface=new o.a({width:128,height:128,devicePixelRatio:f});this._axisPointerLabelsMesh=new p.a({ignorePicking:!0,renderOrder:4,castShadow:!1});this._axisPointerLabelsMesh.material.set("textureAtlas",this._axisPointerLabelsSurface.getTexture());this.groupGL.add(this._axisPointerLabelsMesh);this._lightRoot=new r.a.Node;this._sceneHelper=new a.a;this._sceneHelper.initLight(this._lightRoot)},render:function(n,t,i){var r,u,f;this._model=n;this._api=i;r=n.coordinateSystem;r.viewGL.add(this._lightRoot);n.get("show")?r.viewGL.add(this.groupGL):r.viewGL.remove(this.groupGL);u=this._control;u.setViewGL(r.viewGL);f=n.getModel("viewControl");u.setFromViewControlModel(f,0);this._axisLabelSurface.clear();u.off("update");n.get("show")&&(this._faces.forEach(function(r){r.update(n,t,i)},this),this._axes.forEach(function(t){t.update(n,this._axisLabelSurface,i)},this));u.on("update",this._onCameraChange.bind(this,n,i),this);this._sceneHelper.setScene(r.viewGL.scene);this._sceneHelper.updateLight(n);r.viewGL.setPostEffect(n.getModel("postEffect"),i);r.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));this._initMouseHandler(n)},afterRender:function(n,t,i,r){var u=r.renderer;this._sceneHelper.updateAmbientCubemap(u,n,i);this._sceneHelper.updateSkybox(u,n,i)},showAxisPointer:function(n,t,i,r){this._doShowAxisPointer();this._updateAxisPointer(r.value)},hideAxisPointer:function(){this._doHideAxisPointer()},_initMouseHandler:function(n){var i=n.coordinateSystem,t=i.viewGL;if(n.get("show")&&n.get("axisPointer.show"))t.on("mousemove",this._updateAxisPointerOnMousePosition,this);else t.off("mousemove",this._updateAxisPointerOnMousePosition)},_updateAxisPointerOnMousePosition:function(n){var e,t,i,h;if(!n.target){var c=this._model,f=c.coordinateSystem,s=f.viewGL,l=s.castRay(n.offsetX,n.offsetY,new r.a.Ray),o;for(e=0;e<this._faces.length;e++)if((t=this._faces[e],!t.rootNode.invisible)&&(t.plane.normal.dot(s.camera.worldTransform.z)<0&&t.plane.normal.negate(),i=l.intersectPlane(t.plane),i)){var a=f.getAxis(t.faceInfo[0]),v=f.getAxis(t.faceInfo[1]),y=u[t.faceInfo[0]],p=u[t.faceInfo[1]];a.contain(i.array[y])&&v.contain(i.array[p])&&(o=i)}o?(h=f.pointToData(o.array,[],!0),this._updateAxisPointer(h),this._doShowAxisPointer()):this._doHideAxisPointer()}},_onCameraChange:function(n,t){n.get("show")&&(this._updateFaceVisibility(),this._updateAxisLinePosition());var i=this._control;t.dispatchAction({type:"grid3DChangeCamera",alpha:i.getAlpha(),beta:i.getBeta(),distance:i.getDistance(),center:i.getCenter(),from:this.uid,grid3DId:n.id})},_updateFaceVisibility:function(){var f=this._control.getCamera(),u=new r.a.Vector3,n,i,t,e;for(f.update(),n=0;n<this._faces.length/2;n++){for(i=[],t=0;t<2;t++)e=this._faces[n*2+t],e.rootNode.getWorldPosition(u),u.transformMat4(f.viewMatrix),i[t]=u.z;var o=i[0]>i[1]?0:1,s=this._faces[n*2+o],h=this._faces[n*2+1-o];s.rootNode.invisible=!0;h.rootNode.invisible=!1}},_updateAxisLinePosition:function(){var u=this._model.coordinateSystem,f=u.getAxis("x"),e=u.getAxis("y"),o=u.getAxis("z"),s=o.getExtentMax(),h=o.getExtentMin(),c=f.getExtentMin(),l=f.getExtentMax(),a=e.getExtentMax(),v=e.getExtentMin(),t=this._axes[0].rootNode,i=this._axes[1].rootNode,r=this._axes[2].rootNode,n=this._faces,y=n[4].rootNode.invisible?v:a,p=n[2].rootNode.invisible?s:h,w=n[0].rootNode.invisible?c:l,b=n[2].rootNode.invisible?s:h,k=n[0].rootNode.invisible?l:c,d=n[4].rootNode.invisible?v:a;t.rotation.identity();i.rotation.identity();r.rotation.identity();n[4].rootNode.invisible&&(this._axes[0].flipped=!0,t.rotation.rotateX(Math.PI));n[0].rootNode.invisible&&(this._axes[1].flipped=!0,i.rotation.rotateZ(Math.PI));n[4].rootNode.invisible&&(this._axes[2].flipped=!0,r.rotation.rotateY(Math.PI));t.position.set(0,p,y);i.position.set(w,b,0);r.position.set(k,0,d);t.update();i.update();r.update();this._updateAxisLabelAlign()},_updateAxisLabelAlign:function(){var i=this._control.getCamera(),n=[new r.a.Vector4,new r.a.Vector4],t=new r.a.Vector4;this.groupGL.getWorldPosition(t);t.w=1;t.transformMat4(i.viewMatrix).transformMat4(i.projectionMatrix);t.x/=t.w;t.y/=t.w;this._axes.forEach(function(r){for(var o=r.axisLineCoords,a=r.labelsMesh.geometry,u=0;u<n.length;u++)n[u].setArray(o[u]),n[u].w=1,n[u].transformMat4(r.rootNode.worldTransform).transformMat4(i.viewMatrix).transformMat4(i.projectionMatrix),n[u].x/=n[u].w,n[u].y/=n[u].w;var s=n[1].x-n[0].x,h=n[1].y-n[0].y,c=(n[1].x+n[0].x)/2,l=(n[1].y+n[0].y)/2,f,e;Math.abs(h/s)<.5?(f="center",e=l>t.y?"bottom":"top"):(e="middle",f=c>t.x?"left":"right");r.setSpriteAlign(f,e,this._api)},this)},_doShowAxisPointer:function(){this._axisPointerLineMesh.invisible&&(this._axisPointerLineMesh.invisible=!1,this._axisPointerLabelsMesh.invisible=!1,this._api.getZr().refresh())},_doHideAxisPointer:function(){this._axisPointerLineMesh.invisible||(this._axisPointerLineMesh.invisible=!0,this._axisPointerLabelsMesh.invisible=!0,this._api.getZr().refresh())},_updateAxisPointer:function(n){function d(n){return e.a.firstNotNull(n.model.get("axisPointer.show"),b.get("show"))}function g(n){var u=n.model.getModel("axisPointer",b),t=u.getModel("lineStyle"),i=r.a.parseColor(t.get("color")),f=s(t.get("width"),1),e=s(t.get("opacity"),1);return i[3]*=e,{color:i,lineWidth:f}}var i=this._model.coordinateSystem,v=i.dataToPoint(n),et=this._axisPointerLineMesh,l=et.geometry,b=this._model.getModel("axisPointer"),k=this._api.getDevicePixelRatio(),a,y,c,o,f,h;for(l.convertToDynamicArray(!0),a=0;a<this._faces.length;a++)if(y=this._faces[a],!y.rootNode.invisible){var t=y.faceInfo,nt=t[3]<0?i.getAxis(t[2]).getExtentMin():i.getAxis(t[2]).getExtentMax(),p=u[t[2]];for(c=0;c<2;c++){var tt=t[c],it=t[1-c],rt=i.getAxis(tt),ut=i.getAxis(it);if(d(rt)){var o=[0,0,0],f=[0,0,0],w=u[tt],ft=u[it];o[w]=f[w]=v[w];o[p]=f[p]=nt;o[ft]=ut.getExtentMin();f[ft]=ut.getExtentMax();h=g(rt);l.addLine(o,f,h.color,h.lineWidth*k)}}d(i.getAxis(t[2]))&&(o=v.slice(),f=v.slice(),f[p]=nt,h=g(i.getAxis(t[2])),l.addLine(o,f,h.color,h.lineWidth*k))}l.convertToTypedArray();this._updateAxisPointerLabelsMesh(n);this._api.getZr().refresh()},_updateAxisPointerLabelsMesh:function(n){var r=this._model,t=this._axisPointerLabelsMesh,i=this._axisPointerLabelsSurface,o=r.coordinateSystem,s=r.getModel("axisPointer"),e;t.geometry.convertToDynamicArray(!0);i.clear();e={x:"y",y:"x",z:"y"};this._axes.forEach(function(r,h){var c=o.getAxis(r.dim),tt=c.model,v=tt.getModel("axisPointer",s),l=v.getModel("label"),it=v.get("lineStyle.color"),k;if(l.get("show")&&v.get("show")){var w=n[h],b=l.get("formatter"),a=c.scale.getLabel(w);b!=null?a=b(a,n):(c.scale.type==="interval"||c.scale.type==="log")&&(k=f.a.number.getPrecisionSafe(c.scale.getTicks()[0]),a=w.toFixed(k+2));var d=l.getModel("textStyle"),rt=d.get("color"),y=new f.a.graphic.Text;f.a.graphic.setTextStyle(y.style,d,{text:a,textFill:rt||it,textAlign:"left",textVerticalAlign:"top"});var ut=i.add(y),g=y.getBoundingRect(),nt=this._api.getDevicePixelRatio(),p=r.rootNode.position.toArray(),ft=u[e[r.dim]];p[ft]+=(r.flipped?-1:1)*l.get("margin");p[u[r.dim]]=c.dataToCoord(n[h]);t.geometry.addSprite(p,[g.width*nt,g.height*nt],ut,r.textAlign,r.textVerticalAlign)}},this);i.getZr().refreshImmediately();t.material.set("uvScale",i.getCoordsScale());t.geometry.convertToTypedArray()},dispose:function(){this.groupGL.removeAll();this._control.dispose()}})},function(n,t,i){"use strict";var r=i(70),u=i(12),f=i(33),e=i(78),o=i(79),s=i(34),h=i(21),c=i(55);t.a={vec2:r.a,vec3:u.a,vec4:f.a,mat2:e.a,mat2d:o.a,mat3:s.a,mat4:h.a,quat:c.a}},function(n,t,i){"use strict";function a(n,t,i,r){var u=[0,0,0],f=r<0?i.getExtentMin():i.getExtentMax();u[l[i.dim]]=f;n.position.setArray(u);n.rotation.identity();t.distance=-Math.abs(f);t.normal.set(0,0,0);i.dim==="x"?(n.rotation.rotateY(r*Math.PI/2),t.normal.x=-r):i.dim==="z"?(n.rotation.rotateX(-r*Math.PI/2),t.normal.y=-r):(r>0&&n.rotation.rotateY(Math.PI),t.normal.z=-r)}function u(n,t,i){this.rootNode=new r.a.Node;var u=new r.a.Mesh({geometry:new h.a({useNativeLine:!1}),material:t,castShadow:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:1}),f=new r.a.Mesh({geometry:new c.a,material:i,castShadow:!1,culling:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:0});this.rootNode.add(f);this.rootNode.add(u);this.faceInfo=n;this.plane=new r.a.Plane;this.linesMesh=u;this.quadsMesh=f}var o=i(0),e=i.n(o),r=i(1),s=i(2),h=i(25),c=i(163),f=s.a.firstNotNull,l={x:0,y:2,z:1};u.prototype.update=function(n,t,i){var r=n.coordinateSystem,e=[r.getAxis(this.faceInfo[0]),r.getAxis(this.faceInfo[1])],u=this.linesMesh.geometry,f=this.quadsMesh.geometry,o;u.convertToDynamicArray(!0);f.convertToDynamicArray(!0);this._updateSplitLines(u,e,n,i);this._udpateSplitAreas(f,e,n,i);u.convertToTypedArray();f.convertToTypedArray();o=r.getAxis(this.faceInfo[2]);a(this.rootNode,this.plane,o,this.faceInfo[3])};u.prototype._updateSplitLines=function(n,t,i,u){var o=u.getDevicePixelRatio();t.forEach(function(u,s){var g=u.model,k=t[1-s].getExtent(),c,p,w,l,d,b,a,v;if(!u.scale.isBlank()&&(c=g.getModel("splitLine",i.getModel("splitLine")),c.get("show"))){var y=c.getModel("lineStyle"),h=y.get("color"),nt=f(y.get("opacity"),1),tt=f(y.get("width"),1);for(h=e.a.util.isArray(h)?h:[h],p=u.getTicksCoords({tickModel:c}),w=0,l=0;l<p.length;l++)d=p[l].coord,b=r.a.parseColor(h[w%h.length]),b[3]*=nt,a=[0,0,0],v=[0,0,0],a[s]=v[s]=d,a[1-s]=k[0],v[1-s]=k[1],n.addLine(a,v,b,tt*o),w++}})};u.prototype._udpateSplitAreas=function(n,t,i){t.forEach(function(u,o){var g=u.model,w=t[1-o].getExtent(),a,h,p;if(!u.scale.isBlank()&&(a=g.getModel("splitArea",i.getModel("splitArea")),a.get("show"))){var b=a.getModel("areaStyle"),s=b.get("color"),nt=f(b.get("opacity"),1);s=e.a.util.isArray(s)?s:[s];var k=u.getTicksCoords({tickModel:a,clamp:!0}),d=0,v=[0,0,0],y=[0,0,0];for(h=0;h<k.length;h++){var tt=k[h].coord,c=[0,0,0],l=[0,0,0];if(c[o]=l[o]=tt,c[1-o]=w[0],l[1-o]=w[1],h===0){v=c;y=l;continue}p=r.a.parseColor(s[d%s.length]);p[3]*=nt;n.addQuad([v,c,l,y],p);v=c;y=l;d++}}})};t.a=u},function(n,t,i){"use strict";var u=i(15),e=i(0),o=i.n(e),s=i(38),h=i(6),r=h.a.vec3,f=u.a.extend(function(){return{segmentScale:1,useNativeLine:!0,attributes:{position:new u.a.Attribute("position","float",3,"POSITION"),normal:new u.a.Attribute("normal","float",3,"NORMAL"),color:new u.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setQuadCount:function(n){var i=this.attributes,t=this.getQuadVertexCount()*n,r=this.getQuadTriangleCount()*n;this.vertexCount!==t&&(i.position.init(t),i.normal.init(t),i.color.init(t));this.triangleCount!==r&&(this.indices=t>65535?new Uint32Array(r*3):new Uint16Array(r*3))},getQuadVertexCount:function(){return 4},getQuadTriangleCount:function(){return 2},addQuad:function(){var t=r.create(),i=r.create(),n=r.create(),u=[0,3,1,3,2,1];return function(f,e){var h=this.attributes.position,c=this.attributes.normal,l=this.attributes.color,s,o;for(r.sub(t,f[1],f[0]),r.sub(i,f[2],f[1]),r.cross(n,t,i),r.normalize(n,n),o=0;o<4;o++)h.set(this._vertexOffset+o,f[o]),l.set(this._vertexOffset+o,e),c.set(this._vertexOffset+o,n);for(s=this._faceOffset*3,o=0;o<6;o++)this.indices[s+o]=u[o]+this._vertexOffset;this._vertexOffset+=4;this._faceOffset+=2}}()});o.a.util.defaults(f.prototype,s.a);t.a=f},function(n,t,i){"use strict";function o(n,t){var u=new e.a.Mesh({geometry:new c.a({useNativeLine:!1}),material:t,castShadow:!1,ignorePicking:!0,renderOrder:2}),r=new a.a,i;r.material.depthMask=!1;i=new e.a.Node;i.add(u);i.add(r);this.rootNode=i;this.dim=n;this.linesMesh=u;this.labelsMesh=r;this.axisLineCoords=null;this.labelElements=[]}var h=i(0),f=i.n(h),e=i(1),c=i(25),l=i(2),a=i(63),r=l.a.firstNotNull,u={x:0,y:2,z:1},s={x:"y",y:"x",z:"y"};o.prototype.update=function(n,t,i){var gt=n.coordinateSystem,o=gt.getAxis(this.dim),d=this.linesMesh.geometry,g=this.labelsMesh.geometry,vt,kt,y,h,ft,et,c,ot,b;d.convertToDynamicArray(!0);g.convertToDynamicArray(!0);var l=o.model,nt=o.getExtent(),y=i.getDevicePixelRatio(),ht=l.getModel("axisLine",n.getModel("axisLine")),ct=l.getModel("axisTick",n.getModel("axisTick")),tt=l.getModel("axisLabel",n.getModel("axisLabel")),it=ht.get("lineStyle.color");if(ht.get("show")){var pt=ht.getModel("lineStyle"),k=[0,0,0],p=[0,0,0],a=u[o.dim];k[a]=nt[0];p[a]=nt[1];this.axisLineCoords=[k,p];var wt=e.a.parseColor(it),lt=r(pt.get("width"),1),ni=r(pt.get("opacity"),1);wt[3]*=ni;d.addLine(k,p,wt,lt*y)}if(ct.get("show")){var at=ct.getModel("lineStyle"),bt=e.a.parseColor(r(at.get("color"),it)),lt=r(at.get("width"),1);for(bt[3]*=r(at.get("opacity"),1),vt=o.getTicksCoords(),kt=ct.get("length"),h=0;h<vt.length;h++){var dt=vt[h].coord,k=[0,0,0],p=[0,0,0],a=u[o.dim],yt=u[s[o.dim]];k[a]=p[a]=dt;p[yt]=kt;d.addLine(k,p,bt,lt*y)}}if(this.labelElements=[],y=i.getDevicePixelRatio(),tt.get("show")){var vt=o.getTicksCoords(),rt=l.get("data"),ti=tt.get("margin"),ut=o.getViewLabels();for(h=0;h<ut.length;h++){var w=ut[h].tickValue,ii=ut[h].formattedLabel,ri=ut[h].rawLabel,dt=o.dataToCoord(w),v=[0,0,0],a=u[o.dim],yt=u[s[o.dim]];v[a]=v[a]=dt;v[yt]=ti;ft=tt;rt&&rt[w]&&rt[w].textStyle&&(ft=new f.a.Model(rt[w].textStyle,tt,l.ecModel));et=r(ft.get("color"),it);c=new f.a.graphic.Text;f.a.graphic.setTextStyle(c.style,ft,{text:ii,textFill:typeof et=="function"?et(o.type==="category"?ri:o.type==="value"?w+"":w,h):et,textVerticalAlign:"top",textAlign:"left"});ot=t.add(c);b=c.getBoundingRect();g.addSprite(v,[b.width*y,b.height*y],ot);this.labelElements.push(c)}}if(l.get("name")){var st=l.getModel("nameTextStyle"),v=[0,0,0],a=u[o.dim],yt=u[s[o.dim]],ui=r(st.get("color"),it),fi=st.get("borderColor"),lt=st.get("borderWidth");v[a]=v[a]=(nt[0]+nt[1])/2;v[yt]=l.get("nameGap");c=new f.a.graphic.Text;f.a.graphic.setTextStyle(c.style,st,{text:l.get("name"),textFill:ui,textStroke:fi,lineWidth:lt});ot=t.add(c);b=c.getBoundingRect();g.addSprite(v,[b.width*y,b.height*y],ot);c.__idx=this.labelElements.length;this.nameLabelElement=c}this.labelsMesh.material.set("textureAtlas",t.getTexture());this.labelsMesh.material.set("uvScale",t.getCoordsScale());d.convertToTypedArray();g.convertToTypedArray()};o.prototype.setSpriteAlign=function(n,t,i){for(var s,e,r,u=i.getDevicePixelRatio(),o=this.labelsMesh.geometry,f=0;f<this.labelElements.length;f++)s=this.labelElements[f],r=s.getBoundingRect(),o.setSpriteAlign(f,[r.width*u,r.height*u],n,t);e=this.nameLabelElement;e&&(r=e.getBoundingRect(),o.setSpriteAlign(e.__idx,[r.width*u,r.height*u],n,t),o.dirty());this.textAlign=n;this.textVerticalAlign=t};t.a=o},function(n,t,i){"use strict";var e=i(0),o=i.n(e),r=i(15),s=i(38),u=[0,1,2,0,2,3],f=r.a.extend(function(){return{attributes:{position:new r.a.Attribute("position","float",3,"POSITION"),texcoord:new r.a.Attribute("texcoord","float",2,"TEXCOORD_0"),offset:new r.a.Attribute("offset","float",2),color:new r.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setSpriteCount:function(n){this._spriteCount=n;var t=n*4,i=n*2;this.vertexCount!==t&&(this.attributes.position.init(t),this.attributes.offset.init(t),this.attributes.color.init(t));this.triangleCount!==i&&(this.indices=t>65535?new Uint32Array(i*3):new Uint16Array(i*3))},setSpriteAlign:function(n,t,i,r,u){var f,e,o,s,h,c;i==null&&(i="left");r==null&&(r="top");u=u||0;switch(i){case"left":f=u;o=t[0]+u;break;case"center":case"middle":f=-t[0]/2;o=t[0]/2;break;case"right":f=-t[0]-u;o=-u}switch(r){case"bottom":e=u;s=t[1]+u;break;case"middle":e=-t[1]/2;s=t[1]/2;break;case"top":e=-t[1]-u;s=-u}h=n*4;c=this.attributes.offset;c.set(h,[f,s]);c.set(h+1,[o,s]);c.set(h+2,[o,e]);c.set(h+3,[f,e])},addSprite:function(n,t,i,r,f,e){var s=this._vertexOffset,o;for(this.setSprite(this._vertexOffset/4,n,t,i,r,f,e),o=0;o<u.length;o++)this.indices[this._faceOffset*3+o]=u[o]+s;return this._faceOffset+=2,this._vertexOffset+=4,s/4},setSprite:function(n,t,i,r,u,f,e){for(var s,o=n*4,c=this.attributes,h=0;h<4;h++)c.position.set(o+h,t);s=c.texcoord;s.set(o,[r[0][0],r[0][1]]);s.set(o+1,[r[1][0],r[0][1]]);s.set(o+2,[r[1][0],r[1][1]]);s.set(o+3,[r[0][0],r[1][1]]);this.setSpriteAlign(n,i,u,f,e)}});o.a.util.defaults(f.prototype,s.a);t.a=f},function(n,t){"use strict";t.a="@export ecgl.labels.vertex\n\nattribute vec3 position: POSITION;\nattribute vec2 texcoord: TEXCOORD_0;\nattribute vec2 offset;\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n vec4 proj = worldViewProjection * vec4(position, 1.0);\n\n vec2 screen = (proj.xy / abs(proj.w) + 1.0) * 0.5 * viewport.zw;\n\n screen += offset;\n\n proj.xy = (screen / viewport.zw - 0.5) * 2.0 * abs(proj.w);\n gl_Position = proj;\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n v_Texcoord = texcoord;\n}\n@end\n\n\n@export ecgl.labels.fragment\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\nuniform sampler2D textureAtlas;\nuniform vec2 uvScale: [1.0, 1.0];\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\nvarying float v_Miter;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n gl_FragColor = vec4(color, alpha) * texture2D(textureAtlas, v_Texcoord * uvScale);\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n}\n\n@end"},function(n,t,i){"use strict";function a(n,t){var e=n.getBoxLayoutParams(),i=c.a.getLayoutRect(e,{width:t.getWidth(),height:t.getHeight()});i.y=t.getHeight()-i.y-i.height;this.viewGL.setViewport(i.x,i.y,i.width,i.height,t.getDevicePixelRatio());var r=n.get("boxWidth"),u=n.get("boxHeight"),f=n.get("boxDepth");!0&&["x","y","z"].forEach(function(t){if(!this.getAxis(t))throw new Error("Grid"+n.id+" don't have "+t+"Axis");},this);this.getAxis("x").setExtent(-r/2,r/2);this.getAxis("y").setExtent(f/2,-f/2);this.getAxis("z").setExtent(-u/2,u/2);this.size=[r,u,f]}function v(n,t){function r(n,t){i[n]=i[n]||[Infinity,-Infinity];i[n][0]=Math.min(t[0],i[n][0]);i[n][1]=Math.max(t[1],i[n][1])}var i={};n.eachSeries(function(n){if(n.coordinateSystem===this){var t=n.getData();["x","y","z"].forEach(function(n){t.mapDimension(n,!0).forEach(function(i){r(n,t.getDataExtent(i,!0))})})}},this);["xAxis3D","yAxis3D","zAxis3D"].forEach(function(t){n.eachComponent(t,function(n){var f=t.charAt(0),e=n.getReferringComponents("grid3D")[0],s=e.coordinateSystem,r,h,c;if(s===this){if(r=s.getAxis(f),r){!0&&console.warn("Can't have two %s in one grid3D",t);return}h=u.a.helper.createScale(i[f]||[Infinity,-Infinity],n);r=new o.a(f,h);r.type=n.get("type");c=r.type==="category";r.onBand=c&&n.get("boundaryGap");r.inverse=n.get("inverse");n.axis=r;r.model=n;r.getLabelModel=function(){return n.getModel("axisLabel",e.getModel("axisLabel"))};r.getTickModel=function(){return n.getModel("axisTick",e.getModel("axisTick"))};s.addAxis(r)}},this)},this);this.resize(this.model,t)}var r=i(168),o=i(170),s=i(0),u=i.n(s),h=i(47),c=i.n(h),l=i(22),f=i(2),e={dimensions:r.a.prototype.dimensions,create:function(n){function u(n,t){return i.map(function(i){var r=n.getReferringComponents(i)[0];if(r==null&&(r=t.getComponent(i)),!0&&!r)throw new Error(i+' "'+f.a.firstNotNull(n.get(i+"Index"),n.get(i+"Id"),0)+'" not found');return r})}var t=[],i;return n.eachComponent("grid3D",function(n){n.__viewGL=n.__viewGL||new l.a;var i=new r.a;i.model=n;i.viewGL=n.__viewGL;n.coordinateSystem=i;t.push(i);i.resize=a;i.update=v}),i=["xAxis3D","yAxis3D","zAxis3D"],n.eachSeries(function(t){var r,i,e;t.get("coordinateSystem")==="cartesian3D"&&(i=t.getReferringComponents("grid3D")[0],i==null&&(r=u(t,n),i=r[0].getCoordSysModel(),r.forEach(function(n){var t=n.getCoordSysModel();if(1){if(!t)throw new Error('grid3D "'+f.a.firstNotNull(n.get("gridIndex"),n.get("gridId"),0)+'" not found');if(t!==i)throw new Error("xAxis3D, yAxis3D, zAxis3D must use the same grid");}})),e=i.coordinateSystem,t.coordinateSystem=e)}),t}},y;u.a.registerCoordinateSystem("grid3D",e);y=e},function(n,t,i){"use strict";function r(n){u.a.call(this,n);this.size=[0,0,0]}var f=i(0),e=i.n(f),o=i(169),u=i.n(o);r.prototype={constructor:r,type:"cartesian3D",dimensions:["x","y","z"],model:null,containPoint:function(n){return this.getAxis("x").contain(n[0])&&this.getAxis("y").contain(n[2])&&this.getAxis("z").contain(n[1])},containData:function(n){return this.getAxis("x").containData(n[0])&&this.getAxis("y").containData(n[1])&&this.getAxis("z").containData(n[2])},dataToPoint:function(n,t,i){return t=t||[],t[0]=this.getAxis("x").dataToCoord(n[0],i),t[2]=this.getAxis("y").dataToCoord(n[1],i),t[1]=this.getAxis("z").dataToCoord(n[2],i),t},pointToData:function(n,t,i){return t=t||[],t[0]=this.getAxis("x").coordToData(n[0],i),t[1]=this.getAxis("y").coordToData(n[2],i),t[2]=this.getAxis("z").coordToData(n[1],i),t}};e.a.util.inherits(r,u.a);t.a=r},function(n,t,i){function e(n){return this._axes[n]}var u=i(13),r=function(n){this._axes={};this._dimList=[];this.name=n||""},f;r.prototype={constructor:r,type:"cartesian",getAxis:function(n){return this._axes[n]},getAxes:function(){return u.map(this._dimList,e,this)},getAxesByScale:function(n){return n=n.toLowerCase(),u.filter(this.getAxes(),function(t){return t.scale.type===n})},addAxis:function(n){var t=n.dim;this._axes[t]=n;this._dimList.push(t)},dataToCoord:function(n){return this._dataCoordConvert(n,"dataToCoord")},coordToData:function(n){return this._dataCoordConvert(n,"coordToData")},_dataCoordConvert:function(n,t){for(var i,e,u=this._dimList,f=n instanceof Array?[]:{},r=0;r<u.length;r++)i=u[r],e=this._axes[i],f[i]=e[t](n[i]);return f}};f=r;n.exports=f},function(n,t,i){"use strict";function r(n,t,i){u.a.Axis.call(this,n,t,i)}var f=i(0),u=i.n(f);r.prototype={constructor:r,getExtentMin:function(){var n=this._extent;return Math.min(n[0],n[1])},getExtentMax:function(){var n=this._extent;return Math.max(n[0],n[1])},calculateCategoryInterval:function(){return Math.floor(this.scale.count()/8)}};u.a.util.inherits(r,u.a.Axis);t.a=r},function(n,t,i){function c(n){return isNaN(n)?"-":(n=(n+"").split("."),n[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(n.length>1?"."+n[1]:""))}function l(n,t){return n=(n||"").toLowerCase().replace(/-(.)/g,function(n,t){return t.toUpperCase()}),t&&n&&(n=n.charAt(0).toUpperCase()+n.slice(1)),n}function u(n){return n==null?"":(n+"").replace(v,function(n,t){return y[t]})}function p(n,t,i){var l,h,c,a,r,o,v;if(f.isArray(t)||(t=[t]),l=t.length,!l)return"";for(h=t[0].$vars||[],c=0;c<h.length;c++)a=s[c],n=n.replace(e(a),e(a,0));for(r=0;r<l;r++)for(o=0;o<h.length;o++)v=t[r][h[o]],n=n.replace(e(s[o],r),i?u(v):v);return n}function w(n,t,i){return f.each(t,function(t,r){n=n.replace("{"+r+"}",i?u(t):t)}),n}function b(n,t){n=f.isString(n)?{color:n,extraCssText:t}:n||{};var i=n.color,r=n.type,t=n.extraCssText;return i?r==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+u(i)+";"+(t||"")+'"><\/span>':'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+u(i)+";"+(t||"")+'"><\/span>':""}function r(n,t){return n+="","0000".substr(0,t-n.length)+n}function k(n,t,i){(n==="week"||n==="month"||n==="quarter"||n==="half-year"||n==="year")&&(n="MM-dd\nyyyy");var u=h.parseDate(t),f=i?"UTC":"",e=u["get"+f+"FullYear"](),o=u["get"+f+"Month"]()+1,s=u["get"+f+"Date"](),c=u["get"+f+"Hours"](),l=u["get"+f+"Minutes"](),a=u["get"+f+"Seconds"](),v=u["get"+f+"Milliseconds"]();return n.replace("MM",r(o,2)).replace("M",o).replace("yyyy",e).replace("yy",e%100).replace("dd",r(s,2)).replace("d",s).replace("hh",r(c,2)).replace("h",c).replace("mm",r(l,2)).replace("m",l).replace("ss",r(a,2)).replace("s",a).replace("SSS",r(v,3))}function d(n){return n?n.charAt(0).toUpperCase()+n.substr(1):n}var f=i(13),o=i(172),h=i(85),a=f.normalizeCssArray,v=/([&<>"'])/g,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},s=["a","b","c","d","e","f","g"],e=function(n,t){return"{"+n+(t==null?"":t)+"}"},g=o.truncateText,nt=o.getBoundingRect;t.addCommas=c;t.toCamelCase=l;t.normalizeCssArray=a;t.encodeHTML=u;t.formatTpl=p;t.formatTplSimple=w;t.getTooltipMarker=b;t.formatTime=k;t.capitalFirst=d;t.truncateText=g;t.getTextRect=nt},function(n,t,i){function ot(n,t){c[n]=t}function r(n,t){var r,f,i,u,s;if(t=t||h,r=n+":"+t,e[r])return e[r];for(f=(n+"").split("\n"),i=0,u=0,s=f.length;u<s;u++)i=Math.max(g(f[u],t).width,i);return o>et&&(o=0,e={}),o++,e[r]=i,i}function st(n,t,i,r,u,f,e){return f?ct(n,t,i,r,u,f,e):ht(n,t,i,r,u,e)}function ht(n,t,i,u,f,e){var s=nt(n,t,f,e),o=r(n,t);f&&(o+=f[1]+f[3]);var h=s.outerHeight,v=l(0,o,i),y=a(0,h,u),c=new p(v,y,o,h);return c.lineHeight=s.lineHeight,c}function ct(n,t,i,r,u,f,e){var o=tt(n,{rich:f,truncate:e,font:t,textAlign:i,textPadding:u}),s=o.outerWidth,h=o.outerHeight,c=l(0,s,i),v=a(0,h,r);return new p(c,v,s,h)}function l(n,t,i){return i==="right"?n-=t:i==="center"&&(n-=t/2),n}function a(n,t,i){return i==="middle"?n-=t/2:i==="bottom"&&(n-=t),n}function lt(n,t,i){var r=t.x,u=t.y,s=t.height,o=t.width,h=s/2,f="left",e="top";switch(n){case"left":r-=i;u+=h;f="right";e="middle";break;case"right":r+=i+o;u+=h;e="middle";break;case"top":r+=o/2;u-=i;f="center";e="bottom";break;case"bottom":r+=o/2;u+=s+i;f="center";break;case"inside":r+=o/2;u+=h;f="center";e="middle";break;case"insideLeft":r+=i;u+=h;e="middle";break;case"insideRight":r+=o-i;u+=h;f="right";e="middle";break;case"insideTop":r+=o/2;u+=i;f="center";break;case"insideBottom":r+=o/2;u+=s-i;f="center";e="bottom";break;case"insideTopLeft":r+=i;u+=i;break;case"insideTopRight":r+=o-i;u+=i;f="right";break;case"insideBottomLeft":r+=i;u+=s-i;e="bottom";break;case"insideBottomRight":r+=o-i;u+=s-i;f="right";e="bottom"}return{x:r,y:u,textAlign:f,textVerticalAlign:e}}function b(n,t,i,r,u){var f,e,o;if(!t)return"";for(f=(n+"").split("\n"),u=k(t,i,r,u),e=0,o=f.length;e<o;e++)f[e]=d(f[e],u);return f.join("\n")}function k(n,t,i,f){var i,c,s,e,h,o;for(f=rt({},f),f.font=t,i=u(i,"..."),f.maxIterations=u(f.maxIterations,2),c=f.minChar=u(f.minChar,0),f.cnCharWidth=r("å›½",t),s=f.ascCharWidth=r("a",t),f.placeholder=u(f.placeholder,""),e=n=Math.max(0,n-1),h=0;h<c&&e>=s;h++)e-=s;return o=r(i),o>e&&(i="",o=0),e=n-o,f.ellipsis=i,f.ellipsisWidth=o,f.contentWidth=e,f.containerWidth=n,f}function d(n,t){var e=t.containerWidth,o=t.font,f=t.contentWidth,i,u,s;if(!e)return"";if(i=r(n,o),i<=e)return n;for(u=0;;u++){if(i<=f||u>=t.maxIterations){n+=t.ellipsis;break}s=u===0?at(n,f,t.ascCharWidth,t.cnCharWidth):i>0?Math.floor(n.length*f/i):0;n=n.substr(0,s);i=r(n,o)}return n===""&&(n=t.placeholder),n}function at(n,t,i,r){for(var f,e=0,u=0,o=n.length;u<o&&e<t;u++)f=n.charCodeAt(u),e+=0<=f&&f<=127?i:r;return u}function v(n){return r("å›½",n)}function g(n,t){return c.measureText(n,t)}function nt(n,t,i,r){var o,s,l,f,a;n!=null&&(n+="");var h=v(t),u=n?n.split("\n"):[],c=u.length*h,e=c;if(i&&(e+=i[0]+i[2]),n&&r)if(o=r.outerHeight,s=r.outerWidth,o!=null&&e>o)n="",u=[];else if(s!=null)for(l=k(s-(i?i[1]+i[3]:0),t,r.ellipsis,{minChar:r.minChar,placeholder:r.placeholder}),f=0,a=u.length;f<a;f++)u[f]=d(u[f],l);return{lines:u,height:c,outerHeight:e,lineHeight:h}}function tt(n,t){var e={lines:[],width:0,height:0},a,nt,lt,st,f,yt,pt,l,d,g,c,i,bt;if(n!=null&&(n+=""),!n)return e;for(a=s.lastIndex=0;(nt=s.exec(n))!=null;)lt=nt.index,lt>a&&y(e,n.substring(a,lt)),y(e,nt[2],nt[1]),a=s.lastIndex;a<n.length&&y(e,n.substring(a,n.length));var wt=e.lines,at=0,tt=0,vt=[],h=t.textPadding,p=t.truncate,it=p&&p.outerWidth,rt=p&&p.outerHeight;for(h&&(it!=null&&(it-=h[1]+h[3]),rt!=null&&(rt-=h[0]+h[2])),c=0;c<wt.length;c++){var ft=wt[c],et=0,ot=0;for(st=0;st<ft.tokens.length;st++){var i=ft.tokens[st],o=i.styleName&&t.rich[i.styleName]||{},k=i.textPadding=o.textPadding,ht=i.font=o.font||t.font,ct=i.textHeight=u(o.textHeight,v(ht));if(k&&(ct+=k[0]+k[2]),i.height=ct,i.lineHeight=ut(o.textLineHeight,t.textLineHeight,ct),i.textAlign=o&&o.textAlign||t.textAlign,i.textVerticalAlign=o&&o.textVerticalAlign||"middle",rt!=null&&at+i.lineHeight>rt)return{lines:[],width:0,height:0};i.textWidth=r(i.text,ht);f=o.textWidth;yt=f==null||f==="auto";typeof f=="string"&&f.charAt(f.length-1)==="%"?(i.percentWidth=f,vt.push(i),f=0):(yt&&(f=i.textWidth,pt=o.textBackgroundColor,l=pt&&pt.image,l&&(l=w.findExistImage(l),w.isImageReady(l)&&(f=Math.max(f,l.width*ct/l.height)))),d=k?k[1]+k[3]:0,f+=d,g=it!=null?it-ot:null,g!=null&&g<f&&(!yt||g<d?(i.text="",i.textWidth=f=0):(i.text=b(i.text,g-d,ht,p.ellipsis,{minChar:p.minChar}),i.textWidth=r(i.text,ht),f=i.textWidth+d)));ot+=i.width=f;o&&(et=Math.max(et,i.lineHeight))}ft.width=ot;ft.lineHeight=et;at+=et;tt=Math.max(tt,ot)}for(e.outerWidth=e.width=u(t.textWidth,tt),e.outerHeight=e.height=u(t.textHeight,at),h&&(e.outerWidth+=h[1]+h[3],e.outerHeight+=h[0]+h[2]),c=0;c<vt.length;c++)i=vt[c],bt=i.percentWidth,i.width=parseInt(bt,10)/100*tt;return e}function y(n,t,i){for(var e,o,r,s,h=t==="",c=t.split("\n"),u=n.lines,f=0;f<c.length;f++)e=c[f],o={styleName:i,text:e,isLineHolder:!e&&!h},f?u.push({tokens:[o]}):(r=(u[u.length-1]||(u[0]={tokens:[]})).tokens,s=r.length,s===1&&r[0].isLineHolder?r[0]=o:(e||!s||h)&&r.push(o))}function vt(n){var t=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");return t&&ft(t)||n.textFont||n.font}var p=i(82),w=i(173),f=i(13),it=f.getContext,rt=f.extend,u=f.retrieve2,ut=f.retrieve3,ft=f.trim,e={},o=0,et=5e3,s=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,h="12px sans-serif",c={};c.measureText=function(n,t){var i=it();return i.font=t||h,i.measureText(n)};t.DEFAULT_FONT=h;t.$override=ot;t.getWidth=r;t.getBoundingRect=st;t.adjustTextX=l;t.adjustTextY=a;t.adjustTextPositionOnRect=lt;t.truncateText=b;t.getLineHeight=v;t.measureText=g;t.parsePlainText=nt;t.parseRichText=tt;t.makeFont=vt},function(n,t,i){function e(n){if(typeof n=="string"){var t=r.get(n);return t&&t.image}return n}function o(n,t,i,f,e){if(n){if(typeof n=="string"){if(t&&t.__zrImageSrc===n||!i)return t;var o=r.get(n),h={hostEl:i,cb:f,cbPayload:e};return o?(t=o.image,u(t)||o.pending.push(h)):(t||(t=new Image),t.onload=s,r.put(n,t.__cachedImgObj={image:t,pending:[h]}),t.src=t.__zrImageSrc=n),t}return n}return t}function s(){var i=this.__cachedImgObj,n,t,r;for(this.onload=this.__cachedImgObj=null,n=0;n<i.pending.length;n++)t=i.pending[n],r=t.cb,r&&r(this,t.cbPayload),t.hostEl.dirty();i.pending.length=0}function u(n){return n&&n.width&&n.height}var f=i(60),r=new f(50);t.findExistImage=e;t.createOrUpdateImage=o;t.isImageReady=u},function(n,t,i){"use strict";function v(n,t,i){if(i==="alphaMap")return n.material.get("diffuseMap");if(i==="alphaCutoff"){if(n.material.isDefined("fragment","ALPHA_TEST")&&n.material.get("diffuseMap")){var r=n.material.get("alphaCutoff");return r||0}return 0}return t.get(i)}function w(n,t){var i=n.material,r=t.material;return i.get("diffuseMap")!==r.get("diffuseMap")||(i.get("alphaCutoff")||0)!==(r.get("alphaCutoff")||0)}var b=i(7),y=i(11),r=i(3),c=i(18),k=i(59),f=i(9),l=i(52),s=i(8),d=i(19),g=i(10),p=i(4),nt=i(5),tt=i(27),e=i(41),it=i(37),a=i(16),rt=i(86),h=i(21),ut=i(175),o=["px","nx","py","ny","pz","nz"],u;s.a["import"](ut.a);u=b.a.extend(function(){return{softShadow:u.PCF,shadowBlur:1,lightFrustumBias:"auto",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:"highp",_lastRenderNotCastShadow:!1,_frameBuffer:new g.a,_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new rt.a}},function(){this._gaussianPassH=new a.a({fragment:s.a.source("clay.compositor.gaussian_blur")});this._gaussianPassV=new a.a({fragment:s.a.source("clay.compositor.gaussian_blur")});this._gaussianPassH.setUniform("blurSize",this.shadowBlur);this._gaussianPassH.setUniform("blurDir",0);this._gaussianPassV.setUniform("blurSize",this.shadowBlur);this._gaussianPassV.setUniform("blurDir",1);this._outputDepthPass=new a.a({fragment:s.a.source("clay.sm.debug_depth")})},{render:function(n,t,i,r){i||(i=t.getMainCamera());this.trigger("beforerender",this,n,t,i);this._renderShadowPass(n,t,i,r);this.trigger("afterrender",this,n,t,i)},renderDebug:function(n,t){var o,i;n.saveClear();var f=n.viewport,e=0,r=t||f.width/4,s=r;this.softShadow===u.VSM?this._outputDepthPass.material.define("fragment","USE_VSM"):this._outputDepthPass.material.undefine("fragment","USE_VSM");for(o in this._textures)i=this._textures[o],n.setViewport(e,0,r*i.width/i.height,s),this._outputDepthPass.setUniform("depthMap",i),this._outputDepthPass.render(n),e+=r*i.width/i.height;n.setViewport(f);n.restoreClear()},_updateReceivers:function(n,t){if(t.receiveShadow?(this._receivers.push(t),t.material.set("shadowEnabled",1),t.material.set("pcfKernel",this.kernelPCF)):t.material.set("shadowEnabled",0),this.softShadow===u.VSM)t.material.define("fragment","USE_VSM"),t.material.undefine("fragment","PCF_KERNEL_SIZE");else{t.material.undefine("fragment","USE_VSM");var i=this.kernelPCF;i&&i.length?t.material.define("fragment","PCF_KERNEL_SIZE",i.length/2):t.material.undefine("fragment","PCF_KERNEL_SIZE")}},_update:function(n,t){var u=this,i,r;for(t.traverse(function(t){t.isRenderable()&&u._updateReceivers(n,t)}),i=0;i<t.lights.length;i++)r=t.lights[i],r.castShadow&&!r.invisible&&this._lightsCastShadow.push(r)},_renderShadowPass:function(n,t,i,r){function it(n){return n.height}var nt,s,f,g,v,c,u,y,o,rt,p,w,ut,e;for(nt in this._shadowMapNumber)this._shadowMapNumber[nt]=0;if(this._lightsCastShadow.length=0,this._receivers.length=0,s=n.gl,r||t.update(),i&&i.update(),t.updateLights(),this._update(n,t),this._lightsCastShadow.length||!this._lastRenderNotCastShadow){this._lastRenderNotCastShadow=this._lightsCastShadow===0;s.enable(s.DEPTH_TEST);s.depthMask(!0);s.disable(s.BLEND);s.clearColor(1,1,1,1);var l=[],tt=[],a=[],b=[],k=[],d=[],h;for(u=0;u<this._lightsCastShadow.length;u++){if(f=this._lightsCastShadow[u],f.type==="DIRECTIONAL_LIGHT"){if(h){console.warn("Only one direectional light supported with shadow cascade");continue}if(f.shadowCascade>4){console.warn("Support at most 4 cascade");continue}f.shadowCascade>1&&(h=f);this.renderDirectionalLightShadow(n,t,i,f,k,b,a)}else f.type==="SPOT_LIGHT"?this.renderSpotLightShadow(n,t,f,tt,l):f.type==="POINT_LIGHT"&&this.renderPointLightShadow(n,t,f,d);this._shadowMapNumber[f.type]++}for(g in this._shadowMapNumber)for(v=this._shadowMapNumber[g],c=g+"_SHADOWMAP_COUNT",u=0;u<this._receivers.length;u++)y=this._receivers[u],o=y.material,o.fragmentDefines[c]!==v&&(v>0?o.define("fragment",c,v):o.isDefined("fragment",c)&&o.undefine("fragment",c));for(u=0;u<this._receivers.length;u++)y=this._receivers[u],o=y.material,h?o.define("fragment","SHADOW_CASCADE",h.shadowCascade):o.undefine("fragment","SHADOW_CASCADE");e=t.shadowUniforms;a.length>0&&(rt=a.map(it),e.directionalLightShadowMaps={value:a,type:"tv"},e.directionalLightMatrices={value:b,type:"m4v"},e.directionalLightShadowMapSizes={value:rt,type:"1fv"},h&&(p=k.slice(),w=k.slice(),p.pop(),w.shift(),p.reverse(),w.reverse(),b.reverse(),e.shadowCascadeClipsNear={value:p,type:"1fv"},e.shadowCascadeClipsFar={value:w,type:"1fv"}));l.length>0&&(ut=l.map(it),e=t.shadowUniforms,e.spotLightShadowMaps={value:l,type:"tv"},e.spotLightMatrices={value:tt,type:"m4v"},e.spotLightShadowMapSizes={value:ut,type:"1fv"});d.length>0&&(e.pointLightShadowMaps={value:d,type:"tv"})}},renderDirectionalLightShadow:function(){var o=new k.a,r=new f.a,t=new c.a,s=new f.a,n=new f.a,a=new f.a,i=new f.a;return function(c,y,p,b,k,d,g){var bt=this._getDepthMaterial(b),kt={getMaterial:function(n){return n.shadowDepthMaterial||bt},isMaterialChanged:w,getUniform:v,ifRender:function(n){return n.castShadow},sortCompare:l.a.opaqueSortCompare},vt,ut,pt,et,nt,ct,lt,it,rt,ot,wt,at;y.viewBoundingBoxLastFrame.isFinite()||(vt=y.getBoundingBox(),y.viewBoundingBoxLastFrame.copy(vt).applyTransform(p.viewMatrix));var yt=Math.min(-y.viewBoundingBoxLastFrame.min.z,p.far),ft=Math.max(-y.viewBoundingBoxLastFrame.max.z,p.near),tt=this._getDirectionalLightCamera(b,y,p),dt=a.array;i.copy(tt.projectionMatrix);h.a.invert(n.array,tt.worldTransform.array);h.a.multiply(n.array,n.array,p.worldTransform.array);h.a.multiply(dt,i.array,n.array);var st=[],gt=p instanceof e.a,ni=(p.near+p.far)/(p.near-p.far),ti=2*p.near*p.far/(p.near-p.far);for(nt=0;nt<=b.shadowCascade;nt++){var ii=ft*Math.pow(yt/ft,nt/b.shadowCascade),ri=ft+(yt-ft)*nt/b.shadowCascade,ht=ii*b.cascadeSplitLogFactor+ri*(1-b.cascadeSplitLogFactor);st.push(ht);k.push(-(-ht*ni+ti)/-ht)}for(ut=this._getTexture(b,b.shadowCascade),g.push(ut),pt=c.viewport,et=c.gl,this._frameBuffer.attach(ut),this._frameBuffer.bind(c),et.clear(et.COLOR_BUFFER_BIT|et.DEPTH_BUFFER_BIT),nt=0;nt<b.shadowCascade;nt++)ct=st[nt],lt=st[nt+1],gt?h.a.perspective(r.array,p.fov/180*Math.PI,p.aspect,ct,lt):h.a.ortho(r.array,p.left,p.right,p.bottom,p.top,ct,lt),o.setFromProjection(r),o.getTransformedBoundingBox(t,n),t.applyProjection(i),it=t.min.array,rt=t.max.array,it[0]=Math.max(it[0],-1),it[1]=Math.max(it[1],-1),rt[0]=Math.min(rt[0],1),rt[1]=Math.min(rt[1],1),s.ortho(it[0],rt[0],it[1],rt[1],1,-1),tt.projectionMatrix.multiplyLeft(s),ot=b.shadowResolution||512,c.setViewport((b.shadowCascade-nt-1)*ot,0,ot,ot,1),wt=y.updateRenderList(tt),c.renderPass(wt.opaque,tt,kt),this.softShadow===u.VSM&&this._gaussianFilter(c,ut,ut.width),at=new f.a,at.copy(tt.viewMatrix).multiplyLeft(tt.projectionMatrix),d.push(at.array),tt.projectionMatrix.copy(i);this._frameBuffer.unbind(c);c.setViewport(pt)}}(),renderSpotLightShadow:function(n,t,i,r,e){var o=this._getTexture(i),s=this._getSpotLightCamera(i),h=n.gl,c;this._frameBuffer.attach(o);this._frameBuffer.bind(n);h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);var a=this._getDepthMaterial(i),y={getMaterial:function(n){return n.shadowDepthMaterial||a},isMaterialChanged:w,getUniform:v,ifRender:function(n){return n.castShadow},sortCompare:l.a.opaqueSortCompare},p=t.updateRenderList(s);n.renderPass(p.opaque,s,y);this._frameBuffer.unbind(n);this.softShadow===u.VSM&&this._gaussianFilter(n,o,o.width);c=new f.a;c.copy(s.worldTransform).invert().multiplyLeft(s.projectionMatrix);e.push(o);r.push(c.array)},renderPointLightShadow:function(n,t,i,u){var d=this._getTexture(i),e=n.gl,b,f,a,k,g;u.push(d);var nt=this._getDepthMaterial(i),tt={getMaterial:function(n){return n.shadowDepthMaterial||nt},getUniform:v,sortCompare:l.a.opaqueSortCompare},p={px:[],py:[],pz:[],nx:[],ny:[],nz:[]},y=new c.a,s=i.getWorldPosition().array,h=new c.a,w=i.range;for(h.min.setArray(s),h.max.setArray(s),b=new r.a(w,w,w),h.max.add(b),h.min.sub(b),f={px:!1,py:!1,pz:!1,nx:!1,ny:!1,nz:!1},t.traverse(function(n){var i,t;if(n.isRenderable()&&n.castShadow){if(i=n.geometry,!i.boundingBox){for(t=0;t<o.length;t++)p[o[t]].push(n);return}if(y.transformFrom(i.boundingBox,n.worldTransform),!y.intersectBoundingBox(h))return;for(y.updateVertices(),t=0;t<o.length;t++)f[o[t]]=!1;for(t=0;t<8;t++){var r=y.vertices[t],e=r[0]-s[0],c=r[1]-s[1],u=r[2]-s[2],l=Math.abs(e),a=Math.abs(c),v=Math.abs(u);l>a?l>v?f[e>0?"px":"nx"]=!0:f[u>0?"pz":"nz"]=!0:a>v?f[c>0?"py":"ny"]=!0:f[u>0?"pz":"nz"]=!0}for(t=0;t<o.length;t++)f[o[t]]&&p[o[t]].push(n)}}),a=0;a<6;a++)k=o[a],g=this._getPointLightCamera(i,k),this._frameBuffer.attach(d,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+a),this._frameBuffer.bind(n),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),n.renderPass(p[k],g,tt);this._frameBuffer.unbind(n)},_getDepthMaterial:function(n){var t=this._lightMaterials[n.__uid__],r=n.type==="POINT_LIGHT",i;return t||(i=r?"clay.sm.distance.":"clay.sm.depth.",t=new d.a({precision:this.precision,shader:new s.a(s.a.source(i+"vertex"),s.a.source(i+"fragment"))}),this._lightMaterials[n.__uid__]=t),n.shadowSlopeScale!=null&&t.setUniform("slopeScale",n.shadowSlopeScale),n.shadowBias!=null&&t.setUniform("bias",n.shadowBias),this.softShadow===u.VSM?t.define("fragment","USE_VSM"):t.undefine("fragment","USE_VSM"),r&&(t.set("lightPosition",n.getWorldPosition().array),t.set("range",n.range)),t},_gaussianFilter:function(n,t,i){var u={width:i,height:i,type:p.a.FLOAT},r=this._texturePool.get(u);this._frameBuffer.attach(r);this._frameBuffer.bind(n);this._gaussianPassH.setUniform("texture",t);this._gaussianPassH.setUniform("textureWidth",i);this._gaussianPassH.render(n);this._frameBuffer.attach(t);this._gaussianPassV.setUniform("texture",r);this._gaussianPassV.setUniform("textureHeight",i);this._gaussianPassV.render(n);this._frameBuffer.unbind(n);this._texturePool.put(r)},_getTexture:function(n,t){var r=n.__uid__,i=this._textures[r],f=n.shadowResolution||512;return t=t||1,i||(i=n.type==="POINT_LIGHT"?new tt.a:new nt.a,i.width=f*t,i.height=f,this.softShadow===u.VSM?(i.type=p.a.FLOAT,i.anisotropic=4):(i.minFilter=y.a.NEAREST,i.magFilter=y.a.NEAREST,i.useMipmap=!1),this._textures[r]=i),i},_getPointLightCamera:function(n,t){this._lightCameras.point||(this._lightCameras.point={px:new e.a,nx:new e.a,py:new e.a,ny:new e.a,pz:new e.a,nz:new e.a});var i=this._lightCameras.point[t];i.far=n.range;i.fov=90;i.position.set(0,0,0);switch(t){case"px":i.lookAt(r.a.POSITIVE_X,r.a.NEGATIVE_Y);break;case"nx":i.lookAt(r.a.NEGATIVE_X,r.a.NEGATIVE_Y);break;case"py":i.lookAt(r.a.POSITIVE_Y,r.a.POSITIVE_Z);break;case"ny":i.lookAt(r.a.NEGATIVE_Y,r.a.NEGATIVE_Z);break;case"pz":i.lookAt(r.a.POSITIVE_Z,r.a.NEGATIVE_Y);break;case"nz":i.lookAt(r.a.NEGATIVE_Z,r.a.NEGATIVE_Y)}return n.getWorldPosition(i.position),i.update(),i},_getDirectionalLightCamera:function(){var t=new f.a,n=new c.a,i=new c.a;return function(r,u,e){var o,h,s;return this._lightCameras.directional||(this._lightCameras.directional=new it.a),o=this._lightCameras.directional,n.copy(u.viewBoundingBoxLastFrame),n.intersection(e.frustum.boundingBox),o.position.copy(n.min).add(n.max).scale(.5).transformMat4(e.worldTransform),o.rotation.copy(r.rotation),o.scale.copy(r.scale),o.updateWorldTransform(),f.a.invert(t,o.worldTransform),f.a.multiply(t,t,e.worldTransform),i.copy(n).applyTransform(t),h=i.min.array,s=i.max.array,o.position.set((h[0]+s[0])/2,(h[1]+s[1])/2,s[2]).transformMat4(o.worldTransform),o.near=0,o.far=-h[2]+s[2],isNaN(this.lightFrustumBias)?o.far*=4:o.far+=this.lightFrustumBias,o.left=h[0],o.right=s[0],o.top=s[1],o.bottom=h[1],o.update(!0),o}}(),_getSpotLightCamera:function(n){this._lightCameras.spot||(this._lightCameras.spot=new e.a);var t=this._lightCameras.spot;return t.fov=n.penumbraAngle*2,t.far=n.range,t.worldTransform.copy(n.worldTransform),t.updateProjectionMatrix(),h.a.invert(t.viewMatrix.array,t.worldTransform.array),t},dispose:function(n){var u=n.gl||n,f,i,r,t;this._frameBuffer&&this._frameBuffer.dispose(u);for(f in this._textures)this._textures[f].dispose(u);for(this._texturePool.clear(n.gl),this._depthMaterials={},this._distanceMaterials={},this._textures={},this._lightCameras={},this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},this._meshMaterials={},i=0;i<this._receivers.length;i++)r=this._receivers[i],r.material&&(t=r.material,t.undefine("fragment","POINT_LIGHT_SHADOW_COUNT"),t.undefine("fragment","DIRECTIONAL_LIGHT_SHADOW_COUNT"),t.undefine("fragment","AMBIENT_LIGHT_SHADOW_COUNT"),t.set("shadowEnabled",0));this._receivers=[];this._lightsCastShadow=[]}});u.VSM=1;u.PCF=2;t.a=u},function(n,t){"use strict";t.a="@export clay.sm.depth.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n@import clay.chunk.skinning_header\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nvoid main(){\n vec3 skinnedPosition = position;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n#endif\n v_ViewPosition = worldViewProjection * vec4(skinnedPosition, 1.0);\n gl_Position = v_ViewPosition;\n v_Texcoord = texcoord;\n}\n@end\n@export clay.sm.depth.fragment\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nuniform float bias : 0.001;\nuniform float slopeScale : 1.0;\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\n@import clay.util.encode_float\nvoid main(){\n float depth = v_ViewPosition.z / v_ViewPosition.w;\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n#ifdef USE_VSM\n depth = depth * 0.5 + 0.5;\n float moment1 = depth;\n float moment2 = depth * depth;\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n moment2 += 0.25*(dx*dx+dy*dy);\n gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\n#else\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;\n gl_FragColor = encodeFloat(depth * 0.5 + 0.5);\n#endif\n}\n@end\n@export clay.sm.debug_depth\nuniform sampler2D depthMap;\nvarying vec2 v_Texcoord;\n@import clay.util.decode_float\nvoid main() {\n vec4 tex = texture2D(depthMap, v_Texcoord);\n#ifdef USE_VSM\n gl_FragColor = vec4(tex.rgb, 1.0);\n#else\n float depth = decodeFloat(tex);\n gl_FragColor = vec4(depth, depth, depth, 1.0);\n#endif\n}\n@end\n@export clay.sm.distance.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 world : WORLD;\nattribute vec3 position : POSITION;\n@import clay.chunk.skinning_header\nvarying vec3 v_WorldPosition;\nvoid main (){\n vec3 skinnedPosition = position;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n#endif\n gl_Position = worldViewProjection * vec4(skinnedPosition , 1.0);\n v_WorldPosition = (world * vec4(skinnedPosition, 1.0)).xyz;\n}\n@end\n@export clay.sm.distance.fragment\nuniform vec3 lightPosition;\nuniform float range : 100;\nvarying vec3 v_WorldPosition;\n@import clay.util.encode_float\nvoid main(){\n float dist = distance(lightPosition, v_WorldPosition);\n#ifdef USE_VSM\n gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);\n#else\n dist = dist / range;\n gl_FragColor = encodeFloat(dist);\n#endif\n}\n@end\n@export clay.plugin.shadow_map_common\n@import clay.util.decode_float\nfloat tapShadowMap(sampler2D map, vec2 uv, float z){\n vec4 tex = texture2D(map, uv);\n return step(z, decodeFloat(tex) * 2.0 - 1.0);\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {\n float shadowContrib = tapShadowMap(map, uv, z);\n vec2 offset = vec2(1.0 / textureSize) * scale;\n#ifdef PCF_KERNEL_SIZE\n for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{\n shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);\n }}\n return shadowContrib / float(PCF_KERNEL_SIZE + 1);\n#else\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);\n return shadowContrib / 9.0;\n#endif\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize) {\n return pcf(map, uv, z, textureSize, vec2(1.0));\n}\nfloat chebyshevUpperBound(vec2 moments, float z){\n float p = 0.0;\n z = z * 0.5 + 0.5;\n if (z <= moments.x) {\n p = 1.0;\n }\n float variance = moments.y - moments.x * moments.x;\n variance = max(variance, 0.0000001);\n float mD = moments.x - z;\n float pMax = variance / (variance + mD * mD);\n pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);\n return max(p, pMax);\n}\nfloat computeShadowContrib(\n sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset\n) {\n vec4 posInLightSpace = lightVPM * vec4(position, 1.0);\n posInLightSpace.xyz /= posInLightSpace.w;\n float z = posInLightSpace.z;\n if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&\n all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){\n vec2 uv = (posInLightSpace.xy+1.0) / 2.0;\n #ifdef USE_VSM\n vec2 moments = texture2D(map, uv * scale + offset).xy;\n return chebyshevUpperBound(moments, z);\n #else\n return pcf(map, uv * scale + offset, z, textureSize, scale);\n #endif\n }\n return 1.0;\n}\nfloat computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {\n return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));\n}\nfloat computeShadowContribOmni(samplerCube map, vec3 direction, float range)\n{\n float dist = length(direction);\n vec4 shadowTex = textureCube(map, direction);\n#ifdef USE_VSM\n vec2 moments = shadowTex.xy;\n float variance = moments.y - moments.x * moments.x;\n float mD = moments.x - dist;\n float p = variance / (variance + mD * mD);\n if(moments.x + 0.001 < dist){\n return clamp(p, 0.0, 1.0);\n }else{\n return 1.0;\n }\n#else\n return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);\n#endif\n}\n@end\n@export clay.plugin.compute_shadow_map\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)\n#ifdef SPOT_LIGHT_SHADOWMAP_COUNT\nuniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT\n#if defined(SHADOW_CASCADE)\nuniform sampler2D directionalLightShadowMaps[1]:unconfigurable;\nuniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;\nuniform float directionalLightShadowMapSizes[1]:unconfigurable;\nuniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;\nuniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;\n#else\nuniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#endif\n#ifdef POINT_LIGHT_SHADOWMAP_COUNT\nuniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\nuniform bool shadowEnabled : true;\n#ifdef PCF_KERNEL_SIZE\nuniform vec2 pcfKernel[PCF_KERNEL_SIZE];\n#endif\n@import clay.plugin.shadow_map_common\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,\n spotLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n#ifdef SHADOW_CASCADE\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n / (gl_DepthRange.far - gl_DepthRange.near);\n float shadowContrib;\n shadowContribs[0] = 1.0;\n for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{\n if (\n depth >= shadowCascadeClipsNear[_idx_] &&\n depth <= shadowCascadeClipsFar[_idx_]\n ) {\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[0],\n vec2(1.0 / float(SHADOW_CASCADE), 1.0),\n vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)\n );\n shadowContribs[0] = shadowContrib;\n }\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#else\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n#if defined(POINT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){\n vec3 lightPosition;\n vec3 direction;\n for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n lightPosition = pointLightPosition[_idx_];\n direction = position - lightPosition;\n shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);\n }}\n for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n@end"},function(n,t,i){"use strict";function r(){var t,i,n;this._sourceTexture=new h.a({type:o.a.HALF_FLOAT});this._depthTexture=new h.a({format:o.a.DEPTH_COMPONENT,type:o.a.UNSIGNED_INT});this._framebuffer=new c.a;this._framebuffer.attach(this._sourceTexture);this._framebuffer.attach(this._depthTexture,c.a.DEPTH_ATTACHMENT);this._normalPass=new p.a;this._compositor=Object(a.a)(b.a);t=this._compositor.getNodeByName("source");t.texture=this._sourceTexture;i=this._compositor.getNodeByName("coc");this._sourceNode=t;this._cocNode=i;this._compositeNode=this._compositor.getNodeByName("composite");this._fxaaNode=this._compositor.getNodeByName("FXAA");this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map(function(n){return this._compositor.getNodeByName(n)},this);this._dofBlurKernel=0;this._dofBlurKernelSize=new Float32Array(0);this._finalNodesChain=e.map(function(n){return this._compositor.getNodeByName(n)},this);n={normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()};this._ssaoPass=new v.a(n);this._ssrPass=new y.a(n);this._edgePass=new w.a(n)}var u=i(8),h=i(5),o=i(4),c=i(10),a=i(177),v=i(189),y=i(191),l=i(193),s=i(1),p=i(194),w=i(196),st=i(9),b=i(197),k=i(87),d=i(88),g=i(89),nt=i(90),tt=i(91),it=i(92),rt=i(93),ut=i(94),ft=i(95),et=i(198),ot=i(199),f,e;u.a["import"](k.a);u.a["import"](d.a);u.a["import"](g.a);u.a["import"](nt.a);u.a["import"](tt.a);u.a["import"](it.a);u.a["import"](rt.a);u.a["import"](ut.a);u.a["import"](ft.a);u.a["import"](et.a);u.a["import"](ot.a);f={color:{parameters:{width:function(n){return n.getWidth()},height:function(n){return n.getHeight()}}}};e=["composite","FXAA"];r.prototype.resize=function(n,t,i){i=i||1;var n=n*i,t=t*i,r=this._sourceTexture,u=this._depthTexture;r.width=n;r.height=t;u.width=n;u.height=t};r.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR};r.prototype._getPrevNode=function(n){for(var i=e.indexOf(n.name)-1,t=this._finalNodesChain[i];t&&!this._compositor.getNodeByName(t.name);)i-=1,t=this._finalNodesChain[i];return t};r.prototype._getNextNode=function(n){for(var i=e.indexOf(n.name)+1,t=this._finalNodesChain[i];t&&!this._compositor.getNodeByName(t.name);)i+=1,t=this._finalNodesChain[i];return t};r.prototype._addChainNode=function(n){var t=this._getPrevNode(n),i=this._getNextNode(n);t&&(t.outputs=f,n.inputs.texture=t.name,i?(n.outputs=f,i.inputs.texture=n.name):n.outputs=null,this._compositor.addNode(n))};r.prototype._removeChainNode=function(n){var t=this._getPrevNode(n),i=this._getNextNode(n);t&&(i?(t.outputs=f,i.inputs.texture=t.name):t.outputs=null,this._compositor.removeNode(n))};r.prototype.updateNormal=function(n,t,i){this._ifRenderNormalPass()&&this._normalPass.update(n,t,i)};r.prototype.updateSSAO=function(n,t,i,r){this._ssaoPass.update(n,i,r)};r.prototype.enableSSAO=function(){this._enableSSAO=!0};r.prototype.disableSSAO=function(){this._enableSSAO=!1};r.prototype.enableSSR=function(){this._enableSSR=!0};r.prototype.disableSSR=function(){this._enableSSR=!1};r.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()};r.prototype.getSourceFrameBuffer=function(){return this._framebuffer};r.prototype.getSourceTexture=function(){return this._sourceTexture};r.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)};r.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)};r.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite";this._compositor.dirty()};r.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null;this._compositor.dirty()};r.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite";this._compositor.dirty()};r.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source";this._compositor.dirty()};r.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION");this._enableColorCorrection=!0};r.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION");this._enableColorCorrection=!1};r.prototype.enableEdge=function(){this._enableEdge=!0};r.prototype.disableEdge=function(){this._enableEdge=!1};r.prototype.setBloomIntensity=function(n){this._compositeNode.setParameter("bloomIntensity",n)};r.prototype.setSSAOParameter=function(n,t){switch(n){case"quality":var i={low:6,medium:12,high:32,ultra:62}[t]||12;this._ssaoPass.setParameter("kernelSize",i);break;case"radius":this._ssaoPass.setParameter(n,t);this._ssaoPass.setParameter("bias",t/200);break;case"intensity":this._ssaoPass.setParameter(n,t);break;default:!0&&console.warn("Unkown SSAO parameter "+n)}};r.prototype.setDOFParameter=function(n,t){var r,i;switch(n){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(n,t);break;case"blurRadius":for(i=0;i<this._dofBlurNodes.length;i++)this._dofBlurNodes[i].setParameter("blurRadius",t);break;case"quality":for(r={low:4,medium:8,high:16,ultra:32}[t]||8,this._dofBlurKernelSize=r,i=0;i<this._dofBlurNodes.length;i++)this._dofBlurNodes[i].pass.material.define("POISSON_KERNEL_SIZE",r);this._dofBlurKernel=new Float32Array(r*2);break;default:!0&&console.warn("Unkown DOF parameter "+n)}};r.prototype.setSSRParameter=function(n,t){if(t!=null)switch(n){case"quality":var i={low:10,medium:15,high:30,ultra:80}[t]||20,r={low:32,medium:16,high:8,ultra:4}[t]||16;this._ssrPass.setParameter("maxIteration",i);this._ssrPass.setParameter("pixelStride",r);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-t,1),0));break;case"physical":this.setPhysicallyCorrectSSR(t);break;default:console.warn("Unkown SSR parameter "+n)}};r.prototype.setPhysicallyCorrectSSR=function(n){this._ssrPass.setPhysicallyCorrect(n)};r.prototype.setEdgeColor=function(n){var t=s.a.parseColor(n);this._edgePass.setParameter("edgeColor",t)};r.prototype.setExposure=function(n){this._compositeNode.setParameter("exposure",Math.pow(2,n))};r.prototype.setColorLookupTexture=function(n,t){this._compositeNode.pass.material.setTextureImage("lut",this._enableColorCorrection?n:"none",t,{minFilter:s.a.Texture.NEAREST,magFilter:s.a.Texture.NEAREST,flipY:!1})};r.prototype.setColorCorrection=function(n,t){this._compositeNode.setParameter(n,t)};r.prototype.isSSREnabled=function(){return this._enableSSR};r.prototype.composite=function(n,t,i,r,u){var e=this._sourceTexture,o=e,f;this._enableEdge&&(this._edgePass.update(n,i,e,u),e=o=this._edgePass.getTargetTexture());this._enableSSR&&(this._ssrPass.update(n,i,e,u),o=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null));this._sourceNode.texture=o;this._cocNode.setParameter("depth",this._depthTexture);var h=this._dofBlurKernel,s=this._dofBlurKernelSize,c=Math.floor(l.a.length/2/s),a=u%c;for(f=0;f<s*2;f++)h[f]=l.a[f+a*s*2];for(f=0;f<this._dofBlurNodes.length;f++)this._dofBlurNodes[f].setParameter("percent",u/30),this._dofBlurNodes[f].setParameter("poissonKernel",h);this._cocNode.setParameter("zNear",i.near);this._cocNode.setParameter("zFar",i.far);this._compositor.render(n,r)};r.prototype.dispose=function(n){this._sourceTexture.dispose(n);this._depthTexture.dispose(n);this._framebuffer.dispose(n);this._compositor.dispose(n);this._normalPass.dispose(n);this._ssaoPass.dispose(n)};t.a=r},function(n,t,i){"use strict";var r=i(178);t.a=r.a},function(n,t,i){"use strict";function w(n,t){var f=new s.a,i,e,r,o;t=t||{};i={textures:{},parameters:{}};e=function(){for(var e,u,r=0;r<n.nodes.length;r++)e=n.nodes[r],u=b(e,i,t),u&&f.addNode(u)};for(r in n.parameters)o=n.parameters[r],i.parameters[r]=u(o);return g(n,i,t,function(n){i.textures=n;e()}),f}function b(n,t,i){var b=n.type||"filter",p,k,a,w,d,v,y,r,s;if(b!=="filter"||(w=n.shader.trim(),d=e.exec(w),d?p=f.a.source(d[1].trim()):w.charAt(0)==="#"&&(p=t.shaders[w.substr(1)]),p||(p=w),p)){if(n.inputs){k={};for(r in n.inputs)k[r]=typeof n.inputs[r]=="string"?n.inputs[r]:{node:n.inputs[r].node,pin:n.inputs[r].pin}}if(n.outputs){a={};for(r in n.outputs)v=n.outputs[r],a[r]={},v.attachment!=null&&(a[r].attachment=v.attachment),v.keepLastFrame!=null&&(a[r].keepLastFrame=v.keepLastFrame),v.outputLastFrame!=null&&(a[r].outputLastFrame=v.outputLastFrame),v.parameters&&(a[r].parameters=u(v.parameters))}if(y=b==="scene"?new h.a({name:n.name,scene:i.scene,camera:i.camera,outputs:a}):b==="texture"?new c.a({name:n.name,outputs:a}):new l.a({name:n.name,shader:p,inputs:k,outputs:a}),y){if(n.parameters)for(r in n.parameters){if(s=n.parameters[r],typeof s=="string")if(s=s.trim(),s.charAt(0)==="#")s=t.textures[s.substr(1)];else y.on("beforerender",nt(r,o(s)));y.setParameter(r,s)}if(n.defines&&y.pass)for(r in n.defines)s=n.defines[r],y.pass.material.define("fragment",r,s)}return y}}function k(n){return n}function d(n,t){return t}function u(n){var t={},i;return n?(["type","minFilter","magFilter","wrapS","wrapT","flipY","useMipmap"].forEach(function(i){var r=n[i];r!=null&&(typeof r=="string"&&(r=a.a[r]),t[i]=r)}),i=n.scale||1,["width","height"].forEach(function(r){if(n[r]!=null){var u=n[r];typeof u=="string"?(u=u.trim(),t[r]=tt(r,o(u),i)):t[r]=u}}),t.width||(t.width=k),t.height||(t.height=d),n.useMipmap!=null&&(t.useMipmap=n.useMipmap),t):t}function g(n,t,i,f){if(!n.textures){f({});return}var s={},e=0,h=!1,o=i.textureRootPath;r.a.each(n.textures,function(n,t){var c,i=n.path,l=u(n.parameters);if(Array.isArray(i)&&i.length===6)o&&(i=i.map(function(n){return r.a.relative2absolute(n,o)})),c=new y.a(l);else if(typeof i=="string")o&&(i=r.a.relative2absolute(i,o)),c=new v.a(l);else return;c.load(i);e++;c.once("success",function(){s[t]=c;e--;e===0&&(f(s),h=!0)})});e!==0||h||f(s)}function nt(n,t){return function(i){var r=i.getDevicePixelRatio(),u=i.getWidth(),f=i.getHeight(),e=t(u,f,r);this.setParameter(n,e)}}function tt(n,t,i){return i=i||1,function(n){var r=n.getDevicePixelRatio(),u=n.getWidth()*i,f=n.getHeight()*i;return t(u,f,r)}}function o(n){var i=/^expr\((.*)\)$/.exec(n),t;if(i)try{return t=new Function("width","height","dpr","return "+i[1]),t(1,1),t}catch(r){throw new Error("Invalid expression.");}}var r=i(23),s=i(179),h=i(181),c=i(182),l=i(183),f=i(8),a=i(4),v=i(5),y=i(27),p=i(184),e;Object(p.a)(f.a);e=/^#source\((.*?)\)/;t.a=w},function(n,t,i){"use strict";var r=i(180),u=i(86),f=i(10),e=r.a.extend(function(){return{_outputs:[],_texturePool:new u.a,_frameBuffer:new f.a({depthBuffer:!1})}},{addNode:function(n){r.a.prototype.addNode.call(this,n);n._compositor=this},render:function(n,t){var i;if(this._dirty)for(this.update(),this._dirty=!1,this._outputs.length=0,i=0;i<this.nodes.length;i++)this.nodes[i].outputs||this._outputs.push(this.nodes[i]);for(i=0;i<this.nodes.length;i++)this.nodes[i].beforeFrame();for(i=0;i<this._outputs.length;i++)this._outputs[i].updateReference();for(i=0;i<this._outputs.length;i++)this._outputs[i].render(n,t);for(i=0;i<this.nodes.length;i++)this.nodes[i].afterFrame()},allocateTexture:function(n){return this._texturePool.get(n)},releaseTexture:function(n){this._texturePool.put(n)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(n){this._texturePool.clear(n)}});t.a=e},function(n,t,i){"use strict";var r=i(7),u=i(48),f=r.a.extend(function(){return{nodes:[]}},{dirty:function(){this._dirty=!0},addNode:function(n){this.nodes.indexOf(n)>=0||(this.nodes.push(n),this._dirty=!0)},removeNode:function(n){typeof n=="string"&&(n=this.getNodeByName(n));var t=this.nodes.indexOf(n);t>=0&&(this.nodes.splice(t,1),this._dirty=!0)},getNodeByName:function(n){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===n)return this.nodes[t]},update:function(){for(var n,i,r,u,t=0;t<this.nodes.length;t++)this.nodes[t].clear();for(t=0;t<this.nodes.length;t++)if(n=this.nodes[t],n.inputs)for(i in n.inputs)if(n.inputs[i]){if(n.pass&&!n.pass.material.isUniformEnabled(i)){console.warn("Pin "+n.name+"."+i+" not used.");continue}r=n.inputs[i];u=this.findPin(r);u?n.link(i,u.node,u.pin):typeof r=="string"?console.warn("Node "+r+" not exist"):console.warn("Pin of "+r.node+"."+r.pin+" not exist")}},findPin:function(n){var t,r,f,i;if((typeof n=="string"||n instanceof u.a)&&(n={node:n}),typeof n.node=="string")for(r=0;r<this.nodes.length;r++)f=this.nodes[r],f.name===n.node&&(t=f);else t=n.node;if(t&&(i=n.pin,i||t.outputs&&(i=Object.keys(t.outputs)[0]),t.outputs[i]))return{node:t,pin:i}}});t.a=f},function(n,t,i){"use strict";var u=i(48),r=i(11),f=i(10),e=u.a.extend({name:"scene",scene:null,camera:null,autoUpdateScene:!0,preZ:!1},function(){this.frameBuffer=new f.a},{render:function(n){var i,e,u,f,o,s,t;if(this._rendering=!0,i=n.gl,this.trigger("beforerender"),this.outputs){u=this.frameBuffer;for(f in this.outputs){var c=this.updateParameter(f,n),l=this.outputs[f],h=this._compositor.allocateTexture(c);this._outputTextures[f]=h;t=l.attachment||i.COLOR_ATTACHMENT0;typeof t=="string"&&(t=i[t]);u.attach(h,t)}if(u.bind(n),o=n.getGLExtension("EXT_draw_buffers"),o){s=[];for(t in this.outputs)t=parseInt(t),t>=i.COLOR_ATTACHMENT0&&t<=i.COLOR_ATTACHMENT0+8&&s.push(t);o.drawBuffersEXT(s)}n.saveClear();n.clearBit=r.a.DEPTH_BUFFER_BIT|r.a.COLOR_BUFFER_BIT;e=n.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);n.restoreClear();u.unbind(n)}else e=n.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);this.trigger("afterrender",e);this._rendering=!1;this._rendered=!0}});t.a=e},function(n,t,i){"use strict";var r=i(48),u=r.a.extend(function(){return{texture:null,outputs:{color:{}}}},function(){},{getOutput:function(){return this.texture},beforeFrame:function(){},afterFrame:function(){}});t.a=u},function(n,t,i){"use strict";var u=i(16),r=i(48),f=r.a.extend(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},function(){var n=new u.a({fragment:this.shader});this.pass=n},{render:function(n,t){var o,c,e,f,s,l,h,i,u,r;this.trigger("beforerender",n);this._rendering=!0;o=n.gl;for(u in this.inputLinks)r=this.inputLinks[u],c=r.node.getOutput(n,r.pin),this.pass.setUniform(u,c);if(this.outputs){this.pass.outputs={};e={};for(f in this.outputs)s=this.updateParameter(f,n),isNaN(s.width)&&this.updateParameter(f,n),l=this.outputs[f],h=this._compositor.allocateTexture(s),this._outputTextures[f]=h,i=l.attachment||o.COLOR_ATTACHMENT0,typeof i=="string"&&(i=o[i]),e[i]=h;this._compositor.getFrameBuffer().bind(n);for(i in e)this._compositor.getFrameBuffer().attach(e[i],i);this.pass.render(n);this._compositor.getFrameBuffer().updateMipmap(n)}else this.pass.outputs=null,this._compositor.getFrameBuffer().unbind(n),this.pass.render(n,t);for(u in this.inputLinks)r=this.inputLinks[u],r.node.removeReference(r.pin);this._rendering=!1;this._rendered=!0;this.trigger("afterrender",n)},updateParameter:function(n,t){var o=this.outputs[n],i=o.parameters,r=o._parametersCopy,u,f,e;if(r||(r=o._parametersCopy={}),i)for(u in i)u!=="width"&&u!=="height"&&(r[u]=i[u]);return f=i.width instanceof Function?i.width.call(this,t):i.width,e=i.height instanceof Function?i.height.call(this,t):i.height,f=Math.ceil(f),e=Math.ceil(e),(r.width!==f||r.height!==e)&&this._outputTextures[n]&&this._outputTextures[n].dispose(t),r.width=f,r.height=e,r},setParameter:function(n,t){this.pass.setUniform(n,t)},getParameter:function(n){return this.pass.getUniform(n)},setParameters:function(n){for(var t in n)this.setParameter(t,n[t])},define:function(n,t){this.pass.material.define("fragment",n,t)},undefine:function(n){this.pass.material.undefine("fragment",n)},removeReference:function(n){if(this._outputReferences[n]--,this._outputReferences[n]===0){var t=this.outputs[n];t.keepLastFrame?(this._prevOutputTextures[n]&&this._compositor.releaseTexture(this._prevOutputTextures[n]),this._prevOutputTextures[n]=this._outputTextures[n]):this._compositor.releaseTexture(this._outputTextures[n])}},clear:function(){r.a.prototype.clear.call(this);this.pass.material.disableTexturesAll()}});t.a=f},function(n,t,i){"use strict";function w(n){n["import"](r.a);n["import"](u.a);n["import"](f.a);n["import"](e.a);n["import"](o.a);n["import"](s.a);n["import"](h.a);n["import"](c.a);n["import"](l.a);n["import"](a.a);n["import"](v.a);n["import"](y.a);n["import"](p.a)}t.a=w;var r=i(185),u=i(87),f=i(186),e=i(88),o=i(187),s=i(89),h=i(90),c=i(91),l=i(92),a=i(93),v=i(188),y=i(94),p=i(95)},function(n,t){"use strict";t.a="@export clay.compositor.coloradjust\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float exposure : 0.0;\nuniform float gamma : 1.0;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\n color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n float luminance = dot( color, w );\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.brightness\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = tex.rgb + vec3(brightness);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.contrast\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float contrast : 1.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.exposure\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float exposure : 0.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb * pow(2.0, exposure);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.gamma\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float gamma : 1.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = pow(tex.rgb, vec3(gamma));\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.saturation\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb;\n float luminance = dot(color, w);\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.hdr.log_lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n float luminance = dot(tex.rgb, w);\n luminance = log(luminance + 0.001);\n gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));\n}\n@end\n@export clay.compositor.hdr.lum_adaption\nvarying vec2 v_Texcoord;\nuniform sampler2D adaptedLum;\nuniform sampler2D currentLum;\nuniform float frameTime : 0.02;\n@import clay.util.rgbm\nvoid main()\n{\n float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;\n float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);\n fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));\n gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));\n}\n@end\n@export clay.compositor.lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord );\n float luminance = dot(tex.rgb, w);\n gl_FragColor = vec4(vec3(luminance), 1.0);\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.vignette\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float darkness: 1;\nuniform float offset: 1;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = texel.rgb;\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);\n gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));\n}\n@end"},function(n,t){"use strict";t.a="@export clay.compositor.lensflare\n#define SAMPLE_NUMBER 8\nuniform sampler2D texture;\nuniform sampler2D lenscolor;\nuniform vec2 textureSize : [512, 512];\nuniform float dispersal : 0.3;\nuniform float haloWidth : 0.4;\nuniform float distortion : 1.0;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvec4 textureDistorted(\n in vec2 texcoord,\n in vec2 direction,\n in vec3 distortion\n) {\n return vec4(\n decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,\n 1.0\n );\n}\nvoid main()\n{\n vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;\n vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;\n vec2 haloVec = normalize(ghostVec) * haloWidth;\n vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);\n vec4 result = vec4(0.0);\n for (int i = 0; i < SAMPLE_NUMBER; i++)\n {\n vec2 offset = fract(texcoord + ghostVec * float(i));\n float weight = length(vec2(0.5) - offset) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n }\n result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));\n float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n vec2 offset = fract(texcoord + haloVec);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n gl_FragColor = result;\n}\n@end"},function(n,t,i){"use strict";function c(n){for(var u,t=new Uint8Array(n*n*4),i=0,r=new a.a,f=0;f<n;f++)for(u=0;u<n;u++)r.set(Math.random()*2-1,Math.random()*2-1,0).normalize(),t[i++]=(r.x*.5+.5)*255,t[i++]=(r.y*.5+.5)*255,t[i++]=0,t[i++]=255;return t}function l(n){return new u.a({pixels:c(n),wrapS:o.a.REPEAT,wrapT:o.a.REPEAT,width:n,height:n})}function p(n,t,i){var u=new Float32Array(n*3),r;for(t=t||0,r=0;r<n;r++){var o=Object(h.a)(r+t,2)*(i?1:2)*Math.PI,f=Object(h.a)(r+t,3)*Math.PI,e=Math.random(),s=Math.cos(o)*Math.sin(f)*e,c=Math.cos(f)*e,l=Math.sin(o)*Math.sin(f)*e;u[r*3]=s;u[r*3+1]=c;u[r*3+2]=l}return u}function r(n){n=n||{};this._ssaoPass=new s.a({fragment:f.a.source("ecgl.ssao.estimate")});this._blurPass=new s.a({fragment:f.a.source("ecgl.ssao.blur")});this._framebuffer=new v.a({depthBuffer:!1});this._ssaoTexture=new u.a;this._blurTexture=new u.a;this._blurTexture2=new u.a;this._depthTex=n.depthTexture;this._normalTex=n.normalTexture;this.setNoiseSize(4);this.setKernelSize(n.kernelSize||12);n.radius!=null&&this.setParameter("radius",n.radius);n.power!=null&&this.setParameter("power",n.power);this._normalTex||(this._ssaoPass.material.disableTexture("normalTex"),this._blurPass.material.disableTexture("normalTex"));this._depthTex||this._blurPass.material.disableTexture("depthTex");this._blurPass.material.setUniform("normalTex",this._normalTex);this._blurPass.material.setUniform("depthTex",this._depthTex)}var e=i(9),a=i(3),u=i(5),o=i(4),s=i(16),f=i(8),v=i(10),h=i(49),y=i(190);f.a.import(y.a);r.prototype.setDepthTexture=function(n){this._depthTex=n};r.prototype.setNormalTexture=function(n){this._normalTex=n;this._ssaoPass.material[n?"enableTexture":"disableTexture"]("normalTex");this.setKernelSize(this._kernelSize)};r.prototype.update=function(n,t,i){var f=n.getWidth(),o=n.getHeight(),u=this._ssaoPass,r=this._blurPass,l,s;u.setUniform("kernel",this._kernels[i%this._kernels.length]);u.setUniform("depthTex",this._depthTex);this._normalTex!=null&&u.setUniform("normalTex",this._normalTex);u.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);l=new e.a;e.a.transpose(l,t.worldTransform);u.setUniform("projection",t.projectionMatrix.array);u.setUniform("projectionInv",t.invProjectionMatrix.array);u.setUniform("viewInverseTranspose",l.array);var h=this._ssaoTexture,c=this._blurTexture,a=this._blurTexture2;h.width=f/2;h.height=o/2;c.width=f;c.height=o;a.width=f;a.height=o;this._framebuffer.attach(h);this._framebuffer.bind(n);n.gl.clearColor(1,1,1,1);n.gl.clear(n.gl.COLOR_BUFFER_BIT);u.render(n);r.setUniform("textureSize",[f/2,o/2]);r.setUniform("projection",t.projectionMatrix.array);this._framebuffer.attach(c);r.setUniform("direction",0);r.setUniform("ssaoTexture",h);r.render(n);this._framebuffer.attach(a);r.setUniform("textureSize",[f,o]);r.setUniform("direction",1);r.setUniform("ssaoTexture",c);r.render(n);this._framebuffer.unbind(n);s=n.clearColor;n.gl.clearColor(s[0],s[1],s[2],s[3])};r.prototype.getTargetTexture=function(){return this._blurTexture2};r.prototype.setParameter=function(n,t){n==="noiseTexSize"?this.setNoiseSize(t):n==="kernelSize"?this.setKernelSize(t):n==="intensity"?this._ssaoPass.material.set("intensity",t):this._ssaoPass.setUniform(n,t)};r.prototype.setKernelSize=function(n){this._kernelSize=n;this._ssaoPass.material.define("fragment","KERNEL_SIZE",n);this._kernels=this._kernels||[];for(var t=0;t<30;t++)this._kernels[t]=p(n,t*n,!!this._normalTex)};r.prototype.setNoiseSize=function(n){var t=this._ssaoPass.getUniform("noiseTex");t?(t.data=c(n),t.width=t.height=n,t.dirty()):(t=l(n),this._ssaoPass.setUniform("noiseTex",l(n)));this._ssaoPass.setUniform("noiseTexSize",[n,n])};r.prototype.dispose=function(n){this._blurTexture.dispose(n);this._ssaoTexture.dispose(n);this._blurTexture2.dispose(n)};t.a=r},function(n,t){"use strict";t.a="@export ecgl.ssao.estimate\n\nuniform sampler2D depthTex;\n\nuniform sampler2D normalTex;\n\nuniform sampler2D noiseTex;\n\nuniform vec2 depthTexSize;\n\nuniform vec2 noiseTexSize;\n\nuniform mat4 projection;\n\nuniform mat4 projectionInv;\n\nuniform mat4 viewInverseTranspose;\n\nuniform vec3 kernel[KERNEL_SIZE];\n\nuniform float radius : 1;\n\nuniform float power : 1;\n\nuniform float bias: 1e-2;\n\nuniform float intensity: 1.0;\n\nvarying vec2 v_Texcoord;\n\nfloat ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {\n float occlusion = 0.0;\n\n for (int i = 0; i < KERNEL_SIZE; i++) {\n vec3 samplePos = kernel[i];\n#ifdef NORMALTEX_ENABLED\n samplePos = kernelBasis * samplePos;\n#endif\n samplePos = samplePos * radius + originPos;\n\n vec4 texCoord = projection * vec4(samplePos, 1.0);\n texCoord.xy /= texCoord.w;\n\n vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);\n\n float sampleDepth = depthTexel.r * 2.0 - 1.0;\n if (projection[3][3] == 0.0) {\n sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);\n }\n else {\n sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];\n }\n \n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));\n occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);\n }\n#ifdef NORMALTEX_ENABLED\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\n#else\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\n#endif\n return pow(occlusion, power);\n}\n\nvoid main()\n{\n\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\n\n#ifdef NORMALTEX_ENABLED\n vec4 tex = texture2D(normalTex, v_Texcoord);\n if (dot(tex.rgb, tex.rgb) == 0.0) {\n gl_FragColor = vec4(1.0);\n return;\n }\n vec3 N = tex.rgb * 2.0 - 1.0;\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\n\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n vec3 T = normalize(rvec - N * dot(rvec, N));\n vec3 BT = normalize(cross(N, T));\n mat3 kernelBasis = mat3(T, BT, N);\n#else\n if (depthTexel.r > 0.99999) {\n gl_FragColor = vec4(1.0);\n return;\n }\n mat3 kernelBasis;\n#endif\n\n float z = depthTexel.r * 2.0 - 1.0;\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n\n vec3 position = p4.xyz / p4.w;\n\n float ao = ssaoEstimator(position, kernelBasis);\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n gl_FragColor = vec4(vec3(ao), 1.0);\n}\n\n@end\n\n\n@export ecgl.ssao.blur\n#define SHADER_NAME SSAO_BLUR\n\nuniform sampler2D ssaoTexture;\n\n#ifdef NORMALTEX_ENABLED\nuniform sampler2D normalTex;\n#endif\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\nuniform int direction: 0.0;\n\n#ifdef DEPTHTEX_ENABLED\nuniform sampler2D depthTex;\nuniform mat4 projection;\nuniform float depthRange : 0.5;\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n#endif\n\nvoid main()\n{\n float kernel[5];\n kernel[0] = 0.122581;\n kernel[1] = 0.233062;\n kernel[2] = 0.288713;\n kernel[3] = 0.233062;\n kernel[4] = 0.122581;\n\n vec2 off = vec2(0.0);\n if (direction == 0) {\n off[0] = blurSize / textureSize.x;\n }\n else {\n off[1] = blurSize / textureSize.y;\n }\n\n vec2 coord = v_Texcoord;\n\n float sum = 0.0;\n float weightAll = 0.0;\n\n#ifdef NORMALTEX_ENABLED\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\n#endif\n#if defined(DEPTHTEX_ENABLED)\n float centerDepth = getLinearDepth(v_Texcoord);\n#endif\n\n for (int i = 0; i < 5; i++) {\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\n\n float w = kernel[i];\n#ifdef NORMALTEX_ENABLED\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n#endif\n#ifdef DEPTHTEX_ENABLED\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n#endif\n\n weightAll += w;\n sum += texture2D(ssaoTexture, coord).r * w;\n }\n\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\n}\n\n@end\n"},function(n,t,i){"use strict";function r(n){n=n||{};this._ssrPass=new s.a({fragment:e.a.source("ecgl.ssr.main"),clearColor:[0,0,0,0]});this._blurPass1=new s.a({fragment:e.a.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]});this._blurPass2=new s.a({fragment:e.a.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]});this._blendPass=new s.a({fragment:e.a.source("clay.compositor.blend")});this._blendPass.material.disableTexturesAll();this._blendPass.material.enableTexture(["texture1","texture2"]);this._ssrPass.setUniform("gBufferTexture1",n.normalTexture);this._ssrPass.setUniform("gBufferTexture2",n.depthTexture);this._blurPass1.setUniform("gBufferTexture1",n.normalTexture);this._blurPass1.setUniform("gBufferTexture2",n.depthTexture);this._blurPass2.setUniform("gBufferTexture1",n.normalTexture);this._blurPass2.setUniform("gBufferTexture2",n.depthTexture);this._blurPass2.material.define("fragment","VERTICAL");this._blurPass2.material.define("fragment","BLEND");this._ssrTexture=new u.a({type:f.a.HALF_FLOAT});this._texture2=new u.a({type:f.a.HALF_FLOAT});this._texture3=new u.a({type:f.a.HALF_FLOAT});this._prevTexture=new u.a({type:f.a.HALF_FLOAT});this._currentTexture=new u.a({type:f.a.HALF_FLOAT});this._frameBuffer=new h.a({depthBuffer:!1});this._normalDistribution=null;this._totalSamples=256;this._samplePerFrame=4;this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame);this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples);this._downScale=1}var o=i(9),a=i(3),u=i(5),f=i(4),s=i(16),e=i(8),h=i(10),v=i(49),c=i(77),l=i(192);e.a.import(l.a);r.prototype.setAmbientCubemap=function(n,t){this._ssrPass.material.set("specularCubemap",n);this._ssrPass.material.set("specularIntensity",t);var i=n&&t;this._ssrPass.material[i?"enableTexture":"disableTexture"]("specularCubemap")};r.prototype.update=function(n,t,i,r){var a=n.getWidth(),v=n.getHeight(),f=this._ssrTexture,h=this._texture2,y=this._texture3,b,k;f.width=this._prevTexture.width=this._currentTexture.width=a/this._downScale;f.height=this._prevTexture.height=this._currentTexture.height=v/this._downScale;h.width=y.width=a;h.height=y.height=v;var e=this._frameBuffer,u=this._ssrPass,c=this._blurPass1,s=this._blurPass2,l=this._blendPass,p=new o.a,w=new o.a;o.a.transpose(p,t.worldTransform);o.a.transpose(w,t.viewMatrix);u.setUniform("sourceTexture",i);u.setUniform("projection",t.projectionMatrix.array);u.setUniform("projectionInv",t.invProjectionMatrix.array);u.setUniform("toViewSpace",p.array);u.setUniform("toWorldSpace",w.array);u.setUniform("nearZ",t.near);b=r/this._totalSamples*this._samplePerFrame;u.setUniform("jitterOffset",b);u.setUniform("sampleOffset",r*this._samplePerFrame);c.setUniform("textureSize",[f.width,f.height]);s.setUniform("textureSize",[a,v]);s.setUniform("sourceTexture",i);c.setUniform("projection",t.projectionMatrix.array);s.setUniform("projection",t.projectionMatrix.array);e.attach(f);e.bind(n);u.render(n);this._physicallyCorrect&&(e.attach(this._currentTexture),l.setUniform("texture1",this._prevTexture),l.setUniform("texture2",f),l.material.set({weight1:r>=1?.95:0,weight2:r>=1?.05:1}),l.render(n));e.attach(h);c.setUniform("texture",this._physicallyCorrect?this._currentTexture:f);c.render(n);e.attach(y);s.setUniform("texture",h);s.render(n);e.unbind(n);this._physicallyCorrect&&(k=this._prevTexture,this._prevTexture=this._currentTexture,this._currentTexture=k)};r.prototype.getTargetTexture=function(){return this._texture3};r.prototype.setParameter=function(n,t){n==="maxIteration"?this._ssrPass.material.define("fragment","MAX_ITERATION",t):this._ssrPass.setUniform(n,t)};r.prototype.setPhysicallyCorrect=function(n){n?(this._normalDistribution||(this._normalDistribution=c.a.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT"),this._ssrPass.material.set("normalDistribution",this._normalDistribution),this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])):this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT");this._physicallyCorrect=n};r.prototype.setSSAOTexture=function(n){var t=this._blurPass2;n?(t.material.enableTexture("ssaoTex"),t.material.set("ssaoTex",n)):t.material.disableTexture("ssaoTex")};r.prototype.isFinished=function(n){return this._physicallyCorrect?n>this._totalSamples/this._samplePerFrame:!0};r.prototype.dispose=function(n){this._ssrTexture.dispose(n);this._texture2.dispose(n);this._texture3.dispose(n);this._prevTexture.dispose(n);this._currentTexture.dispose(n);this._frameBuffer.dispose(n)};t.a=r},function(n,t){"use strict";t.a="@export ecgl.ssr.main\n\n#define SHADER_NAME SSR\n#define MAX_ITERATION 20;\n#define SAMPLE_PER_FRAME 5;\n#define TOTAL_SAMPLES 128;\n\nuniform sampler2D sourceTexture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform sampler2D gBufferTexture3;\nuniform samplerCube specularCubemap;\nuniform float specularIntensity: 1;\n\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 toViewSpace;\nuniform mat4 toWorldSpace;\n\nuniform float maxRayDistance: 200;\n\nuniform float pixelStride: 16;\nuniform float pixelStrideZCutoff: 50; \nuniform float screenEdgeFadeStart: 0.9; \nuniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; \nuniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;\n\nuniform float nearZ;\nuniform vec2 viewportSize : VIEWPORT_SIZE;\n\nuniform float jitterOffset: 0;\n\nvarying vec2 v_Texcoord;\n\n#ifdef DEPTH_DECODE\n@import clay.util.decode_float\n#endif\n\n#ifdef PHYSICALLY_CORRECT\nuniform sampler2D normalDistribution;\nuniform float sampleOffset: 0;\nuniform vec2 normalDistributionSize;\n\nvec3 transformNormal(vec3 H, vec3 N) {\n vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\n return transformNormal(H, N);\n}\nfloat G_Smith(float g, float ndv, float ndl) {\n float roughness = 1.0 - g;\n float k = roughness * roughness / 2.0;\n float G1V = ndv / (ndv * (1.0 - k) + k);\n float G1L = ndl / (ndl * (1.0 - k) + k);\n return G1L * G1V;\n}\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n#endif\n\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\n{\n vec4 depthTexel = texture2D(depthTexture, uv);\n return depthTexel.r * 2.0 - 1.0;\n}\n\nfloat linearDepth(float depth)\n{\n if (projection[3][3] == 0.0) {\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n }\n else {\n return (depth - projection[3][2]) / projection[2][2];\n }\n}\n\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\n{\n if (rayZFar > rayZNear)\n {\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n }\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n}\n\n\nbool traceScreenSpaceRay(\n vec3 rayOrigin, vec3 rayDir, float jitter,\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\n)\n{\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\n vec4 H1 = projection * vec4(rayEnd, 1.0);\n\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n vec2 delta = P1 - P0;\n\n bool permute = false;\n if (abs(delta.x) < abs(delta.y)) {\n permute = true;\n delta = delta.yx;\n P0 = P0.yx;\n P1 = P1.yx;\n }\n float stepDir = sign(delta.x);\n float invdx = stepDir / delta.x;\n\n vec3 dQ = (Q1 - Q0) * invdx;\n float dk = (k1 - k0) * invdx;\n\n vec2 dP = vec2(stepDir, delta.y * invdx);\n\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n float pixStride = 1.0 + strideScaler * pixelStride;\n\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n vec4 pqk = vec4(P0, Q0.z, k0);\n vec4 dPQK = vec4(dP, dQ.z, dk);\n\n pqk += dPQK * jitter;\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n float rayZNear;\n\n bool intersect = false;\n\n vec2 texelSize = 1.0 / viewportSize;\n\n iterationCount = 0.0;\n\n for (int i = 0; i < MAX_ITERATION; i++)\n {\n pqk += dPQK;\n\n rayZNear = rayZFar;\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n hitPixel = permute ? pqk.yx : pqk.xy;\n hitPixel *= texelSize;\n\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n iterationCount += 1.0;\n\n dPQK *= 1.2;\n\n if (intersect) {\n break;\n }\n }\n\n Q0.xy += dQ.xy * iterationCount;\n Q0.z = pqk.z;\n hitPoint = Q0 / pqk.w;\n\n return intersect;\n}\n\nfloat calculateAlpha(\n float iterationCount, float reflectivity,\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\n)\n{\n float alpha = clamp(reflectivity, 0.0, 1.0);\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n float _eyeFadeStart = eyeFadeStart;\n float _eyeFadeEnd = eyeFadeEnd;\n if (_eyeFadeStart > _eyeFadeEnd) {\n float tmp = _eyeFadeEnd;\n _eyeFadeEnd = _eyeFadeStart;\n _eyeFadeStart = tmp;\n }\n\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n return alpha;\n}\n\n@import clay.util.rand\n\n@import clay.util.rgbm\n\nvoid main()\n{\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\n\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n discard;\n }\n\n float g = normalAndGloss.a;\n#if !defined(PHYSICALLY_CORRECT)\n if (g <= minGlossiness) {\n discard;\n }\n#endif\n\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\n vec4 pos = projectionInv * projectedPos;\n vec3 rayOrigin = pos.xyz / pos.w;\n vec3 V = -normalize(rayOrigin);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n float iterationCount;\n float jitter = rand(fract(v_Texcoord + jitterOffset));\n\n#ifdef PHYSICALLY_CORRECT\n vec4 color = vec4(vec3(0.0), 1.0);\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\n vec3 albedo = albedoMetalness.rgb;\n float m = albedoMetalness.a;\n vec3 diffuseColor = albedo * (1.0 - m);\n vec3 spec = mix(vec3(0.04), albedo, m);\n\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\n\n for (int i = 0; i < SAMPLE_PER_FRAME; i++) {\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\n vec3 rayDir = normalize(reflect(-V, H));\n#else\n vec3 rayDir = normalize(reflect(-V, N));\n#endif\n vec2 hitPixel;\n vec3 hitPoint;\n\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n float dist = distance(rayOrigin, hitPoint);\n\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\n#ifdef PHYSICALLY_CORRECT\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\n float vdh = clamp(dot(V, H), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n vec3 litTexel = vec3(0.0);\n if (dot(hitNormal, rayDir) < 0.0 && intersect) {\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\n\n }\n else {\n #ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\n#endif\n }\n color.rgb += ndl * litTexel * (\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\n );\n }\n color.rgb /= float(SAMPLE_PER_FRAME);\n#else\n #if !defined(SPECULARCUBEMAP_ENABLED)\n if (dot(hitNormal, rayDir) >= 0.0) {\n discard;\n }\n if (!intersect) {\n discard;\n }\n#endif\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\n vec4 color = texture2D(sourceTexture, hitPixel);\n color.rgb *= alpha;\n\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n alpha = alpha * (intersect ? 1.0 : 0.0);\n float bias = (1.0 -g) * 5.0;\n color.rgb += (1.0 - alpha)\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\n * specularIntensity;\n#endif\n\n#endif\n\n gl_FragColor = encodeHDR(color);\n}\n@end\n\n@export ecgl.ssr.blur\n\nuniform sampler2D texture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\n#ifdef BLEND\n #ifdef SSAOTEX_ENABLED\nuniform sampler2D ssaoTex;\n #endif\nuniform sampler2D sourceTexture;\n#endif\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n\n@import clay.util.rgbm\n\n\nvoid main()\n{\n @import clay.compositor.kernel.gaussian_9\n\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\n float g = centerNTexel.a;\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\n#ifdef VERTICAL\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\n#else\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\n#endif\n\n vec2 coord = v_Texcoord;\n\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\n float cD = getLinearDepth(v_Texcoord);\n for (int i = 0; i < 9; i++) {\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\n float w = gaussianKernel[i]\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\n\n weightAll += w;\n sum += decodeHDR(texture2D(texture, coord)) * w;\n }\n\n#ifdef BLEND\n float aoFactor = 1.0;\n #ifdef SSAOTEX_ENABLED\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\n #endif\n gl_FragColor = encodeHDR(\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\n );\n#else\n gl_FragColor = encodeHDR(sum / weightAll);\n#endif\n}\n\n@end"},function(n,t){"use strict";t.a=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925]},function(n,t,i){"use strict";function o(n,t,i,r,u){var f=n.gl;t.setUniform(f,"1i",i,u);f.activeTexture(f.TEXTURE0+u);r.isRenderable()?r.bind(n):r.unbind(n)}function v(n,t,i,r){var e,s,h,f,u=n.gl;return function(c,l,a){if(!f||f.material!==c.material){var v=c.material,y=c.__program,b=v.get("roughness");b==null&&(b=1);var k=v.get("normalMap")||t,p=v.get("roughnessMap"),w=v.get("bumpMap"),d=v.get("uvRepeat"),g=v.get("uvOffset"),nt=v.get("detailUvRepeat"),tt=v.get("detailUvOffset"),it=!!w&&v.isTextureEnabled("bumpMap"),rt=!!p&&v.isTextureEnabled("roughnessMap"),ut=v.isDefined("fragment","DOUBLE_SIDED");w=w||i;p=p||r;a!==l?(l.set("normalMap",k),l.set("bumpMap",w),l.set("roughnessMap",p),l.set("useBumpMap",it),l.set("useRoughnessMap",rt),l.set("doubleSide",ut),d!=null&&l.set("uvRepeat",d),g!=null&&l.set("uvOffset",g),nt!=null&&l.set("detailUvRepeat",nt),tt!=null&&l.set("detailUvOffset",tt),l.set("roughness",b)):(y.setUniform(u,"1f","roughness",b),e!==k&&o(n,y,"normalMap",k,0),s!==w&&w&&o(n,y,"bumpMap",w,1),h!==p&&p&&o(n,y,"roughnessMap",p,2),d!=null&&y.setUniform(u,"2f","uvRepeat",d),g!=null&&y.setUniform(u,"2f","uvOffset",g),nt!=null&&y.setUniform(u,"2f","detailUvRepeat",nt),tt!=null&&y.setUniform(u,"2f","detailUvOffset",tt),y.setUniform(u,"1i","useBumpMap",+it),y.setUniform(u,"1i","useRoughnessMap",+rt),y.setUniform(u,"1i","doubleSide",+ut));e=k;s=w;h=p;f=c}}}function r(n){n=n||{};this._depthTex=new s.a({format:f.a.DEPTH_COMPONENT,type:f.a.UNSIGNED_INT});this._normalTex=new s.a({type:f.a.HALF_FLOAT});this._framebuffer=new h.a;this._framebuffer.attach(this._normalTex);this._framebuffer.attach(this._depthTex,h.a.DEPTH_ATTACHMENT);this._normalMaterial=new c.a({shader:new u.a(u.a.source("ecgl.normal.vertex"),u.a.source("ecgl.normal.fragment"))});this._normalMaterial.enableTexture(["normalMap","bumpMap","roughnessMap"]);this._defaultNormalMap=e.a.createBlank("#000");this._defaultBumpMap=e.a.createBlank("#000");this._defaultRoughessMap=e.a.createBlank("#000");this._debugPass=new l.a({fragment:u.a.source("clay.compositor.output")});this._debugPass.setUniform("texture",this._normalTex);this._debugPass.material.undefine("fragment","OUTPUT_ALPHA")}var s=i(5),f=i(4),u=i(8),h=i(10),c=i(19),l=i(16),e=i(61),a=i(195);u.a.import(a.a);r.prototype.getDepthTexture=function(){return this._depthTex};r.prototype.getNormalTexture=function(){return this._normalTex};r.prototype.update=function(n,t,i){var r=n.getWidth(),u=n.getHeight(),f=this._depthTex,e=this._normalTex,s=this._normalMaterial,o;f.width=r;f.height=u;e.width=r;e.height=u;o=t.getRenderList(i).opaque;this._framebuffer.bind(n);n.gl.clearColor(0,0,0,0);n.gl.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT);n.gl.disable(n.gl.BLEND);n.renderPass(o,i,{getMaterial:function(){return s},ifRender:function(n){return n.renderNormal},beforeRender:v(n,this._defaultNormalMap,this._defaultBumpMap,this._defaultRoughessMap,this._normalMaterial),sort:n.opaqueSortCompare});this._framebuffer.unbind(n)};r.prototype.renderDebug=function(n){this._debugPass.render(n)};r.prototype.dispose=function(n){this._depthTex.dispose(n);this._normalTex.dispose(n)};t.a=r},function(n,t){"use strict";t.a="@export ecgl.normal.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n@import ecgl.common.normalMap.vertexHeader\n\n@import ecgl.common.vertexAnimation.header\n\nvoid main()\n{\n\n @import ecgl.common.vertexAnimation.main\n\n @import ecgl.common.uv.main\n\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n @import ecgl.common.normalMap.vertexMain\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n}\n\n\n@end\n\n\n@export ecgl.normal.fragment\n\n#define ROUGHNESS_CHANEL 0\n\nuniform bool useBumpMap;\nuniform bool useRoughnessMap;\nuniform bool doubleSide;\nuniform float roughness;\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n@import ecgl.common.normalMap.fragmentHeader\n@import ecgl.common.bumpMap.header\n\nuniform sampler2D roughnessMap;\n\nvoid main()\n{\n vec3 N = v_Normal;\n \n bool flipNormal = false;\n if (doubleSide) {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n flipNormal = true;\n }\n }\n\n @import ecgl.common.normalMap.fragmentMain\n\n if (useBumpMap) {\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n }\n\n float g = 1.0 - roughness;\n\n if (useRoughnessMap) {\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n }\n\n if (flipNormal) {\n N = -N;\n }\n\n gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;\n gl_FragColor.a = g;\n}\n@end"},function(n,t,i){"use strict";function r(n){n=n||{};this._edgePass=new e.a({fragment:o.a.source("ecgl.edge")});this._edgePass.setUniform("normalTexture",n.normalTexture);this._edgePass.setUniform("depthTexture",n.depthTexture);this._targetTexture=new u.a({type:f.a.HALF_FLOAT});this._frameBuffer=new s.a;this._frameBuffer.attach(this._targetTexture)}var h=i(9),c=i(3),u=i(5),f=i(4),e=i(16),o=i(8),s=i(10);r.prototype.update=function(n,t,i){var u=n.getWidth(),f=n.getHeight(),e=this._targetTexture,r;e.width=u;e.height=f;r=this._frameBuffer;r.bind(n);this._edgePass.setUniform("projectionInv",t.invProjectionMatrix.array);this._edgePass.setUniform("textureSize",[u,f]);this._edgePass.setUniform("texture",i);this._edgePass.render(n);r.unbind(n)};r.prototype.getTargetTexture=function(){return this._targetTexture};r.prototype.setParameter=function(n,t){this._edgePass.setUniform(n,t)};r.prototype.dispose=function(n){this._targetTexture.dispose(n);this._frameBuffer.dispose(n)};t.a=r},function(n,t){"use strict";t.a={type:"compositor",nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]}},function(n,t){"use strict";t.a="@export ecgl.dof.coc\n\nuniform sampler2D depth;\n\nuniform float zNear: 0.1;\nuniform float zFar: 2000;\n\nuniform float focalDistance: 3;\nuniform float focalRange: 1;\nuniform float focalLength: 30;\nuniform float fstop: 2.8;\n\nvarying vec2 v_Texcoord;\n\n@import clay.util.encode_float\n\nvoid main()\n{\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\n\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\n\n float aperture = focalLength / fstop;\n\n float coc;\n\n float uppper = focalDistance + focalRange;\n float lower = focalDistance - focalRange;\n if (dist <= uppper && dist >= lower) {\n coc = 0.5;\n }\n else {\n float focalAdjusted = dist > uppper ? uppper : lower;\n\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\n\n if (dist < lower) {\n coc = -coc;\n }\n coc = coc * 0.5 + 0.5;\n }\n\n gl_FragColor = encodeFloat(coc);\n}\n@end\n\n\n@export ecgl.dof.composite\n\n#define DEBUG 0\n\nuniform sampler2D original;\nuniform sampler2D blurred;\nuniform sampler2D nearfield;\nuniform sampler2D coc;\nuniform sampler2D nearcoc;\nvarying vec2 v_Texcoord;\n\n@import clay.util.rgbm\n@import clay.util.float\n\nvoid main()\n{\n vec4 blurredColor = texture2D(blurred, v_Texcoord);\n vec4 originalColor = texture2D(original, v_Texcoord);\n\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\n\n fCoc = abs(fCoc * 2.0 - 1.0);\n\n float weight = smoothstep(0.0, 1.0, fCoc);\n \n#ifdef NEARFIELD_ENABLED\n vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\n\n gl_FragColor = encodeHDR(\n mix(\n nearfieldColor, mix(originalColor, blurredColor, weight),\n pow(1.0 - fNearCoc, 4.0)\n )\n );\n#else\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\n#endif\n\n}\n\n@end\n\n\n\n@export ecgl.dof.diskBlur\n\n#define POISSON_KERNEL_SIZE 16;\n\nuniform sampler2D texture;\nuniform sampler2D coc;\nvarying vec2 v_Texcoord;\n\nuniform float blurRadius : 10.0;\nuniform vec2 textureSize : [512.0, 512.0];\n\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\n\nuniform float percent;\n\nfloat nrand(const in vec2 n) {\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n@import clay.util.rgbm\n@import clay.util.float\n\n\nvoid main()\n{\n vec2 offset = blurRadius / textureSize;\n\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\n float cosa = cos(rnd);\n float sina = sin(rnd);\n vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\n#endif\n\n#ifdef BLUR_COC\n float cocSum = 0.0;\n#else\n vec4 color = vec4(0.0);\n#endif\n\n\n float weightSum = 0.0;\n\n for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {\n vec2 ofs = poissonKernel[i];\n\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\n\n vec2 uv = v_Texcoord + ofs * offset;\n vec4 texel = texture2D(texture, uv);\n\n float w = 1.0;\n#ifdef BLUR_COC\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\n#else\n texel = texel;\n #if !defined(BLUR_NEARFIELD)\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\n w *= abs(fCoc);\n #endif\n texel.rgb *= texel.a;\n color += texel * w;\n#endif\n\n weightSum += w;\n }\n\n#ifdef BLUR_COC\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\n#else\n color /= weightSum;\n color.rgb /= (color.a + 0.0001);\n gl_FragColor = color;\n#endif\n}\n\n@end"},function(n,t){"use strict";t.a="@export ecgl.edge\n\nuniform sampler2D texture;\n\nuniform sampler2D normalTexture;\nuniform sampler2D depthTexture;\n\nuniform mat4 projectionInv;\n\nuniform vec2 textureSize;\n\nuniform vec4 edgeColor: [0,0,0,0.8];\n\nvarying vec2 v_Texcoord;\n\nvec3 packColor(vec2 coord) {\n float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;\n vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * p;\n\n return vec3(\n texture2D(normalTexture, coord).rg,\n -p4.z / p4.w / 5.0\n );\n}\n\nvoid main() {\n vec2 cc = v_Texcoord;\n vec3 center = packColor(cc);\n\n float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;\n float dx = size / textureSize.x;\n float dy = size / textureSize.y;\n\n vec2 coord;\n vec3 topLeft = packColor(cc+vec2(-dx, -dy));\n vec3 top = packColor(cc+vec2(0.0, -dy));\n vec3 topRight = packColor(cc+vec2(dx, -dy));\n vec3 left = packColor(cc+vec2(-dx, 0.0));\n vec3 right = packColor(cc+vec2(dx, 0.0));\n vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\n vec3 bottom = packColor(cc+vec2(0.0, dy));\n vec3 bottomRight = packColor(cc+vec2(dx, dy));\n\n vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n float edge = sqrt(dot(h, h) + dot(v, v));\n\n edge = smoothstep(0.8, 1.0, edge);\n\n gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\n}\n@end"},function(n,t,i){"use strict";function f(){for(var t,i=[],n=0;n<30;n++)i.push([Object(e.a)(n,2),Object(e.a)(n,3)]);this._haltonSequence=i;this._frame=0;this._sourceTex=new r.a;this._sourceFb=new s.a;this._sourceFb.attach(this._sourceTex);this._prevFrameTex=new r.a;this._outputTex=new r.a;t=this._blendPass=new o.a({fragment:h.a.source("clay.compositor.blend")});t.material.disableTexturesAll();t.material.enableTexture(["texture1","texture2"]);this._blendFb=new s.a({depthBuffer:!1});this._outputPass=new o.a({fragment:h.a.source("clay.compositor.output"),blendWithPrevious:!0});this._outputPass.material.define("fragment","OUTPUT_ALPHA");this._outputPass.material.blend=function(n){n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD);n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)}}var e=i(49),o=i(16),s=i(10),r=i(5),h=i(8),u=i(9);f.prototype={constructor:f,jitterProjection:function(n,t){var i=n.viewport,f=i.devicePixelRatio||n.getDevicePixelRatio(),o=i.width*f,s=i.height*f,e=this._haltonSequence[this._frame%this._haltonSequence.length],r=new u.a;r.array[12]=(e[0]*2-1)/o;r.array[13]=(e[1]*2-1)/s;u.a.mul(t.projectionMatrix,r,t.projectionMatrix);u.a.invert(t.invProjectionMatrix,t.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(n,t){this._prevFrameTex.width=n;this._prevFrameTex.height=t;this._outputTex.width=n;this._outputTex.height=t;this._sourceTex.width=n;this._sourceTex.height=t;this._prevFrameTex.dirty();this._outputTex.dirty();this._sourceTex.dirty()},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(n,t,i){var r=this._blendPass,u;this._frame===0?(r.setUniform("weight1",0),r.setUniform("weight2",1)):(r.setUniform("weight1",.9),r.setUniform("weight2",.1));r.setUniform("texture1",this._prevFrameTex);r.setUniform("texture2",t||this._sourceTex);this._blendFb.attach(this._outputTex);this._blendFb.bind(n);r.render(n);this._blendFb.unbind(n);i||(this._outputPass.setUniform("texture",this._outputTex),this._outputPass.render(n));u=this._prevFrameTex;this._prevFrameTex=this._outputTex;this._outputTex=u;this._frame++},dispose:function(n){this._sourceFb.dispose(n);this._blendFb.dispose(n);this._prevFrameTex.dispose(n);this._outputTex.dispose(n);this._sourceTex.dispose(n);this._outputPass.dispose(n);this._blendPass.dispose(n)}};t.a=f},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(202),e=i(203),o=i(98);u.a.registerAction({type:"geo3DChangeCamera",event:"geo3dcamerachanged",update:"series:updateCamera"},function(n,t){t.eachComponent({mainType:"geo3D",query:n},function(t){t.setView(n)})})},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(44),o=i(28),s=i(29),h=i(31),c=i(96),u=r.a.extendComponentModel({type:"geo3D",layoutMode:"box",coordinateSystem:null,optionUpdated:function(){var t=this.option,u,n,i;t.regions=this.getFilledRegions(t.regions,t.map);u=r.a.helper.completeDimensions(["value"],t.data,{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")});n=new r.a.List(u,this);n.initData(t.regions);i={};n.each(function(t){var r=n.getName(t),u=n.getItemModel(t);i[r]=u});this._regionModelMap=i;this._data=n},getData:function(){return this._data},getRegionModel:function(n){var t=this.getData().getName(n);return this._regionModelMap[t]||new r.a.Model(null,this)},getRegionPolygonCoords:function(n){var i=this.getData().getName(n),t=this.coordinateSystem.getRegion(i);return t?t.geometries:[]},getFormattedLabel:function(n,t){var u=this._data.getName(n),e=this.getRegionModel(u),i=e.get(t==="normal"?["label","formatter"]:["emphasis","label","formatter"]),r,f;return i==null&&(i=e.get(["label","formatter"])),r={name:u},typeof i=="function"?(r.status=t,i(r)):typeof i=="string"?(f=r.seriesName,i.replace("{a}",f!=null?f:"")):u},defaultOption:{regions:[]}}),l;r.a.util.merge(u.prototype,c.a);r.a.util.merge(u.prototype,e.a);r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);r.a.util.merge(u.prototype,h.a);l=u},function(n,t,i){"use strict";var u=i(64),f=i(0),e=i.n(f),r=i(1),o=i(45),s=i(30),h=e.a.extendComponentView({type:"geo3D",__ecgl__:!0,init:function(n,t){this._geo3DBuilder=new u.a(t);this.groupGL=new r.a.Node;this._lightRoot=new r.a.Node;this._sceneHelper=new s.a(this._lightRoot);this._sceneHelper.initLight(this._lightRoot);this._control=new o.a({zr:t.getZr()});this._control.init()},render:function(n,t,i){var r,u,f,e;if(this.groupGL.add(this._geo3DBuilder.rootNode),r=n.coordinateSystem,r&&r.viewGL){r.viewGL.add(this._lightRoot);n.get("show")?r.viewGL.add(this.groupGL):r.viewGL.remove(this.groupGL);u=this._control;u.setViewGL(r.viewGL);f=n.getModel("viewControl");u.setFromViewControlModel(f,0);this._sceneHelper.setScene(r.viewGL.scene);this._sceneHelper.updateLight(n);r.viewGL.setPostEffect(n.getModel("postEffect"),i);r.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));this._geo3DBuilder.update(n,t,i,0,n.getData().count());e=r.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(n){n.material&&n.material[e]("fragment","SRGB_DECODE")});u.off("update");u.on("update",function(){i.dispatchAction({type:"geo3DChangeCamera",alpha:u.getAlpha(),beta:u.getBeta(),distance:u.getDistance(),center:u.getCenter(),from:this.uid,geo3DId:n.id})});u.update()}},afterRender:function(n,t,i,r){var u=r.renderer;this._sceneHelper.updateAmbientCubemap(u,n,i);this._sceneHelper.updateSkybox(u,n,i)},dispose:function(){this._control.dispose()}})},function(n,t){"use strict";function a(n,t,i){var r,u,c,l,e,o,w,s;i=i||2;var y=t&&t.length,p=y?t[0]*i:n.length,h=v(n,0,p,i,!0),a=[];if(!h)return a;if(y&&(h=nt(n,t,h,i)),n.length>80*i){for(r=c=n[0],u=l=n[1],s=i;s<p;s+=i)e=n[s],o=n[s+1],e<r&&(r=e),o<u&&(u=o),e>c&&(c=e),o>l&&(l=o);w=Math.max(c-r,l-u)}return f(h,a,i,r,u,w),a}function v(n,t,i,u,f){var e,s;if(f===l(n,t,i,u)>0)for(e=t;e<i;e+=u)s=w(e,n[e],n[e+1],s);else for(e=i-u;e>=t;e-=u)s=w(e,n[e],n[e+1],s);return s&&r(s,s.next)&&(o(s),s=s.next),s}function u(n,t){if(!n)return n;t||(t=n);var u=n,f;do if(f=!1,!u.steiner&&(r(u,u.next)||i(u.prev,u,u.next)===0)){if(o(u),u=t=u.prev,u===u.next)return null;f=!0}else u=u.next;while(f||u!==t);return t}function f(n,t,i,r,e,s,h){if(n){!h&&s&&ut(n,r,e,s);for(var l=n,a,c;n.prev!==n.next;){if(a=n.prev,c=n.next,s?k(n,r,e,s):b(n)){t.push(a.i/i);t.push(n.i/i);t.push(c.i/i);o(n);n=c.next;l=c.next;continue}if(n=c,n===l){h?h===1?(n=d(n,t,i),f(n,t,i,r,e,s,2)):h===2&&g(n,t,i,r,e,s):f(u(n),t,i,r,e,s,1);break}}}}function b(n){var r=n.prev,u=n,f=n.next,t;if(i(r,u,f)>=0)return!1;for(t=n.next.next;t!==n.prev;){if(s(r.x,r.y,u.x,u.y,f.x,f.y,t.x,t.y)&&i(t.prev,t,t.next)>=0)return!1;t=t.next}return!0}function k(n,t,r,u){var o=n.prev,c=n,e=n.next;if(i(o,c,e)>=0)return!1;for(var l=o.x<c.x?o.x<e.x?o.x:e.x:c.x<e.x?c.x:e.x,a=o.y<c.y?o.y<e.y?o.y:e.y:c.y<e.y?c.y:e.y,v=o.x>c.x?o.x>e.x?o.x:e.x:c.x>e.x?c.x:e.x,y=o.y>c.y?o.y>e.y?o.y:e.y:c.y>e.y?c.y:e.y,p=h(l,a,t,r,u),w=h(v,y,t,r,u),f=n.nextZ;f&&f.z<=w;){if(f!==n.prev&&f!==n.next&&s(o.x,o.y,c.x,c.y,e.x,e.y,f.x,f.y)&&i(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=n.prevZ;f&&f.z>=p;){if(f!==n.prev&&f!==n.next&&s(o.x,o.y,c.x,c.y,e.x,e.y,f.x,f.y)&&i(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function d(n,t,i){var u=n,s,f;do s=u.prev,f=u.next.next,!r(s,f)&&y(s,u,u.next,f)&&e(s,f)&&e(f,s)&&(t.push(s.i/i),t.push(u.i/i),t.push(f.i/i),o(u),o(u.next),u=n=f),u=u.next;while(u!==n);return u}function g(n,t,i,r,e,o){var s=n,h,c;do{for(h=s.next.next;h!==s.prev;){if(s.i!==h.i&&ot(s,h)){c=p(s,h);s=u(s,s.next);c=u(c,c.next);f(s,t,i,r,e,o);f(c,t,i,r,e,o);return}h=h.next}s=s.next}while(s!==n)}function nt(n,t,i,r){for(var o=[],h,c,e,f=0,s=t.length;f<s;f++)h=t[f]*r,c=f<s-1?t[f+1]*r:n.length,e=v(n,h,c,r,!1),e===e.next&&(e.steiner=!0),o.push(et(e));for(o.sort(tt),f=0;f<o.length;f++)it(o[f],i),i=u(i,i.next);return i}function tt(n,t){return n.x-t.x}function it(n,t){if(t=rt(n,t),t){var i=p(t,n);u(i,i.next)}}function rt(n,t){var i=t,f=n.x,r=n.y,o=-Infinity,u,h;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y&&(h=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y),h<=f&&h>o)){if(o=h,h===f){if(r===i.y)return i;if(r===i.next.y)return i.next}u=i.x<i.next.x?i:i.next}i=i.next}while(i!==t);if(!u)return null;if(f===o)return u.prev;var y=u,v=u.x,l=u.y,a=Infinity,c;for(i=u.next;i!==y;)f>=i.x&&i.x>=v&&f!==i.x&&s(r<l?f:o,r,v,l,r<l?o:f,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(f-i.x),(c<a||c===a&&i.x>u.x)&&e(i,n)&&(u=i,a=c)),i=i.next;return u}function ut(n,t,i,r){var u=n;do u.z===null&&(u.z=h(u.x,u.y,t,i,r)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next;while(u!==n);u.prevZ.nextZ=null;u.prevZ=null;ft(u)}function ft(n){var o,i,t,r,u,s,f,e,h=1;do{for(i=n,n=null,u=null,s=0;i;){for(s++,t=i,f=0,o=0;o<h;o++)if(f++,t=t.nextZ,!t)break;for(e=h;f>0||e>0&&t;)f!==0&&(e===0||!t||i.z<=t.z)?(r=i,i=i.nextZ,f--):(r=t,t=t.nextZ,e--),u?u.nextZ=r:n=r,r.prevZ=u,u=r;i=t}u.nextZ=null;h*=2}while(s>1);return n}function h(n,t,i,r,u){return n=32767*(n-i)/u,t=32767*(t-r)/u,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function et(n){var t=n,i=n;do t.x<i.x&&(i=t),t=t.next;while(t!==n);return i}function s(n,t,i,r,u,f,e,o){return(u-e)*(t-o)-(n-e)*(f-o)>=0&&(n-e)*(r-o)-(i-e)*(t-o)>=0&&(i-e)*(f-o)-(u-e)*(r-o)>=0}function ot(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!st(n,t)&&e(n,t)&&e(t,n)&&ht(n,t)}function i(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function r(n,t){return n.x===t.x&&n.y===t.y}function y(n,t,u,f){return r(n,t)&&r(u,f)||r(n,f)&&r(u,t)?!0:i(n,t,u)>0!=i(n,t,f)>0&&i(u,f,n)>0!=i(u,f,t)>0}function st(n,t){var i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,n,t))return!0;i=i.next}while(i!==n);return!1}function e(n,t){return i(n.prev,n,n.next)<0?i(n,t,n.next)>=0&&i(n,n.prev,t)>=0:i(n,t,n.prev)<0||i(n,n.next,t)<0}function ht(n,t){var i=n,r=!1,f=(n.x+t.x)/2,u=(n.y+t.y)/2;do i.y>u!=i.next.y>u&&i.next.y!==i.y&&f<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==n);return r}function p(n,t){var r=new c(n.i,n.x,n.y),i=new c(t.i,t.x,t.y),u=n.next,f=t.prev;return n.next=t,t.prev=n,r.next=u,u.prev=r,i.next=r,r.prev=i,f.next=i,i.prev=f,i}function w(n,t,i,r){var u=new c(n,t,i);return r?(u.next=r.next,u.prev=r,r.next.prev=u,r.next=u):(u.prev=u,u.next=u),u}function o(n){n.next.prev=n.prev;n.prev.next=n.next;n.prevZ&&(n.prevZ.nextZ=n.nextZ);n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function c(n,t,i){this.i=n;this.x=t;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function l(n,t,i,r){for(var e=0,u=t,f=i-r;u<i;u+=r)e+=(n[f]-n[u])*(n[u+1]+n[f+1]),f=u;return e}t.a=a;a.deviation=function(n,t,i,r){var h=t&&t.length,p=h?t[0]*i:n.length,f=Math.abs(l(n,0,p,i)),u,s,c,a,e;if(h)for(u=0,s=t.length;u<s;u++)c=t[u]*i,a=u<s-1?t[u+1]*i:n.length,f-=Math.abs(l(n,c,a,i));for(e=0,u=0;u<r.length;u+=3){var o=r[u]*i,v=r[u+1]*i,y=r[u+2]*i;e+=Math.abs((n[o]-n[y])*(n[v+1]-n[o+1])-(n[o]-n[v])*(n[y+1]-n[o+1]))}return f===0&&e===0?0:Math.abs((e-f)/f)}},function(n,t,i){function f(n){r.each(n.regions,function(n){var t=u[n.name],i;t&&(i=n.center,i[0]+=t[0]/10.5,i[1]+=-t[1]/(10.5/.75))})}var r=i(13),u={"å—æµ·è¯¸å²›":[32,80],"å¹¿ä¸œ":[0,-10],"é¦™æ¸¯":[10,5],"æ¾³é—¨":[-10,10],"å¤©æ´¥":[5,5]};n.exports=f},function(n,t,i){function f(n){r.each(n.regions,function(n){var t=u[n.name],i;t&&(i=n.center,i[0]=t[0],i[1]=t[1])})}var r=i(13),u={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};n.exports=f},function(n,t,i){"use strict";var u=i(0),r=i.n(u),f=i(208),e=i(209),o=i(211);r.a.registerAction({type:"globeChangeCamera",event:"globecamerachanged",update:"series:updateCamera"},function(n,t){t.eachComponent({mainType:"globe",query:n},function(t){t.setView(n)})});r.a.registerAction({type:"globeUpdateDisplacment",event:"globedisplacementupdated",update:"update"},function(){})},function(n,t,i){"use strict";function f(n,t){n.id=n.id||n.name||t+""}var e=i(0),r=i.n(e),o=i(44),s=i(28),h=i(29),c=i(31),u=r.a.extendComponentModel({type:"globe",layoutMode:"box",coordinateSystem:null,init:function(){u.superApply(this,"init",arguments);r.a.util.each(this.option.layers,function(n,t){r.a.util.merge(n,this.defaultLayerOption);f(n,t)},this)},mergeOption:function(n){function s(n){return r.a.util.reduce(n,function(n,t,i){return f(t,i),n[t.id]=t,n},{})}var t=this.option.layers,e,o,i;if(this.option.layers=null,u.superApply(this,"mergeOption",arguments),t&&t.length){e=s(n.layers);o=s(t);for(i in e)o[i]?r.a.util.merge(o[i],e[i],!0):t.push(n.layers[i]);this.option.layers=t}r.a.util.each(this.option.layers,function(n){r.a.util.merge(n,this.defaultLayerOption)},this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:!0,type:"overlay"},defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",baseColor:"#fff",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,displacementQuality:"medium",globeRadius:100,globeOuterRadius:150,shading:"lambert",light:{main:{time:""}},viewControl:{autoRotate:!0,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(n,t,i){this.displacementData=n;this.displacementWidth=t;this.displacementHeight=i},getDisplacementTexture:function(){return this.get("displacementTexture")||this.get("heightTexture")},getDisplacemenScale:function(){var n=this.getDisplacementTexture(),t=this.get("displacementScale");return n&&n!=="none"||(t=0),t},hasDisplacement:function(){return this.getDisplacemenScale()>0},_displacementChanged:!0,_displacementScale:0,updateDisplacementHash:function(){var n=this.getDisplacementTexture(),t=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==n||this._displacementScale!==t;this._displacementTexture=n;this._displacementScale=t},isDisplacementChanged:function(){return this._displacementChanged}}),l;r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);r.a.util.merge(u.prototype,h.a);r.a.util.merge(u.prototype,c.a);l=u},function(n,t,i){"use strict";var e=i(0),u=i.n(e),r=i(1),o=i(45),s=i(30),h=i(210),f=i(2),c=u.a.extendComponentView({type:"globe",__ecgl__:!0,_displacementScale:0,init:function(n,t){this.groupGL=new r.a.Node;this._sphereGeometry=new r.a.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0});this._overlayGeometry=new r.a.SphereGeometry({widthSegments:80,heightSegments:40});this._planeGeometry=new r.a.PlaneGeometry;this._earthMesh=new r.a.Mesh({renderNormal:!0});this._lightRoot=new r.a.Node;this._sceneHelper=new s.a;this._sceneHelper.initLight(this._lightRoot);this.groupGL.add(this._earthMesh);this._control=new o.a({zr:t.getZr()});this._control.init();this._layerMeshes={}},render:function(n,t,i){var f=n.coordinateSystem,c=n.get("shading"),u,h,e,o,s;f.viewGL.add(this._lightRoot);n.get("show")?f.viewGL.add(this.groupGL):f.viewGL.remove(this.groupGL);this._sceneHelper.setScene(f.viewGL.scene);f.viewGL.setPostEffect(n.getModel("postEffect"),i);f.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));u=this._earthMesh;u.geometry=this._sphereGeometry;h="ecgl."+c;u.material&&u.material.shader.name===h||(u.material=r.a.createMaterial(h));r.a.setMaterialFromModel(c,u.material,n,i);["roughnessMap","metalnessMap","detailMap","normalMap"].forEach(function(n){var t=u.material.get(n);t&&(t.flipY=!1)});u.material.set("color",r.a.parseColor(n.get("baseColor")));e=f.radius*.99;u.scale.set(e,e,e);o=u.material.setTextureImage("diffuseMap",n.get("baseTexture"),i,{flipY:!1,anisotropic:8});o&&o.surface&&o.surface.attachToMesh(u);s=u.material.setTextureImage("bumpMap",n.get("heightTexture"),i,{flipY:!1,anisotropic:8});s&&s.surface&&s.surface.attachToMesh(u);u.material[n.get("postEffect.enable")?"define":"undefine"]("fragment","SRGB_DECODE");this._updateLight(n,i);this._displaceVertices(n,i);this._updateViewControl(n,i);this._updateLayers(n,i)},afterRender:function(n,t,i,r){var u=r.renderer;this._sceneHelper.updateAmbientCubemap(u,n,i);this._sceneHelper.updateSkybox(u,n,i)},_updateLayers:function(n,t){var h=n.coordinateSystem,p=n.get("layers"),c=h.radius,o=[],l=[],s=[],a=[],i,e,v,y;u.a.util.each(p,function(n){var e=new u.a.Model(n),nt=e.get("type"),y=r.a.loadTexture(e.get("texture"),t,{flipY:!1,anisotropic:8}),k,p,w,i,d,b,v,g;y.surface&&y.surface.attachToMesh(this._earthMesh);nt==="blend"?(k=e.get("blendTo"),p=f.a.firstNotNull(e.get("intensity"),1),k==="emission"?(s.push(y),a.push(p)):(o.push(y),l.push(p))):(w=e.get("id"),i=this._layerMeshes[w],i||(i=this._layerMeshes[w]=new r.a.Mesh({geometry:this._overlayGeometry,castShadow:!1,ignorePicking:!0})),d=e.get("shading"),d==="lambert"?(i.material=i.__lambertMaterial||new r.a.Material({autoUpdateTextureStatus:!1,shader:r.a.createShader("ecgl.lambert"),transparent:!0,depthMask:!1}),i.__lambertMaterial=i.material):(i.material=i.__colorMaterial||new r.a.Material({autoUpdateTextureStatus:!1,shader:r.a.createShader("ecgl.color"),transparent:!0,depthMask:!1}),i.__colorMaterial=i.material),i.material.enableTexture("diffuseMap"),b=e.get("distance"),v=c+(b==null?h.radius/100:b),i.scale.set(v,v,v),c=v,g=this._blankTexture||(this._blankTexture=r.a.createBlankTexture("rgba(255, 255, 255, 0)")),i.material.set("diffuseMap",g),r.a.loadTexture(e.get("texture"),t,{flipY:!1,anisotropic:8},function(n){n.surface&&n.surface.attachToMesh(i);i.material.set("diffuseMap",n);t.getZr().refresh()}),e.get("show")?this.groupGL.add(i):this.groupGL.remove(i))},this);i=this._earthMesh.material;i.define("fragment","LAYER_DIFFUSEMAP_COUNT",o.length);i.define("fragment","LAYER_EMISSIVEMAP_COUNT",s.length);i.set("layerDiffuseMap",o);i.set("layerDiffuseIntensity",l);i.set("layerEmissiveMap",s);i.set("layerEmissionIntensity",a);e=n.getModel("debug.wireframe");e.get("show")?(i.define("both","WIREFRAME_TRIANGLE"),v=r.a.parseColor(e.get("lineStyle.color")||"rgba(0,0,0,0.5)"),y=f.a.firstNotNull(e.get("lineStyle.width"),1),i.set("wireframeLineWidth",y),i.set("wireframeLineColor",v)):i.undefine("both","WIREFRAME_TRIANGLE")},_updateViewControl:function(n,t){function h(){return{type:"globeChangeCamera",alpha:i.getAlpha(),beta:i.getBeta(),distance:i.getDistance()-r.radius,center:i.getCenter(),from:s.uid,globeId:n.id}}var r=n.coordinateSystem,f=n.getModel("viewControl"),c=r.viewGL.camera,s=this,i=this._control,u,e,o;i.setViewGL(r.viewGL);u=f.get("targetCoord");u!=null&&(o=u[0]+90,e=u[1]);i.setFromViewControlModel(f,{baseDistance:r.radius,alpha:e,beta:o});i.off("update");i.on("update",function(){t.dispatchAction(h())})},_displaceVertices:function(n){var r=n.get("displacementQuality"),i=n.get("debug.wireframe.show"),f=n.coordinateSystem;if(n.isDisplacementChanged()||r!==this._displacementQuality||i!==this._showDebugWireframe){this._displacementQuality=r;this._showDebugWireframe=i;var t=this._sphereGeometry,u={low:100,medium:200,high:400,ultra:800}[r]||200,e=u/2;(t.widthSegments!==u||i)&&(t.widthSegments=u,t.heightSegments=e,t.build());this._doDisplaceVertices(t,f);i&&t.generateBarycentric()}},_doDisplaceVertices:function(n,t){var r=n.attributes.position.value,o=n.attributes.texcoord0.value,i=n.__originalPosition,f;i&&i.length===r.length||(i=new Float32Array(r.length),i.set(r),n.__originalPosition=i);var s=t.displacementWidth,y=t.displacementHeight,h=t.displacementData;for(f=0;f<n.vertexCount;f++){var u=f*3,c=f*2,l=i[u+1],a=i[u+2],v=i[u+3],p=o[c++],w=o[c++],b=Math.round(p*(s-1)),k=Math.round(w*(y-1)),d=k*s+b,e=h?h[d]:0;r[u+1]=l+l*e;r[u+2]=a+a*e;r[u+3]=v+v*e}n.generateVertexNormals();n.dirty();n.updateBoundingBox()},_updateLight:function(n){var f=this._earthMesh;this._sceneHelper.updateLight(n);var t=this._sceneHelper.mainLight,e=n.get("light.main.time")||new Date,i=h.a.getPosition(u.a.number.parseDate(e),0,0),r=Math.cos(i.altitude);t.position.y=-r*Math.cos(i.azimuth);t.position.x=Math.sin(i.altitude);t.position.z=r*Math.sin(i.azimuth);t.lookAt(f.getWorldPosition())},dispose:function(){this.groupGL.removeAll();this._control.dispose()}})},function(n,t){"use strict";function y(n){return n.valueOf()/l-.5+a}function p(n){return y(n)-v}function w(n,t){return h(i(n)*r(f)-o(t)*i(f),r(n))}function b(n,t){return s(i(t)*r(f)+r(t)*i(f)*i(n))}function k(n,t,u){return h(i(n),r(n)*i(t)-o(u)*r(t))}function d(n,t,u){return s(i(t)*i(u)+r(t)*r(u)*r(n))}function g(n,t){return u*(280.16+360.9856235*n)-t}function nt(n){return u*(357.5291+.98560028*n)}function tt(n){var t=u*(1.9148*i(n)+.02*i(2*n)+.0003*i(3*n)),r=u*102.9372;return n+t+r+e}function it(n){var i=nt(n),t=tt(i);return{dec:b(t,0),ra:w(t,0)}}var e=Math.PI,i=Math.sin,r=Math.cos,o=Math.tan,s=Math.asin,h=Math.atan2,u=e/180,l=864e5,a=2440588,v=2451545,f=u*23.4397,c={};c.getPosition=function(n,t,i){var s=u*-i,f=u*t,e=p(n),r=it(e),o=g(e,s)-r.ra;return{azimuth:k(o,f,r.dec),altitude:d(o,f,r.dec)}};t.a=c},function(n,t,i){"use strict";function a(n,t){var e=document.createElement("canvas"),s=e.getContext("2d"),r=n.width,u=n.height,f,o,i,h;for(e.width=r,e.height=u,s.drawImage(n,0,0,r,u),f=s.getImageData(0,0,r,u).data,o=new Float32Array(f.length/4),i=0;i<f.length/4;i++)h=f[i*4],o[i]=h/255*t;return{data:o,width:r,height:u}}function v(n,t){var u=n.getBoxLayoutParams(),i=s.a.getLayoutRect(u,{width:t.getWidth(),height:t.getHeight()}),r;i.y=t.getHeight()-i.y-i.height;this.viewGL.setViewport(i.x,i.y,i.width,i.height,t.getDevicePixelRatio());this.radius=n.get("globeRadius");r=n.get("globeOuterRadius");this.altitudeAxis&&this.altitudeAxis.setExtent(0,r-this.radius)}function y(n,t){var i=[Infinity,-Infinity],u;n.eachSeries(function(n){var t;if(n.coordinateSystem===this){var f=n.getData(),r=n.coordDimToDataDim("alt"),u=r&&r[0];u&&(t=f.getDataExtent(u,!0),i[0]=Math.min(i[0],t[0]),i[1]=Math.max(i[1],t[1]))}},this);i&&isFinite(i[1]-i[0])&&(u=r.a.helper.createScale(i,{type:"value",min:"dataMin",max:"dataMax"}),this.altitudeAxis=new r.a.Axis("altitude",u),this.resize(this.model,t))}var u=i(212),e=i(0),r=i.n(e),o=i(47),s=i.n(o),h=i(22),c=i(2),l=i(1),f={dimensions:u.a.prototype.dimensions,create:function(n,t){var i=[];return n.eachComponent("globe",function(n){n.__viewGL=n.__viewGL||new h.a;var r=new u.a;r.viewGL=n.__viewGL;n.coordinateSystem=r;r.model=n;i.push(r);r.resize=v;r.resize(n,t);r.update=y}),n.eachSeries(function(t){var i,r;if(t.get("coordinateSystem")==="globe"){if(i=t.getReferringComponents("globe")[0],i||(i=n.getComponent("globe")),!i)throw new Error('globe "'+c.a.firstNotNull(t.get("globe3DIndex"),t.get("globe3DId"),0)+'" not found');r=i.coordinateSystem;t.coordinateSystem=r}}),n.eachComponent("globe",function(n){var r=n.coordinateSystem,u=n.getDisplacementTexture(),f=n.getDisplacemenScale(),i;n.isDisplacementChanged()&&(n.hasDisplacement()?(i=!0,l.a.loadTexture(u,t,function(r){var e=r.image,u=a(e,f);n.setDisplacementData(u.data,u.width,u.height);i||t.dispatchAction({type:"globeUpdateDisplacment"})}),i=!1):r.setDisplacementData(null,0,0),r.setDisplacementData(n.displacementData,n.displacementWidth,n.displacementHeight))}),i}},p;r.a.registerCoordinateSystem("globe",f);p=f},function(n,t,i){"use strict";function r(n){this.radius=n;this.viewGL=null;this.altitudeAxis;this.displacementData=null;this.displacementWidth;this.displacementHeight}var u=i(6),f=u.a.vec3;r.prototype={constructor:r,dimensions:["lng","lat","alt"],type:"globe",containPoint:function(){},setDisplacementData:function(n,t,i){this.displacementData=n;this.displacementWidth=t;this.displacementHeight=i},_getDisplacementScale:function(n,t){var i=(n+180)/360*(this.displacementWidth-1),r=(90-t)/180*(this.displacementHeight-1),u=Math.round(i)+Math.round(r)*this.displacementWidth;return this.displacementData[u]},dataToPoint:function(n,t){var i=n[0],r=n[1],e=n[2]||0,u=this.radius,f;return this.displacementData&&(u*=1+this._getDisplacementScale(i,r)),this.altitudeAxis&&(u+=this.altitudeAxis.dataToCoord(e)),i=i*Math.PI/180,r=r*Math.PI/180,f=Math.cos(r)*u,t=t||[],t[0]=-f*Math.cos(i+Math.PI),t[1]=Math.sin(r)*u,t[2]=f*Math.sin(i+Math.PI),t},pointToData:function(n,t){var u=n[0],e=n[1],o=n[2],r=f.len(n),s,i,h,c;return u/=r,e/=r,o/=r,s=Math.asin(e),i=Math.atan2(o,-u),i<0&&(i=Math.PI*2+i),h=s*180/Math.PI,c=i*180/Math.PI-180,t=t||[],t[0]=c,t[1]=h,t[2]=r-this.radius,this.altitudeAxis&&(t[2]=this.altitudeAxis.coordToData(t[2])),t}};t.a=r},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(214),e=i(216),o=i(217);u.a.registerAction({type:"mapbox3DChangeCamera",event:"mapbox3dcamerachanged",update:"mapbox3D:updateCamera"},function(n,t){t.eachComponent({mainType:"mapbox3D",query:n},function(t){t.setMapboxCameraOption(n)})})},function(n,t,i){"use strict";var u=i(215),f=i(0),e=i.n(f),o=i(101),r=Object(o.a)("mapbox3D",u.a,function(n){n.forEach(function(n){n.setCameraOption(n.model.getMapboxCameraOption())})}),s;e.a.registerCoordinateSystem("mapbox3D",r);s=r},function(n,t,i){"use strict";function r(){u.a.apply(this,arguments)}var u=i(100);r.prototype=new u.a;r.prototype.constructor=r;r.prototype.type="mapbox3D";t.a=r},function(n,t,i){"use strict";var e=i(0),r=i.n(e),o=i(28),s=i(29),f=["zoom","center","pitch","bearing"],u=r.a.extendComponentModel({type:"mapbox3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,style:"mapbox://styles/mapbox/light-v9",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMapboxCameraOption:function(){var n=this;return f.reduce(function(t,i){return t[i]=n.get(i),t},{})},setMapboxCameraOption:function(n){n!=null&&f.forEach(function(t){n[t]!=null&&(this.option[t]=n[t])},this)},getMapbox:function(){return this._mapbox},setMapbox:function(n){this._mapbox=n}}),h;r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);h=u},function(n,t,i){"use strict";var u=i(0),f=i.n(u),e=i(218),o=i(30),r=i(1),s=i(102),h,c;r.a.Shader.import(s.a);h=512;c=f.a.extendComponentView({type:"mapbox3D",__ecgl__:!0,init:function(n,t){var u=t.getZr(),i,f;this._zrLayer=new e.a("mapbox3D",u);u.painter.insertLayer(-1e3,this._zrLayer);this._lightRoot=new r.a.Node;this._sceneHelper=new o.a(this._lightRoot);this._sceneHelper.initLight(this._lightRoot);i=this._zrLayer.getMapbox();f=this._dispatchInteractAction.bind(this,t,i);["zoom","rotate","drag","pitch","rotate","move"].forEach(function(n){i.on(n,f)});this._groundMesh=new r.a.Mesh({geometry:new r.a.PlaneGeometry,material:new r.a.Material({shader:new r.a.Shader({vertex:r.a.Shader.source("ecgl.displayShadow.vertex"),fragment:r.a.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},render:function(n,t,i){var r=this._zrLayer.getMapbox(),f=n.get("style"),e=JSON.stringify(f),u;e!==this._oldStyleStr&&f&&r.setStyle(f);this._oldStyleStr=e;r.setCenter(n.get("center"));r.setZoom(n.get("zoom"));r.setPitch(n.get("pitch"));r.setBearing(n.get("bearing"));n.setMapbox(r);u=n.coordinateSystem;u.viewGL.scene.add(this._lightRoot);u.viewGL.add(this._groundMesh);this._updateGroundMesh();this._sceneHelper.setScene(u.viewGL.scene);this._sceneHelper.updateLight(n);u.viewGL.setPostEffect(n.getModel("postEffect"),i);u.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));this._mapbox3DModel=n},afterRender:function(n,t,i,r){var u=r.renderer;this._sceneHelper.updateAmbientCubemap(u,n,i);this._sceneHelper.updateSkybox(u,n,i);n.coordinateSystem.viewGL.scene.traverse(function(n){n.material&&(n.material.define("fragment","NORMAL_UP_AXIS",2),n.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(n,t,i,r){n.coordinateSystem.setCameraOption(r);this._updateGroundMesh();i.getZr().refresh()},_dispatchInteractAction:function(n,t){n.dispatchAction({type:"mapbox3DChangeCamera",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),mapbox3DId:this._mapbox3DModel&&this._mapbox3DModel.id})},_updateGroundMesh:function(){var n,t;if(this._mapbox3DModel){n=this._mapbox3DModel.coordinateSystem;t=n.dataToPoint(n.center);this._groundMesh.position.set(t[0],t[1],-.001);var i=new r.a.Plane(new r.a.Vector3(0,0,1),0),f=n.viewGL.camera.castRay(new r.a.Vector2(-1,-1)),e=n.viewGL.camera.castRay(new r.a.Vector2(1,1)),o=f.intersectPlane(i),s=e.intersectPlane(i),u=o.dist(s)/n.viewGL.rootNode.scale.x;this._groundMesh.scale.set(u,u,1)}},dispose:function(n,t){this._zrLayer&&this._zrLayer.dispose();t.getZr().painter.delLayer(-1e3)}})},function(n,t){"use strict";function i(n,t){if(this.id=n,this.zr=t,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!mapboxgl)throw new Error("Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/");this._mapbox=new mapboxgl.Map({container:this.dom});this._initEvents()}i.prototype.resize=function(){this._mapbox.resize()};i.prototype.getMapbox=function(){return this._mapbox};i.prototype.clear=function(){};i.prototype.refresh=function(){this._mapbox.resize()};var r=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel"];i.prototype._initEvents=function(){var n=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(n){return n.preventDefault(),!1}};r.forEach(function(t){this._handlers[t]=function(t){var i={},r,u;for(r in t)i[r]=t[r];i.bubbles=!1;u=new t.constructor(t.type,i);n.dispatchEvent(u)};this.zr.dom.addEventListener(t,this._handlers[t])},this);this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};i.prototype.dispose=function(){r.forEach(function(n){this.zr.dom.removeEventListener(n,this._handlers[n])},this)};t.a=i},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(220),e=i(222),o=i(223);u.a.registerAction({type:"maptalks3DChangeCamera",event:"maptalks3dcamerachanged",update:"maptalks3D:updateCamera"},function(n,t){t.eachComponent({mainType:"maptalks3D",query:n},function(t){t.setMaptalksCameraOption(n)})})},function(n,t,i){"use strict";var u=i(221),f=i(0),e=i.n(f),o=i(101),r=Object(o.a)("maptalks3D",u.a,function(n){n.forEach(function(n){n.setCameraOption(n.model.getMaptalksCameraOption())})}),s;e.a.registerCoordinateSystem("maptalks3D",r);s=r},function(n,t,i){"use strict";function r(){u.a.apply(this,arguments);this.maxPitch=85;this.zoomOffset=1}var u=i(100);r.prototype=new u.a;r.prototype.constructor=r;r.prototype.type="maptalks3D";t.a=r},function(n,t,i){"use strict";var e=i(0),r=i.n(e),o=i(28),s=i(29),f=["zoom","center","pitch","bearing"],u=r.a.extendComponentModel({type:"maptalks3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org">OpenStreetMap<\/a> contributors, &copy; <a href="https://carto.com/">CARTO<\/a>',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMaptalksCameraOption:function(){var n=this;return f.reduce(function(t,i){return t[i]=n.get(i),t},{})},setMaptalksCameraOption:function(n){n!=null&&f.forEach(function(t){n[t]!=null&&(this.option[t]=n[t])},this)},getMaptalks:function(){return this._maptalks},setMaptalks:function(n){this._maptalks=n}}),h;r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);h=u},function(n,t,i){"use strict";var u=i(0),f=i.n(u),e=i(224),o=i(30),r=i(1),s=i(102),h;r.a.Shader.import(s.a);h=f.a.extendComponentView({type:"maptalks3D",__ecgl__:!0,init:function(){this._groundMesh=new r.a.Mesh({geometry:new r.a.PlaneGeometry,material:new r.a.Material({shader:new r.a.Shader({vertex:r.a.Shader.source("ecgl.displayShadow.vertex"),fragment:r.a.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},_initMaptalksLayer:function(n,t){var u=t.getZr(),i,f;this._zrLayer=new e.a("maptalks3D",u,n.get("center"),n.get("zoom"));u.painter.insertLayer(-1e3,this._zrLayer);this._lightRoot=new r.a.Node;this._sceneHelper=new o.a(this._lightRoot);this._sceneHelper.initLight(this._lightRoot);i=this._zrLayer.getMaptalks();f=this._dispatchInteractAction.bind(this,t,i);["zoomend","zooming","zoomstart","dragrotating","pitch","pitchend","movestart","moving","moveend","resize","touchstart","touchmove","touchend"].forEach(function(n){i.on(n,f)})},render:function(n,t,i){var u;this._zrLayer||this._initMaptalksLayer(n,i);var r=this._zrLayer.getMaptalks(),f=n.get("urlTemplate"),e=r.getBaseLayer();f!==this._oldUrlTemplate&&(e?e.setOptions({urlTemplate:f,attribution:n.get("attribution")}):(e=new maptalks.TileLayer("maptalks-echarts-gl-baselayer",{urlTemplate:f,subdomains:["a","b","c"],attribution:n.get("attribution")}),r.setBaseLayer(e)));this._oldUrlTemplate=f;r.setCenter(n.get("center"));r.setZoom(n.get("zoom"),{animation:!1});r.setPitch(n.get("pitch"));r.setBearing(n.get("bearing"));n.setMaptalks(r);u=n.coordinateSystem;u.viewGL.scene.add(this._lightRoot);u.viewGL.add(this._groundMesh);this._updateGroundMesh();this._sceneHelper.setScene(u.viewGL.scene);this._sceneHelper.updateLight(n);u.viewGL.setPostEffect(n.getModel("postEffect"),i);u.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));this._maptalks3DModel=n},afterRender:function(n,t,i,r){var u=r.renderer;this._sceneHelper.updateAmbientCubemap(u,n,i);this._sceneHelper.updateSkybox(u,n,i);n.coordinateSystem.viewGL.scene.traverse(function(n){n.material&&(n.material.define("fragment","NORMAL_UP_AXIS",2),n.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(n,t,i,r){n.coordinateSystem.setCameraOption(r);this._updateGroundMesh();i.getZr().refresh()},_dispatchInteractAction:function(n,t){n.dispatchAction({type:"maptalks3DChangeCamera",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),maptalks3DId:this._maptalks3DModel&&this._maptalks3DModel.id})},_updateGroundMesh:function(){var n,t;if(this._maptalks3DModel){n=this._maptalks3DModel.coordinateSystem;t=n.dataToPoint(n.center);this._groundMesh.position.set(t[0],t[1],-.001);var i=new r.a.Plane(new r.a.Vector3(0,0,1),0),f=n.viewGL.camera.castRay(new r.a.Vector2(-1,-1)),e=n.viewGL.camera.castRay(new r.a.Vector2(1,1)),o=f.intersectPlane(i),s=e.intersectPlane(i),u=o.dist(s)/n.viewGL.rootNode.scale.x;this._groundMesh.scale.set(u,u,1)}},dispose:function(n,t){this._zrLayer&&this._zrLayer.dispose();t.getZr().painter.delLayer(-1e3)}})},function(n,t){"use strict";function i(n,t,i,r){if(this.id=n,this.zr=t,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!maptalks)throw new Error("Maptalks library must be included. See https://maptalks.org");this._maptalks=new maptalks.Map(this.dom,{center:i,zoom:r,fog:!1});this._initEvents()}i.prototype.resize=function(){this._maptalks.checkSize()};i.prototype.getMaptalks=function(){return this._maptalks};i.prototype.clear=function(){};i.prototype.refresh=function(){this._maptalks.checkSize()};var r=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","touchcancel"];i.prototype._initEvents=function(){var n=this.dom;this._handlers=this._handlers||{contextmenu:function(n){return n.preventDefault(),!1}};r.forEach(function(t){this._handlers[t]=function(i){var r={},u,f;for(u in i)r[u]=i[u];r.bubbles=!1;f=new i.constructor(i.type,r);t==="mousewheel"||t==="DOMMouseScroll"?n.dispatchEvent(f):n.firstElementChild.dispatchEvent(f)};this.zr.dom.addEventListener(t,this._handlers[t])},this);this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};i.prototype.dispose=function(){r.forEach(function(n){this.zr.dom.removeEventListener(n,this._handlers[n])},this);this._maptalks.remove()};t.a=i},function(n,t,i){"use strict";var u=i(0),r=i.n(u),e=i(226),o=i(229),s=i(231),f=i(17);r.a.registerVisual(Object(f.a)("bar3D"));r.a.registerProcessor(function(n){n.eachSeriesByType("bar3d",function(n){var t=n.getData();t.filterSelf(function(n){return t.hasValue(n)})})})},function(n,t,i){"use strict";function a(n,t){var i=n.getData(),v=n.get("minHeight")||0,o=n.get("barSize"),h=["lng","lat","alt"].map(function(t){return n.coordDimToDataDim(t)[0]}),c,l,a;o==null?(c=t.radius*Math.PI,l=Object(u.a)(i,h[0],h[1]),o=[c/Math.sqrt(i.count()/l),c/Math.sqrt(i.count()/l)]):r.a.util.isArray(o)||(o=[o,o]);a=f(i,h);i.each(h,function(n,r,u,f){var h=i.get(a.dimension,f),y=a.isStacked?h-u:t.altitudeAxis.scale.getExtent()[0],p=Math.max(t.altitudeAxis.dataToCoord(u),v),c=t.dataToPoint([n,r,y]),w=t.dataToPoint([n,r,h]),s=e.sub([],w,c),l;e.normalize(s,s);l=[o[0],p,o[1]];i.setItemLayout(f,[c,s,l])});i.setLayout("orient",s.a.UP.array)}function v(n,t){var i=n.getData(),e=n.get("barSize"),a=n.get("minHeight")||0,o=["lng","lat","alt"].map(function(t){return n.coordDimToDataDim(t)[0]}),s,h,l,c;e==null?(s=Math.min(t.size[0],t.size[2]),h=Object(u.a)(i,o[0],o[1]),e=[s/Math.sqrt(i.count()/h),s/Math.sqrt(i.count()/h)]):r.a.util.isArray(e)||(e=[e,e]);l=[0,1,0];c=f(i,o);i.each(o,function(n,r,u,f){var o=i.get(c.dimension,f),s=c.isStacked?o-u:t.altitudeAxis.scale.getExtent()[0],h=Math.max(t.altitudeAxis.dataToCoord(u),a),v=t.dataToPoint([n,r,s]),y=[e[0],h,e[1]];i.setItemLayout(f,[v,l,y])});i.setLayout("orient",[1,0,0])}function y(n,t){var i=n.getData(),o=n.coordDimToDataDim("lng")[0],s=n.coordDimToDataDim("lat")[0],b=n.coordDimToDataDim("alt")[0],e=n.get("barSize"),k=n.get("minHeight")||0;if(e==null){var h=i.getDataExtent(o),c=i.getDataExtent(s),l=t.dataToPoint([h[0],c[0]]),a=t.dataToPoint([h[1],c[1]]),v=Math.min(Math.abs(l[0]-a[0]),Math.abs(l[1]-a[1]))||1,y=Object(u.a)(i,o,s);e=[v/Math.sqrt(i.count()/y),v/Math.sqrt(i.count()/y)]}else r.a.util.isArray(e)||(e=[e,e]),e[0]/=t.getScale()/16,e[1]/=t.getScale()/16;var d=[0,0,1],p=[o,s,b],w=f(i,p);i.each(p,function(n,r,u,f){var o=i.get(w.dimension,f),h=w.isStacked?o-u:0,s=t.dataToPoint([n,r,h]),c=t.dataToPoint([n,r,o]),l=Math.max(c[2]-s[2],k),a=[e[0],l,e[1]];i.setItemLayout(f,[s,d,a])});i.setLayout("orient",[1,0,0])}function f(n,t){var i=l(n,t[2]);return{dimension:i?n.getCalculationInfo("stackResultDimension"):t[2],isStacked:i}}var o=i(0),r=i.n(o),s=i(3),h=i(6),c=i(227),u=i(228),e=h.a.vec3,l=r.a.helper.dataStack.isDimensionStacked;r.a.registerLayout(function(n){n.eachSeriesByType("bar3D",function(n){var t=n.coordinateSystem,i=t&&t.type;if(i==="globe")a(n,t);else if(i==="cartesian3D")Object(c.a)(n,t);else if(i==="geo3D")v(n,t);else if(i==="mapbox3D"||i==="maptalks3D")y(n,t);else if(1)if(t)throw new Error("bar3D doesn't support coordinate system "+t.type);else throw new Error("bar3D doesn't have coordinate system.");})})},function(n,t,i){"use strict";function s(n){var t=n[0],i=n[1];return!(t>0&&i>0||t<0&&i<0)}function h(n,t){var i=n.getData(),u=n.get("barSize");if(u==null){var h=t.size,c,l,a=t.getAxis("x"),v=t.getAxis("y");c=a.type==="category"?a.getBandWidth()*.7:Math.round(h[0]/Math.sqrt(i.count()))*.6;l=v.type==="category"?v.getBandWidth()*.7:Math.round(h[1]/Math.sqrt(i.count()))*.6;u=[c,l]}else r.a.util.isArray(u)||(u=[u,u]);var y=t.getAxis("z").scale.getExtent(),w=s(y),f=["x","y","z"].map(function(t){return n.coordDimToDataDim(t)[0]}),p=o(i,f[2]),b=p?i.getCalculationInfo("stackResultDimension"):f[2];i.each(f,function(n,r,f,o){var c=i.get(b,o),v=p?c-f:w?0:y[0],s=t.dataToPoint([n,r,v]),l=t.dataToPoint([n,r,c]),h=e.dist(s,l),k=[0,l[1]<s[1]?-1:1,0],a;Math.abs(h)===0&&(h=.1);a=[u[0],h,u[1]];i.setItemLayout(o,[s,k,a])});i.setLayout("orient",[1,0,0])}var u=i(0),r=i.n(u),f=i(6),e=f.a.vec3,o=r.a.helper.dataStack.isDimensionStacked;t.a=h},function(n,t){"use strict";t.a=function(n,t,i){for(var s,e=n.getDataExtent(t),o=n.getDataExtent(i),c=e[1]-e[0]||e[0],l=o[1]-o[0]||o[0],u=50,f=new Uint8Array(u*u),r=0;r<n.count();r++){var a=n.get(t,r),v=n.get(i,r),y=Math.floor((a-e[0])/c*(u-1)),p=Math.floor((v-o[0])/l*(u-1)),h=p*u+y;f[h]=f[h]||1}for(s=0,r=0;r<f.length;r++)f[r]&&s++;return s/f.length}},function(n,t,i){"use strict";var f=i(0),u=i.n(f),r=i(1),e=i(2),o=i(32),s=i(230),h=i(66),c=i(6),l=c.a.vec3,a=u.a.extendChartView({type:"bar3D",__ecgl__:!0,init:function(n,t){this.groupGL=new r.a.Node;this._api=t;this._labelsBuilder=new h.a(256,256,t);var i=this;this._labelsBuilder.getLabelPosition=function(n,t,r){if(i._data){var u=i._data.getItemLayout(n),f=u[0],e=u[1],o=u[2][1];return l.scaleAndAdd([],f,e,r+o)}return[0,0]};this._labelsBuilder.getMesh().renderOrder=100},render:function(n,t,i){var e=this._prevBarMesh,u,f;this._prevBarMesh=this._barMesh;this._barMesh=e;this._barMesh||(this._barMesh=new r.a.Mesh({geometry:new s.a,shadowDepthMaterial:new r.a.Material({shader:new r.a.Shader(r.a.Shader.source("ecgl.sm.depth.vertex"),r.a.Shader.source("ecgl.sm.depth.fragment"))}),culling:n.coordinateSystem.type==="cartesian3D",renderOrder:10,renderNormal:!0}));this.groupGL.remove(this._prevBarMesh);this.groupGL.add(this._barMesh);this.groupGL.add(this._labelsBuilder.getMesh());u=n.coordinateSystem;this._doRender(n,i);u&&u.viewGL&&(u.viewGL.add(this.groupGL),f=u.viewGL.isLinearSpace()?"define":"undefine",this._barMesh.material[f]("fragment","SRGB_DECODE"));this._data=n.getData();this._labelsBuilder.updateData(this._data);this._labelsBuilder.updateLabels();this._updateAnimation(n)},_updateAnimation:function(n){r.a.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevBarMesh,this._barMesh,n)},_doRender:function(n,t){var f=n.getData(),h=n.get("shading"),w=h!=="color",b=this,u=this._barMesh,a="ecgl."+h,v,y,l;u.material&&u.material.shader.name===a||(u.material=r.a.createMaterial(a,["VERTEX_COLOR"]));r.a.setMaterialFromModel(h,u.material,n,t);u.geometry.enableNormal=w;u.geometry.resetOffset();v=n.get("bevelSize");y=n.get("bevelSmoothness");u.geometry.bevelSegments=y;u.geometry.bevelSize=v;var i=[],e=new Float32Array(f.count()*4),o=0,c=0,s=!1;f.each(function(n){if(f.hasValue(n)){var u=f.getItemVisual(n,"color"),t=f.getItemVisual(n,"opacity");t==null&&(t=1);r.a.parseColor(u,i);i[3]*=t;e[o++]=i[0];e[o++]=i[1];e[o++]=i[2];e[o++]=i[3];i[3]>0&&(c++,i[3]<.99&&(s=!0))}});u.geometry.setBarCount(c);var k=f.getLayout("orient"),p=this._barIndexOfData=new Int32Array(f.count()),c=0;f.each(function(n){if(!f.hasValue(n)){p[n]=-1;return}var r=f.getItemLayout(n),u=r[0],o=r[1],s=r[2],t=n*4;i[0]=e[t++];i[1]=e[t++];i[2]=e[t++];i[3]=e[t++];i[3]>0&&(b._barMesh.geometry.addBar(u,o,k,s,i,n),p[n]=c++)});u.geometry.dirty();u.geometry.updateBoundingBox();l=u.material;l.transparent=s;l.depthMask=!s;u.geometry.sortTriangles=s;this._initHandler(n,t)},_initHandler:function(n,t){var u=n.getData(),i=this._barMesh,f=n.coordinateSystem.type==="cartesian3D",r;i.seriesIndex=n.seriesIndex;r=-1;i.off("mousemove");i.off("mouseout");i.on("mousemove",function(n){var e=i.geometry.getDataIndexOfVertex(n.triangle[0]);e!==r&&(this._downplay(r),this._highlight(e),this._labelsBuilder.updateLabels([e]),f&&t.dispatchAction({type:"grid3DShowAxisPointer",value:[u.get("x",e),u.get("y",e),u.get("z",e,!0)]}));r=e;i.dataIndex=e},this);i.on("mouseout",function(){this._downplay(r);this._labelsBuilder.updateLabels();r=-1;i.dataIndex=-1;f&&t.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_highlight:function(n){var t=this._data,i,h,o;if(t&&(i=this._barIndexOfData[n],!(i<0))){var c=t.getItemModel(n),s=c.getModel("emphasis.itemStyle"),f=s.get("color"),e=s.get("opacity");f==null&&(h=t.getItemVisual(n,"color"),f=u.a.color.lift(h,-.4));e==null&&(e=t.getItemVisual(n,"opacity"));o=r.a.parseColor(f);o[3]*=e;this._barMesh.geometry.setColor(i,o);this._api.getZr().refresh()}},_downplay:function(n){var t=this._data,i;if(t&&(i=this._barIndexOfData[n],!(i<0))){var f=t.getItemVisual(n,"color"),e=t.getItemVisual(n,"opacity"),u=r.a.parseColor(f);u[3]*=e;this._barMesh.geometry.setColor(i,u);this._api.getZr().refresh()}},highlight:function(n,t,i,r){this._toggleStatus("highlight",n,t,i,r)},downplay:function(n,t,i,r){this._toggleStatus("downplay",n,t,i,r)},_toggleStatus:function(n,t,i,r,f){var s=t.getData(),h=e.a.queryDataIndex(s,f),c=this;h!=null?u.a.util.each(o.a.normalizeToArray(h),function(t){n==="highlight"?this._highlight(t):this._downplay(t)},this):s.each(function(t){n==="highlight"?c._highlight(t):c._downplay(t)})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";var s=i(0),e=i.n(s),h=i(38),c=i(65),u=i(15),o=i(6),r=o.a.vec3,l=o.a.mat3,f=u.a.extend(function(){return{attributes:{position:new u.a.Attribute("position","float",3,"POSITION"),normal:new u.a.Attribute("normal","float",3,"NORMAL"),color:new u.a.Attribute("color","float",4,"COLOR"),prevPosition:new u.a.Attribute("prevPosition","float",3),prevNormal:new u.a.Attribute("prevNormal","float",3)},dynamic:!0,enableNormal:!1,bevelSize:1,bevelSegments:0,_dataIndices:null,_vertexOffset:0,_triangleOffset:0}},{resetOffset:function(){this._vertexOffset=0;this._triangleOffset=0},setBarCount:function(n){var r=this.enableNormal,t=this.getBarVertexCount()*n,i=this.getBarTriangleCount()*n;this.vertexCount!==t&&(this.attributes.position.init(t),r?this.attributes.normal.init(t):this.attributes.normal.value=null,this.attributes.color.init(t));this.triangleCount!==i&&(this.indices=t>65535?new Uint32Array(i*3):new Uint16Array(i*3),this._dataIndices=new Uint32Array(t))},getBarVertexCount:function(){var n=this.bevelSize>0?this.bevelSegments:0;return n>0?this._getBevelBarVertexCount(n):this.enableNormal?24:8},getBarTriangleCount:function(){var n=this.bevelSize>0?this.bevelSegments:0;return n>0?this._getBevelBarTriangleCount(n):12},_getBevelBarVertexCount:function(n){return(n+1)*4*(n+1)*2},_getBevelBarTriangleCount:function(n){var t=n*4+3,i=n*2+1;return(t+1)*i*2+4},setColor:function(n,t){for(var r=this.getBarVertexCount(),u=r*n,f=r*(n+1),i=u;i<f;i++)this.attributes.color.set(i,t);this.dirtyAttribute("color")},getDataIndexOfVertex:function(n){return this._dataIndices?this._dataIndices[n]:null},addBar:function(){for(var d,v,w,y,u=r.create,t=r.scaleAndAdd,l=u(),e=u(),f=u(),i=u(),h=u(),b=u(),c=u(),n=[],o=[],s=0;s<8;s++)n[s]=u();var a=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[3,2,1,0],[0,4,7,3],[1,2,6,5]],k=[0,1,2,0,2,3],p=[];for(s=0;s<a.length;s++)for(d=a[s],v=0;v<2;v++){for(w=[],y=0;y<3;y++)w.push(d[k[v*3+y]]);p.push(w)}return function(u,s,v,y,w,d){var ot=this._vertexOffset,tt,rt,ut,ft,it,nt,et,g;if(this.bevelSize>0&&this.bevelSegments>0)this._addBevelBar(u,s,v,y,this.bevelSize,this.bevelSegments,w);else if(r.copy(f,s),r.normalize(f,f),r.cross(i,v,f),r.normalize(i,i),r.cross(e,f,i),r.normalize(i,i),r.negate(h,e),r.negate(b,f),r.negate(c,i),t(n[0],u,e,y[0]/2),t(n[0],n[0],i,y[2]/2),t(n[1],u,e,y[0]/2),t(n[1],n[1],c,y[2]/2),t(n[2],u,h,y[0]/2),t(n[2],n[2],c,y[2]/2),t(n[3],u,h,y[0]/2),t(n[3],n[3],i,y[2]/2),t(l,u,f,y[1]),t(n[4],l,e,y[0]/2),t(n[4],n[4],i,y[2]/2),t(n[5],l,e,y[0]/2),t(n[5],n[5],c,y[2]/2),t(n[6],l,h,y[0]/2),t(n[6],n[6],c,y[2]/2),t(n[7],l,h,y[0]/2),t(n[7],n[7],i,y[2]/2),tt=this.attributes,this.enableNormal){for(o[0]=e,o[1]=h,o[2]=f,o[3]=b,o[4]=i,o[5]=c,rt=this._vertexOffset,g=0;g<a.length;g++){for(it=this._triangleOffset*3,nt=0;nt<6;nt++)this.indices[it++]=rt+k[nt];rt+=4;this._triangleOffset+=2}for(g=0;g<a.length;g++)for(ut=o[g],nt=0;nt<4;nt++)ft=a[g][nt],tt.position.set(this._vertexOffset,n[ft]),tt.normal.set(this._vertexOffset,ut),tt.color.set(this._vertexOffset++,w)}else{for(g=0;g<p.length;g++){for(it=this._triangleOffset*3,nt=0;nt<3;nt++)this.indices[it+nt]=p[g][nt]+this._vertexOffset;this._triangleOffset++}for(g=0;g<n.length;g++)tt.position.set(this._vertexOffset,n[g]),tt.color.set(this._vertexOffset++,w)}for(et=this._vertexOffset,g=ot;g<et;g++)this._dataIndices[g]=d}}(),_addBevelBar:function(){var f=r.create(),i=r.create(),t=r.create(),n=l.create(),u=[],e=[1,-1,-1,1],o=[1,1,-1,-1],s=[2,0];return function(h,c,l,a,v,y,p){var it,et,st,ot,d,w;for(r.copy(i,c),r.normalize(i,i),r.cross(t,l,i),r.normalize(t,t),r.cross(f,i,t),r.normalize(t,t),n[0]=f[0],n[1]=f[1],n[2]=f[2],n[3]=i[0],n[4]=i[1],n[5]=i[2],n[6]=t[0],n[7]=t[1],n[8]=t[2],v=Math.min(a[0],a[2])/2*v,w=0;w<3;w++)u[w]=Math.max(a[w]-v*2,0);var ut=(a[0]-u[0])/2,nt=(a[1]-u[1])/2,ft=(a[2]-u[2])/2,g=[],k=[],tt=this._vertexOffset,b=[];for(w=0;w<2;w++)for(b[w]=b[w]=[],it=0;it<=y;it++)for(d=0;d<4;d++)for((it===0&&w===0||w===1&&it===y)&&b[w].push(tt),et=0;et<=y;et++)st=et/y*Math.PI/2+Math.PI/2*d,ot=it/y*Math.PI/2+Math.PI/2*w,k[0]=ut*Math.cos(st)*Math.sin(ot),k[1]=nt*Math.cos(ot),k[2]=ft*Math.sin(st)*Math.sin(ot),g[0]=k[0]+e[d]*u[0]/2,g[1]=k[1]+nt+s[w]*u[1]/2,g[2]=k[2]+o[d]*u[2]/2,Math.abs(ut-nt)<1e-6&&Math.abs(nt-ft)<1e-6||(k[0]/=ut*ut,k[1]/=nt*nt,k[2]/=ft*ft),r.normalize(k,k),r.transformMat3(g,g,n),r.transformMat3(k,k,n),r.add(g,g,h),this.attributes.position.set(tt,g),this.enableNormal&&this.attributes.normal.set(tt,k),this.attributes.color.set(tt,p),tt++;var ht=y*4+3,at=y*2+1,rt=ht+1;for(d=0;d<at;d++)for(w=0;w<=ht;w++){var ct=d*rt+w+this._vertexOffset,vt=d*rt+(w+1)%rt+this._vertexOffset,lt=(d+1)*rt+(w+1)%rt+this._vertexOffset,yt=(d+1)*rt+w+this._vertexOffset;this.setTriangleIndices(this._triangleOffset++,[lt,ct,vt]);this.setTriangleIndices(this._triangleOffset++,[lt,yt,ct])}this.setTriangleIndices(this._triangleOffset++,[b[0][0],b[0][2],b[0][1]]);this.setTriangleIndices(this._triangleOffset++,[b[0][0],b[0][3],b[0][2]]);this.setTriangleIndices(this._triangleOffset++,[b[1][0],b[1][1],b[1][2]]);this.setTriangleIndices(this._triangleOffset++,[b[1][0],b[1][2],b[1][3]]);this._vertexOffset=tt}}()});e.a.util.defaults(f.prototype,h.a);e.a.util.defaults(f.prototype,c.a);t.a=f},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(31),o=i(32),s=i(39),h=i(50),u=r.a.extendSeriesModel({type:"series.bar3D",dependencies:["globe"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){return Object(h.a)(this)},getFormattedLabel:function(n,t,i,r){var u=o.a.getFormattedLabel(this,n,t,i,r);return u==null&&(u=this.getData().get("z",n)),u},formatTooltip:function(n){return Object(s.a)(this,n)},defaultOption:{coordinateSystem:"cartesian3D",globeIndex:0,grid3DIndex:0,zlevel:-10,bevelSize:0,bevelSmoothness:2,onGridPlane:"xy",shading:"color",minHeight:0,itemStyle:{opacity:1},label:{show:!1,distance:2,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},emphasis:{label:{show:!0}},animationDurationUpdate:500}}),c;r.a.util.merge(u.prototype,e.a);c=u},function(n,t,i){"use strict";var u=i(0),r=i.n(u),s=i(233),h=i(234),f=i(51),e=i.n(f),o=i(17);r.a.registerVisual(e()("line3D","circle",null));r.a.registerVisual(Object(o.a)("line3D"));r.a.registerLayout(function(n){n.eachSeriesByType("line3D",function(n){var f=n.getData(),t=n.coordinateSystem;if(t){if(t.type!=="cartesian3D"){!0&&console.error("line3D needs cartesian3D coordinateSystem");return}var i=new Float32Array(f.count()*3),r=[],u=[],e=t.dimensions,o=e.map(function(t){return n.coordDimToDataDim(t)[0]});t&&f.each(o,function(n,f,e,o){r[0]=n;r[1]=f;r[2]=e;t.dataToPoint(r,u);i[o*3]=u[0];i[o*3+1]=u[1];i[o*3+2]=u[2]});f.setLayout("points",i)}})})},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(39),e=i(50),o=u.a.extendSeriesModel({type:"series.line3D",dependencies:["grid3D"],visualColorAccessPath:"lineStyle.color",getInitialData:function(){return Object(e.a)(this)},formatTooltip:function(n){return Object(f.a)(this,n)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,lineStyle:{width:2},animationDurationUpdate:500}}),s=o},function(n,t,i){"use strict";var e=i(0),o=i.n(e),r=i(1),u=i(2),s=i(25),f=i(9),h=i(3),c=i(235),l=i.n(c),a=i(6),v=i(46),y=a.a.vec3,p;r.a.Shader.import(v.a);p=o.a.extendChartView({type:"line3D",__ecgl__:!0,init:function(n,t){this.groupGL=new r.a.Node;this._api=t},render:function(n,t,i){var e=this._prevLine3DMesh,u,f;this._prevLine3DMesh=this._line3DMesh;this._line3DMesh=e;this._line3DMesh||(this._line3DMesh=new r.a.Mesh({geometry:new s.a({useNativeLine:!1,sortTriangles:!0}),material:new r.a.Material({shader:r.a.createShader("ecgl.meshLines3D")}),renderOrder:10}),this._line3DMesh.geometry.pick=this._pick.bind(this));this.groupGL.remove(this._prevLine3DMesh);this.groupGL.add(this._line3DMesh);u=n.coordinateSystem;u&&u.viewGL&&(u.viewGL.add(this.groupGL),f=u.viewGL.isLinearSpace()?"define":"undefine",this._line3DMesh.material[f]("fragment","SRGB_DECODE"));this._doRender(n,i);this._data=n.getData();this._camera=u.viewGL.camera;this.updateCamera();this._updateAnimation(n)},updateCamera:function(){this._updateNDCPosition()},_doRender:function(n,t){var s=n.getData(),i=this._line3DMesh,a,c;i.geometry.resetOffset();var e=s.getLayout("points"),f=[],o=new Float32Array(e.length/3*4),h=0,l=!1;s.each(function(n){var i=s.getItemVisual(n,"color"),t=s.getItemVisual(n,"opacity");t==null&&(t=1);r.a.parseColor(i,f);f[3]*=t;o[h++]=f[0];o[h++]=f[1];o[h++]=f[2];o[h++]=f[3];f[3]<.99&&(l=!0)});i.geometry.setVertexCount(i.geometry.getPolylineVertexCount(e));i.geometry.setTriangleCount(i.geometry.getPolylineTriangleCount(e));i.geometry.addPolyline(e,o,u.a.firstNotNull(n.get("lineStyle.width"),1));i.geometry.dirty();i.geometry.updateBoundingBox();a=i.material;a.transparent=l;a.depthMask=!l;c=n.getModel("debug.wireframe");c.get("show")?(i.geometry.createAttribute("barycentric","float",3),i.geometry.generateBarycentric(),i.material.set("both","WIREFRAME_TRIANGLE"),i.material.set("wireframeLineColor",r.a.parseColor(c.get("lineStyle.color")||"rgba(0,0,0,0.5)")),i.material.set("wireframeLineWidth",u.a.firstNotNull(c.get("lineStyle.width"),1))):i.material.set("both","WIREFRAME_TRIANGLE");this._points=e;this._initHandler(n,t)},_updateAnimation:function(n){r.a.updateVertexAnimation([["prevPosition","position"],["prevPositionPrev","positionPrev"],["prevPositionNext","positionNext"]],this._prevLine3DMesh,this._line3DMesh,n)},_initHandler:function(n,t){var r=n.getData(),f=n.coordinateSystem,i=this._line3DMesh,u=-1;i.seriesIndex=n.seriesIndex;i.off("mousemove");i.off("mouseout");i.on("mousemove",function(n){var o=f.pointToData(n.point.array),e=r.indicesOfNearest("x",o[0])[0];e!==u&&(t.dispatchAction({type:"grid3DShowAxisPointer",value:[r.get("x",e),r.get("y",e),r.get("z",e)]}),i.dataIndex=e);u=e},this);i.on("mouseout",function(){u=-1;i.dataIndex=-1;t.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateNDCPosition:function(){var s=new f.a,h=this._camera,n,i,u,o;f.a.multiply(s,h.projectionMatrix,h.viewMatrix);var t=this._positionNDC,r=this._points,e=r.length/3;for(t&&t.length/2===e||(t=this._positionNDC=new Float32Array(e*2)),n=[],i=0;i<e;i++)u=i*3,o=i*2,n[0]=r[u],n[1]=r[u+1],n[2]=r[u+2],n[3]=1,y.transformMat4(n,n,s.array),t[o]=n[0]/n[3],t[o+1]=n[1]/n[3]},_pick:function(n,t,i,r,u,f){var o=this._positionNDC,nt=this._data.hostModel,tt=nt.get("lineStyle.width"),s=-1,it=i.viewport.width,rt=i.viewport.height,v=it*.5,y=rt*.5,e,d,g,c,a;for(n=(n+1)*v,t=(t+1)*y,e=1;e<o.length/2;e++){var p=(o[(e-1)*2]+1)*v,w=(o[(e-1)*2+1]+1)*y,b=(o[e*2]+1)*v,k=(o[e*2+1]+1)*y;l.a.containStroke(p,w,b,k,tt,n,t)&&(d=(p-n)*(p-n)+(w-t)*(w-t),g=(b-n)*(b-n)+(k-t)*(k-t),s=d<g?e-1:e)}s>=0&&(c=s*3,a=new h.a(this._points[c],this._points[c+1],this._points[c+2]),f.push({dataIndex:s,point:a,pointWorld:a.clone(),target:this._line3DMesh,distance:this._camera.getWorldPosition().dist(a)}))},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(n,t){function i(n,t,i,r,u,f,e){var h,l;if(u===0)return!1;var o=u,s=0,c=n;if(e>t+o&&e>r+o||e<t-o&&e<r-o||f>n+o&&f>i+o||f<n-o&&f<i-o)return!1;if(n!==i)s=(t-r)/(n-i),c=(n*r-i*t)/(n-i);else return Math.abs(f-n)<=o/2;return h=s*f-e+c,l=h*h/(s*s+1),l<=o/2*o/2}t.containStroke=i},function(n,t,i){"use strict";var u=i(0),r=i.n(u),s=i(237),h=i(238),f=i(51),e=i.n(f),o=i(17);r.a.registerVisual(e()("scatter3D","circle",null));r.a.registerVisual(Object(o.a)("scatter3D"));r.a.registerLayout({seriesType:"scatter3D",reset:function(n){var r=n.coordinateSystem,u;if(r){if(u=r.dimensions,u.length<3){!0&&console.error("scatter3D needs 3D coordinateSystem");return}var f=u.map(function(t){return n.coordDimToDataDim(t)[0]}),t=[],i=[];return{progress:function(n,u){for(var s,o=new Float32Array((n.end-n.start)*3),e=n.start;e<n.end;e++)s=(e-n.start)*3,t[0]=u.get(f[0],e),t[1]=u.get(f[1],e),t[2]=u.get(f[2],e),r.dataToPoint(t,i),o[s]=i[0],o[s+1]=i[1],o[s+2]=i[2];u.setLayout("points",o)}}}}})},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(32),e=i(39),o=i(50);u.a.extendSeriesModel({type:"series.scatter3D",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){return Object(o.a)(this)},getFormattedLabel:function(n,t,i,r){var e=f.a.getFormattedLabel(this,n,t,i,r),u,o;return e==null&&(u=this.getData(),o=u.dimensions[u.dimensions.length-1],e=u.get(o,n)),e},formatTooltip:function(n){return Object(e.a)(this,n)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,progressive:1e5,progressiveThreshold:1e5,grid3DIndex:0,globeIndex:0,symbol:"circle",symbolSize:10,blendMode:"source-over",label:{show:!1,position:"right",distance:5,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},itemStyle:{opacity:.8},emphasis:{label:{show:!0}},animationDurationUpdate:500}})},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(1),o=i(2),s=i(32),u=i(67);r.a.extendChartView({type:"scatter3D",__ecgl__:!0,init:function(){this.groupGL=new e.a.Node;this._pointsBuilderList=[];this._currentStep=0},render:function(n,t,i){var r,f;if(this.groupGL.removeAll(),n.getData().count())if(r=n.coordinateSystem,r&&r.viewGL)r.viewGL.add(this.groupGL),this._camera=r.viewGL.camera,f=this._pointsBuilderList[0],f||(f=this._pointsBuilderList[0]=new u.a(!1,i)),this._pointsBuilderList.length=1,this.groupGL.add(f.rootNode),f.update(n,t,i),f.updateView(r.viewGL.camera);else if(1)throw new Error("Invalid coordinate system");},incrementalPrepareRender:function(n){var t=n.coordinateSystem;if(t&&t.viewGL)t.viewGL.add(this.groupGL),this._camera=t.viewGL.camera;else if(1)throw new Error("Invalid coordinate system");this.groupGL.removeAll();this._currentStep=0},incrementalRender:function(n,t,i,r){if(!(n.end<=n.start)){var f=this._pointsBuilderList[this._currentStep];f||(f=new u.a(!1,r),this._pointsBuilderList[this._currentStep]=f);this.groupGL.add(f.rootNode);f.update(t,i,r,n.start,n.end);f.updateView(t.coordinateSystem.viewGL.camera);this._currentStep++}},updateCamera:function(){this._pointsBuilderList.forEach(function(n){n.updateView(this._camera)},this)},highlight:function(n,t,i,r){this._toggleStatus("highlight",n,t,i,r)},downplay:function(n,t,i,r){this._toggleStatus("downplay",n,t,i,r)},_toggleStatus:function(n,t,i,u,f){var e=t.getData(),h=o.a.queryDataIndex(e,f),c=n==="highlight";h!=null?r.a.util.each(s.a.normalizeToArray(h),function(n){for(var i,t=0;t<this._pointsBuilderList.length;t++)i=this._pointsBuilderList[t],c?i.highlight(e,n):i.downplay(e,n)},this):e.each(function(n){for(var i,t=0;t<this._pointsBuilderList.length;t++)i=this._pointsBuilderList[t],c?i.highlight(e,n):i.downplay(e,n)})},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";function r(n,t,i){var t=t||document.createElement("canvas"),r;return t.width=n,t.height=n,r=t.getContext("2d"),i&&i(r),t}function o(n,t,i,r){var l;f.a.util.isArray(t)||(t=[t,t]);var o=u.getMarginByStyle(i,r),s=t[0]+o.left+o.right,h=t[1]+o.top+o.bottom,e=f.a.helper.createSymbol(n,0,0,t[0],t[1]),c=Math.max(s,h);return e.position=[o.left,o.top],s>h?e.position[1]+=(c-h)/2:e.position[0]+=(c-s)/2,l=e.getBoundingRect(),e.position[0]-=l.x,e.position[1]-=l.y,e.setStyle(i),e.update(),e.__size=c,e}function s(n,t,i){function a(n){return n<128?1:-1}function p(n,r){var o=Infinity,u,e,s;n=Math.floor(n*v);r=Math.floor(r*y);var h=r*f+n,b=t.data[h*4],c=a(b);for(u=Math.max(r-i,0);u<Math.min(r+i,l);u++)for(e=Math.max(n-i,0);e<Math.min(n+i,f);e++){var h=u*f+e,k=t.data[h*4],d=a(k),p=e-n,w=u-r;c!==d&&(s=p*p+w*w,s<o&&(o=s))}return c*Math.sqrt(o)}for(var u,f=t.width,l=t.height,e=n.canvas.width,h=n.canvas.height,v=f/e,y=l/h,r=n.createImageData(e,h),o=0;o<h;o++)for(u=0;u<e;u++){var w=p(u,o),c=w/i*.5+.5,s=(o*e+u)*4;r.data[s++]=(1-c)*255;r.data[s++]=(1-c)*255;r.data[s++]=(1-c)*255;r.data[s++]=255}return r}var e=i(0),f=i.n(e),u={getMarginByStyle:function(n){var r=n.minMargin||0,t=0;n.stroke&&n.stroke!=="none"&&(t=n.lineWidth==null?1:n.lineWidth);var u=n.shadowBlur||0,f=n.shadowOffsetX||0,e=n.shadowOffsetY||0,i={};return i.left=Math.max(t/2,-f+u,r),i.right=Math.max(t/2,f+u,r),i.top=Math.max(t/2,-e+u,r),i.bottom=Math.max(t/2,e+u,r),i},createSymbolSprite:function(n,t,i,f){var e=o(n,t,i),s=u.getMarginByStyle(i);return{image:r(e.__size,f,function(n){e.brush(n)}),margin:s}},createSDFFromCanvas:function(n,t,i,u){return r(t,u,function(t){var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height);t.putImageData(s(t,u,i),0,0)})},createSimpleSprite:function(n,t){return r(n,t,function(t){var i=n/2,r;t.beginPath();t.arc(i,i,60,0,Math.PI*2,!1);t.closePath();r=t.createRadialGradient(i,i,0,i,i,i);r.addColorStop(0,"rgba(255, 255, 255, 1)");r.addColorStop(.5,"rgba(255, 255, 255, 0.5)");r.addColorStop(1,"rgba(255, 255, 255, 0)");t.fillStyle=r;t.fill()})}};t.a=u},function(n,t,i){"use strict";var r=i(1),e=i(241),o=i(0),s=i.n(o),h=i(6),c=i(242),u=h.a.vec4,f;r.a.Shader.import(c.a);f=r.a.Mesh.extend(function(){var t=new r.a.Geometry({dynamic:!0,attributes:{color:new r.a.Geometry.Attribute("color","float",4,"COLOR"),position:new r.a.Geometry.Attribute("position","float",3,"POSITION"),size:new r.a.Geometry.Attribute("size","float",1),prevPosition:new r.a.Geometry.Attribute("prevPosition","float",3),prevSize:new r.a.Geometry.Attribute("prevSize","float",1)}}),n,i;return s.a.util.extend(t,e.a),n=new r.a.Material({shader:r.a.createShader("ecgl.sdfSprite"),transparent:!0,depthMask:!1}),n.enableTexture("sprite"),n.define("both","VERTEX_COLOR"),n.define("both","VERTEX_SIZE"),i=new r.a.Texture2D({image:document.createElement("canvas"),flipY:!1}),n.set("sprite",i),t.pick=this._pick.bind(this),{geometry:t,material:n,mode:r.a.Mesh.POINTS,sizeScale:1}},{_pick:function(n,t,i,u,f,e){var a=this._positionNDC,s,o,c,l;if(a){var v=i.viewport,y=2/v.width,p=2/v.height;for(s=this.geometry.vertexCount-1;s>=0;s--){o=this.geometry.indices?this.geometry.indices[s]:s;var w=a[o*2],b=a[o*2+1],k=this.geometry.attributes.size.get(o)/this.sizeScale,h=k/2;n>w-h*y&&n<w+h*y&&t>b-h*p&&t<b+h*p&&(c=new r.a.Vector3,l=new r.a.Vector3,this.geometry.attributes.position.get(o,c.array),r.a.Vector3.transformMat4(l,c,this.worldTransform),e.push({vertexIndex:o,point:c,pointWorld:l,target:this,distance:l.distance(u.getWorldPosition())}))}}},updateNDCPosition:function(n){var r=this._positionNDC,f=this.geometry,t,i;for(r&&r.length/2===f.vertexCount||(r=this._positionNDC=new Float32Array(f.vertexCount*2)),t=u.create(),i=0;i<f.vertexCount;i++)f.attributes.position.get(i,t),t[3]=1,u.transformMat4(t,t,n.array),u.scale(t,t,1/t[3]),r[i*2]=t[0],r[i*2+1]=t[1]}});t.a=f},function(n,t,i){"use strict";var r=i(97),f=i(6),u=f.a.vec3;t.a={needsSortVertices:function(){return this.sortVertices},needsSortVerticesProgressively:function(){return this.needsSortVertices()&&this.vertexCount>=2e4},doSortVertices:function(n,t){var f=this.indices,e=u.create(),s,r,i;if(!f)for(f=this.indices=this.vertexCount>65535?new Uint32Array(this.vertexCount):new Uint16Array(this.vertexCount),i=0;i<f.length;i++)f[i]=i;if(t===0){var h=this.attributes.position,n=n.array,o=0;for(this._zList&&this._zList.length===this.vertexCount||(this._zList=new Float32Array(this.vertexCount)),i=0;i<this.vertexCount;i++)h.get(i,e),r=u.sqrDist(e,n),isNaN(r)&&(r=1e7,o++),i===0?(s=r,r=0):r=r-s,this._zList[i]=r;this._noneCount=o}if(this.vertexCount<2e4)t===0&&this._simpleSort(this._noneCount/this.vertexCount>.05);else for(i=0;i<3;i++)this._progressiveQuickSort(t*3+i);this.dirtyIndices()},_simpleSort:function(n){function u(n,t){return i[t]-i[n]}var i=this._zList,t=this.indices;n?Array.prototype.sort.call(t,u):r.a.sort(t,u,0,t.length-1)},_progressiveQuickSort:function(n){var t=this._zList,i=this.indices;this._quickSort=this._quickSort||new r.a;this._quickSort.step(i,function(n,i){return t[i]-t[n]},n)}}},function(n,t){"use strict";t.a="@export ecgl.sdfSprite.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform float elapsedTime : 0;\n\nattribute vec3 position : POSITION;\n\n#ifdef VERTEX_SIZE\nattribute float size;\n#else\nuniform float u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_FillColor: COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute float prevSize;\nuniform float percent : 1.0;\n#endif\n\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvarying float v_Size;\n\nvoid main()\n{\n\n#ifdef POSITIONTEXTURE_ENABLED\n gl_Position = worldViewProjection * vec4(texture2D(positionTexture, position.xy).xy, -10.0, 1.0);\n#else\n\n #ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n #else\n vec3 pos = position;\n #endif\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n#endif\n\n#ifdef VERTEX_SIZE\n#ifdef VERTEX_ANIMATION\n v_Size = mix(prevSize, size, percent);\n#else\n v_Size = size;\n#endif\n#else\n v_Size = u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\n v_Color = a_FillColor;\n #endif\n\n gl_PointSize = v_Size;\n}\n\n@end\n\n@export ecgl.sdfSprite.fragment\n\nuniform vec4 color: [1, 1, 1, 1];\nuniform vec4 strokeColor: [1, 1, 1, 1];\nuniform float smoothing: 0.07;\n\nuniform float lineWidth: 0.0;\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\nvarying float v_Size;\n\nuniform sampler2D sprite;\n\n@import clay.util.srgb\n\nvoid main()\n{\n gl_FragColor = color;\n\n vec4 _strokeColor = strokeColor;\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n #endif\n\n#ifdef SPRITE_ENABLED\n float d = texture2D(sprite, gl_PointCoord).r;\n gl_FragColor.a *= smoothstep(0.5 - smoothing, 0.5 + smoothing, d);\n\n if (lineWidth > 0.0) {\n float sLineWidth = lineWidth / 2.0;\n\n float outlineMaxValue0 = 0.5 + sLineWidth;\n float outlineMaxValue1 = 0.5 + sLineWidth + smoothing;\n float outlineMinValue0 = 0.5 - sLineWidth - smoothing;\n float outlineMinValue1 = 0.5 - sLineWidth;\n\n if (d <= outlineMaxValue1 && d >= outlineMinValue0) {\n float a = _strokeColor.a;\n if (d <= outlineMinValue1) {\n a = a * smoothstep(outlineMinValue0, outlineMinValue1, d);\n }\n else {\n a = a * smoothstep(outlineMaxValue1, outlineMaxValue0, d);\n }\n gl_FragColor.rgb = mix(gl_FragColor.rgb * gl_FragColor.a, _strokeColor.rgb, a);\n gl_FragColor.a = gl_FragColor.a * (1.0 - a) + a;\n }\n }\n#endif\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(gl_FragColor);\n#endif\n}\n@end"},function(n,t,i){"use strict";var u=i(0),r=i.n(u),e=i(244),o=i(245),s=i(248),f=i(17);r.a.registerVisual(Object(f.a)("lines3D"));r.a.registerAction({type:"lines3DPauseEffect",event:"lines3deffectpaused",update:"series.lines3D:pauseEffect"},function(){});r.a.registerAction({type:"lines3DResumeEffect",event:"lines3deffectresumed",update:"series.lines3D:resumeEffect"},function(){});r.a.registerAction({type:"lines3DToggleEffect",event:"lines3deffectchanged",update:"series.lines3D:toggleEffect"},function(){})},function(n,t,i){"use strict";function tt(n,t){v.copy(p,n[0]);v.copy(w,n[1]);var k=[],i=k[0]=e(),b=k[1]=e(),d=k[2]=e(),a=k[3]=e();t.dataToPoint(p,i);t.dataToPoint(w,a);f(o,i);y(u,a,i);f(u,u);c(s,u,o);f(s,s);c(u,o,s);l(b,o,u);f(b,b);f(o,a);y(u,i,a);f(u,u);c(s,u,o);f(s,s);c(u,o,s);l(d,o,u);f(d,d);l(h,i,a);f(h,h);var nt=r.dot(i,h),tt=r.dot(h,b),g=(Math.max(r.len(i),r.len(a))-nt)/tt*2;return r.scaleAndAdd(b,i,b,g),r.scaleAndAdd(d,a,d,g),k}function it(n,t,i){var u=[],f=u[0]=r.create(),o=u[1]=r.create(),s=u[2]=r.create(),e=u[3]=r.create(),h;return t.dataToPoint(n[0],f),t.dataToPoint(n[1],e),h=r.dist(f,e),r.lerp(o,f,e,.3),r.lerp(s,f,e,.3),r.scaleAndAdd(o,o,i,Math.min(h*.1,10)),r.scaleAndAdd(s,s,i,Math.min(h*.1,10)),u}function b(n,t){for(var i=new Float32Array(n.length*3),u=0,r=[],f=0;f<n.length;f++)t.dataToPoint(n[f],r),i[u++]=r[0],i[u++]=r[1],i[u++]=r[2];return i}function k(n){var t=[];return n.each(function(i){var u=n.getItemModel(i),r=u.option instanceof Array?u.option:u.getShallow("coords",!0);if(!0&&!(r instanceof Array&&r.length>0&&r[0]instanceof Array))throw new Error("Invalid coords "+JSON.stringify(r)+". Lines must have 2d coords array in data item.");t.push(r)}),{coordsList:t}}function rt(n,t){var i=n.getData(),r=n.get("polyline"),u;i.setLayout("lineType",r?"polyline":"cubicBezier");u=k(i);i.each(function(n){var f=u.coordsList[n],e=r?b:tt;i.setItemLayout(n,e(f,t))})}function d(n,t,i){var r=n.getData(),u=n.get("polyline"),f=k(r);r.setLayout("lineType",u?"polyline":"cubicBezier");r.each(function(n){var e=f.coordsList[n],o=u?b(e,t):it(e,t,i);r.setItemLayout(n,o)})}var g=i(0),nt=i.n(g),a=i(6),r=a.a.vec3,v=a.a.vec2,f=r.normalize,c=r.cross,y=r.sub,l=r.add,e=r.create,o=e(),u=e(),s=e(),h=e(),p=[],w=[];nt.a.registerLayout(function(n){n.eachSeriesByType("lines3D",function(n){var t=n.coordinateSystem;t.type==="globe"?rt(n,t):t.type==="geo3D"?d(n,t,[0,1,0]):(t.type==="mapbox3D"||t.type==="maptalks3D")&&d(n,t,[0,0,1])})})},function(n,t,i){"use strict";function h(n){return n.radius!=null?n.radius:n.size!=null?Math.max(n.size[0],n.size[1],n.size[2]):100}var u=i(0),f=i.n(u),r=i(1),e=i(25),o=i(246),s=i(46),c;r.a.Shader.import(s.a);c=f.a.extendChartView({type:"lines3D",__ecgl__:!0,init:function(){this.groupGL=new r.a.Node;this._meshLinesMaterial=new r.a.Material({shader:r.a.createShader("ecgl.meshLines3D"),transparent:!0,depthMask:!1});this._linesMesh=new r.a.Mesh({geometry:new e.a,material:this._meshLinesMaterial,$ignorePicking:!0});this._trailMesh=new o.a},render:function(n,t,i){var f,s,h,e,u,o;this.groupGL.add(this._linesMesh);f=n.coordinateSystem;s=n.getData();f&&f.viewGL&&(h=f.viewGL,h.add(this.groupGL),this._updateLines(n,t,i),e=f.viewGL.isLinearSpace()?"define":"undefine",this._linesMesh.material[e]("fragment","SRGB_DECODE"),this._trailMesh.material[e]("fragment","SRGB_DECODE"));u=this._trailMesh;u.stopAnimation();n.get("effect.show")?(this.groupGL.add(u),u.updateData(s,i,this._linesMesh.geometry),u.__time=u.__time||0,o=36e5,this._curveEffectsAnimator=u.animate("",{loop:!0}).when(o,{__time:o}).during(function(){u.setAnimationTime(u.__time)}).start()):(this.groupGL.remove(u),this._curveEffectsAnimator=null);this._linesMesh.material.blend=this._trailMesh.material.blend=n.get("blendMode")==="lighter"?r.a.additiveBlend:null},pauseEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.pause()},resumeEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.resume()},toggleEffect:function(){var n=this._curveEffectsAnimator;n&&(n.isPaused()?n.resume():n.pause())},_updateLines:function(n,t,i){var f=n.getData(),v=n.coordinateSystem,u=this._linesMesh.geometry,c=n.get("polyline"),l,o,s,e;u.expandLine=!0;l=h(v);u.segmentScale=l/20;var y="lineStyle.width".split("."),p=i.getDevicePixelRatio(),a=0;f.each(function(n){var i=f.getItemModel(n),t=i.get(y);t==null&&(t=1);f.setItemVisual(n,"lineWidth",t);a=Math.max(t,a)});u.useNativeLine=!1;o=0;s=0;f.each(function(n){var t=f.getItemLayout(n);c?(o+=u.getPolylineVertexCount(t),s+=u.getPolylineTriangleCount(t)):(o+=u.getCubicCurveVertexCount(t[0],t[1],t[2],t[3]),s+=u.getCubicCurveTriangleCount(t[0],t[1],t[2],t[3]))});u.setVertexCount(o);u.setTriangleCount(s);u.resetOffset();e=[];f.each(function(n){var t=f.getItemLayout(n),s=f.getItemVisual(n,"color"),i=f.getItemVisual(n,"opacity"),o=f.getItemVisual(n,"lineWidth")*p;i==null&&(i=1);e=r.a.parseColor(s,e);e[3]*=i;c?u.addPolyline(t,e,o):u.addCubicCurve(t[0],t[1],t[2],t[3],e,o)});u.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";function h(n){return n>0?1:-1}var f=i(0),c=i.n(f),r=i(1),e=i(6),o=i(25),s=i(247),u=e.a.vec3;r.a.Shader.import(s.a);t.a=r.a.Mesh.extend(function(){var t=new r.a.Material({shader:new r.a.Shader(r.a.Shader.source("ecgl.trail2.vertex"),r.a.Shader.source("ecgl.trail2.fragment")),transparent:!0,depthMask:!1}),n=new o.a({dynamic:!0});return n.createAttribute("dist","float",1),n.createAttribute("distAll","float",1),n.createAttribute("start","float",1),{geometry:n,material:t,culling:!1,$ignorePicking:!0}},{updateData:function(n,t,i){var s=n.hostModel,f=this.geometry,o=s.getModel("effect"),g=o.get("trailWidth")*t.getDevicePixelRatio(),l=o.get("trailLength"),y=s.get("effect.constantSpeed"),p=s.get("effect.period")*1e3,a=y!=null,w,b;!0&&(this.getScene()||console.error("TrailMesh must been add to scene before updateData"));a?this.material.set("speed",y/1e3):this.material.set("period",p);this.material[a?"define":"undefine"]("vertex","CONSTANT_SPEED");w=s.get("polyline");f.trailLength=l;this.material.set("trailLength",l);f.resetOffset();["position","positionPrev","positionNext"].forEach(function(n){f.attributes[n].value=i.attributes[n].value});b=["dist","distAll","start","offset","color"];b.forEach(function(n){f.attributes[n].init(f.vertexCount)});f.indices=i.indices;var c=[],k=o.get("trailColor"),d=o.get("trailOpacity"),nt=k!=null,tt=d!=null;this.updateWorldTransform();var it=this.worldTransform.x.len(),rt=this.worldTransform.y.len(),ut=this.worldTransform.z.len(),e=0,v=0;n.each(function(t){var l=n.getItemLayout(t),b=tt?d:n.getItemVisual(t,"opacity"),st=n.getItemVisual(t,"color"),ot,o;b==null&&(b=1);c=r.a.parseColor(nt?k:st,c);c[3]*=b;var ft=w?i.getPolylineVertexCount(l):i.getCubicCurveVertexCount(l[0],l[1],l[2],l[3]),y=0,s=[],et=[];for(o=e;o<e+ft;o++)f.attributes.position.get(o,s),s[0]*=it,s[1]*=rt,s[2]*=ut,o>e&&(y+=u.dist(s,et)),f.attributes.dist.set(o,y),u.copy(et,s);for(v=Math.max(v,y),ot=Math.random()*(a?y:p),o=e;o<e+ft;o++)f.attributes.distAll.set(o,y),f.attributes.start.set(o,ot),f.attributes.offset.set(o,h(i.attributes.offset.get(o))*g/2),f.attributes.color.set(o,c);e+=ft});this.material.set("spotSize",v*.1*l);this.material.set("spotIntensity",o.get("spotIntensity"));f.dirty()},setAnimationTime:function(n){this.material.set("time",n)}})},function(n,t){"use strict";t.a="@export ecgl.trail2.vertex\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute float dist;\nattribute float distAll;\nattribute float start;\n\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nuniform float speed : 0;\nuniform float trailLength: 0.3;\nuniform float time;\nuniform float period: 1000;\n\nuniform float spotSize: 1;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n\n#ifdef CONSTANT_SPEED\n float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;\n#else\n float t = mod((time + start) / period, 1. + trailLength) - trailLength;\n#endif\n\n float trailLen = distAll * trailLength;\n\n v_Percent = (dist - t * distAll) / trailLen;\n\n v_SpotPercent = spotSize / distAll;\n\n }\n@end\n\n\n@export ecgl.trail2.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform float spotIntensity: 5;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n if (v_Percent > 1.0 || v_Percent < 0.0) {\n discard;\n }\n\n float fade = v_Percent;\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n\n if (v_Percent > (1.0 - v_SpotPercent)) {\n gl_FragColor.rgb *= spotIntensity;\n }\n\n gl_FragColor.a *= fade;\n}\n\n@end"},function(n,t,i){"use strict";var u=i(0),r=i.n(u);r.a.extendSeriesModel({type:"series.lines3D",dependencies:["globe"],visualColorAccessPath:"lineStyle.color",getInitialData:function(n){var t=new r.a.List(["value"],this);return t.hasItemOption=!1,t.initData(n.data,[],function(n,i,r,u){if(n instanceof Array)return NaN;t.hasItemOption=!0;var f=n.value;if(f!=null)return f instanceof Array?f[u]:f}),t},defaultOption:{coordinateSystem:"globe",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:!1,effect:{show:!1,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:!0,blendMode:"source-over",lineStyle:{width:1,opacity:.5}}})},function(n,t,i){"use strict";var r=i(0),u=i.n(r),e=i(250),o=i(251),f=i(17);u.a.registerVisual(Object(f.a)("polygons3D"))},function(n,t,i){"use strict";function u(n,t){for(var r=[],i=0;i<t.length;i++)r.push(n.dataToPoint(t[i]));return r}var e=i(0),r=i.n(e),o=i(31),f=r.a.extendSeriesModel({type:"series.polygons3D",getRegionModel:function(n){return this.getData().getItemModel(n)},getRegionPolygonCoords:function(n){var s=this.coordinateSystem,r=this.getData().getItemModel(n),t=r.option instanceof Array?r.option:r.getShallow("coords"),e,i,o,f;for(r.get("multiPolygon")||(t=[t]),e=[],i=0;i<t.length;i++){for(o=[],f=1;f<t[i].length;f++)o.push(u(s,t[i][f]));e.push({exterior:u(s,t[i][0]),interiors:o})}return e},getInitialData:function(n){var t=new r.a.List(["value"],this);return t.hasItemOption=!1,t.initData(n.data,[],function(n,i,r,u){if(n instanceof Array)return NaN;t.hasItemOption=!0;var f=n.value;if(f!=null)return f instanceof Array?f[u]:f}),t},defaultOption:{show:!0,data:null,multiPolygon:!1,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}}),s;r.a.util.merge(f.prototype,o.a);s=f},function(n,t,i){"use strict";var u=i(0),f=i.n(u),r=i(64),e=i(1);f.a.extendChartView({type:"polygons3D",__ecgl__:!0,init:function(){this.groupGL=new e.a.Node;this._geo3DBuilderList=[];this._currentStep=0},render:function(n,t,i){var f,u;this.groupGL.removeAll();f=n.coordinateSystem;f&&f.viewGL&&f.viewGL.add(this.groupGL);u=this._geo3DBuilderList[0];u||(u=new r.a(i),u.extrudeY=f.type!=="mapbox3D"&&f.type!=="maptalks3D",this._geo3DBuilderList[0]=u);this._updateShaderDefines(f,u);u.update(n,t,i);this._geo3DBuilderList.length=1;this.groupGL.add(u.rootNode)},incrementalPrepareRender:function(n){this.groupGL.removeAll();var t=n.coordinateSystem;t&&t.viewGL&&t.viewGL.add(this.groupGL);this._currentStep=0},incrementalRender:function(n,t,i,u){var f=this._geo3DBuilderList[this._currentStep],e=t.coordinateSystem;f||(f=new r.a(u),f.extrudeY=e.type!=="mapbox3D"&&e.type!=="maptalks3D",this._geo3DBuilderList[this._currentStep]=f);f.update(t,i,u,n.start,n.end);this.groupGL.add(f.rootNode);this._updateShaderDefines(e,f);this._currentStep++},_updateShaderDefines:function(n,t){var i=n.viewGL.isLinearSpace()?"define":"undefine";t.rootNode.traverse(function(t){t.material&&(t.material[i]("fragment","SRGB_DECODE"),(n.type==="mapbox3D"||n.type==="maptalks3D")&&(t.material.define("fragment","NORMAL_UP_AXIS",2),t.material.define("fragment","NORMAL_FRONT_AXIS",1)))})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";var r=i(0),u=i.n(r),e=i(253),o=i(254),s=i(255),f=i(17);u.a.registerVisual(Object(f.a)("surface"))},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(31),o=i(39),s=i(50),u=r.a.extendSeriesModel({type:"series.surface",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",formatTooltip:function(n){return Object(o.a)(this,n)},getInitialData:function(n){function nt(n){return!(isNaN(n.min)||isNaN(n.max)||isNaN(n.step))}function v(n){var t=r.a.number.getPrecisionSafe;return Math.max(t(n.min),t(n.max),t(n.step))+1}var t=n.data,w,b,k,d,e,o,g;if(!t)if(n.parametric){var l=n.parametricEquation||{},h=l.u||{},c=l.v||{};["u","v"].forEach(function(n){if(!nt(l[n])){!0&&console.error("Invalid parametricEquation.%s",n);return}});["x","y","z"].forEach(function(n){if(typeof l[n]!="function"){!0&&console.error("parametricEquation.%s needs to be function",n);return}});k=Math.floor((h.max+h.step-h.min)/h.step);d=Math.floor((c.max+c.step-c.min)/c.step);t=new Float32Array(k*d*5);var st=v(h),ht=v(c),f=0;for(e=0;e<d;e++)for(o=0;o<k;o++){var ct=o*h.step+h.min,lt=e*c.step+c.min,y=r.a.number.round(Math.min(ct,h.max),st),p=r.a.number.round(Math.min(lt,c.max),ht),tt=l.x(y,p),it=l.y(y,p),ft=l.z(y,p);t[f++]=tt;t[f++]=it;t[f++]=ft;t[f++]=y;t[f++]=p}}else{var a=n.equation||{},i=a.x||{},u=a.y||{};if(["x","y"].forEach(function(n){if(!nt(a[n])){!0&&console.error("Invalid equation.%s",n);return}}),typeof a.z!="function"){!0&&console.error("equation.z needs to be function");return}w=Math.floor((i.max+i.step-i.min)/i.step);b=Math.floor((u.max+u.step-u.min)/u.step);t=new Float32Array(w*b*3);var et=v(i),ot=v(u),f=0;for(e=0;e<b;e++)for(o=0;o<w;o++){var tt=o*i.step+i.min,it=e*u.step+u.min,rt=r.a.number.round(Math.min(tt,i.max),et),ut=r.a.number.round(Math.min(it,u.max),ot),ft=a.z(rt,ut);t[f++]=rt;t[f++]=ut;t[f++]=ft}}return g=["x","y","z"],n.parametric&&g.push("u","v"),Object(s.a)(this,g,t)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,shading:"lambert",parametric:!1,wireframe:{show:!0,lineStyle:{color:"rgba(0,0,0,0.5)",width:1}},equation:{x:{min:-1,max:1,step:.1},y:{min:-1,max:1,step:.1},z:null},parametricEquation:{u:{min:-1,max:1,step:.1},v:{min:-1,max:1,step:.1},x:null,y:null,z:null},itemStyle:{},animationDurationUpdate:500}}),h;r.a.util.merge(u.prototype,e.a);h=u},function(n,t,i){"use strict";function h(n){return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])}var e=i(0),f=i.n(e),r=i(1),c=i(2),o=i(6),s=i(65),u=o.a.vec3;f.a.extendChartView({type:"surface",__ecgl__:!0,init:function(){this.groupGL=new r.a.Node},render:function(n,t,i){var a=this._prevSurfaceMesh,h,u;this._prevSurfaceMesh=this._surfaceMesh;this._surfaceMesh=a;this._surfaceMesh||(this._surfaceMesh=this._createSurfaceMesh());this.groupGL.remove(this._prevSurfaceMesh);this.groupGL.add(this._surfaceMesh);var f=n.coordinateSystem,o=n.get("shading"),v=n.getData(),s="ecgl."+o;this._surfaceMesh.material&&this._surfaceMesh.material.shader.name===s||(this._surfaceMesh.material=r.a.createMaterial(s,["VERTEX_COLOR","DOUBLE_SIDED"]));r.a.setMaterialFromModel(o,this._surfaceMesh.material,n,i);f&&f.viewGL&&(f.viewGL.add(this.groupGL),h=f.viewGL.isLinearSpace()?"define":"undefine",this._surfaceMesh.material[h]("fragment","SRGB_DECODE"));var y=n.get("parametric"),p=this._getDataShape(v,y),e=n.getModel("wireframe"),c=e.get("lineStyle.width"),l=e.get("show")&&c>0;this._updateSurfaceMesh(this._surfaceMesh,n,p,l);u=this._surfaceMesh.material;l?(u.define("WIREFRAME_QUAD"),u.set("wireframeLineWidth",c),u.set("wireframeLineColor",r.a.parseColor(e.get("lineStyle.color")))):u.undefine("WIREFRAME_QUAD");this._initHandler(n,i);this._updateAnimation(n)},_updateAnimation:function(n){r.a.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevSurfaceMesh,this._surfaceMesh,n)},_createSurfaceMesh:function(){var n=new r.a.Mesh({geometry:new r.a.Geometry({dynamic:!0,sortTriangles:!0}),shadowDepthMaterial:new r.a.Material({shader:new r.a.Shader(r.a.Shader.source("ecgl.sm.depth.vertex"),r.a.Shader.source("ecgl.sm.depth.fragment"))}),culling:!1,renderOrder:10,renderNormal:!0});return n.geometry.createAttribute("barycentric","float",4),n.geometry.createAttribute("prevPosition","float",3),n.geometry.createAttribute("prevNormal","float",3),f.a.util.extend(n.geometry,s.a),n},_initHandler:function(n,t){function o(n,t){for(var f,e=Infinity,o=-1,s=[],r=0;r<n.length;r++)i.geometry.attributes.position.get(n[r],s),f=u.dist(t.array,s),f<e&&(e=f,o=n[r]);return o}var r=n.getData(),i=this._surfaceMesh,e=n.coordinateSystem,f;i.seriesIndex=n.seriesIndex;f=-1;i.off("mousemove");i.off("mouseout");i.on("mousemove",function(n){var v=o(n.triangle,n.point),l,s,a;if(v>=0){l=[];i.geometry.attributes.position.get(v,l);var y=e.pointToData(l),p=Infinity,h=-1,c=[];for(s=0;s<r.count();s++)c[0]=r.get("x",s),c[1]=r.get("y",s),c[2]=r.get("z",s),a=u.squaredDistance(c,y),a<p&&(h=s,p=a);h!==f&&t.dispatchAction({type:"grid3DShowAxisPointer",value:y});f=h;i.dataIndex=h}else i.dataIndex=-1},this);i.on("mouseout",function(){f=-1;i.dataIndex=-1;t.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateSurfaceMesh:function(n,t,i,f){var c=n.geometry,b=t.getData(),tt=b.getLayout("points"),dt=0,wt,fi,vt,kt,nt,ft,k,a,et,d,w,at,v,ei,o,l,e;b.each(function(n){b.hasValue(n)||dt++});var gt=dt||f,ot=c.attributes.position,st=c.attributes.normal,yt=c.attributes.texcoord0,ni=c.attributes.barycentric,pt=c.attributes.color,g=i.row,s=i.column,oi=t.get("shading"),it=oi!=="color";gt?(wt=(g-1)*(s-1)*4,ot.init(wt),f&&ni.init(wt)):ot.value=new Float32Array(tt);pt.init(c.vertexCount);yt.init(c.vertexCount);var ht=[0,3,1,1,3,2],si=[[1,1,0,0],[0,1,0,1],[1,0,0,1],[1,0,1,0]],ti=c.indices=new(c.vertexCount>65535?Uint32Array:Uint16Array)((g-1)*(s-1)*6),bt=function(n,t,i){i[1]=n*s+t;i[0]=n*s+t+1;i[3]=(n+1)*s+t+1;i[2]=(n+1)*s+t},ct=!1;if(gt){var v=[],lt=[],hi=0;it?st.init(c.vertexCount):st.value=null;var rt=[[],[],[]],ii=[],ri=[],y=u.create(),ut=function(n,t,i){var r=t*3;return i[0]=n[r],i[1]=n[r+1],i[2]=n[r+2],i},p=new Float32Array(tt.length),ui=new Float32Array(tt.length/3*4);for(o=0;o<b.count();o++)if(b.hasValue(o))for(w=r.a.parseColor(b.getItemVisual(o,"color")),at=b.getItemVisual(o,"opacity"),w[3]*=at,w[3]<.99&&(ct=!0),e=0;e<4;e++)ui[o*4+e]=w[e];for(fi=[1e7,1e7,1e7],o=0;o<g-1;o++)for(l=0;l<s-1;l++){for(ft=o*(s-1)+l,k=ft*4,bt(o,l,v),vt=!1,e=0;e<4;e++)ut(tt,v[e],lt),h(lt)&&(vt=!0);for(e=0;e<4;e++)vt?ot.set(k+e,fi):(ut(tt,v[e],lt),ot.set(k+e,lt)),f&&ni.set(k+e,si[e]);for(e=0;e<6;e++)ti[hi++]=ht[e]+k;if(it&&!vt)for(e=0;e<2;e++){for(kt=e*3,a=0;a<3;a++)et=v[ht[kt]+a],ut(tt,et,rt[a]);for(u.sub(ii,rt[0],rt[1]),u.sub(ri,rt[1],rt[2]),u.cross(y,ii,ri),a=0;a<3;a++)nt=v[ht[kt]+a]*3,p[nt]=p[nt]+y[0],p[nt+1]=p[nt+1]+y[1],p[nt+2]=p[nt+2]+y[2]}}if(it)for(o=0;o<p.length/3;o++)ut(p,o,y),u.normalize(y,y),p[o*3]=y[0],p[o*3+1]=y[1],p[o*3+2]=y[2];for(w=[],d=[],o=0;o<g-1;o++)for(l=0;l<s-1;l++){for(ft=o*(s-1)+l,k=ft*4,bt(o,l,v),e=0;e<4;e++){for(a=0;a<4;a++)w[a]=ui[v[e]*4+a];pt.set(k+e,w);it&&(ut(p,v[e],y),st.set(k+e,y));et=v[e];d[0]=et%s/(s-1);d[1]=Math.floor(et/s)/(g-1);yt.set(k+e,d)}ft++}}else{for(d=[],o=0;o<b.count();o++)d[0]=o%s/(s-1),d[1]=Math.floor(o/s)/(g-1),w=r.a.parseColor(b.getItemVisual(o,"color")),at=b.getItemVisual(o,"opacity"),w[3]*=at,w[3]<.99&&(ct=!0),pt.set(o,w),yt.set(o,d);for(v=[],ei=0,o=0;o<g-1;o++)for(l=0;l<s-1;l++)for(bt(o,l,v),e=0;e<6;e++)ti[ei++]=v[ht[e]];it?c.generateVertexNormals():st.value=null}n.material.get("normalMap")&&c.generateTangents();c.updateBoundingBox();c.dirty();n.material.transparent=ct;n.material.depthMask=!ct},_getDataShape:function(n,t){for(var f,e=-Infinity,o=0,i=0,r=0,s=t?"u":"x",u=0;u<n.count();u++){if(f=n.get(s,u),f<e){if(r&&r!==i&&!0)throw new Error("Invalid data. data should be a row major 2d array.");r=i;i=0;o++}e=f;i++}return{row:o+1,column:i}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";var r=i(0),u=i.n(r);u.a.registerLayout(function(n){n.eachSeriesByType("surface",function(n){var t=n.coordinateSystem,u,f;t&&t.type==="cartesian3D"||!0&&console.error("Surface chart only support cartesian3D coordinateSystem");var i=n.getData(),r=new Float32Array(3*i.count()),e=[NaN,NaN,NaN];t&&t.type==="cartesian3D"&&(u=t.dimensions,f=u.map(function(t){return n.coordDimToDataDim(t)[0]}),i.each(f,function(n,u,f,o){var s;s=i.hasValue(o)?t.dataToPoint([n,u,f]):e;r[o*3]=s[0];r[o*3+1]=s[1];r[o*3+2]=s[2]}));i.setLayout("points",r)})})},function(n,t,i){"use strict";var u=i(0),r=i.n(u),e=i(99),o=i(257),s=i(258),f=i(17);r.a.registerVisual(Object(f.a)("map3D"));r.a.registerAction({type:"map3DChangeCamera",event:"map3dcamerachanged",update:"series:updateCamera"},function(n,t){t.eachComponent({mainType:"series",subType:"map3D",query:n},function(t){t.setView(n)})})},function(n,t,i){"use strict";function f(n,t){for(var r=[],i=0;i<t.length;i++)r.push(n.dataToPoint(t[i]));return r}var e=i(0),r=i.n(e),o=i(44),s=i(28),h=i(29),c=i(31),l=i(96),a=i(32),v=i(39),y=i(98),u=r.a.extendSeriesModel({type:"series.map3D",layoutMode:"box",coordinateSystem:null,visualColorAccessPath:"itemStyle.color",optionUpdated:function(n){var t,r,i;(n=n||{},t=this.get("coordinateSystem"),t!=null&&t!=="geo3D")&&(!0&&(r=["left","top","width","height","boxWidth","boxDepth","boxHeight","light","viewControl","postEffect","temporalSuperSampling","environment","groundPlane"],i=[],r.forEach(function(t){n[t]!=null&&i.push(t)}),i.length&&console.warn("Property %s in map3D series will be ignored if coordinate system is %s",i.join(", "),t)),this.get("groundPlane.show")&&(this.option.groundPlane.show=!1),this._geo=null)},getInitialData:function(n){var u,t,i;return n.data=this.getFilledRegions(n.data,n.map),u=r.a.helper.completeDimensions(["value"],n.data),t=new r.a.List(u,this),t.initData(n.data),i={},t.each(function(n){var r=t.getName(n),u=t.getItemModel(n);i[r]=u}),this._regionModelMap=i,t},formatTooltip:function(n){return Object(v.a)(this,n)},getRegionModel:function(n){var t=this.getData().getName(n);return this._regionModelMap[t]||new r.a.Model(null,this)},getRegionPolygonCoords:function(n){var r=this.coordinateSystem,s=this.getData().getName(n),t,o,u,e;if(r.transform)return t=r.getRegion(s),t?t.geometries:[];for(this._geo||(this._geo=y.a.createGeo3D(this)),t=this._geo.getRegion(s),o=[],u=0;u<t.geometries.length;u++){var h=t.geometries[u],i=[],c=f(r,h.exterior);if(i&&i.length)for(e=0;e<h.interiors.length;e++)i.push(f(r,i[e]));o.push({interiors:i,exterior:c})}return o},getFormattedLabel:function(n,t){var i=a.a.getFormattedLabel(this,n,t);return i==null&&(i=this.getData().getName(n)),i},defaultOption:{coordinateSystem:"geo3D",data:null}}),p;r.a.util.merge(u.prototype,l.a);r.a.util.merge(u.prototype,o.a);r.a.util.merge(u.prototype,s.a);r.a.util.merge(u.prototype,h.a);r.a.util.merge(u.prototype,c.a);p=u},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(1),e=i(45),o=i(30),s=i(64),h=u.a.extendChartView({type:"map3D",__ecgl__:!0,init:function(n,t){this._geo3DBuilder=new s.a(t);this.groupGL=new f.a.Node},render:function(n,t,i){var r=n.coordinateSystem,f,u,s,h;if(r&&r.viewGL){if(this.groupGL.add(this._geo3DBuilder.rootNode),r.viewGL.add(this.groupGL),r.type==="geo3D"){f=r;this._sceneHelper||(this._sceneHelper=new o.a,this._sceneHelper.initLight(this.groupGL));this._sceneHelper.setScene(r.viewGL.scene);this._sceneHelper.updateLight(n);r.viewGL.setPostEffect(n.getModel("postEffect"),i);r.viewGL.setTemporalSuperSampling(n.getModel("temporalSuperSampling"));u=this._control;u||(u=this._control=new e.a({zr:i.getZr()}),this._control.init());s=n.getModel("viewControl");u.setViewGL(r.viewGL);u.setFromViewControlModel(s,0);u.off("update");u.on("update",function(){i.dispatchAction({type:"map3DChangeCamera",alpha:u.getAlpha(),beta:u.getBeta(),distance:u.getDistance(),from:this.uid,map3DId:n.id})});this._geo3DBuilder.extrudeY=!0}else this._control&&(this._control.dispose(),this._control=null),this._sceneHelper&&(this._sceneHelper.dispose(),this._sceneHelper=null),f=n.getData().getLayout("geo3D"),this._geo3DBuilder.extrudeY=!1;this._geo3DBuilder.update(n,t,i,0,n.getData().count());h=r.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(n){n.material&&n.material[h]("fragment","SRGB_DECODE")})}},afterRender:function(n,t,i,r){var u=r.renderer,f=n.coordinateSystem;f&&f.type==="geo3D"&&(this._sceneHelper.updateAmbientCubemap(u,n,i),this._sceneHelper.updateSkybox(u,n,i))},dispose:function(){this.groupGL.removeAll();this._control.dispose()}})},function(n,t,i){"use strict";var u=i(0),r=i.n(u),s=i(260),h=i(261),f=i(51),e=i.n(f),o=i(17);r.a.registerVisual(e()("scatterGL","circle",null));r.a.registerVisual(Object(o.a)("scatterGL"));r.a.registerLayout({seriesType:"scatterGL",reset:function(n){var r=n.coordinateSystem,u,i,t;return r&&(i=r.dimensions,t=[],i.length===1?u=function(n,t){for(var f=new Float32Array((n.end-n.start)*2),u=n.start;u<n.end;u++){var e=(u-n.start)*2,s=t.get(i[0],u),o=r.dataToPoint(s);f[e]=o[0];f[e+1]=o[1]}t.setLayout("points",f)}:i.length===2&&(u=function(n,u){for(var e=new Float32Array((n.end-n.start)*2),f=n.start;f<n.end;f++){var o=(f-n.start)*2,s=u.get(i[0],f),h=u.get(i[1],f);t[0]=s;t[1]=h;t=r.dataToPoint(t);e[o]=t[0];e[o+1]=t[1]}u.setLayout("points",e)})),{progress:u}}})},function(n,t,i){"use strict";var u=i(0),r=i.n(u);r.a.extendSeriesModel({type:"series.scatterGL",dependencies:["grid","polar","geo","singleAxis"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){return r.a.helper.createList(this)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:!1,symbol:"circle",symbolSize:10,zoomScale:0,blendMode:"source-over",itemStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}})},function(n,t,i){"use strict";var u=i(0),f=i.n(u),e=i(1),o=i(22),r=i(67),s=i(103),h=i(2);f.a.extendChartView({type:"scatterGL",__ecgl__:!0,init:function(){this.groupGL=new e.a.Node;this.viewGL=new o.a("orthographic");this.viewGL.add(this.groupGL);this._pointsBuilderList=[];this._currentStep=0;this._sizeScale=1;this._glViewHelper=new s.a(this.viewGL)},render:function(n,t,i){if(this.groupGL.removeAll(),this._glViewHelper.reset(n,i),n.getData().count()){var u=this._pointsBuilderList[0];u||(u=this._pointsBuilderList[0]=new r.a(!0,i));this._pointsBuilderList.length=1;this.groupGL.add(u.rootNode);this._removeTransformInPoints(n.getData().getLayout("points"));u.update(n,t,i);this.viewGL.setPostEffect(n.getModel("postEffect"),i)}},incrementalPrepareRender:function(n,t,i){this.groupGL.removeAll();this._glViewHelper.reset(n,i);this._currentStep=0;this.viewGL.setPostEffect(n.getModel("postEffect"),i)},incrementalRender:function(n,t,i,u){if(!(n.end<=n.start)){var f=this._pointsBuilderList[this._currentStep];f||(f=new r.a(!0,u),this._pointsBuilderList[this._currentStep]=f);this.groupGL.add(f.rootNode);this._removeTransformInPoints(t.getData().getLayout("points"));f.setSizeScale(this._sizeScale);f.update(t,i,u,n.start,n.end);u.getZr().refresh();this._currentStep++}},updateTransform:function(n,t,i){if(n.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(n,i);var u=this._glViewHelper.getZoom(),r=Math.max((n.get("zoomScale")||0)*(u-1)+1,0);this._sizeScale=r;this._pointsBuilderList.forEach(function(n){n.setSizeScale(r)})}},_removeTransformInPoints:function(n){var i,t;if(n)for(i=[],t=0;t<n.length;t+=2)i[0]=n[t],i[1]=n[t+1],this._glViewHelper.removeTransformInPoint(i),n[t]=i[0],n[t+1]=i[1]},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(n,t,i){"use strict";function u(){}var f=i(0),r=i.n(f),h=i(263),c=i(268),e=i(51),o=i.n(e),s=i(17);r.a.registerVisual(o()("graphGL","circle",null));r.a.registerVisual(Object(s.a)("graphGL"));r.a.registerVisual(function(n){var t={};n.eachSeriesByType("graphGL",function(n){var i=n.getCategoriesData(),r=n.getData(),u={};i.each(function(r){var f=i.getName(r),e,o;u[f]=r;e=i.getItemModel(r);o=e.get("itemStyle.color")||n.getColorFromPalette(f,t);i.setItemVisual(r,"color",o)});i.count()&&r.each(function(n){var f=r.getItemModel(n),t=f.getShallow("category");t!=null&&(typeof t=="string"&&(t=u[t]),r.getItemVisual(n,"color",!0)||r.setItemVisual(n,"color",i.getItemVisual(t,"color")))})})});r.a.registerVisual(function(n){n.eachSeriesByType("graphGL",function(n){var u=n.getGraph(),t=n.getEdgeData(),i="lineStyle.color".split("."),r="lineStyle.opacity".split(".");t.setVisual("color",n.get(i));t.setVisual("opacity",n.get(r));t.each(function(n){var o=t.getItemModel(n),f=u.getEdgeByIndex(n),e=o.get(i),s=o.get(r);switch(e){case"source":e=f.node1.getVisual("color");break;case"target":e=f.node2.getVisual("color")}f.setVisual("color",e);f.setVisual("opacity",s)})})});r.a.registerAction({type:"graphGLRoam",event:"graphglroam",update:"series.graphGL:roam"},function(n,t){t.eachComponent({mainType:"series",query:n},function(t){t.setView(n)})});r.a.registerAction({type:"graphGLStartLayout",event:"graphgllayoutstarted",update:"series.graphGL:startLayout"},u);r.a.registerAction({type:"graphGLStopLayout",event:"graphgllayoutstopped",update:"series.graphGL:stopLayout"},u);r.a.registerAction({type:"graphGLFocusNodeAdjacency",event:"graphGLFocusNodeAdjacency",update:"series.graphGL:focusNodeAdjacency"},u);r.a.registerAction({type:"graphGLUnfocusNodeAdjacency",event:"graphGLUnfocusNodeAdjacency",update:"series.graphGL:unfocusNodeAdjacency"},u)},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(264),o=i(32),u=r.a.extendSeriesModel({type:"series.graphGL",visualColorAccessPath:"itemStyle.color",init:function(){u.superApply(this,"init",arguments);this.legendDataProvider=function(){return this._categoriesData};this._updateCategoriesData()},mergeOption:function(){u.superApply(this,"mergeOption",arguments);this._updateCategoriesData()},getFormattedLabel:function(n,t,i,r){var f=o.a.getFormattedLabel(this,n,t,i,r),u,e;return f==null&&(u=this.getData(),e=u.dimensions[u.dimensions.length-1],f=u.get(e,n)),f},getInitialData:function(n,t){function o(n,i){function o(n){return n=this.parsePath(n),n&&n[0]==="label"?e:this.parentModel}n.wrapMethod("getItemModel",function(n){var i=f._categoriesModels,r=n.getShallow("category"),t=i[r];return t&&(t.parentModel=n.parentModel,n.parentModel=t),n});var u=f.getModel("edgeLabel"),e=new r.a.Model({label:u.option},u.parentModel,t);i.wrapMethod("getItemModel",function(n){return n.customizeGetParent(o),n})}var i=n.edges||n.links||[],u=n.data||n.nodes||[],f=this;if(u&&i)return Object(e.a)(u,i,this,!0,o).data},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(n,t,i){if(i==="edge"){var e=this.getData(),o=this.getDataParams(n,i),s=e.graph.getEdgeByIndex(n),h=e.getName(s.node1.dataIndex),c=e.getName(s.node2.dataIndex),f=[];return h!=null&&f.push(h),c!=null&&f.push(c),f=r.a.format.encodeHTML(f.join(" > ")),o.value&&(f+=" : "+r.a.format.encodeHTML(o.value)),f}return u.superApply(this,"formatTooltip",arguments)},_updateCategoriesData:function(){var t=(this.option.categories||[]).map(function(n){return n.value!=null?n:r.a.util.extend({value:0},n)}),n=new r.a.List(["value"],this);n.initData(t);this._categoriesData=n;this._categoriesModels=n.mapArray(function(t){return n.getItemModel(t,!0)})},setView:function(n){n.zoom!=null&&(this.option.zoom=n.zoom);n.offset!=null&&(this.option.offset=n.offset)},setNodePosition:function(n){for(var t=0;t<n.length/2;t++){var r=n[t*2],u=n[t*2+1],i=this.getData().getRawDataItem(t);i.x=r;i.y=u}},isAnimationEnabled:function(){return u.superCall(this,"isAnimationEnabled")&&!(this.get("layout")==="force"&&this.get("force.layoutAnimation"))},defaultOption:{zlevel:10,z:2,legendHoverLink:!0,layout:"forceAtlas2",forceAtlas2:{initLayout:null,GPU:!0,steps:1,maxSteps:1e3,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:!1,gravityCenter:null},focusNodeAdjacency:!0,focusNodeAdjacencyOn:"mouseover",left:"center",top:"center",symbol:"circle",symbolSize:5,roam:!1,center:null,zoom:1,label:{show:!1,formatter:"{b}",position:"right",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{label:{show:!0}},animation:!1}}),s=u},function(n,t,i){"use strict";var f=i(0),r=i.n(f),e=i(265),o=i.n(e),s=i(267),h=i.n(s),u=i(2);t.a=function(n,t,i,f,e){for(var l,d,v,c=new o.a(f),s=0;s<n.length;s++)c.addNode(u.a.firstNotNull(n[s].id,n[s].name,s),s);var y=[],p=[],w=0;for(s=0;s<t.length;s++){var a=t[s],b=a.source,k=a.target;c.addEdge(b,k,w)&&(p.push(a),y.push(u.a.firstNotNull(a.id,b+" > "+k)),w++)}return d=r.a.helper.completeDimensions(["value"],n),l=new r.a.List(d,i),l.initData(n),v=new r.a.List(["value"],i),v.initData(p,y),e&&e(l,v),h()({mainData:l,struct:c,structAttr:"graph",datas:{node:l,edge:v},datasAttr:{node:"data",edge:"edgeData"}}),c.update(),c}},function(n,t,i){function f(n){return"_EC_"+n}function u(n,t){this.id=n==null?"":n;this.inEdges=[];this.outEdges=[];this.edges=[];this.hostGraph;this.dataIndex=t==null?-1:t}function o(n,t,i){this.node1=n;this.node2=t;this.dataIndex=i==null?-1:i}var a=i(104),y=a.__DEV__,h=i(13),v=i(266),c=v.enableClassCheck,e=function(n){this._directed=n||!1;this.nodes=[];this.edges=[];this._nodesMap={};this._edgesMap={};this.data;this.edgeData},r=e.prototype,s,l;r.type="graph";r.isDirected=function(){return this._directed};r.addNode=function(n,t){var r,i;if(n=n||""+t,r=this._nodesMap,!r[f(n)])return i=new u(n,t),i.hostGraph=this,this.nodes.push(i),r[f(n)]=i,i};r.getNodeByIndex=function(n){var t=this.data.getRawIndex(n);return this.nodes[t]};r.getNodeById=function(n){return this._nodesMap[f(n)]};r.addEdge=function(n,t,i){var s=this._nodesMap,h=this._edgesMap,e,r;if(typeof n=="number"&&(n=this.nodes[n]),typeof t=="number"&&(t=this.nodes[t]),u.isInstance(n)||(n=s[f(n)]),u.isInstance(t)||(t=s[f(t)]),n&&t)return(e=n.id+"-"+t.id,h[e])?void 0:(r=new o(n,t,i),r.hostGraph=this,this._directed&&(n.outEdges.push(r),t.inEdges.push(r)),n.edges.push(r),n!==t&&t.edges.push(r),this.edges.push(r),h[e]=r,r)};r.getEdgeByIndex=function(n){var t=this.edgeData.getRawIndex(n);return this.edges[t]};r.getEdge=function(n,t){u.isInstance(n)&&(n=n.id);u.isInstance(t)&&(t=t.id);var i=this._edgesMap;return this._directed?i[n+"-"+t]:i[n+"-"+t]||i[t+"-"+n]};r.eachNode=function(n,t){for(var r=this.nodes,u=r.length,i=0;i<u;i++)r[i].dataIndex>=0&&n.call(t,r[i],i)};r.eachEdge=function(n,t){for(var r=this.edges,u=r.length,i=0;i<u;i++)r[i].dataIndex>=0&&r[i].node1.dataIndex>=0&&r[i].node2.dataIndex>=0&&n.call(t,r[i],i)};r.breadthFirstTraverse=function(n,t,i,r){var a,s,h,l,e,c,o;if(u.isInstance(t)||(t=this._nodesMap[f(t)]),t){for(a=i==="out"?"outEdges":i==="in"?"inEdges":"edges",e=0;e<this.nodes.length;e++)this.nodes[e].__visited=!1;if(!n.call(r,t,null))for(s=[t];s.length;)for(h=s.shift(),l=h[a],e=0;e<l.length;e++)if(c=l[e],o=c.node1===h?c.node2:c.node1,!o.__visited){if(n.call(r,o,h))return;s.push(o);o.__visited=!0}}};r.update=function(){for(var f=this.data,i=this.edgeData,u=this.nodes,r=this.edges,n=0,t=u.length;n<t;n++)u[n].dataIndex=-1;for(n=0,t=f.count();n<t;n++)u[f.getRawIndex(n)].dataIndex=n;for(i.filterSelf(function(n){var t=r[i.getRawIndex(n)];return t.node1.dataIndex>=0&&t.node2.dataIndex>=0}),n=0,t=r.length;n<t;n++)r[n].dataIndex=-1;for(n=0,t=i.count();n<t;n++)r[i.getRawIndex(n)].dataIndex=n};r.clone=function(){for(var t,i=new e(this._directed),r=this.nodes,u=this.edges,n=0;n<r.length;n++)i.addNode(r[n].id,r[n].dataIndex);for(n=0;n<u.length;n++)t=u[n],i.addEdge(t.node1.id,t.node2.id,t.dataIndex);return i};u.prototype={constructor:u,degree:function(){return this.edges.length},inDegree:function(){return this.inEdges.length},outDegree:function(){return this.outEdges.length},getModel:function(n){if(!(this.dataIndex<0)){var t=this.hostGraph,i=t.data.getItemModel(this.dataIndex);return i.getModel(n)}}};o.prototype.getModel=function(n){if(!(this.dataIndex<0)){var t=this.hostGraph,i=t.edgeData.getItemModel(this.dataIndex);return i.getModel(n)}};s=function(n,t){return{getValue:function(i){var r=this[n][t];return r.get(r.getDimension(i||"value"),this.dataIndex)},setVisual:function(i,r){this.dataIndex>=0&&this[n][t].setItemVisual(this.dataIndex,i,r)},getVisual:function(i,r){return this[n][t].getItemVisual(this.dataIndex,i,r)},setLayout:function(i,r){this.dataIndex>=0&&this[n][t].setItemLayout(this.dataIndex,i,r)},getLayout:function(){return this[n][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[n][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[n][t].getRawIndex(this.dataIndex)}}};h.mixin(u,s("hostGraph","data"));h.mixin(o,s("hostGraph","edgeData"));e.Node=u;e.Edge=o;c(u);c(o);l=e;n.exports=l},function(n,t,i){function f(n){var t={main:"",sub:""};return n&&(n=n.split(o),t.main=n[0]||"",t.sub=n[1]||""),t}function s(n){u.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(n),'componentType "'+n+'" illegal')}function h(n){n.$constructor=n;n.extend=function(n){var i=this,t=function(){n.$constructor?n.$constructor.apply(this,arguments):i.apply(this,arguments)};return u.extend(t.prototype,n),t.extend=this.extend,t.superCall=a,t.superApply=v,u.inherits(t,this),t.superClass=i,t}}function l(n){var t=['__\0is_clz',c++,Math.random().toFixed(3)].join("_");n.prototype[t]=!0;n.isInstance=function(n){return!!(n&&n[t])}}function a(n,t){var i=u.slice(arguments,2);return this.superClass.prototype[t].apply(n,i)}function v(n,t,i){return this.superClass.prototype[t].apply(n,i)}function y(n,t){function o(n){var t=i[n.main];return t&&t[r]||(t=i[n.main]={},t[r]=!0),t}var i,e;return t=t||{},i={},n.registerClass=function(n,t){if(t)if(s(t),t=f(t),t.sub){if(t.sub!==r){var u=o(t);u[t.sub]=n}}else i[t.main]=n;return n},n.getClass=function(n,t,u){var f=i[n];if(f&&f[r]&&(f=t?f[t]:null),u&&!f)throw new Error(t?"Component "+n+"."+(t||"")+" not exists. Load it first.":n+".type should be specified.");return f},n.getClassesByMainType=function(n){n=f(n);var e=[],t=i[n.main];return t&&t[r]?u.each(t,function(n,t){t!==r&&e.push(n)}):e.push(t),e},n.hasClass=function(n){return n=f(n),!!i[n.main]},n.getAllClassMainTypes=function(){var n=[];return u.each(i,function(t,i){n.push(i)}),n},n.hasSubTypes=function(n){n=f(n);var t=i[n.main];return t&&t[r]},n.parseClassType=f,t.registerWhenExtend&&(e=n.extend,e&&(n.extend=function(t){var i=e.call(this,t);return n.registerClass(i,t.type)})),n}function p(){}var e=i(104),w=e.__DEV__,u=i(13),o=".",r="___EC__COMPONENT__CONTAINER___",c=0;t.parseClassType=f;t.enableClassExtend=h;t.enableClassCheck=l;t.enableClassManagement=y;t.setReadOnly=p},function(n,t,i){function h(n){var t=n.mainData,i=n.datas;i||(i={main:t},n.datasAttr={main:"data"});n.datas=n.mainData=null;s(t,i,n);u(i,function(i){u(t.TRANSFERABLE_METHODS,function(t){i.wrapMethod(t,r.curry(c,n))})});t.wrapMethod("cloneShallow",r.curry(a,n));u(t.CHANGABLE_METHODS,function(i){t.wrapMethod(i,r.curry(l,n))});r.assert(i[t.dataType]===t)}function c(n,t){if(y(this)){var i=r.extend({},this[f]);i[this.dataType]=t;s(t,i,n)}else o(t,this.dataType,this[e],n);return t}function l(n,t){return n.struct&&n.struct.update(this),t}function a(n,t){return u(t[f],function(i,r){i!==t&&o(i.cloneShallow(),r,t,n)}),t}function v(n){var t=this[e];return n==null||t==null?t:t[f][n]}function y(n){return n[e]===n}function s(n,t,i){n[f]={};u(t,function(t,r){o(t,r,n,i)})}function o(n,t,i,r){i[f][t]=n;n[e]=i;n.dataType=t;r.struct&&(n[r.structAttr]=r.struct,r.struct[r.datasAttr[t]]=n);n.getLinkedData=v}var r=i(13),u=r.each,f='\0__link_datas',e='\0__link_mainData',p=h;n.exports=p},function(n,t,i){"use strict";var l=i(0),e=i.n(l),a=i(47),v=i.n(a),r=i(1),y=i(22),p=i(105),u=i(2),o=i(269),s=i(271),w=i(80),h=i.n(w),b=i(6),k=i(273),d=i(67),g=i(274),f=b.a.vec2,c;r.a.Shader.import(g.a);c=1;e.a.extendChartView({type:"graphGL",__ecgl__:!0,init:function(n,t){this.groupGL=new r.a.Node;this.viewGL=new y.a("orthographic");this.viewGL.camera.left=this.viewGL.camera.right=0;this.viewGL.add(this.groupGL);this._pointsBuilder=new d.a(!0,t);this._forceEdgesMesh=new r.a.Mesh({material:new r.a.Material({shader:r.a.createShader("ecgl.forceAtlas2.edges"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new r.a.Geometry({attributes:{node:new r.a.Geometry.Attribute("node","float",2),color:new r.a.Geometry.Attribute("color","float",4,"COLOR")},dynamic:!0,mainAttribute:"node"}),renderOrder:-1,mode:r.a.Mesh.LINES});this._edgesMesh=new r.a.Mesh({material:new r.a.Material({shader:r.a.createShader("ecgl.meshLines2D"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new p.a({useNativeLine:!1,dynamic:!0}),renderOrder:-1,culling:!1});this._layoutId=0;this._control=new k.a({zr:t.getZr(),viewGL:this.viewGL});this._control.setTarget(this.groupGL);this._control.init();this._clickHandler=this._clickHandler.bind(this)},render:function(n,t,i){var r,f;this.groupGL.add(this._pointsBuilder.rootNode);this._model=n;this._api=i;this._initLayout(n,t,i);this._pointsBuilder.update(n,t,i);this._forceLayoutInstance instanceof o.a||this.groupGL.remove(this._forceEdgesMesh);this._updateCamera(n,i);this._control.off("update");this._control.on("update",function(){i.dispatchAction({type:"graphGLRoam",seriesId:n.id,zoom:this._control.getZoom(),offset:this._control.getOffset()});this._pointsBuilder.updateView(this.viewGL.camera)},this);if(this._control.setZoom(u.a.firstNotNull(n.get("zoom"),1)),this._control.setOffset(n.get("offset")||[0,0]),r=this._pointsBuilder.getPointsMesh(),r.off("mousemove",this._mousemoveHandler),r.off("mouseout",this._mouseOutHandler,this),i.getZr().off("click",this._clickHandler),this._pointsBuilder.highlightOnMouseover=!0,n.get("focusNodeAdjacency"))if(f=n.get("focusNodeAdjacencyOn"),f==="click")i.getZr().on("click",this._clickHandler);else if(f==="mouseover"){r.on("mousemove",this._mousemoveHandler,this);r.on("mouseout",this._mouseOutHandler,this);this._pointsBuilder.highlightOnMouseover=!1}else!0&&console.warn("Unkown focusNodeAdjacencyOn value s"+f);this._lastMouseOverDataIndex=-1},_clickHandler:function(){if(!this._layouting){var n=this._pointsBuilder.getPointsMesh().dataIndex;n>=0?this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:n}):this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id})}},_mousemoveHandler:function(n){if(!this._layouting){var t=this._pointsBuilder.getPointsMesh().dataIndex;t>=0?t!==this._lastMouseOverDataIndex&&this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:t}):this._mouseOutHandler(n);this._lastMouseOverDataIndex=t}},_mouseOutHandler:function(){this._layouting||(this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id}),this._lastMouseOverDataIndex=-1)},_updateForceEdgesGeometry:function(n,t){var i=this._forceEdgesMesh.geometry,e=t.getEdgeData(),f=0,o=this._forceLayoutInstance,s=e.count()*2;i.attributes.node.init(s);i.attributes.color.init(s);e.each(function(t){var s=n[t],c,h;i.attributes.node.set(f,o.getNodeUV(s.node1));i.attributes.node.set(f+1,o.getNodeUV(s.node2));c=e.getItemVisual(s.dataIndex,"color");h=r.a.parseColor(c);h[3]*=u.a.firstNotNull(e.getItemVisual(s.dataIndex,"opacity"),1);i.attributes.color.set(f,h);i.attributes.color.set(f+1,h);f+=2});i.dirty()},_updateMeshLinesGeometry:function(){var n=this._model.getEdgeData(),t=this._edgesMesh.geometry,n=this._model.getEdgeData(),i=this._model.getData().getLayout("points");t.resetOffset();t.setVertexCount(n.count()*t.getLineVertexCount());t.setTriangleCount(n.count()*t.getLineTriangleCount());var f=[],e=[],o=["lineStyle","width"];this._originalEdgeColors=new Float32Array(n.count()*4);this._edgeIndicesMap=new Float32Array(n.count());n.each(function(s){var h=n.graph.getEdgeByIndex(s),a=h.node1.dataIndex*2,v=h.node2.dataIndex*2,y,l,p,w,c;for(f[0]=i[a],f[1]=i[a+1],e[0]=i[v],e[1]=i[v+1],y=n.getItemVisual(h.dataIndex,"color"),l=r.a.parseColor(y),l[3]*=u.a.firstNotNull(n.getItemVisual(h.dataIndex,"opacity"),1),p=n.getItemModel(h.dataIndex),w=u.a.firstNotNull(p.get(o),1)*this._api.getDevicePixelRatio(),t.addLine(f,e,l,w),c=0;c<4;c++)this._originalEdgeColors[h.dataIndex*4+c]=l[c];this._edgeIndicesMap[h.dataIndex]=s},this);t.dirty()},_updateForceNodesGeometry:function(n){for(var i=this._pointsBuilder.getPointsMesh(),r=[],t=0;t<n.count();t++)this._forceLayoutInstance.getNodeUV(t,r),i.geometry.attributes.position.set(t,r);i.geometry.dirty("position")},_initLayout:function(n,t,i){var b=n.get("layout"),k=n.getGraph(),it=n.getBoxLayoutParams(),y=v.a.getLayoutRect(it,{width:i.getWidth(),height:i.getHeight()}),r,g,w,c,l;if(b==="force"&&(!0&&console.warn("Currently only forceAtlas2 layout supported."),b="forceAtlas2"),this.stopLayout(n,t,i,{beforeLayout:!0}),r=n.getData(),g=n.getData(),b==="forceAtlas2"){var p=n.getModel("forceAtlas2"),a=this._forceLayoutInstance,nt=[],tt=[],rt=r.getDataExtent("value"),ut=g.getDataExtent("value"),f=u.a.firstNotNull(p.get("edgeWeight"),1),h=u.a.firstNotNull(p.get("nodeWeight"),1);typeof f=="number"&&(f=[f,f]);typeof h=="number"&&(h=[h,h]);var l=0,d={},c=new Float32Array(r.count()*2);k.eachNode(function(n){var f=n.dataIndex,s=r.get("value",f),t,i,o,u;r.hasItemOption&&(o=r.getItemModel(f),t=o.get("x"),i=o.get("y"));t==null&&(t=y.x+Math.random()*y.width,i=y.y+Math.random()*y.height);c[l*2]=t;c[l*2+1]=i;d[n.id]=l++;u=e.a.number.linearMap(s,rt,h);isNaN(u)&&(u=isNaN(h[0])?1:h[0]);nt.push({x:t,y:i,mass:u,size:r.getItemVisual(f,"symbolSize")})});r.setLayout("points",c);k.eachEdge(function(n){var i=n.dataIndex,u=r.get("value",i),t=e.a.number.linearMap(u,ut,f);isNaN(t)&&(t=isNaN(f[0])?1:f[0]);tt.push({node1:d[n.node1.id],node2:d[n.node2.id],weight:t,dataIndex:i})});a||(w=p.get("GPU"),this._forceLayoutInstance&&((!w||this._forceLayoutInstance instanceof o.a)&&(w||this._forceLayoutInstance instanceof s.a)||(this._forceLayoutInstanceToDispose=this._forceLayoutInstance)),a=this._forceLayoutInstance=w?new o.a:new s.a);a.initData(nt,tt);a.updateOption(p.option);this._updateForceEdgesGeometry(a.getEdges(),n);this._updatePositionTexture();i.dispatchAction({type:"graphGLStartLayout",from:this.uid})}else c=new Float32Array(r.count()*2),l=0,k.eachNode(function(n){var f=n.dataIndex,i,u,t;r.hasItemOption&&(t=r.getItemModel(f),i=t.get("x"),u=t.get("y"));c[l++]=i;c[l++]=u}),r.setLayout("points",c),this._updateAfterLayout(n,t,i)},_updatePositionTexture:function(){var n=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(n);this._forceEdgesMesh.material.set("positionTex",n)},startLayout:function(n,t,i,r){if(!r||r.from==null||r.from===this.uid){var s=this.viewGL,i=this._api,f=this._forceLayoutInstance,v=this._model.getData(),l=this._model.getModel("forceAtlas2");if(!f){!0&&console.error("None layout don't have startLayout action");return}if(this.groupGL.remove(this._edgesMesh),this.groupGL.add(this._forceEdgesMesh),this._forceLayoutInstance){this._updateForceNodesGeometry(n.getData());this._pointsBuilder.hideLabels();var u=this,y=this._layoutId=c++,p=l.getShallow("maxSteps"),e=l.getShallow("steps"),o=0,w=Math.max(e*2,20),a=function(t){if(t===u._layoutId){if(f.isFinished(p)){i.dispatchAction({type:"graphGLStopLayout",from:u.uid});i.dispatchAction({type:"graphGLFinishLayout",points:v.getLayout("points"),from:u.uid});return}f.update(s.layer.renderer,e,function(){u._updatePositionTexture();o+=e;o>=w&&(u._syncNodePosition(n),o=0);i.getZr().refresh();h()(function(){a(t)})})}};h()(function(){u._forceLayoutInstanceToDispose&&(u._forceLayoutInstanceToDispose.dispose(s.layer.renderer),u._forceLayoutInstanceToDispose=null);a(y)});this._layouting=!0}}},stopLayout:function(n,t,i,r){r&&r.from!=null&&r.from!==this.uid||(this._layoutId=0,this.groupGL.remove(this._forceEdgesMesh),this.groupGL.add(this._edgesMesh),this._forceLayoutInstance)&&this.viewGL.layer&&(r&&r.beforeLayout||(this._syncNodePosition(n),this._updateAfterLayout(n,t,i)),this._api.getZr().refresh(),this._layouting=!1)},_syncNodePosition:function(n){var t=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);n.getData().setLayout("points",t);n.setNodePosition(t)},_updateAfterLayout:function(n,t,i){this._updateMeshLinesGeometry();this._pointsBuilder.removePositionTexture();this._pointsBuilder.updateLayout(n,t,i);this._pointsBuilder.updateView(this.viewGL.camera);this._pointsBuilder.updateLabels();this._pointsBuilder.showLabels()},focusNodeAdjacency:function(n,t,i,r){var o=this._model.getData(),e;this._downplayAll();var s=r.dataIndex,h=o.graph,u=[],f=h.getNodeByIndex(s);u.push(f);f.edges.forEach(function(n){n.dataIndex<0||(n.node1!==f&&u.push(n.node1),n.node2!==f&&u.push(n.node2))},this);this._pointsBuilder.fadeOutAll(.05);this._fadeOutEdgesAll(.05);u.forEach(function(n){this._pointsBuilder.highlight(o,n.dataIndex)},this);this._pointsBuilder.updateLabels(u.map(function(n){return n.dataIndex}));e=[];f.edges.forEach(function(n){n.dataIndex>=0&&(this._highlightEdge(n.dataIndex),e.push(n))},this);this._focusNodes=u;this._focusEdges=e},unfocusNodeAdjacency:function(){this._downplayAll();this._pointsBuilder.fadeInAll();this._fadeInEdgesAll();this._pointsBuilder.updateLabels()},_highlightEdge:function(n){var t=this._model.getEdgeData().getItemModel(n),i=r.a.parseColor(t.get("emphasis.lineStyle.color")||t.get("lineStyle.color")),f=u.a.firstNotNull(t.get("emphasis.lineStyle.opacity"),t.get("lineStyle.opacity"),1);i[3]*=f;this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[n],i)},_downplayAll:function(){this._focusNodes&&this._focusNodes.forEach(function(n){this._pointsBuilder.downplay(this._model.getData(),n.dataIndex)},this);this._focusEdges&&this._focusEdges.forEach(function(n){this._downplayEdge(n.dataIndex)},this)},_downplayEdge:function(n){var t=this._getColor(n,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[n],t)},_setEdgeFade:function(){var n=[];return function(t,i){this._getColor(t,n);n[3]*=i;this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[t],n)}}(),_getColor:function(n,t){for(var i=0;i<4;i++)t[i]=this._originalEdgeColors[n*4+i];return t},_fadeOutEdgesAll:function(n){var t=this._model.getData().graph;t.eachEdge(function(t){this._setEdgeFade(t.dataIndex,n)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(n,t){var h,e,a,o,c;this.viewGL.setViewport(0,0,t.getWidth(),t.getHeight(),t.getDevicePixelRatio());var i=this.viewGL.camera,v=n.getData(),l=v.getLayout("points"),r=f.create(Infinity,Infinity),u=f.create(-Infinity,-Infinity),s=[];for(h=0;h<l.length;)s[0]=l[h++],s[1]=l[h++],f.min(r,r,s),f.max(u,u,s);(e=(u[1]+r[1])/2,a=(u[0]+r[0])/2,a>i.left&&a<i.right&&e<i.bottom&&e>i.top)||(o=Math.max(u[0]-r[0],10),c=o/t.getWidth()*t.getHeight(),o*=1.4,c*=1.4,r[0]-=o*.2,i.left=r[0],i.top=e-c/2,i.bottom=e+c/2,i.right=o+r[0],i.near=0,i.far=100)},dispose:function(){var n=this.viewGL.layer.renderer;this._forceLayoutInstance&&this._forceLayoutInstance.dispose(n);this.groupGL.removeAll();this._layoutId=-1},remove:function(){this.groupGL.removeAll();this._control.dispose()}})},function(n,t,i){"use strict";function u(){var n={type:r.a.Texture.FLOAT,minFilter:r.a.Texture.NEAREST,magFilter:r.a.Texture.NEAREST},t;this._positionSourceTex=new r.a.Texture2D(n);this._positionSourceTex.flipY=!1;this._positionTex=new r.a.Texture2D(n);this._positionPrevTex=new r.a.Texture2D(n);this._forceTex=new r.a.Texture2D(n);this._forcePrevTex=new r.a.Texture2D(n);this._weightedSumTex=new r.a.Texture2D(n);this._weightedSumTex.width=this._weightedSumTex.height=1;this._globalSpeedTex=new r.a.Texture2D(n);this._globalSpeedPrevTex=new r.a.Texture2D(n);this._globalSpeedTex.width=this._globalSpeedTex.height=1;this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1;this._nodeRepulsionPass=new f.a({fragment:r.a.Shader.source("ecgl.forceAtlas2.updateNodeRepulsion")});this._positionPass=new f.a({fragment:r.a.Shader.source("ecgl.forceAtlas2.updatePosition")});this._globalSpeedPass=new f.a({fragment:r.a.Shader.source("ecgl.forceAtlas2.calcGlobalSpeed")});this._copyPass=new f.a({fragment:r.a.Shader.source("clay.compositor.output")});t=function(n){n.blendEquation(n.FUNC_ADD);n.blendFunc(n.ONE,n.ONE)};this._edgeForceMesh=new r.a.Mesh({geometry:new r.a.Geometry({attributes:{node1:new r.a.Geometry.Attribute("node1","float",2),node2:new r.a.Geometry.Attribute("node2","float",2),weight:new r.a.Geometry.Attribute("weight","float",1)},dynamic:!0,mainAttribute:"node1"}),material:new r.a.Material({transparent:!0,shader:r.a.createShader("ecgl.forceAtlas2.updateEdgeAttraction"),blend:t,depthMask:!1,depthText:!1}),mode:r.a.Mesh.POINTS});this._weightedSumMesh=new r.a.Mesh({geometry:new r.a.Geometry({attributes:{node:new r.a.Geometry.Attribute("node","float",2)},dynamic:!0,mainAttribute:"node"}),material:new r.a.Material({transparent:!0,shader:r.a.createShader("ecgl.forceAtlas2.calcWeightedSum"),blend:t,depthMask:!1,depthText:!1}),mode:r.a.Mesh.POINTS});this._framebuffer=new h.a({depthBuffer:!1});this._dummyCamera=new r.a.OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100});this._globalSpeed=0}var o=i(0),s=i.n(o),r=i(1),f=i(16),h=i(10),c=i(270),e;r.a.Shader.import(c.a);e={repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};u.prototype.updateOption=function(n){var r,t,u,i;for(t in e)this[t]=e[t];if(r=this._nodes.length,this.jitterTolerence=r>5e4?10:r>5e3?1:.1,this.scaling=r>100?2:10,n)for(t in e)n[t]!=null&&(this[t]=n[t]);if(this.repulsionByDegree)for(u=this._positionSourceTex.pixels,i=0;i<this._nodes.length;i++)u[i*4+2]=(this._nodes[i].degree||0)+1};u.prototype._updateGravityCenter=function(){var t=this._nodes,u=this._edges,i,r,n,f,e;if(this.gravityCenter)this._gravityCenter=this.gravityCenter;else{for(i=[Infinity,Infinity],r=[-Infinity,-Infinity],n=0;n<t.length;n++)i[0]=Math.min(t[n].x,i[0]),i[1]=Math.min(t[n].y,i[1]),r[0]=Math.max(t[n].x,r[0]),r[1]=Math.max(t[n].y,r[1]);this._gravityCenter=[(i[0]+r[0])*.5,(i[1]+r[1])*.5]}for(n=0;n<u.length;n++)f=u[n].node1,e=u[n].node2,t[f].degree=(t[f].degree||0)+1,t[e].degree=(t[e].degree||0)+1};u.prototype.initData=function(n,t){var s,h,f,r,e,u,c,a,i;this._nodes=n;this._edges=t;this._updateGravityCenter();var l=Math.ceil(Math.sqrt(n.length)),v=l,o=new Float32Array(l*v*4);for(this._resize(l,v),s=0,i=0;i<n.length;i++)h=n[i],o[s++]=h.x||0,o[s++]=h.y||0,o[s++]=h.mass||1,o[s++]=h.size||1;for(this._positionSourceTex.pixels=o,f=this._edgeForceMesh.geometry,r=t.length,f.attributes.node1.init(r*2),f.attributes.node2.init(r*2),f.attributes.weight.init(r*2),e=[],i=0;i<t.length;i++)u=f.attributes,c=t[i].weight,c==null&&(c=1),u.node1.set(i,this.getNodeUV(t[i].node1,e)),u.node2.set(i,this.getNodeUV(t[i].node2,e)),u.weight.set(i,c),u.node1.set(i+r,this.getNodeUV(t[i].node2,e)),u.node2.set(i+r,this.getNodeUV(t[i].node1,e)),u.weight.set(i+r,c);for(a=this._weightedSumMesh.geometry,a.attributes.node.init(n.length),i=0;i<n.length;i++)a.attributes.node.set(i,this.getNodeUV(i,e));f.dirty();a.dirty();this._nodeRepulsionPass.material.define("fragment","NODE_COUNT",n.length);this._nodeRepulsionPass.material.setUniform("textureSize",[l,v]);this._inited=!1;this._frame=0};u.prototype.getNodes=function(){return this._nodes};u.prototype.getEdges=function(){return this._edges};u.prototype.step=function(n){var t,i,u,f,r;this._inited||(this._initFromSource(n),this._inited=!0);this._frame++;this._framebuffer.attach(this._forceTex);this._framebuffer.bind(n);t=this._nodeRepulsionPass;t.setUniform("strongGravityMode",this.strongGravityMode);t.setUniform("gravity",this.gravity);t.setUniform("gravityCenter",this._gravityCenter);t.setUniform("scaling",this.scaling);t.setUniform("preventOverlap",this.preventOverlap);t.setUniform("positionTex",this._positionPrevTex);t.render(n);i=this._edgeForceMesh;i.material.set("linLogMode",this.linLogMode);i.material.set("edgeWeightInfluence",this.edgeWeightInfluence);i.material.set("preventOverlap",this.preventOverlap);i.material.set("positionTex",this._positionPrevTex);n.gl.enable(n.gl.BLEND);n.renderPass([i],this._dummyCamera);this._framebuffer.attach(this._weightedSumTex);n.gl.clearColor(0,0,0,0);n.gl.clear(n.gl.COLOR_BUFFER_BIT);n.gl.enable(n.gl.BLEND);u=this._weightedSumMesh;u.material.set("positionTex",this._positionPrevTex);u.material.set("forceTex",this._forceTex);u.material.set("forcePrevTex",this._forcePrevTex);n.renderPass([u],this._dummyCamera);this._framebuffer.attach(this._globalSpeedTex);f=this._globalSpeedPass;f.setUniform("globalSpeedPrevTex",this._globalSpeedPrevTex);f.setUniform("weightedSumTex",this._weightedSumTex);f.setUniform("jitterTolerence",this.jitterTolerence);n.gl.disable(n.gl.BLEND);f.render(n);r=this._positionPass;this._framebuffer.attach(this._positionTex);r.setUniform("globalSpeedTex",this._globalSpeedTex);r.setUniform("positionTex",this._positionPrevTex);r.setUniform("forceTex",this._forceTex);r.setUniform("forcePrevTex",this._forcePrevTex);r.render(n);this._framebuffer.unbind(n);this._swapTexture()};u.prototype.update=function(n,t,i){t==null&&(t=1);t=Math.max(t,1);for(var r=0;r<t;r++)this.step(n);i&&i()};u.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex};u.prototype.getNodeUV=function(n,t){t=t||[];var i=this._positionTex.width,r=this._positionTex.height;return t[0]=n%i/(i-1),t[1]=Math.floor(n/i)/(r-1)||0,t};u.prototype.getNodePosition=function(n,t){var r=this._positionArr,u=this._positionTex.width,f=this._positionTex.height,e=u*f,i;for(r&&r.length===e*4||(r=this._positionArr=new Float32Array(e*4)),this._framebuffer.bind(n),this._framebuffer.attach(this._positionPrevTex),n.gl.readPixels(0,0,u,f,n.gl.RGBA,n.gl.FLOAT,r),this._framebuffer.unbind(n),t||(t=new Float32Array(this._nodes.length*2)),i=0;i<this._nodes.length;i++)t[i*2]=r[i*4],t[i*2+1]=r[i*4+1];return t};u.prototype.getTextureData=function(n,t){var i=this["_"+t+"Tex"],u=i.width,f=i.height,r;return this._framebuffer.bind(n),this._framebuffer.attach(i),r=new Float32Array(u*f*4),n.gl.readPixels(0,0,u,f,n.gl.RGBA,n.gl.FLOAT,r),this._framebuffer.unbind(n),r};u.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}};u.prototype.isFinished=function(n){return this._frame>n};u.prototype._swapTexture=function(){var n=this._positionPrevTex;this._positionPrevTex=this._positionTex;this._positionTex=n;n=this._forcePrevTex;this._forcePrevTex=this._forceTex;this._forceTex=n;n=this._globalSpeedPrevTex;this._globalSpeedPrevTex=this._globalSpeedTex;this._globalSpeedTex=n};u.prototype._initFromSource=function(n){this._framebuffer.attach(this._positionPrevTex);this._framebuffer.bind(n);this._copyPass.setUniform("texture",this._positionSourceTex);this._copyPass.render(n);n.gl.clearColor(0,0,0,0);this._framebuffer.attach(this._forcePrevTex);n.gl.clear(n.gl.COLOR_BUFFER_BIT);this._framebuffer.attach(this._globalSpeedPrevTex);n.gl.clear(n.gl.COLOR_BUFFER_BIT);this._framebuffer.unbind(n)};u.prototype._resize=function(n,t){["_positionSourceTex","_positionTex","_positionPrevTex","_forceTex","_forcePrevTex"].forEach(function(i){this[i].width=n;this[i].height=t;this[i].dirty()},this)};u.prototype.dispose=function(n){this._framebuffer.dispose(n);this._copyPass.dispose(n);this._nodeRepulsionPass.dispose(n);this._positionPass.dispose(n);this._globalSpeedPass.dispose(n);this._edgeForceMesh.geometry.dispose(n);this._weightedSumMesh.geometry.dispose(n);this._positionSourceTex.dispose(n);this._positionTex.dispose(n);this._positionPrevTex.dispose(n);this._forceTex.dispose(n);this._forcePrevTex.dispose(n);this._weightedSumTex.dispose(n);this._globalSpeedTex.dispose(n);this._globalSpeedPrevTex.dispose(n)};s.a.ForceAtlas2GPU=u;t.a=u},function(n,t){"use strict";t.a="@export ecgl.forceAtlas2.updateNodeRepulsion\n\n#define NODE_COUNT 0\n\nuniform sampler2D positionTex;\n\nuniform vec2 textureSize;\nuniform float gravity;\nuniform float scaling;\nuniform vec2 gravityCenter;\n\nuniform bool strongGravityMode;\nuniform bool preventOverlap;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, v_Texcoord);\n\n vec2 force = vec2(0.0);\n for (int i = 0; i < NODE_COUNT; i++) {\n vec2 uv = vec2(\n mod(float(i), textureSize.x) / (textureSize.x - 1.0),\n floor(float(i) / textureSize.x) / (textureSize.y - 1.0)\n );\n vec4 n1 = texture2D(positionTex, uv);\n\n vec2 dir = n0.xy - n1.xy;\n float d2 = dot(dir, dir);\n\n if (d2 > 0.0) {\n float factor = 0.0;\n if (preventOverlap) {\n float d = sqrt(d2);\n d = d - n0.w - n1.w;\n if (d > 0.0) {\n factor = scaling * n0.z * n1.z / (d * d);\n }\n else if (d < 0.0) {\n factor = scaling * 100.0 * n0.z * n1.z;\n }\n }\n else {\n factor = scaling * n0.z * n1.z / d2;\n }\n force += dir * factor;\n }\n }\n\n vec2 dir = gravityCenter - n0.xy;\n float d = 1.0;\n if (!strongGravityMode) {\n d = length(dir);\n }\n\n force += dir * n0.z * gravity / (d + 1.0);\n\n gl_FragColor = vec4(force, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.vertex\n\nattribute vec2 node1;\nattribute vec2 node2;\nattribute float weight;\n\nuniform sampler2D positionTex;\nuniform float edgeWeightInfluence;\nuniform bool preventOverlap;\nuniform bool linLogMode;\n\nuniform vec2 windowSize: WINDOW_SIZE;\n\nvarying vec2 v_Force;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, node1);\n vec4 n1 = texture2D(positionTex, node2);\n\n vec2 dir = n1.xy - n0.xy;\n float d = length(dir);\n float w;\n if (edgeWeightInfluence == 0.0) {\n w = 1.0;\n }\n else if (edgeWeightInfluence == 1.0) {\n w = weight;\n }\n else {\n w = pow(weight, edgeWeightInfluence);\n }\n vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);\n vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);\n vec2 pos = node1 * scale * 2.0 - 1.0;\n gl_Position = vec4(pos + offset, 0.0, 1.0);\n gl_PointSize = 1.0;\n\n float factor;\n if (preventOverlap) {\n d = d - n1.w - n0.w;\n }\n if (d <= 0.0) {\n v_Force = vec2(0.0);\n return;\n }\n\n if (linLogMode) {\n factor = w * log(d) / d;\n }\n else {\n factor = w;\n }\n v_Force = dir * factor;\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.fragment\n\nvarying vec2 v_Force;\n\nvoid main() {\n gl_FragColor = vec4(v_Force, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.vertex\n\nattribute vec2 node;\n\nvarying vec2 v_NodeUv;\n\nvoid main() {\n\n v_NodeUv = node;\n gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n gl_PointSize = 1.0;\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.fragment\n\nvarying vec2 v_NodeUv;\n\nuniform sampler2D positionTex;\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_NodeUv).rg;\n vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;\n\n float mass = texture2D(positionTex, v_NodeUv).z;\n float swing = length(force - forcePrev) * mass;\n float traction = length(force + forcePrev) * 0.5 * mass;\n\n gl_FragColor = vec4(swing, traction, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcGlobalSpeed\n\nuniform sampler2D globalSpeedPrevTex;\nuniform sampler2D weightedSumTex;\nuniform float jitterTolerence;\n\nvoid main() {\n vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;\n float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;\n float globalSpeed = jitterTolerence * jitterTolerence\n * weightedSum.y / weightedSum.x;\n if (prevGlobalSpeed > 0.0) {\n globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;\n }\n gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updatePosition\n\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\nuniform sampler2D positionTex;\nuniform sampler2D globalSpeedTex;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_Texcoord).xy;\n vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;\n vec4 node = texture2D(positionTex, v_Texcoord);\n\n float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;\n float swing = length(force - forcePrev);\n float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));\n\n float df = length(force);\n if (df > 0.0) {\n speed = min(df * speed, 10.0) / df;\n\n gl_FragColor = vec4(node.xy + speed * force, node.zw);\n }\n else {\n gl_FragColor = node;\n }\n}\n@end\n\n@export ecgl.forceAtlas2.edges.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 node;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nuniform sampler2D positionTex;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(\n texture2D(positionTex, node).xy, -10.0, 1.0\n );\n v_Color = a_Color;\n}\n@end\n\n@export ecgl.forceAtlas2.edges.fragment\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nvarying vec4 v_Color;\nvoid main() {\n gl_FragColor = color * v_Color;\n}\n@end"},function(n,t,i){"use strict";var o=i(5),e=i(4),s=i(272),f=s.a.toString(),u,r;f=f.slice(f.indexOf("{")+1,f.lastIndexOf("}"));u={barnesHutOptimize:!0,barnesHutTheta:1.5,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};r=function(n){for(var t in u)this[t]=u[t];if(n)for(t in n)this[t]=n[t];this._nodes=[];this._edges=[];this._disposed=!1;this._positionTex=new o.a({type:e.a.FLOAT,flipY:!1,minFilter:e.a.NEAREST,magFilter:e.a.NEAREST})};r.prototype.initData=function(n,t){var w=new Blob([f]),b=window.URL.createObjectURL(w),r,i;this._worker=new Worker(b);this._worker.onmessage=this._$onupdate.bind(this);this._nodes=n;this._edges=t;this._frame=0;var e=n.length,l=t.length,o=new Float32Array(e*2),a=new Float32Array(e),v=new Float32Array(e),s=new Float32Array(l*2),y=new Float32Array(l);for(i=0;i<n.length;i++)r=n[i],o[i*2]=r.x,o[i*2+1]=r.y,a[i]=r.mass==null?1:r.mass,v[i]=r.size==null?1:r.size;for(i=0;i<t.length;i++){var u=t[i],k=u.node1,d=u.node2;s[i*2]=k;s[i*2+1]=d;y[i]=u.weight==null?1:u.weight}var h=Math.ceil(Math.sqrt(n.length)),p=h,g=new Float32Array(h*p*4),c=this._positionTex;c.width=h;c.height=p;c.pixels=g;this._worker.postMessage({cmd:"init",nodesPosition:o,nodesMass:a,nodesSize:v,edges:s,edgesWeight:y});this._globalSpeed=Infinity};r.prototype.updateOption=function(n){var r={},f,e,o,t,c,l;for(f in u)r[f]=u[f];var i=this._nodes,h=this._edges,s=i.length;if(r.jitterTolerence=s>5e4?10:s>5e3?1:.1,r.scaling=s>100?2:10,r.barnesHutOptimize=s>1e3?!0:!1,n)for(f in u)n[f]!=null&&(r[f]=n[f]);if(!r.gravityCenter){for(e=[Infinity,Infinity],o=[-Infinity,-Infinity],t=0;t<i.length;t++)e[0]=Math.min(i[t].x,e[0]),e[1]=Math.min(i[t].y,e[1]),o[0]=Math.max(i[t].x,o[0]),o[1]=Math.max(i[t].y,o[1]);r.gravityCenter=[(e[0]+o[0])*.5,(e[1]+o[1])*.5]}for(t=0;t<h.length;t++)c=h[t].node1,l=h[t].node2,i[c].degree=(i[c].degree||0)+1,i[l].degree=(i[l].degree||0)+1;this._worker&&this._worker.postMessage({cmd:"updateConfig",config:r})};r.prototype.update=function(n,t,i){t==null&&(t=1);t=Math.max(t,1);this._frame+=t;this._onupdate=i;this._worker&&this._worker.postMessage({cmd:"update",steps:Math.round(t)})};r.prototype._$onupdate=function(n){if(!this._disposed){var t=new Float32Array(n.data.buffer);this._globalSpeed=n.data.globalSpeed;this._positionArr=t;this._updateTexture(t);this._onupdate&&this._onupdate()}};r.prototype.getNodePositionTexture=function(){return this._positionTex};r.prototype.getNodeUV=function(n,t){t=t||[];var i=this._positionTex.width,r=this._positionTex.height;return t[0]=n%i/(i-1),t[1]=Math.floor(n/i)/(r-1),t};r.prototype.getNodes=function(){return this._nodes};r.prototype.getEdges=function(){return this._edges};r.prototype.isFinished=function(n){return this._frame>n};r.prototype.getNodePosition=function(n,t){if(t||(t=new Float32Array(this._nodes.length*2)),this._positionArr)for(var i=0;i<this._positionArr.length;i++)t[i]=this._positionArr[i];return t};r.prototype._updateTexture=function(n){for(var t=this._positionTex.pixels,i=0,r=0;r<n.length;)t[i++]=n[r++],t[i++]=n[r++],t[i++]=1,t[i++]=1;this._positionTex.dirty()};r.prototype.dispose=function(){this._disposed=!0;this._worker=null};t.a=r},function(n,t){"use strict";function i(){function u(){this.subRegions=[];this.nSubRegions=0;this.node=null;this.mass=0;this.centerOfMass=null;this.bbox=new Float32Array(4);this.size=0}function e(){this.position=new Float32Array(2);this.force=n.create();this.forcePrev=n.create();this.mass=1;this.inDegree=0;this.outDegree=0}function o(n,t){this.source=n;this.target=t;this.weight=1}function f(){this.autoSettings=!0;this.barnesHutOptimize=!0;this.barnesHutTheta=1.5;this.repulsionByDegree=!0;this.linLogMode=!1;this.strongGravityMode=!1;this.gravity=1;this.scaling=1;this.edgeWeightInfluence=1;this.jitterTolerence=.1;this.preventOverlap=!1;this.dissuadeHubs=!1;this.rootRegion=new u;this.rootRegion.centerOfMass=n.create();this.nodes=[];this.edges=[];this.bbox=new Float32Array(4);this.gravityCenter=null;this._massArr=null;this._swingingArr=null;this._sizeArr=null;this._globalSpeed=0}var n={create:function(){return new Float32Array(2)},dist:function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)},len:function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)},scaleAndAdd:function(n,t,i,r){return n[0]=t[0]+i[0]*r,n[1]=t[1]+i[1]*r,n},scale:function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n},add:function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n},sub:function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n},normalize:function(n,t){var r=t[0],u=t[1],i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i),n},negate:function(n,t){return n[0]=-t[0],n[1]=-t[1],n},copy:function(n,t){return n[0]=t[0],n[1]=t[1],n},set:function(n,t,i){return n[0]=t,n[1]=i,n}},r=u.prototype,t,i;r.beforeUpdate=function(){for(var n=0;n<this.nSubRegions;n++)this.subRegions[n].beforeUpdate();this.mass=0;this.centerOfMass&&(this.centerOfMass[0]=0,this.centerOfMass[1]=0);this.nSubRegions=0;this.node=null};r.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var n=0;n<this.nSubRegions;n++)this.subRegions[n].afterUpdate()};r.addNode=function(n){if(this.nSubRegions===0){if(this.node==null){this.node=n;return}this._addNodeToSubRegion(this.node);this.node=null}this._addNodeToSubRegion(n);this._updateCenterOfMass(n)};r.findSubRegion=function(n,t){for(var r,i=0;i<this.nSubRegions;i++)if(r=this.subRegions[i],r.contain(n,t))return r};r.contain=function(n,t){return this.bbox[0]<=n&&this.bbox[2]>=n&&this.bbox[1]<=t&&this.bbox[3]>=t};r.setBBox=function(n,t,i,r){this.bbox[0]=n;this.bbox[1]=t;this.bbox[2]=i;this.bbox[3]=r;this.size=(i-n+r-t)/2};r._newSubRegion=function(){var n=this.subRegions[this.nSubRegions];return n||(n=new u,this.subRegions[this.nSubRegions]=n),this.nSubRegions++,n};r._addNodeToSubRegion=function(n){var i=this.findSubRegion(n.position[0],n.position[1]),t=this.bbox;if(!i){var o=(t[0]+t[2])/2,s=(t[1]+t[3])/2,r=(t[2]-t[0])/2,u=(t[3]-t[1])/2,f=n.position[0]>=o?1:0,e=n.position[1]>=s?1:0,i=this._newSubRegion();i.setBBox(f*r+t[0],e*u+t[1],(f+1)*r+t[0],(e+1)*u+t[1])}i.addNode(n)};r._updateCenterOfMass=function(n){this.centerOfMass==null&&(this.centerOfMass=new Float32Array(2));var t=this.centerOfMass[0]*this.mass,i=this.centerOfMass[1]*this.mass;t+=n.position[0]*n.mass;i+=n.position[1]*n.mass;this.mass+=n.mass;this.centerOfMass[0]=t/this.mass;this.centerOfMass[1]=i/this.mass};t=f.prototype;t.initNodes=function(n,t,i){var o=t.length,f,r,u;for(this.nodes.length=0,f=typeof i!="undefined",r=0;r<o;r++)u=new e,u.position[0]=n[r*2],u.position[1]=n[r*2+1],u.mass=t[r],f&&(u.size=i[r]),this.nodes.push(u);this._massArr=t;this._swingingArr=new Float32Array(o);f&&(this._sizeArr=i)};t.initEdges=function(n,t){var e=n.length/2,i,f;for(this.edges.length=0,i=0;i<e;i++){var s=n[i*2],h=n[i*2+1],r=this.nodes[s],u=this.nodes[h];if(!r||!u){console.error("Node not exists, try initNodes before initEdges");return}r.outDegree++;u.inDegree++;f=new o(r,u);t&&(f.weight=t[i]);this.edges.push(f)}};t.updateSettings=function(){var n,t;if(this.repulsionByDegree)for(n=0;n<this.nodes.length;n++)t=this.nodes[n],t.mass=t.inDegree+t.outDegree+1;else for(n=0;n<this.nodes.length;n++)t=this.nodes[n],t.mass=this._massArr[n]};t.update=function(){var r=this.nodes.length,f,e,c,i,o,y,u,t;if(this.updateSettings(),this.updateBBox(),this.barnesHutOptimize){for(this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this.rootRegion.beforeUpdate(),t=0;t<r;t++)this.rootRegion.addNode(this.nodes[t]);this.rootRegion.afterUpdate()}for(t=0;t<r;t++)i=this.nodes[t],n.copy(i.forcePrev,i.force),n.set(i.force,0,0);for(t=0;t<r;t++){if(f=this.nodes[t],this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this.rootRegion,f);else for(e=t+1;e<r;e++)c=this.nodes[e],this.applyNodeToNodeRepulsion(f,c,!1);this.gravity>0&&(this.strongGravityMode?this.applyNodeStrongGravity(f):this.applyNodeGravity(f))}for(t=0;t<this.edges.length;t++)this.applyEdgeAttraction(this.edges[t]);var l=0,a=0,v=n.create();for(t=0;t<r;t++)i=this.nodes[t],o=n.dist(i.force,i.forcePrev),l+=o*i.mass,n.add(v,i.force,i.forcePrev),y=n.len(v)*.5,a+=y*i.mass,this._swingingArr[t]=o;for(u=this.jitterTolerence*this.jitterTolerence*a/l,this._globalSpeed>0&&(u=Math.min(u/this._globalSpeed,1.5)*this._globalSpeed),this._globalSpeed=u,t=0;t<r;t++){var i=this.nodes[t],o=this._swingingArr[t],s=.1*u/(1+u*Math.sqrt(o)),h=n.len(i.force);h>0&&(s=Math.min(h*s,10)/h,n.scaleAndAdd(i.position,i.position,i.force,s))}};t.applyRegionToNodeRepulsion=function(){var t=n.create();return function(i,r){var f,e,u;if(i.node)this.applyNodeToNodeRepulsion(i.node,r,!0);else if(n.sub(t,r.position,i.centerOfMass),f=t[0]*t[0]+t[1]*t[1],f>this.barnesHutTheta*i.size*i.size)e=this.scaling*r.mass*i.mass/f,n.scaleAndAdd(r.force,r.force,t,e);else for(u=0;u<i.nSubRegions;u++)this.applyRegionToNodeRepulsion(i.subRegions[u],r)}}();t.applyNodeToNodeRepulsion=function(){var t=n.create();return function(i,r){var e,f,u;if(i!=r&&(n.sub(t,i.position,r.position),e=t[0]*t[0]+t[1]*t[1],e!==0)){if(this.preventOverlap)if(u=Math.sqrt(e),u=u-i.size-r.size,u>0)f=this.scaling*i.mass*r.mass/(u*u);else if(u<0)f=this.scaling*100*i.mass*r.mass;else return;else f=this.scaling*i.mass*r.mass/e;n.scaleAndAdd(i.force,i.force,t,f);n.scaleAndAdd(r.force,r.force,t,-f)}}}();t.applyEdgeAttraction=function(){var t=n.create();return function(i){var u=i.source,f=i.target,r,e,o;(n.sub(t,u.position,f.position),r=n.len(t),e=this.edgeWeightInfluence===0?1:this.edgeWeightInfluence===1?i.weight:Math.pow(i.weight,this.edgeWeightInfluence),this.preventOverlap&&(r=r-u.size-f.size,r<=0))||(o=this.linLogMode?-e*Math.log(r+1)/(r+1):-e,n.scaleAndAdd(u.force,u.force,t,o),n.scaleAndAdd(f.force,f.force,t,-o))}}();t.applyNodeGravity=function(){var t=n.create();return function(i){n.sub(t,this.gravityCenter,i.position);var r=n.len(t);n.scaleAndAdd(i.force,i.force,t,this.gravity*i.mass/(r+1))}}();t.applyNodeStrongGravity=function(){var t=n.create();return function(i){n.sub(t,this.gravityCenter,i.position);n.scaleAndAdd(i.force,i.force,t,this.gravity*i.mass)}}();t.updateBBox=function(){for(var n,t=Infinity,i=Infinity,r=-Infinity,u=-Infinity,f=0;f<this.nodes.length;f++)n=this.nodes[f].position,t=Math.min(t,n[0]),i=Math.min(i,n[1]),r=Math.max(r,n[0]),u=Math.max(u,n[1]);this.bbox[0]=t;this.bbox[1]=i;this.bbox[2]=r;this.bbox[3]=u};t.getGlobalSpeed=function(){return this._globalSpeed};i=null;self.onmessage=function(n){var u,h,e,r,t,o,s;switch(n.data.cmd){case"init":i=new f;i.initNodes(n.data.nodesPosition,n.data.nodesMass,n.data.nodesSize);i.initEdges(n.data.edges,n.data.edgesWeight);break;case"updateConfig":if(i)for(u in n.data.config)i[u]=n.data.config[u];break;case"update":if(h=n.data.steps,i){for(t=0;t<h;t++)i.update();for(e=i.nodes.length,r=new Float32Array(e*2),t=0;t<e;t++)o=i.nodes[t],r[t*2]=o.position[0],r[t*2+1]=o.position[1];self.postMessage({buffer:r.buffer,globalSpeed:i.getGlobalSpeed()},[r.buffer])}else s=new Float32Array,self.postMessage({buffer:s.buffer,globalSpeed:i.getGlobalSpeed()},[s.buffer])}}}t.a=i},function(n,t,i){"use strict";var r=i(7),f=i(2),u=r.a.extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:!1,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this);this._mouseWheelHandler=this._mouseWheelHandler.bind(this);this._mouseMoveHandler=this._mouseMoveHandler.bind(this);this._mouseUpHandler=this._mouseUpHandler.bind(this);this._update=this._update.bind(this)},{init:function(){var n=this.zr;n.on("mousedown",this._mouseDownHandler);n.on("mousewheel",this._mouseWheelHandler);n.on("globalout",this._mouseUpHandler);n.animation.on("frame",this._update)},setTarget:function(n){this._target=n},setZoom:function(n){this._zoom=Math.max(Math.min(n,this.maxZoom),this.minZoom);this._needsUpdate=!0},setOffset:function(n){this._dx=n[0];this._dy=n[1];this._needsUpdate=!0},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){if(this._target&&this._needsUpdate){var n=this._target,t=this._zoom;n.position.x=this._dx;n.position.y=this._dy;n.scale.set(t,t,t);this.zr.refresh();this._needsUpdate=!1;this.trigger("update")}},_mouseDownHandler:function(n){var t,i,r;if(!n.target&&(t=n.offsetX,i=n.offsetY,!this.viewGL||this.viewGL.containPoint(t,i))){this.zr.on("mousemove",this._mouseMoveHandler);this.zr.on("mouseup",this._mouseUpHandler);r=this._convertPos(t,i);this._x=r.x;this._y=r.y}},_convertPos:function(n,t){var i=this.viewGL.camera,r=this.viewGL.viewport;return{x:(n-r.x)/r.width*(i.right-i.left)+i.left,y:(t-r.y)/r.height*(i.bottom-i.top)+i.top}},_mouseMoveHandler:function(n){var t=this._convertPos(n.offsetX,n.offsetY);this._dx+=t.x-this._x;this._dy+=t.y-this._y;this._x=t.x;this._y=t.y;this._needsUpdate=!0},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler);this.zr.off("mouseup",this._mouseUpHandler)},_mouseWheelHandler:function(n){var i,r,u,t,f;if((n=n.event,i=n.wheelDelta||-n.detail,i!==0)&&(r=n.offsetX,u=n.offsetY,!this.viewGL||this.viewGL.containPoint(r,u))){t=i>0?1.1:.9;f=Math.max(Math.min(this._zoom*t,this.maxZoom),this.minZoom);t=f/this._zoom;var e=this._convertPos(r,u),o=(e.x-this._dx)*(t-1),s=(e.y-this._dy)*(t-1);this._dx-=o;this._dy-=s;this._zoom=f;this._needsUpdate=!0}},dispose:function(){var n=this.zr;n.off("mousedown",this._mouseDownHandler);n.off("mousemove",this._mouseMoveHandler);n.off("mouseup",this._mouseUpHandler);n.off("mousewheel",this._mouseWheelHandler);n.off("globalout",this._mouseUpHandler);n.animation.off("frame",this._update)}});t.a=u},function(n,t){"use strict";t.a="@export ecgl.lines2D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.vertex\n\nattribute vec2 position: POSITION;\nattribute vec2 normal;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n p2.xy /= p2.w;\n gl_Position.xy /= gl_Position.w;\n\n vec2 N = normalize(p2.xy - gl_Position.xy);\n gl_Position.xy += N * offset / viewport.zw * 2.0;\n\n gl_Position.xy *= gl_Position.w;\n\n v_Color = a_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n\n@end"},function(n,t,i){"use strict";var r=i(0),u=i.n(r),f=i(276),e=i(280)},function(n,t,i){"use strict";var f=i(0),e=i.n(f),r=i(1),u=i(2),o=i(22),s=i(277);e.a.extendChartView({type:"flowGL",__ecgl__:!0,init:function(){this.viewGL=new o.a("orthographic");this.groupGL=new r.a.Node;this.viewGL.add(this.groupGL);this._particleSurface=new s.a;var n=new r.a.Mesh({geometry:new r.a.PlaneGeometry,material:new r.a.Material({shader:new r.a.Shader({vertex:r.a.Shader.source("ecgl.color.vertex"),fragment:r.a.Shader.source("ecgl.color.fragment")}),transparent:!0})});n.material.enableTexture("diffuseMap");this.groupGL.add(n);this._planeMesh=n},render:function(n,t,i){var f=this._particleSurface,o,h,c;f.setParticleType(n.get("particleType"));f.setSupersampling(n.get("supersampling"));this._updateData(n,i);this._updateCamera(i.getWidth(),i.getHeight(),i.getDevicePixelRatio());o=u.a.firstNotNull(n.get("particleDensity"),128);f.setParticleDensity(o,o);var e=this._planeMesh,s=+new Date,l=this,a=!0;e.__percent=0;e.stopAnimation();e.animate("",{loop:!0}).when(1e5,{__percent:1}).during(function(){var t=+new Date,n=Math.min(t-s,20);s=s+n;l._renderer&&(f.update(l._renderer,i,n/1e3,a),e.material.set("diffuseMap",f.getSurfaceTexture()));a=!1}).start();h=n.getModel("itemStyle");c=r.a.parseColor(h.get("color"));c[3]*=u.a.firstNotNull(h.get("opacity"),1);e.material.set("color",c);f.setColorTextureImage(n.get("colorTexture"),i);f.setParticleSize(n.get("particleSize"));f.particleSpeedScaling=n.get("particleSpeed");f.motionBlurFactor=1-Math.pow(.1,n.get("particleTrail"))},updateTransform:function(n,t,i){this._updateData(n,i)},afterRender:function(n,t,i,r){var u=r.renderer;this._renderer=u},_updateData:function(n,t){var v=n.coordinateSystem,h=v.dimensions.map(function(t){return n.coordDimToDataDim(t)[0]}),f=n.getData(),y=f.getDataExtent(h[0]),p=f.getDataExtent(h[1]),r=n.get("gridWidth"),e=n.get("gridHeight"),w,o,u,c;if((r==null||r==="auto")&&(w=(y[1]-y[0])/(p[1]-p[0]),r=Math.round(Math.sqrt(w*f.count()))),(e==null||e==="auto")&&(e=Math.ceil(f.count()/r)),o=this._particleSurface.vectorFieldTexture,u=o.pixels,u&&u.length===e*r*4)for(c=0;c<u.length;c++)u[c]=0;else u=o.pixels=new Float32Array(r*e*4);var s=0,a=Infinity,l=new Float32Array(f.count()*2),b=0,i=[[Infinity,Infinity],[-Infinity,-Infinity]];f.each([h[0],h[1],"vx","vy"],function(n,t,r,u){var f=v.dataToPoint([n,t]),e;l[b++]=f[0];l[b++]=f[1];i[0][0]=Math.min(f[0],i[0][0]);i[0][1]=Math.min(f[1],i[0][1]);i[1][0]=Math.max(f[0],i[1][0]);i[1][1]=Math.max(f[1],i[1][1]);e=Math.sqrt(r*r+u*u);s=Math.max(s,e);a=Math.min(a,e)});f.each(["vx","vy"],function(n,t,f){var h=Math.round((l[f*2]-i[0][0])/(i[1][0]-i[0][0])*(r-1)),c=e-1-Math.round((l[f*2+1]-i[0][1])/(i[1][1]-i[0][1])*(e-1)),o=(c*r+h)*4;u[o]=n/s*.5+.5;u[o+1]=t/s*.5+.5;u[o+3]=1});o.width=r;o.height=e;n.get("coordinateSystem")==="bmap"&&this._fillEmptyPixels(o);o.dirty();this._updatePlanePosition(i[0],i[1],n,t);this._updateGradientTexture(f.getVisual("visualMeta"),[a,s])},_fillEmptyPixels:function(n){function s(n,t,i){n=Math.max(Math.min(n,o-1),0);t=Math.max(Math.min(t,c-1),0);var u=(t*(o-1)+n)*4;return r[u+3]===0?!1:(i[0]=r[u],i[1]=r[u+1],!0)}function h(n,t,i){i[0]=n[0]+t[0];i[1]=n[1]+t[1]}for(var i,e,r=n.pixels,o=n.width,c=n.height,t=[],l=[],a=[],v=[],y=[],u=0,f=0;f<c;f++)for(i=0;i<o;i++)e=(f*(o-1)+i)*4,r[e+3]===0&&(u=t[0]=t[1]=0,s(i-1,f,l)&&(u++,h(l,t,t)),s(i+1,f,a)&&(u++,h(a,t,t)),s(i,f-1,v)&&(u++,h(v,t,t)),s(i,f+1,y)&&(u++,h(y,t,t)),t[0]/=u,t[1]/=u,r[e]=t[0],r[e+1]=t[1]),r[e+3]=1},_updateGradientTexture:function(n,t){var f,i,u,e;if(!n||!n.length){this._particleSurface.setGradientTexture(null);return}this._gradientTexture=this._gradientTexture||new r.a.Texture2D({image:document.createElement("canvas")});f=this._gradientTexture;i=f.image;i.width=200;i.height=1;u=i.getContext("2d");e=u.createLinearGradient(0,.5,i.width,.5);n[0].stops.forEach(function(n){var i;t[1]===t[0]?i=0:(i=n.value/t[1],i=Math.min(Math.max(i,0),1));e.addColorStop(i,n.color)});u.fillStyle=e;u.fillRect(0,0,i.width,i.height);f.dirty();this._particleSurface.setGradientTexture(this._gradientTexture)},_updatePlanePosition:function(n,t,i,r){var u=this._limitInViewportAndFullFill(n,t,i,r),f,e;n=u.leftTop;t=u.rightBottom;this._particleSurface.setRegion(u.region);this._planeMesh.position.set((n[0]+t[0])/2,r.getHeight()-(n[1]+t[1])/2,0);f=t[0]-n[0];e=t[1]-n[1];this._planeMesh.scale.set(f/2,e/2,1);this._particleSurface.resize(Math.max(Math.min(f,2048),1),Math.max(Math.min(e,2048),1));this._renderer&&this._particleSurface.clearFrame(this._renderer)},_limitInViewportAndFullFill:function(n,t,i,r){var u=[Math.max(n[0],0),Math.max(n[1],0)],f=[Math.min(t[0],r.getWidth()),Math.min(t[1],r.getHeight())],e,s;i.get("coordinateSystem")==="bmap"&&(e=i.getData().getDataExtent(i.coordDimToDataDim("lng")[0]),s=Math.floor(e[1]-e[0])>=359,s&&(u[0]>0&&(u[0]=0),f[0]<r.getWidth()&&(f[0]=r.getWidth())));var h=t[0]-n[0],o=t[1]-n[1],l=f[0]-u[0],c=f[1]-u[1],a=[(u[0]-n[0])/h,1-c/o-(u[1]-n[1])/o,l/h,c/o];return{leftTop:u,rightBottom:f,region:a}},_updateCamera:function(n,t,i){this.viewGL.setViewport(0,0,n,t,i);var r=this.viewGL.camera;r.left=r.bottom=0;r.top=t;r.right=n;r.near=0;r.far=100;r.position.z=10},remove:function(){this._planeMesh.stopAnimation();this.groupGL.removeAll()},dispose:function(){this._renderer&&this._particleSurface.dispose(this._renderer);this.groupGL.removeAll()}})},function(n,t,i){"use strict";function w(n){var t=document.createElement("canvas"),i;return t.width=t.height=n,i=t.getContext("2d"),i.fillStyle="#fff",i.arc(n/2,n/2,n/2,0,Math.PI*2),i.fill(),t}var h=i(16),c=i(15),f=i(40),s=i(19),r=i(8),u=i(5),e=i(4),l=i(37),a=i(43),v=i(10),y=i(278),p=i(279),o;r.a["import"](p.a);o=function(){this.motionBlurFactor=.99;this.vectorFieldTexture=new u.a({type:e.a.FLOAT,flipY:!1});this.particleLife=[5,20];this._particleType="point";this._particleSize=1;this.particleColor=[1,1,1,1];this.particleSpeedScaling=1;this._thisFrameTexture=null;this._particlePass=null;this._spawnTexture=null;this._particleTexture0=null;this._particleTexture1=null;this._particlePointsMesh=null;this._surfaceFrameBuffer=null;this._elapsedTime=0;this._scene=null;this._camera=null;this._lastFrameTexture=null;this._supersampling=1;this._downsampleTextures=[];this._width=512;this._height=512;this.init()};o.prototype={constructor:o,init:function(){var n={type:e.a.FLOAT,minFilter:e.a.NEAREST,magFilter:e.a.NEAREST,useMipmap:!1};this._spawnTexture=new u.a(n);this._particleTexture0=new u.a(n);this._particleTexture1=new u.a(n);this._frameBuffer=new v.a({depthBuffer:!1});this._particlePass=new h.a({fragment:r.a.source("ecgl.vfParticle.particle.fragment")});this._particlePass.setUniform("velocityTexture",this.vectorFieldTexture);this._particlePass.setUniform("spawnTexture",this._spawnTexture);this._downsamplePass=new h.a({fragment:r.a.source("clay.compositor.downsample")});var i=new f.a({renderOrder:10,material:new s.a({shader:new r.a(r.a.source("ecgl.vfParticle.renderPoints.vertex"),r.a.source("ecgl.vfParticle.renderPoints.fragment"))}),mode:f.a.POINTS,geometry:new c.a({dynamic:!0,mainAttribute:"texcoord0"})}),o=new f.a({renderOrder:10,material:new s.a({shader:new r.a(r.a.source("ecgl.vfParticle.renderLines.vertex"),r.a.source("ecgl.vfParticle.renderLines.fragment"))}),geometry:new y.a,culling:!1}),t=new f.a({material:new s.a({shader:new r.a(r.a.source("ecgl.color.vertex"),r.a.source("ecgl.color.fragment"))}),geometry:new a.a});t.material.enableTexture("diffuseMap");this._particlePointsMesh=i;this._particleLinesMesh=o;this._lastFrameFullQuadMesh=t;this._camera=new l.a;this._thisFrameTexture=new u.a;this._lastFrameTexture=new u.a},setParticleDensity:function(n,t){for(var f,o,s=n*t,i=new Float32Array(s*4),r=0,u=this.particleLife,e=0;e<n;e++)for(f=0;f<t;f++,r++)i[r*4]=Math.random(),i[r*4+1]=Math.random(),i[r*4+2]=Math.random(),o=(u[1]-u[0])*Math.random()+u[0],i[r*4+3]=o;this._particleType==="line"?this._setLineGeometry(n,t):this._setPointsGeometry(n,t);this._spawnTexture.width=n;this._spawnTexture.height=t;this._spawnTexture.pixels=i;this._particleTexture0.width=this._particleTexture1.width=n;this._particleTexture0.height=this._particleTexture1.height=t;this._particlePass.setUniform("textureSize",[n,t])},_setPointsGeometry:function(n,t){var o=n*t,e=this._particlePointsMesh.geometry,f=e.attributes,i,r,u;for(f.texcoord0.init(o),i=0,r=0;r<n;r++)for(u=0;u<t;u++,i++)f.texcoord0.value[i*2]=r/n,f.texcoord0.value[i*2+1]=u/t;e.dirty()},_setLineGeometry:function(n,t){var f=n*t,i=this._getParticleMesh().geometry,r,u;for(i.setLineCount(f),i.resetOffset(),r=0;r<n;r++)for(u=0;u<t;u++)i.addLine([r/n,u/t]);i.dirty()},_getParticleMesh:function(){return this._particleType==="line"?this._particleLinesMesh:this._particlePointsMesh},update:function(n,t,i,r){var f=this._getParticleMesh(),e=this._frameBuffer,u=this._particlePass,o;r&&this._updateDownsampleTextures(n,t);f.material.set("size",this._particleSize*this._supersampling);f.material.set("color",this.particleColor);u.setUniform("speedScaling",this.particleSpeedScaling);e.attach(this._particleTexture1);u.setUniform("firstFrameTime",r?(this.particleLife[1]+this.particleLife[0])/2:0);u.setUniform("particleTexture",this._particleTexture0);u.setUniform("deltaTime",i);u.setUniform("elapsedTime",this._elapsedTime);u.render(n,e);f.material.set("particleTexture",this._particleTexture1);f.material.set("prevParticleTexture",this._particleTexture0);e.attach(this._thisFrameTexture);e.bind(n);n.gl.clear(n.gl.DEPTH_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT);o=this._lastFrameFullQuadMesh;o.material.set("diffuseMap",this._lastFrameTexture);o.material.set("color",[1,1,1,this.motionBlurFactor]);this._camera.update(!0);n.renderPass([o,f],this._camera);e.unbind(n);this._downsample(n);this._swapTexture();this._elapsedTime+=i},_downsample:function(n){var r=this._downsampleTextures;if(r.length!==0)for(var u=0,t=this._thisFrameTexture,i=r[u];i;)this._frameBuffer.attach(i),this._downsamplePass.setUniform("texture",t),this._downsamplePass.setUniform("textureSize",[t.width,t.height]),this._downsamplePass.render(n,this._frameBuffer),t=i,i=r[++u]},getSurfaceTexture:function(){var n=this._downsampleTextures;return n.length>0?n[n.length-1]:this._lastFrameTexture},setRegion:function(n){this._particlePass.setUniform("region",n)},resize:function(n,t){this._lastFrameTexture.width=n*this._supersampling;this._lastFrameTexture.height=t*this._supersampling;this._thisFrameTexture.width=n*this._supersampling;this._thisFrameTexture.height=t*this._supersampling;this._width=n;this._height=t},setParticleSize:function(n){var t=this._getParticleMesh();if(n<=2){t.material.disableTexture("spriteTexture");t.material.transparent=!1;return}this._spriteTexture||(this._spriteTexture=new u.a);this._spriteTexture.image&&this._spriteTexture.image.width===n||(this._spriteTexture.image=w(n),this._spriteTexture.dirty());t.material.transparent=!0;t.material.enableTexture("spriteTexture");t.material.set("spriteTexture",this._spriteTexture);this._particleSize=n},setGradientTexture:function(n){var t=this._getParticleMesh().material;t[n?"enableTexture":"disableTexture"]("gradientTexture");t.setUniform("gradientTexture",n)},setColorTextureImage:function(n,t){var i=this._getParticleMesh().material;i.setTextureImage("colorTexture",n,t,{flipY:!0})},setParticleType:function(n){this._particleType=n},clearFrame:function(n){var t=this._frameBuffer;t.attach(this._lastFrameTexture);t.bind(n);n.gl.clear(n.gl.DEPTH_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT);t.unbind(n)},setSupersampling:function(n){this._supersampling=n;this.resize(this._width,this._height)},_updateDownsampleTextures:function(n,t){for(var r=this._downsampleTextures,e=Math.max(Math.floor(Math.log(this._supersampling/t.getDevicePixelRatio())/Math.log(2)),0),f=2,o=this._width*this._supersampling,s=this._height*this._supersampling,i=0;i<e;i++)r[i]=r[i]||new u.a,r[i].width=o/f,r[i].height=s/f,f*=2;for(;i<r.length;i++)r[i].dispose(n);r.length=e},_swapTexture:function(){var n=this._particleTexture0;this._particleTexture0=this._particleTexture1;this._particleTexture1=n;n=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture;this._lastFrameTexture=n},dispose:function(n){n.disposeFrameBuffer(this._frameBuffer);n.disposeTexture(this.vectorFieldTexture);n.disposeTexture(this._spawnTexture);n.disposeTexture(this._particleTexture0);n.disposeTexture(this._particleTexture1);n.disposeTexture(this._thisFrameTexture);n.disposeTexture(this._lastFrameTexture);n.disposeGeometry(this._particleLinesMesh.geometry);n.disposeGeometry(this._particlePointsMesh.geometry);n.disposeGeometry(this._lastFrameFullQuadMesh.geometry);this._spriteTexture&&n.disposeTexture(this._spriteTexture);this._particlePass.dispose(n);this._downsamplePass.dispose(n);this._downsampleTextures.forEach(function(t){t.dispose(n)})}};t.a=o},function(n,t,i){"use strict";var r=i(15),u=i(0),e=i.n(u),f=r.a.extend(function(){return{dynamic:!0,attributes:{position:new r.a.Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setLineCount:function(n){var r=this.attributes,i=4*n,t=2*n;this.vertexCount!==i&&r.position.init(i);this.triangleCount!==t&&(this.indices=t===0?null:this.vertexCount>65535?new Uint32Array(t*3):new Uint16Array(t*3))},addLine:function(n){var t=this._vertexOffset;this.attributes.position.set(t,[n[0],n[1],1]);this.attributes.position.set(t+1,[n[0],n[1],-1]);this.attributes.position.set(t+2,[n[0],n[1],2]);this.attributes.position.set(t+3,[n[0],n[1],-2]);this.setTriangleIndices(this._faceOffset++,[t,t+1,t+2]);this.setTriangleIndices(this._faceOffset++,[t+1,t+2,t+3]);this._vertexOffset+=4}});t.a=f},function(n,t){"use strict";t.a="@export ecgl.vfParticle.particle.fragment\n\nuniform sampler2D particleTexture;\nuniform sampler2D spawnTexture;\nuniform sampler2D velocityTexture;\n\nuniform float deltaTime;\nuniform float elapsedTime;\n\nuniform float speedScaling : 1.0;\n\nuniform vec2 textureSize;\nuniform vec4 region : [0, 0, 1, 1];\nuniform float firstFrameTime;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, v_Texcoord);\n bool spawn = false;\n if (p.w <= 0.0) {\n p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));\n p.w -= firstFrameTime;\n spawn = true;\n }\n vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;\n v = (v - 0.5) * 2.0;\n p.z = length(v);\n p.xy += v * deltaTime / 10.0 * speedScaling;\n p.w -= deltaTime;\n\n if (spawn || p.xy != fract(p.xy)) {\n p.z = 0.0;\n }\n p.xy = fract(p.xy);\n\n gl_FragColor = p;\n}\n@end\n\n@export ecgl.vfParticle.renderPoints.vertex\n\n#define PI 3.1415926\n\nattribute vec2 texcoord : TEXCOORD_0;\n\nuniform sampler2D particleTexture;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nuniform float size : 1.0;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, texcoord);\n\n if (p.w > 0.0 && p.z > 1e-5) {\n gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n\n v_Mag = p.z;\n v_Uv = p.xy;\n\n gl_PointSize = size;\n}\n\n@end\n\n@export ecgl.vfParticle.renderPoints.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\nuniform sampler2D spriteTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n#ifdef SPRITETEXTURE_ENABLED\n gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);\n if (color.a == 0.0) {\n discard;\n }\n#endif\n#ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.vertex\n\n#define PI 3.1415926\n\nattribute vec3 position : POSITION;\n\nuniform sampler2D particleTexture;\nuniform sampler2D prevParticleTexture;\n\nuniform float size : 1.0;\nuniform vec4 vp: VIEWPORT;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\n@import clay.util.rand\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, position.xy);\n vec4 p2 = texture2D(prevParticleTexture, position.xy);\n\n p.xy = p.xy * 2.0 - 1.0;\n p2.xy = p2.xy * 2.0 - 1.0;\n\n if (p.w > 0.0 && p.z > 1e-5) {\n vec2 dir = normalize(p.xy - p2.xy);\n vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;\n if (abs(position.z) == 2.0) {\n gl_Position = vec4(p.xy + norm, 0.0, 1.0);\n v_Uv = p.xy;\n v_Mag = p.z;\n }\n else {\n gl_Position = vec4(p2.xy + norm, 0.0, 1.0);\n v_Mag = p2.z;\n v_Uv = p2.xy;\n }\n gl_Position = worldViewProjection * gl_Position;\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n #ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n"},function(n,t,i){"use strict";var u=i(0),r=i.n(u);r.a.extendSeriesModel({type:"series.flowGL",dependencies:["geo","grid","bmap"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){var n=r.a.getCoordinateSystemDimensions(this.get("coordinateSystem"))||["x","y"],i,t;if(!0&&n.length>2)throw new Error("flowGL can only be used on 2d coordinate systems.");return n.push("vx","vy"),i=r.a.helper.completeDimensions(n,this.getSource(),{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")}),t=new r.a.List(i,this),t.initData(this.getSource()),t},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,supersampling:1,particleType:"point",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:"auto",gridHeight:"auto",itemStyle:{color:"#fff",opacity:.8}}})},function(n,t,i){"use strict";var r=i(0),u=i.n(r),e=i(282),o=i(283),f=i(17);u.a.registerVisual(Object(f.a)("linesGL"))},function(n,t,i){"use strict";var e=i(0),u=i.n(e),r=i(13),o=i.n(r),f=u.a.extendSeriesModel({type:"series.linesGL",dependencies:["grid","geo"],visualColorAccessPath:"lineStyle.color",streamEnabled:!0,init:function(n){var t=this._processFlatCoordsArray(n.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;t.flatCoords&&(n.data=new Float32Array(t.count));f.superApply(this,"init",arguments)},mergeOption:function(n){var t=this._processFlatCoordsArray(n.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;t.flatCoords&&(n.data=new Float32Array(t.count));f.superApply(this,"mergeOption",arguments)},appendData:function(n){var t=this._processFlatCoordsArray(n.data);t.flatCoords&&(this._flatCoords?(this._flatCoords=Object(r.concatArray)(this._flatCoords,t.flatCoords),this._flatCoordsOffset=Object(r.concatArray)(this._flatCoordsOffset,t.flatCoordsOffset)):(this._flatCoords=t.flatCoords,this._flatCoordsOffset=t.flatCoordsOffset),n.data=new Float32Array(t.count));this.getRawData().appendData(n.data)},_getCoordsFromItemModel:function(n){var i=this.getData().getItemModel(n),t=i.option instanceof Array?i.option:i.getShallow("coords");if(!0&&!(t instanceof Array&&t.length>0&&t[0]instanceof Array))throw new Error("Invalid coords "+JSON.stringify(t)+". Lines must have 2d coords array in data item.");return t},getLineCoordsCount:function(n){return this._flatCoordsOffset?this._flatCoordsOffset[n*2+1]:this._getCoordsFromItemModel(n).length},getLineCoords:function(n,t){var u,f,r,i;if(this._flatCoordsOffset){for(u=this._flatCoordsOffset[n*2],f=this._flatCoordsOffset[n*2+1],i=0;i<f;i++)t[i]=t[i]||[],t[i][0]=this._flatCoords[u+i*2],t[i][1]=this._flatCoords[u+i*2+1];return f}for(r=this._getCoordsFromItemModel(n),i=0;i<r.length;i++)t[i]=t[i]||[],t[i][0]=r[i][0],t[i][1]=r[i][1];return r.length},_processFlatCoordsArray:function(n){var h=0,t,o,s,l,a;if(this._flatCoords&&(h=this._flatCoords.length),typeof n[0]=="number"){var i=n.length,r=new Uint32Array(i),u=new Float64Array(i),f=0,e=0,c=0;for(t=0;t<i;)for(c++,o=n[t++],r[e++]=f+h,r[e++]=o,s=0;s<o;s++)if(l=n[t++],a=n[t++],u[f++]=l,u[f++]=a,t>i&&!0)throw new Error("Invalid data format.");return{flatCoordsOffset:new Uint32Array(r.buffer,0,e),flatCoords:u,count:c}}return{flatCoordsOffset:null,flatCoords:null,count:n.length}},getInitialData:function(n){var t=new u.a.List(["value"],this);return t.hasItemOption=!1,t.initData(n.data,[],function(n,i,r,u){if(n instanceof Array)return NaN;t.hasItemOption=!0;var f=n.value;if(f!=null)return f instanceof Array?f[u]:f}),t},defaultOption:{coordinateSystem:"geo",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:"source-over",lineStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}})},function(n,t,i){"use strict";var f=i(0),e=i.n(f),r=i(1),o=i(22),s=i(105),h=i(103),u=i(2);e.a.extendChartView({type:"linesGL",__ecgl__:!0,init:function(){this.groupGL=new r.a.Node;this.viewGL=new o.a("orthographic");this.viewGL.add(this.groupGL);this._glViewHelper=new h.a(this.viewGL);this._nativeLinesShader=r.a.createShader("ecgl.lines3D");this._meshLinesShader=r.a.createShader("ecgl.meshLines3D");this._linesMeshes=[];this._currentStep=0},render:function(n,t,i){this.groupGL.removeAll();this._glViewHelper.reset(n,i);var r=this._linesMeshes[0];r||(r=this._linesMeshes[0]=this._createLinesMesh(n));this._linesMeshes.length=1;this.groupGL.add(r);this._updateLinesMesh(n,r,0,n.getData().count());this.viewGL.setPostEffect(n.getModel("postEffect"),i)},incrementalPrepareRender:function(n,t,i){this.groupGL.removeAll();this._glViewHelper.reset(n,i);this._currentStep=0;this.viewGL.setPostEffect(n.getModel("postEffect"),i)},incrementalRender:function(n,t,i,r){var u=this._linesMeshes[this._currentStep];u||(u=this._createLinesMesh(t),this._linesMeshes[this._currentStep]=u);this._updateLinesMesh(t,u,n.start,n.end);this.groupGL.add(u);r.getZr().refresh();this._currentStep++},updateTransform:function(n,t,i){n.coordinateSystem.getRoamTransform&&this._glViewHelper.updateTransform(n,i)},_createLinesMesh:function(){return new r.a.Mesh({$ignorePicking:!0,material:new r.a.Material({shader:r.a.createShader("ecgl.lines3D"),transparent:!0,depthMask:!1,depthTest:!1}),geometry:new s.a({segmentScale:10,useNativeLine:!0,dynamic:!1}),mode:r.a.Mesh.LINES,culling:!1})},_updateLinesMesh:function(n,t,i,f){function et(){y[0]=e[0]*nt+o[0]*g-(e[1]-o[1])*l;y[1]=e[1]*nt+o[1]*g-(o[0]-e[0])*l;p[0]=e[0]*g+o[0]*nt-(e[1]-o[1])*l;p[1]=e[1]*g+o[1]*nt-(o[0]-e[0])*l}var it=n.getData(),ft,tt,v,c,ot,a,w;t.material.blend=n.get("blendMode")==="lighter"?r.a.additiveBlend:null;var l=n.get("lineStyle.curveness")||0,rt=n.get("polyline"),s=t.geometry,ut=n.coordinateSystem,b=u.a.firstNotNull(n.get("lineStyle.width"),1);b>1?(t.material.shader!==this._meshLinesShader&&t.material.attachShader(this._meshLinesShader),t.mode=r.a.Mesh.TRIANGLES):(t.material.shader!==this._nativeLinesShader&&t.material.attachShader(this._nativeLinesShader),t.mode=r.a.Mesh.LINES);i=i||0;f=f||it.count();s.resetOffset();var k=0,d=0,e=[],y=[],p=[],o=[],h=[],g=.3,nt=.7;if(rt||l!==0)for(c=i;c<f;c++)rt?(a=n.getLineCoordsCount(c),k+=s.getPolylineVertexCount(a),d+=s.getPolylineTriangleCount(a)):(n.getLineCoords(c,h),this._glViewHelper.dataToPoint(ut,h[0],e),this._glViewHelper.dataToPoint(ut,h[1],o),et(),k+=s.getCubicCurveVertexCount(e,y,p,o),d+=s.getCubicCurveTriangleCount(e,y,p,o));else ft=f-i,k+=ft*s.getLineVertexCount(),d+=ft*s.getLineVertexCount();for(s.setVertexCount(k),s.setTriangleCount(d),tt=i,v=[],c=i;c<f;c++){for(r.a.parseColor(it.getItemVisual(tt,"color"),v),ot=u.a.firstNotNull(it.getItemVisual(tt,"opacity"),1),v[3]*=ot,a=n.getLineCoords(c,h),w=0;w<a;w++)this._glViewHelper.dataToPoint(ut,h[w],h[w]);rt?s.addPolyline(h,v,b,0,a):l!==0?(e=h[0],o=h[1],et(),s.addCubicCurve(e,y,p,o,v,b)):s.addPolyline(h,v,b,0,2);tt++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})}])});
//# sourceMappingURL=echarts-gl.min.js.map
